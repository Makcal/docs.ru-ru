---
description: Дополнительные сведения о том, как создавать Часовые пояса с помощью правил коррекции.
title: Практическое руководство. Создание часовых поясов с правилами коррекции
ms.date: 04/10/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- time zones [.NET], creating
- time zones [.NET], and adjustment rules
- adjustment rule [.NET]
ms.assetid: c52ef192-13a9-435f-8015-3b12eae8c47c
ms.openlocfilehash: d581d01d9f9386adf99079f4f8f8e09585b06848
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99702773"
---
# <a name="how-to-create-time-zones-with-adjustment-rules"></a><span data-ttu-id="7498e-103">Практическое руководство. Создание часовых поясов с правилами коррекции</span><span class="sxs-lookup"><span data-stu-id="7498e-103">How to: Create time zones with adjustment rules</span></span>

<span data-ttu-id="7498e-104">Точные сведения о часовом поясе, необходимые для приложения, могут отсутствовать в определенной системе по нескольким причинам:</span><span class="sxs-lookup"><span data-stu-id="7498e-104">The precise time zone information that is required by an application may not be present on a particular system for several reasons:</span></span>

- <span data-ttu-id="7498e-105">Часовой пояс никогда не был определен в реестре локальной системы.</span><span class="sxs-lookup"><span data-stu-id="7498e-105">The time zone has never been defined in the local system's registry.</span></span>

- <span data-ttu-id="7498e-106">Данные о часовом поясе были изменены или удалены из реестра.</span><span class="sxs-lookup"><span data-stu-id="7498e-106">Data about the time zone has been modified or removed from the registry.</span></span>

- <span data-ttu-id="7498e-107">Часовой пояс не содержит точных сведений о корректировках часового пояса для определенного исторического периода.</span><span class="sxs-lookup"><span data-stu-id="7498e-107">The time zone does not have accurate information about time zone adjustments for a particular historic period.</span></span>

<span data-ttu-id="7498e-108">В таких случаях можно вызвать <xref:System.TimeZoneInfo.CreateCustomTimeZone%2A> метод, чтобы определить часовой пояс, необходимый для приложения.</span><span class="sxs-lookup"><span data-stu-id="7498e-108">In these cases, you can call the <xref:System.TimeZoneInfo.CreateCustomTimeZone%2A> method to define the time zone required by your application.</span></span> <span data-ttu-id="7498e-109">Перегрузки этого метода можно использовать для создания часового пояса с правилами коррекции или без них.</span><span class="sxs-lookup"><span data-stu-id="7498e-109">You can use the overloads of this method to create a time zone with or without adjustment rules.</span></span> <span data-ttu-id="7498e-110">Если часовой пояс поддерживает переход на летнее время, можно определить корректировки с помощью фиксированных или плавающих правил коррекции.</span><span class="sxs-lookup"><span data-stu-id="7498e-110">If the time zone supports daylight saving time, you can define adjustments with either fixed or floating adjustment rules.</span></span> <span data-ttu-id="7498e-111">(Определения этих терминов см. в подразделе «терминология часовых поясов» раздела « [Общие сведения о часовом поясе](time-zone-overview.md)».)</span><span class="sxs-lookup"><span data-stu-id="7498e-111">(For definitions of these terms, see the "Time Zone Terminology" section in [Time zone overview](time-zone-overview.md).)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7498e-112">Пользовательские часовые пояса, созданные путем вызова <xref:System.TimeZoneInfo.CreateCustomTimeZone%2A> метода, не добавляются в реестр.</span><span class="sxs-lookup"><span data-stu-id="7498e-112">Custom time zones created by calling the <xref:System.TimeZoneInfo.CreateCustomTimeZone%2A> method are not added to the registry.</span></span> <span data-ttu-id="7498e-113">Вместо этого доступ к ним можно получить только через ссылку на объект, возвращенную <xref:System.TimeZoneInfo.CreateCustomTimeZone%2A> вызовом метода.</span><span class="sxs-lookup"><span data-stu-id="7498e-113">Instead, they can be accessed only through the object reference returned by the <xref:System.TimeZoneInfo.CreateCustomTimeZone%2A> method call.</span></span>

<span data-ttu-id="7498e-114">В этом разделе показано, как создать часовой пояс с правилами коррекции.</span><span class="sxs-lookup"><span data-stu-id="7498e-114">This topic shows how to create a time zone with adjustment rules.</span></span> <span data-ttu-id="7498e-115">Сведения о создании часового пояса, не поддерживающего правила коррекции перехода на летнее время, см. [в разделе как создавать Часовые пояса без правил коррекции](create-time-zones-without-adjustment-rules.md).</span><span class="sxs-lookup"><span data-stu-id="7498e-115">To create a time zone that does not support daylight saving time adjustment rules, see [How to: Create Time Zones Without Adjustment Rules](create-time-zones-without-adjustment-rules.md).</span></span>

### <a name="to-create-a-time-zone-with-floating-adjustment-rules"></a><span data-ttu-id="7498e-116">Создание часового пояса с плавающими правилами коррекции</span><span class="sxs-lookup"><span data-stu-id="7498e-116">To create a time zone with floating adjustment rules</span></span>

1. <span data-ttu-id="7498e-117">Для каждой корректировки (т. е. для каждого перехода на зимнее и обратное время в течение определенного интервала времени) выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="7498e-117">For each adjustment (that is, for each transition away from and back to standard time over a particular time interval), do the following:</span></span>

    1. <span data-ttu-id="7498e-118">Определите начальное время перехода для коррекции часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-118">Define the starting transition time for the time zone adjustment.</span></span>

       <span data-ttu-id="7498e-119">Необходимо вызвать <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A?displayProperty=nameWithType> метод и передать ему <xref:System.DateTime> значение, определяющее время перехода, целочисленное значение, определяющее месяц перехода, целочисленное значение, определяющее неделю перехода, и <xref:System.DayOfWeek> значение, определяющее день недели, в который происходит переход.</span><span class="sxs-lookup"><span data-stu-id="7498e-119">You must call the <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A?displayProperty=nameWithType> method and pass it a <xref:System.DateTime> value that defines the time of the transition, an integer value that defines the month of the transition, an integer value that defines the week on which the transition occurs, and a <xref:System.DayOfWeek> value that defines the day of the week on which the transition occurs.</span></span> <span data-ttu-id="7498e-120">Этот вызов метода создает экземпляр <xref:System.TimeZoneInfo.TransitionTime> объекта.</span><span class="sxs-lookup"><span data-stu-id="7498e-120">This method call instantiates a <xref:System.TimeZoneInfo.TransitionTime> object.</span></span>

    2. <span data-ttu-id="7498e-121">Укажите время окончания перехода для коррекции часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-121">Define the ending transition time for the time zone adjustment.</span></span> <span data-ttu-id="7498e-122">Для этого требуется еще один вызов <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A?displayProperty=nameWithType> метода.</span><span class="sxs-lookup"><span data-stu-id="7498e-122">This requires another call to the <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="7498e-123">Этот вызов метода создает экземпляр второго <xref:System.TimeZoneInfo.TransitionTime> объекта.</span><span class="sxs-lookup"><span data-stu-id="7498e-123">This method call instantiates a second <xref:System.TimeZoneInfo.TransitionTime> object.</span></span>

    3. <span data-ttu-id="7498e-124">Вызовите <xref:System.TimeZoneInfo.AdjustmentRule.CreateAdjustmentRule%2A> метод и передайте ему действующие даты начала и окончания корректировки, <xref:System.TimeSpan> объект, определяющий время перехода, и два <xref:System.TimeZoneInfo.TransitionTime> объекта, которые определяют, когда происходят переходы на летнее время и обратно.</span><span class="sxs-lookup"><span data-stu-id="7498e-124">Call the <xref:System.TimeZoneInfo.AdjustmentRule.CreateAdjustmentRule%2A> method and pass it the effective start and end dates of the adjustment, a <xref:System.TimeSpan> object that defines the amount of time in the transition, and the two <xref:System.TimeZoneInfo.TransitionTime> objects that define when the transitions to and from daylight saving time occur.</span></span> <span data-ttu-id="7498e-125">Этот вызов метода создает экземпляр <xref:System.TimeZoneInfo.AdjustmentRule> объекта.</span><span class="sxs-lookup"><span data-stu-id="7498e-125">This method call instantiates a <xref:System.TimeZoneInfo.AdjustmentRule> object.</span></span>

    4. <span data-ttu-id="7498e-126">Назначьте <xref:System.TimeZoneInfo.AdjustmentRule> объект массиву <xref:System.TimeZoneInfo.AdjustmentRule> объектов.</span><span class="sxs-lookup"><span data-stu-id="7498e-126">Assign the <xref:System.TimeZoneInfo.AdjustmentRule> object to an array of <xref:System.TimeZoneInfo.AdjustmentRule> objects.</span></span>

2. <span data-ttu-id="7498e-127">Определите отображаемое имя часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-127">Define the time zone's display name.</span></span> <span data-ttu-id="7498e-128">Отображаемое имя соответствует довольно стандартному формату, в котором смещение часового пояса относительно времени в формате UTC заключено в круглые скобки. за ним следует строка, определяющая часовой пояс, один или несколько городов в часовом поясе, а также одну или несколько стран или регионов в часовом поясе.</span><span class="sxs-lookup"><span data-stu-id="7498e-128">The display name follows a fairly standard format in which the time zone's offset from Coordinated Universal Time (UTC) is enclosed in parentheses and is followed by a string that identifies the time zone, one or more of the cities in the time zone, or one or more of the countries or regions in the time zone.</span></span>

3. <span data-ttu-id="7498e-129">Определите имя стандартного времени часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-129">Define the name of the time zone's standard time.</span></span> <span data-ttu-id="7498e-130">Как правило, эта строка также используется в качестве идентификатора часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-130">Typically, this string is also used as the time zone's identifier.</span></span>

4. <span data-ttu-id="7498e-131">Определите название часового пояса (лето).</span><span class="sxs-lookup"><span data-stu-id="7498e-131">Define the name of the time zone's daylight time.</span></span>

5. <span data-ttu-id="7498e-132">Если вы хотите использовать другой идентификатор, отличный от стандартного имени часового пояса, определите идентификатор часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-132">If you want to use a different identifier than the time zone's standard name, define the time zone identifier.</span></span>

6. <span data-ttu-id="7498e-133">Создайте экземпляр <xref:System.TimeSpan> объекта, который определяет смещение часового пояса относительно времени в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="7498e-133">Instantiate a <xref:System.TimeSpan> object that defines the time zone's offset from UTC.</span></span> <span data-ttu-id="7498e-134">Часовые пояса со временем, превышающим время UTC, имеют положительное смещение.</span><span class="sxs-lookup"><span data-stu-id="7498e-134">Time zones with times that are later than UTC have a positive offset.</span></span> <span data-ttu-id="7498e-135">Часовые пояса со временем, предшествующим UTC, имеют отрицательное смещение.</span><span class="sxs-lookup"><span data-stu-id="7498e-135">Time zones with times that are earlier than UTC have a negative offset.</span></span>

7. <span data-ttu-id="7498e-136">Вызовите <xref:System.TimeZoneInfo.CreateCustomTimeZone%28System.String%2CSystem.TimeSpan%2CSystem.String%2CSystem.String%2CSystem.String%2CSystem.TimeZoneInfo.AdjustmentRule%5B%5D%29?displayProperty=nameWithType> метод, чтобы создать экземпляр нового часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-136">Call the <xref:System.TimeZoneInfo.CreateCustomTimeZone%28System.String%2CSystem.TimeSpan%2CSystem.String%2CSystem.String%2CSystem.String%2CSystem.TimeZoneInfo.AdjustmentRule%5B%5D%29?displayProperty=nameWithType> method to instantiate the new time zone.</span></span>

## <a name="example"></a><span data-ttu-id="7498e-137">Пример</span><span class="sxs-lookup"><span data-stu-id="7498e-137">Example</span></span>

<span data-ttu-id="7498e-138">В следующем примере определяется центральный стандартный часовой пояс для США, включающий правила коррекции для различных временных интервалов от 1918 до текущего.</span><span class="sxs-lookup"><span data-stu-id="7498e-138">The following example defines a Central Standard Time zone for the United States that includes adjustment rules for a variety of time intervals from 1918 to the present.</span></span>

[!code-csharp[System.TimeZone2.CreateTimeZone#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.CreateTimeZone/cs/System.TimeZone2.CreateTimeZone.cs#5)]
[!code-vb[System.TimeZone2.CreateTimeZone#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.CreateTimeZone/vb/System.TimeZone2.CreateTimeZone.vb#5)]

<span data-ttu-id="7498e-139">Часовой пояс, созданный в этом примере, имеет несколько правил коррекции.</span><span class="sxs-lookup"><span data-stu-id="7498e-139">The time zone created in this example has multiple adjustment rules.</span></span> <span data-ttu-id="7498e-140">Необходимо соблюдать осторожность, чтобы гарантировать, что действующие даты начала и окончания всех правил коррекции не перекрываются с датами другого правила коррекции.</span><span class="sxs-lookup"><span data-stu-id="7498e-140">Care must be taken to ensure that the effective start and end dates of any adjustment rule do not overlap with the dates of another adjustment rule.</span></span> <span data-ttu-id="7498e-141">Если перекрывается, <xref:System.InvalidTimeZoneException> создается исключение.</span><span class="sxs-lookup"><span data-stu-id="7498e-141">If there is an overlap, an <xref:System.InvalidTimeZoneException> is thrown.</span></span>

<span data-ttu-id="7498e-142">Для правил коррекции с плавающей запятой значение 5 передается в `week` параметр <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A> метода, чтобы указать, что переход выполняется в последнюю неделю конкретного месяца.</span><span class="sxs-lookup"><span data-stu-id="7498e-142">For floating adjustment rules, the value 5 is passed to the `week` parameter of the <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A> method to indicate that the transition occurs on the last week of a particular month.</span></span>

<span data-ttu-id="7498e-143">При создании массива <xref:System.TimeZoneInfo.AdjustmentRule> объектов для использования в <xref:System.TimeZoneInfo.CreateCustomTimeZone%28System.String%2CSystem.TimeSpan%2CSystem.String%2CSystem.String%2CSystem.String%2CSystem.TimeZoneInfo.AdjustmentRule%5B%5D%29?displayProperty=nameWithType> вызове метода код может инициализировать массив до размера, необходимого для количества корректировок, создаваемых для часового пояса.</span><span class="sxs-lookup"><span data-stu-id="7498e-143">In creating the array of <xref:System.TimeZoneInfo.AdjustmentRule> objects to use in the <xref:System.TimeZoneInfo.CreateCustomTimeZone%28System.String%2CSystem.TimeSpan%2CSystem.String%2CSystem.String%2CSystem.String%2CSystem.TimeZoneInfo.AdjustmentRule%5B%5D%29?displayProperty=nameWithType> method call, the code could initialize the array to the size required by the number of adjustments to be created for the time zone.</span></span> <span data-ttu-id="7498e-144">Вместо этого этот пример кода вызывает <xref:System.Collections.Generic.List%601.Add%2A> метод, чтобы добавить каждое правило коррекции в универсальную <xref:System.Collections.Generic.List%601> коллекцию <xref:System.TimeZoneInfo.AdjustmentRule> объектов.</span><span class="sxs-lookup"><span data-stu-id="7498e-144">Instead, this code example calls the <xref:System.Collections.Generic.List%601.Add%2A> method to add each adjustment rule to a generic <xref:System.Collections.Generic.List%601> collection of <xref:System.TimeZoneInfo.AdjustmentRule> objects.</span></span> <span data-ttu-id="7498e-145">Затем код вызывает метод, <xref:System.Collections.Generic.List%601.CopyTo%2A> чтобы скопировать члены этой коллекции в массив.</span><span class="sxs-lookup"><span data-stu-id="7498e-145">The code then calls the <xref:System.Collections.Generic.List%601.CopyTo%2A> method to copy the members of this collection to the array.</span></span>

<span data-ttu-id="7498e-146">В примере также используется <xref:System.TimeZoneInfo.TransitionTime.CreateFixedDateRule%2A> метод для определения корректировок фиксированной даты.</span><span class="sxs-lookup"><span data-stu-id="7498e-146">The example also uses the <xref:System.TimeZoneInfo.TransitionTime.CreateFixedDateRule%2A> method to define fixed-date adjustments.</span></span> <span data-ttu-id="7498e-147">Это похоже на вызов <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A> метода, за исключением того, что ему требуется только время, месяц и день параметров перехода.</span><span class="sxs-lookup"><span data-stu-id="7498e-147">This is similar to calling the <xref:System.TimeZoneInfo.TransitionTime.CreateFloatingDateRule%2A> method, except that it requires only the time, month, and day of the transition parameters.</span></span>

<span data-ttu-id="7498e-148">Пример можно протестировать с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="7498e-148">The example can be tested using code such as the following:</span></span>

[!code-csharp[System.TimeZone2.CreateTimeZone#7](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.CreateTimeZone/cs/System.TimeZone2.CreateTimeZone.cs#7)]
[!code-vb[System.TimeZone2.CreateTimeZone#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.CreateTimeZone/vb/System.TimeZone2.CreateTimeZone.vb#7)]

## <a name="compiling-the-code"></a><span data-ttu-id="7498e-149">Компиляция кода</span><span class="sxs-lookup"><span data-stu-id="7498e-149">Compiling the code</span></span>

<span data-ttu-id="7498e-150">Для этого примера требуются:</span><span class="sxs-lookup"><span data-stu-id="7498e-150">This example requires:</span></span>

- <span data-ttu-id="7498e-151">Для импорта следующих пространств имен:</span><span class="sxs-lookup"><span data-stu-id="7498e-151">That the following namespaces be imported:</span></span>

  [!code-csharp[System.TimeZone2.CreateTimeZone#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.TimeZone2.CreateTimeZone/cs/System.TimeZone2.CreateTimeZone.cs#6)]
  [!code-vb[System.TimeZone2.CreateTimeZone#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.TimeZone2.CreateTimeZone/vb/System.TimeZone2.CreateTimeZone.vb#6)]

## <a name="see-also"></a><span data-ttu-id="7498e-152">См. также</span><span class="sxs-lookup"><span data-stu-id="7498e-152">See also</span></span>

- [<span data-ttu-id="7498e-153">Даты, время и часовые пояса</span><span class="sxs-lookup"><span data-stu-id="7498e-153">Dates, times, and time zones</span></span>](index.md)
- [<span data-ttu-id="7498e-154">Общие сведения о часовых поясах</span><span class="sxs-lookup"><span data-stu-id="7498e-154">Time zone overview</span></span>](time-zone-overview.md)
- [<span data-ttu-id="7498e-155">Руководство. Создание часовых поясов без правил коррекции</span><span class="sxs-lookup"><span data-stu-id="7498e-155">How to: Create time zones without adjustment rules</span></span>](create-time-zones-without-adjustment-rules.md)
