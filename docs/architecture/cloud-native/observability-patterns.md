---
title: Шаблоны наблюдаемости
description: Шаблоны наблюдаемых приложений для облачных машин
ms.date: 01/19/2021
ms.openlocfilehash: acb1dc5c62787e9487c0e95c7e86a8f9a1967951
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99506023"
---
# <a name="observability-patterns"></a><span data-ttu-id="9c278-103">Шаблоны наблюдаемости</span><span class="sxs-lookup"><span data-stu-id="9c278-103">Observability patterns</span></span>

<span data-ttu-id="9c278-104">Так же, как шаблоны были разработаны для облегчения размещения кода в приложениях, существуют шаблоны для операционных приложений в надежном виде.</span><span class="sxs-lookup"><span data-stu-id="9c278-104">Just as patterns have been developed to aid in the layout of code in applications, there are patterns for operating applications in a reliable way.</span></span> <span data-ttu-id="9c278-105">Появилось три полезных шаблона обслуживания приложений: **ведение журнала**, **мониторинг** и **оповещения**.</span><span class="sxs-lookup"><span data-stu-id="9c278-105">Three useful patterns in maintaining applications have emerged: **logging**, **monitoring**, and **alerts**.</span></span>

## <a name="when-to-use-logging"></a><span data-ttu-id="9c278-106">Когда следует использовать ведение журнала</span><span class="sxs-lookup"><span data-stu-id="9c278-106">When to use logging</span></span>

<span data-ttu-id="9c278-107">Независимо от того, насколько внимательны мы, приложения практически всегда ведут себя неожиданным образом в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9c278-107">No matter how careful we are, applications almost always behave in unexpected ways in production.</span></span> <span data-ttu-id="9c278-108">Когда пользователи сообщают о проблемах с приложением, полезно иметь возможность увидеть, что произошло с приложением в момент возникновения проблемы.</span><span class="sxs-lookup"><span data-stu-id="9c278-108">When users report problems with an application, it's useful to be able to see what was going on with the app when the problem occurred.</span></span> <span data-ttu-id="9c278-109">Одним из наиболее удачных и верных способов записи информации о том, что делает приложение во время его работы, является то, что приложение записывает то, что выполняется.</span><span class="sxs-lookup"><span data-stu-id="9c278-109">One of the most tried and true ways of capturing information about what an application is doing while it's running is to have the application write down what it's doing.</span></span> <span data-ttu-id="9c278-110">Этот процесс называется ведением журнала.</span><span class="sxs-lookup"><span data-stu-id="9c278-110">This process is known as logging.</span></span> <span data-ttu-id="9c278-111">При возникновении неисправностей или проблем в рабочей среде цель должна состоять в том, чтобы воспроизводить условия, при которых произошел сбой, в нерабочем окружении.</span><span class="sxs-lookup"><span data-stu-id="9c278-111">Anytime failures or problems occur in production, the goal should be to reproduce the conditions under which the failures occurred, in a non-production environment.</span></span> <span data-ttu-id="9c278-112">Наличие хорошего ведения журнала — это стратегия, с помощью которой разработчики могут дублировать проблемы в среде, которую можно протестировать и поэкспериментировать с.</span><span class="sxs-lookup"><span data-stu-id="9c278-112">Having good logging in place provides a roadmap for developers to follow in order to duplicate problems in an environment that can be tested and experimented with.</span></span>

### <a name="challenges-when-logging-with-cloud-native-applications"></a><span data-ttu-id="9c278-113">Проблемы при ведении журналов с помощью собственных приложений в облаке</span><span class="sxs-lookup"><span data-stu-id="9c278-113">Challenges when logging with cloud-native applications</span></span>

<span data-ttu-id="9c278-114">В традиционных приложениях файлы журнала обычно хранятся на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="9c278-114">In traditional applications, log files are typically stored on the local machine.</span></span> <span data-ttu-id="9c278-115">Фактически, в операционных системах, аналогичных UNIX, определена структура папок для хранения журналов, обычно в `/var/log` .</span><span class="sxs-lookup"><span data-stu-id="9c278-115">In fact, on Unix-like operating systems, there's a folder structure defined to hold any logs, typically under `/var/log`.</span></span>

<span data-ttu-id="9c278-116">![Ведение журнала в файл в монолитном приложении. ](./media/single-monolith-logging.png)
 **Рис. 7-1**.</span><span class="sxs-lookup"><span data-stu-id="9c278-116">![Logging to a file in a monolithic app.](./media/single-monolith-logging.png)
**Figure 7-1**.</span></span> <span data-ttu-id="9c278-117">Ведение журнала в файл в монолитном приложении.</span><span class="sxs-lookup"><span data-stu-id="9c278-117">Logging to a file in a monolithic app.</span></span>

<span data-ttu-id="9c278-118">Полезность ведения журнала в неструктурированный файл на одном компьютере значительно снизилась в облачной среде.</span><span class="sxs-lookup"><span data-stu-id="9c278-118">The usefulness of logging to a flat file on a single machine is vastly reduced in a cloud environment.</span></span> <span data-ttu-id="9c278-119">Приложения, производящие журналы, могут не иметь доступа к локальному диску, или локальный диск может быть очень временным, так как контейнеры находятся на физических компьютерах.</span><span class="sxs-lookup"><span data-stu-id="9c278-119">Applications producing logs may not have access to the local disk or the local disk may be highly transient as containers are shuffled around physical machines.</span></span> <span data-ttu-id="9c278-120">Даже простое масштабирование монолитных приложений на нескольких узлах может усложнить Поиск соответствующего файла журнала на основе файлов.</span><span class="sxs-lookup"><span data-stu-id="9c278-120">Even simple scaling up of monolithic applications across multiple nodes can make it challenging to locate the appropriate file-based log file.</span></span>

<span data-ttu-id="9c278-121">![Ведение журнала для файлов в масштабируемом монолитном приложении. ](./media/multiple-node-monolith-logging.png)
 **Рис. 7-2**.</span><span class="sxs-lookup"><span data-stu-id="9c278-121">![Logging to files in a scaled monolithic app.](./media/multiple-node-monolith-logging.png)
**Figure 7-2**.</span></span> <span data-ttu-id="9c278-122">Ведение журнала для файлов в масштабируемом монолитном приложении.</span><span class="sxs-lookup"><span data-stu-id="9c278-122">Logging to files in a scaled monolithic app.</span></span>

<span data-ttu-id="9c278-123">Облачные приложения, разработанные с помощью архитектуры микрослужб, также сталкиваются с некоторыми трудностями при работе с средствами ведения журнала на основе файлов.</span><span class="sxs-lookup"><span data-stu-id="9c278-123">Cloud-native applications developed using a microservices architecture also pose some challenges for file-based loggers.</span></span> <span data-ttu-id="9c278-124">Теперь запросы пользователей могут охватывать несколько служб, которые выполняются на разных компьютерах, и могут включать бессерверные функции без доступа к локальной файловой системе.</span><span class="sxs-lookup"><span data-stu-id="9c278-124">User requests may now span multiple services that are run on different machines and may include serverless functions with no access to a local file system at all.</span></span> <span data-ttu-id="9c278-125">Соотнесение журналов от пользователя или сеанса между несколькими службами и компьютерами будет очень трудной задачей.</span><span class="sxs-lookup"><span data-stu-id="9c278-125">It would be very challenging to correlate the logs from a user or a session across these many services and machines.</span></span>

<span data-ttu-id="9c278-126">![Ведение журнала для локальных файлов в приложении микрослужб. ](./media/local-log-file-per-service.png)
 **Рис. 7-3**.</span><span class="sxs-lookup"><span data-stu-id="9c278-126">![Logging to local files in a microservices app.](./media/local-log-file-per-service.png)
**Figure 7-3**.</span></span> <span data-ttu-id="9c278-127">Ведение журнала для локальных файлов в приложении микрослужб.</span><span class="sxs-lookup"><span data-stu-id="9c278-127">Logging to local files in a microservices app.</span></span>

<span data-ttu-id="9c278-128">Наконец, число пользователей в некоторых облачных приложениях имеет большое значение.</span><span class="sxs-lookup"><span data-stu-id="9c278-128">Finally, the number of users in some cloud-native applications is high.</span></span> <span data-ttu-id="9c278-129">Представьте себе, что каждый пользователь создает сотни строк сообщений журнала при входе в приложение.</span><span class="sxs-lookup"><span data-stu-id="9c278-129">Imagine that each user generates a hundred lines of log messages when they log into an application.</span></span> <span data-ttu-id="9c278-130">В изоляции, это может быть управляемым, но более 100 000 пользователей и объем журналов достаточно велики, что для поддержки эффективного использования журналов требуются специализированные средства.</span><span class="sxs-lookup"><span data-stu-id="9c278-130">In isolation, that is manageable, but multiply that over 100,000 users and the volume of logs becomes large enough that specialized tools are needed to support effective use of the logs.</span></span>

### <a name="logging-in-cloud-native-applications"></a><span data-ttu-id="9c278-131">Ведение журнала в собственных облачных приложениях</span><span class="sxs-lookup"><span data-stu-id="9c278-131">Logging in cloud-native applications</span></span>

<span data-ttu-id="9c278-132">У каждого языка программирования есть средства, позволяющие записывать журналы, и обычно накладные расходы на запись этих журналов имеют низкий уровень.</span><span class="sxs-lookup"><span data-stu-id="9c278-132">Every programming language has tooling that permits writing logs, and typically the overhead for writing these logs is low.</span></span> <span data-ttu-id="9c278-133">Многие библиотеки ведения журналов предоставляют различные типы критических событий, которые можно настроить во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="9c278-133">Many of the logging libraries provide logging different kinds of criticalities, which can be tuned at run time.</span></span> <span data-ttu-id="9c278-134">Например, [Библиотека Serilog](https://serilog.net/) — это популярная структурированная библиотека ведения журнала для .NET, которая предоставляет следующие уровни ведения журнала:</span><span class="sxs-lookup"><span data-stu-id="9c278-134">For instance, the [Serilog library](https://serilog.net/) is a popular structured logging library for .NET that provides the following logging levels:</span></span>

* <span data-ttu-id="9c278-135">Подробный</span><span class="sxs-lookup"><span data-stu-id="9c278-135">Verbose</span></span>
* <span data-ttu-id="9c278-136">Отладка</span><span class="sxs-lookup"><span data-stu-id="9c278-136">Debug</span></span>
* <span data-ttu-id="9c278-137">Сведения</span><span class="sxs-lookup"><span data-stu-id="9c278-137">Information</span></span>
* <span data-ttu-id="9c278-138">Предупреждение</span><span class="sxs-lookup"><span data-stu-id="9c278-138">Warning</span></span>
* <span data-ttu-id="9c278-139">Ошибка</span><span class="sxs-lookup"><span data-stu-id="9c278-139">Error</span></span>
* <span data-ttu-id="9c278-140">Аварий</span><span class="sxs-lookup"><span data-stu-id="9c278-140">Fatal</span></span>

<span data-ttu-id="9c278-141">Эти различные уровни ведения журнала обеспечивают гранулярность ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="9c278-141">These different log levels provide granularity in logging.</span></span> <span data-ttu-id="9c278-142">Если приложение работает правильно в рабочей среде, оно может быть настроено на запись только важных сообщений.</span><span class="sxs-lookup"><span data-stu-id="9c278-142">When the application is functioning properly in production, it may be configured to only log important messages.</span></span> <span data-ttu-id="9c278-143">Если приложение работает неправильно, уровень журнала можно увеличить, чтобы собрать более подробные журналы.</span><span class="sxs-lookup"><span data-stu-id="9c278-143">When the application is misbehaving, then the log level can be increased so more verbose logs are gathered.</span></span> <span data-ttu-id="9c278-144">Это обеспечивает баланс производительности от простоты отладки.</span><span class="sxs-lookup"><span data-stu-id="9c278-144">This balances performance against ease of debugging.</span></span>

<span data-ttu-id="9c278-145">Высокая производительность средств ведения журнала и тунабилити уровня детализации должны рекомендовать разработчикам часто заноситься в журнал.</span><span class="sxs-lookup"><span data-stu-id="9c278-145">The high performance of logging tools and the tunability of verbosity should encourage developers to log frequently.</span></span> <span data-ttu-id="9c278-146">Многие применяют шаблон для регистрации входа и выхода каждого метода.</span><span class="sxs-lookup"><span data-stu-id="9c278-146">Many favor a pattern of logging the entry and exit of each method.</span></span> <span data-ttu-id="9c278-147">Такой подход может показаться избыточным, но нередко, что разработчики хотят уменьшить объем ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="9c278-147">This approach may sound like overkill, but it's infrequent that developers will wish for less logging.</span></span> <span data-ttu-id="9c278-148">На самом деле, не очень часто выполняются развертывания с целью добавления ведения журнала для проблемного метода.</span><span class="sxs-lookup"><span data-stu-id="9c278-148">In fact, it's not uncommon to perform deployments for the sole purpose of adding logging around a problematic method.</span></span> <span data-ttu-id="9c278-149">Ошибка на стороне слишком большого объема ведения журнала, а не слишком мало.</span><span class="sxs-lookup"><span data-stu-id="9c278-149">Err on the side of too much logging and not on too little.</span></span> <span data-ttu-id="9c278-150">Для автоматического предоставления такого рода журналов можно использовать некоторые средства.</span><span class="sxs-lookup"><span data-stu-id="9c278-150">Some tools can be used to automatically provide this kind of logging.</span></span>

<span data-ttu-id="9c278-151">Из-за проблем, связанных с использованием файловых журналов в облачных приложениях, рекомендуется использовать централизованные журналы.</span><span class="sxs-lookup"><span data-stu-id="9c278-151">Because of the challenges associated with using file-based logs in cloud-native apps, centralized logs are preferred.</span></span> <span data-ttu-id="9c278-152">Журналы собираются приложениями и передаются в центральное приложение ведения журнала, которое индексирует и хранит журналы.</span><span class="sxs-lookup"><span data-stu-id="9c278-152">Logs are collected by the applications and shipped to a central logging application which indexes and stores the logs.</span></span> <span data-ttu-id="9c278-153">Этот класс системы может каждый день получать десятки гигабайт журналов.</span><span class="sxs-lookup"><span data-stu-id="9c278-153">This class of system can ingest tens of gigabytes of logs every day.</span></span>

<span data-ttu-id="9c278-154">Кроме того, при создании журнала, охватывающего множество служб, полезно соблюдать некоторые стандартные рекомендации.</span><span class="sxs-lookup"><span data-stu-id="9c278-154">It's also helpful to follow some standard practices when building logging that spans many services.</span></span> <span data-ttu-id="9c278-155">Например, создание [идентификатора корреляции](https://blog.rapid7.com/2016/12/23/the-value-of-correlation-ids/) в начале длительного взаимодействия и последующее его ведение в каждом сообщении, связанном с этим взаимодействием, упрощает поиск всех связанных сообщений.</span><span class="sxs-lookup"><span data-stu-id="9c278-155">For instance, generating a [correlation ID](https://blog.rapid7.com/2016/12/23/the-value-of-correlation-ids/) at the start of a lengthy interaction, and then logging it in each message that is related to that interaction, makes it easier to search for all related messages.</span></span> <span data-ttu-id="9c278-156">Одна из них должна находить только одно сообщение и извлекать идентификатор корреляции, чтобы найти все связанные сообщения.</span><span class="sxs-lookup"><span data-stu-id="9c278-156">One need only find a single message and extract the correlation ID to find all the related messages.</span></span> <span data-ttu-id="9c278-157">Другой пример — обеспечение того, что формат журнала одинаков для каждой службы, независимо от используемого языка или библиотеки ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="9c278-157">Another example is ensuring that the log format is the same for every service, whatever the language or logging library it uses.</span></span> <span data-ttu-id="9c278-158">Эта стандартизация значительно упрощает чтение журналов.</span><span class="sxs-lookup"><span data-stu-id="9c278-158">This standardization makes reading logs much easier.</span></span> <span data-ttu-id="9c278-159">На рис. 7-4 показано, как архитектура микрослужб может использовать централизованное ведение журналов в рамках рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="9c278-159">Figure 7-4 demonstrates how a microservices architecture can leverage centralized logging as part of its workflow.</span></span>

<span data-ttu-id="9c278-160">![Журналы из различных источников принимаются в централизованное хранилище журналов. ](./media/centralized-logging.png)
 **Рис. 7-4**.</span><span class="sxs-lookup"><span data-stu-id="9c278-160">![Logs from various sources are ingested into a centralized log store.](./media/centralized-logging.png)
**Figure 7-4**.</span></span> <span data-ttu-id="9c278-161">Журналы из различных источников принимаются в централизованное хранилище журналов.</span><span class="sxs-lookup"><span data-stu-id="9c278-161">Logs from various sources are ingested into a centralized log store.</span></span>

## <a name="challenges-with-detecting-and-responding-to-potential-app-health-issues"></a><span data-ttu-id="9c278-162">Проблемы с обнаружением и реагированием на потенциальные проблемы работоспособности приложений</span><span class="sxs-lookup"><span data-stu-id="9c278-162">Challenges with detecting and responding to potential app health issues</span></span>

<span data-ttu-id="9c278-163">Некоторые приложения не являются критически важными.</span><span class="sxs-lookup"><span data-stu-id="9c278-163">Some applications aren't mission critical.</span></span> <span data-ttu-id="9c278-164">Возможно, они используются только внутри системы, и при возникновении проблемы пользователь может связаться с группой, которой он отвечает, и приложение можно перезапустить.</span><span class="sxs-lookup"><span data-stu-id="9c278-164">Maybe they're only used internally, and when a problem occurs, the user can contact the team responsible and the application can be restarted.</span></span> <span data-ttu-id="9c278-165">Однако клиенты часто имеют более высокие ожидания для используемых ими приложений.</span><span class="sxs-lookup"><span data-stu-id="9c278-165">However, customers often have higher expectations for the applications they consume.</span></span> <span data-ttu-id="9c278-166">Вам следует узнать, когда возникают проблемы с вашим приложением *перед тем* , как пользователи будут уведомлены.</span><span class="sxs-lookup"><span data-stu-id="9c278-166">You should know when problems occur with your application *before* users do, or before users notify you.</span></span> <span data-ttu-id="9c278-167">В противном случае, первое, что вы узнаете о проблеме, может быть замечено при обнаружении злость грудеа публикации социальных сетей, в которой размещается приложение или даже ваша организация.</span><span class="sxs-lookup"><span data-stu-id="9c278-167">Otherwise, the first you know about a problem may be when you notice an angry deluge of social media posts deriding your application or even your organization.</span></span>

<span data-ttu-id="9c278-168">В некоторых сценариях может потребоваться рассмотреть следующее:</span><span class="sxs-lookup"><span data-stu-id="9c278-168">Some scenarios you may need to consider include:</span></span>

- <span data-ttu-id="9c278-169">Одна служба в приложении сохраняет сбои и перезапуски, что приводит к периодическим медленным ответам.</span><span class="sxs-lookup"><span data-stu-id="9c278-169">One service in your application keeps failing and restarting, resulting in intermittent slow responses.</span></span>
- <span data-ttu-id="9c278-170">В некоторые моменты дня время ответа приложения будет задолго.</span><span class="sxs-lookup"><span data-stu-id="9c278-170">At some times of the day, your application's response time is slow.</span></span>
- <span data-ttu-id="9c278-171">После последнего развертывания нагрузка на базу данных перегружается.</span><span class="sxs-lookup"><span data-stu-id="9c278-171">After a recent deployment, load on the database has tripled.</span></span>

<span data-ttu-id="9c278-172">Наблюдение правильно реализовано. Мониторинг может помочь вам узнать об условиях, которые приведут к проблемам, позволяя устранить основные условия, прежде чем они приведут к значительным последствиям для пользователя.</span><span class="sxs-lookup"><span data-stu-id="9c278-172">Implemented properly, monitoring can let you know about conditions that will lead to problems, letting you address underlying conditions before they result in any significant user impact.</span></span>

### <a name="monitoring-cloud-native-apps"></a><span data-ttu-id="9c278-173">Мониторинг облачных приложений</span><span class="sxs-lookup"><span data-stu-id="9c278-173">Monitoring cloud-native apps</span></span>

<span data-ttu-id="9c278-174">Некоторые централизованные системы ведения журналов принимают дополнительную роль в сборе данных телеметрии за пределами чистых журналов.</span><span class="sxs-lookup"><span data-stu-id="9c278-174">Some centralized logging systems take on an additional role of collecting telemetry outside of pure logs.</span></span> <span data-ttu-id="9c278-175">Они могут получать метрики, такие как время выполнения запроса к базе данных, среднее время отклика с веб-сервера и даже средние нагрузки ЦП и нехватка памяти, сообщаемые операционной системой.</span><span class="sxs-lookup"><span data-stu-id="9c278-175">They can collect metrics, such as time to run a database query, average response time from a web server, and even CPU load averages and memory pressure as reported by the operating system.</span></span> <span data-ttu-id="9c278-176">В сочетании с журналами эти системы могут обеспечить целостное представление работоспособности узлов в системе и приложения в целом.</span><span class="sxs-lookup"><span data-stu-id="9c278-176">In conjunction with the logs, these systems can provide a holistic view of the health of nodes in the system and the application as a whole.</span></span>

<span data-ttu-id="9c278-177">Возможности сбора метрик для средств мониторинга можно также поставлять вручную в приложении.</span><span class="sxs-lookup"><span data-stu-id="9c278-177">The metric-gathering capabilities of the monitoring tools can also be fed manually from within the application.</span></span> <span data-ttu-id="9c278-178">Бизнес-последовательности, представляющие интерес, такие как регистрация новых пользователей или размещение заказов, могут быть инструментированы таким образом, что увеличивают счетчик в системе центрального мониторинга.</span><span class="sxs-lookup"><span data-stu-id="9c278-178">Business flows that are of particular interest such as new users signing up or orders being placed, may be instrumented such that they increment a counter in the central monitoring system.</span></span> <span data-ttu-id="9c278-179">Этот аспект разблокирует средства мониторинга, чтобы не только отслеживать работоспособность приложения, но и работоспособность бизнеса.</span><span class="sxs-lookup"><span data-stu-id="9c278-179">This aspect unlocks the monitoring tools to not only monitor the health of the application but the health of the business.</span></span>

<span data-ttu-id="9c278-180">Запросы можно создавать в средствах объединения журналов для поиска определенной статистики или закономерностей, которые затем могут отображаться в графической форме на пользовательских панелях мониторинга.</span><span class="sxs-lookup"><span data-stu-id="9c278-180">Queries can be constructed in the log aggregation tools to look for certain statistics or patterns, which can then be displayed in graphical form, on custom dashboards.</span></span> <span data-ttu-id="9c278-181">Часто группы будут вкладывать в большие, подключенные к стене экраны, которые поворачивают статистику, связанную с приложением.</span><span class="sxs-lookup"><span data-stu-id="9c278-181">Frequently, teams will invest in large, wall-mounted displays that rotate through the statistics related to an application.</span></span> <span data-ttu-id="9c278-182">Таким образом, можно легко увидеть проблемы по мере их возникновения.</span><span class="sxs-lookup"><span data-stu-id="9c278-182">This way, it's simple to see the problems as they occur.</span></span>

<span data-ttu-id="9c278-183">Облачные средства мониторинга обеспечивают телеметрию и анализ в реальном времени для приложений независимо от того, являются ли они однопроцессными монолитными приложениями или распределенными архитектурами микрослужб.</span><span class="sxs-lookup"><span data-stu-id="9c278-183">Cloud-native monitoring tools provide real-time telemetry and insight into apps regardless of whether they're single-process monolithic applications or distributed microservice architectures.</span></span> <span data-ttu-id="9c278-184">Они включают в себя средства, позволяющие собирать данные из приложения, а также средства для запроса и отображения сведений о работоспособности приложения.</span><span class="sxs-lookup"><span data-stu-id="9c278-184">They include tools that allow collection of data from the app as well as tools for querying and displaying information about the app's health.</span></span>

## <a name="challenges-with-reacting-to-critical-problems-in-cloud-native-apps"></a><span data-ttu-id="9c278-185">Проблемы, связанные с реагированием на критические проблемы в облачных приложениях</span><span class="sxs-lookup"><span data-stu-id="9c278-185">Challenges with reacting to critical problems in cloud-native apps</span></span>

<span data-ttu-id="9c278-186">Если вам нужно реагировать на проблемы с приложением, вам нужен какой – то способ оповещения о нужном сотруднике.</span><span class="sxs-lookup"><span data-stu-id="9c278-186">If you need to react to problems with your application, you need some way to alert the right personnel.</span></span> <span data-ttu-id="9c278-187">Это третий шаблон наблюдаемого приложения в собственном облаке, который зависит от ведения журнала и мониторинга.</span><span class="sxs-lookup"><span data-stu-id="9c278-187">This is the third cloud-native application observability pattern and depends on logging and monitoring.</span></span> <span data-ttu-id="9c278-188">Вашему приложению необходимо войти в систему, чтобы разрешить диагностику проблем, а в некоторых случаях передавать их в средства мониторинга.</span><span class="sxs-lookup"><span data-stu-id="9c278-188">Your application needs to have logging in place to allow problems to be diagnosed, and in some cases to feed into monitoring tools.</span></span> <span data-ttu-id="9c278-189">Он должен выполнять мониторинг для агрегирования метрик приложения и данных о работоспособности в одном месте.</span><span class="sxs-lookup"><span data-stu-id="9c278-189">It needs monitoring to aggregate application metrics and health data in one place.</span></span> <span data-ttu-id="9c278-190">После этого можно создать правила, которые активируют предупреждения, если определенные метрики выходят за пределы допустимых уровней.</span><span class="sxs-lookup"><span data-stu-id="9c278-190">Once this has been established, rules can be created that will trigger alerts when certain metrics fall outside of acceptable levels.</span></span>

<span data-ttu-id="9c278-191">Как правило, оповещения размещаются поверх наблюдения таким образом, что определенные условия инициируют соответствующие предупреждения, чтобы уведомлять членов группы о срочных проблемах.</span><span class="sxs-lookup"><span data-stu-id="9c278-191">Generally, alerts are layered on top of monitoring such that certain conditions trigger appropriate alerts to notify team members of urgent problems.</span></span> <span data-ttu-id="9c278-192">Ниже перечислены некоторые сценарии, которые могут потребовать оповещения.</span><span class="sxs-lookup"><span data-stu-id="9c278-192">Some scenarios that may require alerts include:</span></span>

- <span data-ttu-id="9c278-193">Одна из служб вашего приложения не отвечает через 1 минуту простоя.</span><span class="sxs-lookup"><span data-stu-id="9c278-193">One of your application's services is not responding after 1 minute of downtime.</span></span>
- <span data-ttu-id="9c278-194">Приложение возвращает неудачные ответы HTTP более чем на 1% запросов.</span><span class="sxs-lookup"><span data-stu-id="9c278-194">Your application is returning unsuccessful HTTP responses to more than 1% of requests.</span></span>
- <span data-ttu-id="9c278-195">Среднее время ответа для основных конечных точек приложения превышает 2000 мс.</span><span class="sxs-lookup"><span data-stu-id="9c278-195">Your application's average response time for key endpoints exceeds 2000 ms.</span></span>

### <a name="alerts-in-cloud-native-apps"></a><span data-ttu-id="9c278-196">Оповещения в собственных облачных приложениях</span><span class="sxs-lookup"><span data-stu-id="9c278-196">Alerts in cloud-native apps</span></span>

<span data-ttu-id="9c278-197">Для поиска известных условий сбоя можно создавать запросы к средствам мониторинга.</span><span class="sxs-lookup"><span data-stu-id="9c278-197">You can craft queries against the monitoring tools to look for known failure conditions.</span></span> <span data-ttu-id="9c278-198">Например, запросы могут искать в входящих журналах события с кодом состояния HTTP 500, что указывает на проблему на веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="9c278-198">For instance, queries could search through the incoming logs for indications of HTTP status code 500, which indicates a problem on a web server.</span></span> <span data-ttu-id="9c278-199">Как только один из них будет обнаружен, можно отправить владельцу исходной службы сообщение электронной почты или сервер SMS, который может начать анализ.</span><span class="sxs-lookup"><span data-stu-id="9c278-199">As soon as one of these is detected, then an e-mail or an SMS could be sent to the owner of the originating service who can begin to investigate.</span></span>

<span data-ttu-id="9c278-200">Однако, как правило, одна ошибка 500 недостаточно, чтобы определить, что возникла проблема.</span><span class="sxs-lookup"><span data-stu-id="9c278-200">Typically, though, a single 500 error isn't enough to determine that a problem has occurred.</span></span> <span data-ttu-id="9c278-201">Это может означать, что пользователь неправильно вводит пароль или указал неправильные данные.</span><span class="sxs-lookup"><span data-stu-id="9c278-201">It could mean that a user mistyped their password or entered some malformed data.</span></span> <span data-ttu-id="9c278-202">Запросы предупреждений можно создавать, только если обнаружено больше среднего числа ошибок 500.</span><span class="sxs-lookup"><span data-stu-id="9c278-202">The alert queries can be crafted to only fire when a larger than average number of 500 errors are detected.</span></span>

<span data-ttu-id="9c278-203">Одним из наиболее вредных шаблонов в предупреждении является инициация слишком большого количества предупреждений для исследования.</span><span class="sxs-lookup"><span data-stu-id="9c278-203">One of the most damaging patterns in alerting is to fire too many alerts for humans to investigate.</span></span> <span data-ttu-id="9c278-204">Владельцы служб быстро предесенситизедся к ошибкам, которые ранее были исследованы и были неблагоприятными.</span><span class="sxs-lookup"><span data-stu-id="9c278-204">Service owners will rapidly become desensitized to errors that they've previously investigated and found to be benign.</span></span> <span data-ttu-id="9c278-205">Затем при возникновении истинных ошибок они будут потеряны в случае сотен ложных срабатываний.</span><span class="sxs-lookup"><span data-stu-id="9c278-205">Then, when true errors occur, they'll be lost in the noise of hundreds of false positives.</span></span> <span data-ttu-id="9c278-206">Притче о кошке от перегрузки [, которая убедимся Wolf](https://en.wikipedia.org/wiki/The_Boy_Who_Cried_Wolf) , часто сообщает детям о том, что это очень опасно.</span><span class="sxs-lookup"><span data-stu-id="9c278-206">The parable of the [Boy Who Cried Wolf](https://en.wikipedia.org/wiki/The_Boy_Who_Cried_Wolf) is frequently told to children to warn them of this very danger.</span></span> <span data-ttu-id="9c278-207">Важно убедиться, что срабатывание оповещений говорит о реальной проблеме.</span><span class="sxs-lookup"><span data-stu-id="9c278-207">It's important to ensure that the alerts that do fire are indicative of a real problem.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="9c278-208">[Назад](monitoring-health.md)
>[Вперед](logging-with-elastic-stack.md)</span><span class="sxs-lookup"><span data-stu-id="9c278-208">[Previous](monitoring-health.md)
[Next](logging-with-elastic-stack.md)</span></span>
