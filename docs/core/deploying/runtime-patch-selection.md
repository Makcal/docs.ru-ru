---
title: Накат среды выполнения для развертывания автономных приложений .NET Core
description: Дополнительные сведения об изменениях команды dotnet publish для автономных развертываний.
author: KathleenDollard
ms.date: 05/31/2018
ms.openlocfilehash: 6bc578c63b28f51f1dd98e3e7e56fbe2c7a3e7cf
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505912"
---
# <a name="self-contained-deployment-runtime-roll-forward"></a><span data-ttu-id="b6af3-103">Обновление версии среды выполнения автономного развертывания</span><span class="sxs-lookup"><span data-stu-id="b6af3-103">Self-contained deployment runtime roll forward</span></span>

<span data-ttu-id="b6af3-104">[Автономные развертывания приложений](index.md) в .NET Core включают библиотеки .NET Core и среду выполнения .NET Core.</span><span class="sxs-lookup"><span data-stu-id="b6af3-104">.NET Core [self-contained application deployments](index.md) include both the .NET Core libraries and the .NET Core runtime.</span></span> <span data-ttu-id="b6af3-105">Начиная с пакета SDK для .NET Core 2.1 (версии 2.1.300), при автономном развертывании приложений [публикуются последние исправления среды выполнения на компьютере](https://github.com/dotnet/designs/blob/main/accepted/2018/self-contained-roll-forward.md).</span><span class="sxs-lookup"><span data-stu-id="b6af3-105">Starting in .NET Core 2.1 SDK (version 2.1.300), a self-contained application deployment [publishes the highest patch runtime on your machine](https://github.com/dotnet/designs/blob/main/accepted/2018/self-contained-roll-forward.md).</span></span> <span data-ttu-id="b6af3-106">По умолчанию [`dotnet publish`](../tools/dotnet-publish.md) для автономного развертывания выбирает последнюю версию, установленную как часть пакета SDK на компьютере для публикации.</span><span class="sxs-lookup"><span data-stu-id="b6af3-106">By default, [`dotnet publish`](../tools/dotnet-publish.md) for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine.</span></span> <span data-ttu-id="b6af3-107">Благодаря этому развернутое приложение запускается с исправлениями для системы безопасности (и другими исправлениями), доступными во время публикации `publish`.</span><span class="sxs-lookup"><span data-stu-id="b6af3-107">This enables your deployed application to run with security fixes (and other fixes) available during `publish`.</span></span> <span data-ttu-id="b6af3-108">Приложение нужно опубликовать повторно для получения нового исправления.</span><span class="sxs-lookup"><span data-stu-id="b6af3-108">The application must be republished to obtain a new patch.</span></span> <span data-ttu-id="b6af3-109">Чтобы создать автономное приложение, укажите параметр `-r <RID>` в команде `dotnet publish` или укажите [идентификатор среды выполнения (RID)](../rid-catalog.md) в файле проекта (CSPROJ или VBPROJ) или в командной строке.</span><span class="sxs-lookup"><span data-stu-id="b6af3-109">Self-contained applications are created by specifying `-r <RID>` on the `dotnet publish` command or by specifying the [runtime identifier (RID)](../rid-catalog.md) in the project file (csproj / vbproj) or on the command line.</span></span>

## <a name="patch-version-roll-forward-overview"></a><span data-ttu-id="b6af3-110">Общие сведения об обновлении версии исправления</span><span class="sxs-lookup"><span data-stu-id="b6af3-110">Patch version roll forward overview</span></span>

<span data-ttu-id="b6af3-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) и [`publish`](../tools/dotnet-publish.md) — это команды `dotnet`, которые выполняются отдельно.</span><span class="sxs-lookup"><span data-stu-id="b6af3-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) and [`publish`](../tools/dotnet-publish.md) are `dotnet` commands that can run separately.</span></span> <span data-ttu-id="b6af3-112">Выбор среды выполнения является частью операции `restore`, а не `publish` или `build`.</span><span class="sxs-lookup"><span data-stu-id="b6af3-112">The runtime choice is part of the `restore` operation, not `publish` or `build`.</span></span> <span data-ttu-id="b6af3-113">При вызове команды `publish` выбирается последняя версия исправлений.</span><span class="sxs-lookup"><span data-stu-id="b6af3-113">If you call `publish`, the latest patch version will be chosen.</span></span> <span data-ttu-id="b6af3-114">Команда `publish` с аргументом `--no-restore` может не дать нужную версию исправлений, если предварительно не выполнена команда `restore` с новой политикой публикации автономных приложений.</span><span class="sxs-lookup"><span data-stu-id="b6af3-114">If you call `publish` with the `--no-restore` argument, then you may not get the desired patch version because a prior `restore` may not have been executed with the new self-contained application publishing policy.</span></span> <span data-ttu-id="b6af3-115">В этом случае возникает ошибка сборки со следующим или подобным текстом:</span><span class="sxs-lookup"><span data-stu-id="b6af3-115">In this case, a build error is generated with text similar to the following:</span></span>

  <span data-ttu-id="b6af3-116">"Проект был восстановлен с использованием Microsoft.NETCore.App версии 2.0.0, но с текущими параметрами будет использоваться версия 2.0.6.</span><span class="sxs-lookup"><span data-stu-id="b6af3-116">"The project was restored using Microsoft.NETCore.App version 2.0.0, but with current settings, version 2.0.6 would be used instead.</span></span> <span data-ttu-id="b6af3-117">Чтобы устранить эту проблему, убедитесь, что для операции восстановления и для последующих операций, например сборки или публикации, используются одинаковые параметры.</span><span class="sxs-lookup"><span data-stu-id="b6af3-117">To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish.</span></span> <span data-ttu-id="b6af3-118">Обычно эта проблема возникает, если свойство RuntimeIdentifier задается во время сборки или публикации, а не во время восстановления".</span><span class="sxs-lookup"><span data-stu-id="b6af3-118">Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore."</span></span>

> [!NOTE]
> <span data-ttu-id="b6af3-119">`restore` и `build` могут выполняться неявно как часть другой команды, например `publish`.</span><span class="sxs-lookup"><span data-stu-id="b6af3-119">`restore` and `build` can be run implicitly as part of another command, like `publish`.</span></span> <span data-ttu-id="b6af3-120">При неявном выполнении в рамках другой команды им предоставляется дополнительный контекст для создания подходящих артефактов.</span><span class="sxs-lookup"><span data-stu-id="b6af3-120">When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced.</span></span> <span data-ttu-id="b6af3-121">Когда вы выполняете операцию `publish` в среде выполнения (например, `dotnet publish -r linux-x64`), неявная команда `restore` восстанавливает пакеты для среды выполнения linux x64.</span><span class="sxs-lookup"><span data-stu-id="b6af3-121">When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime.</span></span> <span data-ttu-id="b6af3-122">Если вы явно вызываете метод`restore`, он не восстанавливает пакеты среды выполнения по умолчанию, поскольку у него нет этого контекста.</span><span class="sxs-lookup"><span data-stu-id="b6af3-122">If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.</span></span>

## <a name="how-to-avoid-restore-during-publish"></a><span data-ttu-id="b6af3-123">Как избежать восстановления во время публикации</span><span class="sxs-lookup"><span data-stu-id="b6af3-123">How to avoid restore during publish</span></span>

<span data-ttu-id="b6af3-124">Выполнение операции `restore` в рамках операции `publish` может привести к нежелательным результатам.</span><span class="sxs-lookup"><span data-stu-id="b6af3-124">Running `restore` as part of the `publish` operation may be undesirable for your scenario.</span></span> <span data-ttu-id="b6af3-125">Чтобы избежать операции `restore` во время операции `publish` при создании автономных приложений, выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="b6af3-125">To avoid `restore` during `publish` while creating self-contained applications, do the following:</span></span>

- <span data-ttu-id="b6af3-126">Установите для свойства `RuntimeIdentifiers` разделенный точкой с запятой список идентификаторов [RID](../rid-catalog.md) для публикации.</span><span class="sxs-lookup"><span data-stu-id="b6af3-126">Set the `RuntimeIdentifiers` property to a semicolon-separated list of all the [RIDs](../rid-catalog.md) to be published.</span></span>
- <span data-ttu-id="b6af3-127">Задайте для свойства `TargetLatestRuntimePatch` значение `true`.</span><span class="sxs-lookup"><span data-stu-id="b6af3-127">Set the `TargetLatestRuntimePatch` property to `true`.</span></span>

## <a name="no-restore-argument-with-dotnet-publish-options"></a><span data-ttu-id="b6af3-128">Аргумент no-restore в параметрах dotnet publish</span><span class="sxs-lookup"><span data-stu-id="b6af3-128">No-restore argument with dotnet publish options</span></span>

<span data-ttu-id="b6af3-129">Если вы хотите создать автономные приложения и [приложения, зависящие от платформы,](index.md) в одном файле проекта и использовать аргумент `--no-restore` с `dotnet publish`, выберите один из следующих вариантов:</span><span class="sxs-lookup"><span data-stu-id="b6af3-129">If you want to create both self-contained applications and [framework-dependent applications](index.md) with the same project file, and you want to use the `--no-restore` argument with `dotnet publish`, then choose one of the following:</span></span>

1. <span data-ttu-id="b6af3-130">Выберите поведение зависимости от платформы.</span><span class="sxs-lookup"><span data-stu-id="b6af3-130">Prefer the framework-dependent behavior.</span></span> <span data-ttu-id="b6af3-131">Если приложение зависит от платформы, это поведение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b6af3-131">If the application is framework-dependent, this is the default behavior.</span></span> <span data-ttu-id="b6af3-132">Если приложение является автономным и может использовать локальную среду выполнения 2.1.0 без исправлений, установите для параметра `TargetLatestRuntimePatch` значение `false` в файле проекта.</span><span class="sxs-lookup"><span data-stu-id="b6af3-132">If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the `TargetLatestRuntimePatch` to `false` in the project file.</span></span>

2. <span data-ttu-id="b6af3-133">Выберите автономное поведение.</span><span class="sxs-lookup"><span data-stu-id="b6af3-133">Prefer the self-contained behavior.</span></span> <span data-ttu-id="b6af3-134">Если приложение автономное, это поведение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b6af3-134">If the application is self-contained, this is the default behavior.</span></span> <span data-ttu-id="b6af3-135">Если приложение зависит от платформы и требует установки последнего исправления, установите для параметра `TargetLatestRuntimePatch` значение `true` в файле проекта.</span><span class="sxs-lookup"><span data-stu-id="b6af3-135">If the application is framework-dependent, and requires the latest patch installed, set `TargetLatestRuntimePatch` to `true` in the project file.</span></span>

3. <span data-ttu-id="b6af3-136">Вы можете явным образом контролировать версию среды выполнения платформы, установив для параметра `RuntimeFrameworkVersion` конкретную версию исправления в файле проекта.</span><span class="sxs-lookup"><span data-stu-id="b6af3-136">Take explicit control of the runtime framework version by setting `RuntimeFrameworkVersion` to the specific patch version in the project file.</span></span>
