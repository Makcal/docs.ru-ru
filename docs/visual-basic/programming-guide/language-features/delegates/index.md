---
description: 'Дополнительные сведения: Делегаты (Visual Basic)'
title: Делегаты
ms.date: 07/20/2015
helpviewer_keywords:
- delegates [Visual Basic]
- Visual Basic code, delegates
ms.assetid: 410b60dc-5e60-4ec0-bfae-426755a2ee28
ms.openlocfilehash: aba3c1483f2875600d925ec3edb0167ddfb18125
ms.sourcegitcommit: 10e719780594efc781b15295e499c66f316068b8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100434437"
---
# <a name="delegates-visual-basic"></a><span data-ttu-id="7a4af-103">Делегаты (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="7a4af-103">Delegates (Visual Basic)</span></span>

<span data-ttu-id="7a4af-104">Делегаты являются объектами, которые ссылаются на методы.</span><span class="sxs-lookup"><span data-stu-id="7a4af-104">Delegates are objects that refer to methods.</span></span> <span data-ttu-id="7a4af-105">Иногда их описывают как *типобезопасные указатели функций*, поскольку они похожи на указатели функций, используемые в других языках программирования.</span><span class="sxs-lookup"><span data-stu-id="7a4af-105">They are sometimes described as *type-safe function pointers* because they are similar to function pointers used in other programming languages.</span></span> <span data-ttu-id="7a4af-106">Но в отличие от указателей функций, Visual Basic делегаты являются ссылочным типом, основанным на классе <xref:System.Delegate?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="7a4af-106">But unlike function pointers, Visual Basic delegates are a reference type based on the class <xref:System.Delegate?displayProperty=nameWithType>.</span></span> <span data-ttu-id="7a4af-107">Делегаты могут ссылаться на оба вида общих методов — на методы, которые могут вызываться без определенного экземпляра класса, и на методы экземпляра.</span><span class="sxs-lookup"><span data-stu-id="7a4af-107">Delegates can reference both shared methods — methods that can be called without a specific instance of a class — and instance methods.</span></span>

## <a name="delegates-and-events"></a><span data-ttu-id="7a4af-108">Делегаты и события</span><span class="sxs-lookup"><span data-stu-id="7a4af-108">Delegates and Events</span></span>

<span data-ttu-id="7a4af-109">Делегаты полезны в тех ситуациях, когда требуется промежуточное звено между вызывающей и вызываемой процедурами.</span><span class="sxs-lookup"><span data-stu-id="7a4af-109">Delegates are useful in situations where you need an intermediary between a calling procedure and the procedure being called.</span></span> <span data-ttu-id="7a4af-110">Например, вы хотите создать объект, который создает события и в зависимости от обстоятельств может вызывать разные обработчики событий.</span><span class="sxs-lookup"><span data-stu-id="7a4af-110">For example, you might want an object that raises events to be able to call different event handlers under different circumstances.</span></span> <span data-ttu-id="7a4af-111">К сожалению, этот объект не может знать заранее, какой обработчик событий обрабатывает конкретное событие.</span><span class="sxs-lookup"><span data-stu-id="7a4af-111">Unfortunately, the object raising the events cannot know ahead of time which event handler is handling a specific event.</span></span> <span data-ttu-id="7a4af-112">Visual Basic позволяет динамически связывать обработчики событий с событиями, создавая делегат при использовании `AddHandler` инструкции.</span><span class="sxs-lookup"><span data-stu-id="7a4af-112">Visual Basic lets you dynamically associate event handlers with events by creating a delegate for you when you use the `AddHandler` statement.</span></span> <span data-ttu-id="7a4af-113">Во время выполнения делегат передает вызовы в соответствующий обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="7a4af-113">At run time, the delegate forwards calls to the appropriate event handler.</span></span>

<span data-ttu-id="7a4af-114">Несмотря на то, что вы можете создавать собственные делегаты, в большинстве случаев Visual Basic создает делегат и следит за информацией.</span><span class="sxs-lookup"><span data-stu-id="7a4af-114">Although you can create your own delegates, in most cases Visual Basic creates the delegate and takes care of the details for you.</span></span> <span data-ttu-id="7a4af-115">Например, инструкция `Event` неявно определяет класс делегата с именем `<EventName>EventHandler`. Он размещается как вложенный класс в том классе, который содержит инструкцию `Event`, а его сигнатура совпадает с сигнатурой события.</span><span class="sxs-lookup"><span data-stu-id="7a4af-115">For example, an `Event` statement implicitly defines a delegate class named `<EventName>EventHandler` as a nested class of the class containing the `Event` statement, and with the same signature as the event.</span></span> <span data-ttu-id="7a4af-116">Инструкция `AddressOf` неявно создает экземпляр делегата, который ссылается на конкретную процедуру.</span><span class="sxs-lookup"><span data-stu-id="7a4af-116">The `AddressOf` statement implicitly creates an instance of a delegate that refers to a specific procedure.</span></span> <span data-ttu-id="7a4af-117">Следующие два фрагмента кода эквивалентны.</span><span class="sxs-lookup"><span data-stu-id="7a4af-117">The following two lines of code are equivalent.</span></span> <span data-ttu-id="7a4af-118">В первой строке вы видите явное создание экземпляра `EventHandler`, который ссылается на метод `Button1_Click`, переданный в качестве аргумента.</span><span class="sxs-lookup"><span data-stu-id="7a4af-118">In the first line, you see the explicit creation of an instance of `EventHandler`, with a reference to method `Button1_Click` sent as the argument.</span></span> <span data-ttu-id="7a4af-119">Вторая строка делает то же самое, но более удобна в использовании.</span><span class="sxs-lookup"><span data-stu-id="7a4af-119">The second line is a more convenient way to do the same thing.</span></span>

[!code-vb[VbVbalrDelegates#6](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrDelegates/VB/Class1.vb#6)]

<span data-ttu-id="7a4af-120">Сокращенный способ создания делегатов вы можете использовать в любом месте кода, где компилятор может определить тип делегата по контексту.</span><span class="sxs-lookup"><span data-stu-id="7a4af-120">You can use the shorthand way of creating delegates anywhere the compiler can determine the delegate's type by the context.</span></span>

## <a name="declaring-events-that-use-an-existing-delegate-type"></a><span data-ttu-id="7a4af-121">Объявление событий, использующих существующий тип делегата</span><span class="sxs-lookup"><span data-stu-id="7a4af-121">Declaring Events that Use an Existing Delegate Type</span></span>

<span data-ttu-id="7a4af-122">В некоторых ситуациях вам потребуется объявить, чтобы событие использовало в качестве своего делегата уже существующий тип делегата.</span><span class="sxs-lookup"><span data-stu-id="7a4af-122">In some situations, you may want to declare an event to use an existing delegate type as its underlying delegate.</span></span> <span data-ttu-id="7a4af-123">Для этого используется следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="7a4af-123">The following syntax demonstrates how:</span></span>

[!code-vb[VbVbalrDelegates#7](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrDelegates/VB/Class1.vb#7)]

<span data-ttu-id="7a4af-124">Это удобно, когда нужно направить к одному обработчику несколько событий.</span><span class="sxs-lookup"><span data-stu-id="7a4af-124">This is useful when you want to route multiple events to the same handler.</span></span>

## <a name="delegate-variables-and-parameters"></a><span data-ttu-id="7a4af-125">Переменные и параметры делегата</span><span class="sxs-lookup"><span data-stu-id="7a4af-125">Delegate Variables and Parameters</span></span>

<span data-ttu-id="7a4af-126">Делегаты можно использовать для других, не связанных с событиями задач, например в свободной потоковой модели или в процедурах, которые должны вызывать разные версии функции во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="7a4af-126">You can use delegates for other, non-event related tasks, such as free threading or with procedures that need to call different versions of functions at run time.</span></span>

<span data-ttu-id="7a4af-127">Предположим, у вас есть рекламное приложения, которое содержит список с названиями автомобилей.</span><span class="sxs-lookup"><span data-stu-id="7a4af-127">For example, suppose you have a classified-ad application that includes a list box with the names of cars.</span></span> <span data-ttu-id="7a4af-128">Рекламные объявления сортируются по названию, которое обычно содержит модель автомобиля.</span><span class="sxs-lookup"><span data-stu-id="7a4af-128">The ads are sorted by title, which is normally the make of the car.</span></span> <span data-ttu-id="7a4af-129">Если у некоторых автомобилей перед моделью указан год производства, возникает проблема.</span><span class="sxs-lookup"><span data-stu-id="7a4af-129">A problem you may face occurs when some cars include the year of the car before the make.</span></span> <span data-ttu-id="7a4af-130">Эта проблема связана с тем, что встроенная функция сортировки упорядочивает значения только по кодам знаков. В результате все объявления, которые начинаются с даты, располагаются первыми, и лишь затем идут объявления с моделью в начале строки.</span><span class="sxs-lookup"><span data-stu-id="7a4af-130">The problem is that the built-in sort functionality of the list box sorts only by character codes; it places all the ads starting with dates first, followed by the ads starting with the make.</span></span>

<span data-ttu-id="7a4af-131">Чтобы устранить эту проблему, можно создать в классе специальную процедуру сортировки, которая для большинства списков использует стандартную сортировку по алфавиту, но во время выполнения переключается на пользовательскую сортировку для объявлений о продаже автомобилей.</span><span class="sxs-lookup"><span data-stu-id="7a4af-131">To fix this, you can create a sort procedure in a class that uses the standard alphabetic sort on most list boxes, but is able to switch at run time to the custom sort procedure for car ads.</span></span> <span data-ttu-id="7a4af-132">Для этого во время выполнения пользовательская процедура сортировки передается классу сортировки с помощью делегатов.</span><span class="sxs-lookup"><span data-stu-id="7a4af-132">To do this, you pass the custom sort procedure to the sort class at run time, using delegates.</span></span>

## <a name="addressof-and-lambda-expressions"></a><span data-ttu-id="7a4af-133">AddressOf и лямбда-выражения</span><span class="sxs-lookup"><span data-stu-id="7a4af-133">AddressOf and Lambda Expressions</span></span>

<span data-ttu-id="7a4af-134">Каждый класс делегата определяет конструктор, которому передается спецификация метода объекта.</span><span class="sxs-lookup"><span data-stu-id="7a4af-134">Each delegate class defines a constructor that is passed the specification of an object method.</span></span> <span data-ttu-id="7a4af-135">Аргумент конструктора делегата должен быть ссылкой на метод или лямбда-выражение.</span><span class="sxs-lookup"><span data-stu-id="7a4af-135">An argument to a delegate constructor must be a reference to a method, or a lambda expression.</span></span>

<span data-ttu-id="7a4af-136">Чтобы указать ссылку на метод, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="7a4af-136">To specify a reference to a method, use the following syntax:</span></span>

<span data-ttu-id="7a4af-137">`AddressOf` [`expression`.]`methodName`</span><span class="sxs-lookup"><span data-stu-id="7a4af-137">`AddressOf` [`expression`.]`methodName`</span></span>

<span data-ttu-id="7a4af-138">Тип `expression` во время компиляции должен представлять собой имя класса или интерфейса, который содержит метод с указанным именем, сигнатура которого соответствует сигнатуре класса делегата.</span><span class="sxs-lookup"><span data-stu-id="7a4af-138">The compile-time type of the `expression` must be the name of a class or an interface that contains a method of the specified name whose signature matches the signature of the delegate class.</span></span> <span data-ttu-id="7a4af-139">`methodName` должен быть общим методом или методом экземпляра.</span><span class="sxs-lookup"><span data-stu-id="7a4af-139">The `methodName` can be either a shared method or an instance method.</span></span> <span data-ttu-id="7a4af-140">`methodName` всегда является обязательным, даже если делегат создается для метода по умолчанию в классе.</span><span class="sxs-lookup"><span data-stu-id="7a4af-140">The `methodName` is not optional, even if you create a delegate for the default method of the class.</span></span>

<span data-ttu-id="7a4af-141">Чтобы указать лямбда-выражение, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="7a4af-141">To specify a lambda expression, use the following syntax:</span></span>

<span data-ttu-id="7a4af-142">`Function` ([`parm` As `type`, `parm2` As `type2`, ...]) `expression`</span><span class="sxs-lookup"><span data-stu-id="7a4af-142">`Function` ([`parm` As `type`, `parm2` As `type2`, ...]) `expression`</span></span>

<span data-ttu-id="7a4af-143">В следующем примере показано, как использовать `AddressOf` и лямбда-выражения для указания ссылки на делегат.</span><span class="sxs-lookup"><span data-stu-id="7a4af-143">The following example shows both `AddressOf` and lambda expressions used to specify the reference for a delegate.</span></span>

[!code-vb[VbVbalrDelegates#15](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrDelegates/VB/Class2.vb#15)]

<span data-ttu-id="7a4af-144">Сигнатура функции должна соответствовать сигнатуре типа делегата.</span><span class="sxs-lookup"><span data-stu-id="7a4af-144">The signature of the function must match that of the delegate type.</span></span> <span data-ttu-id="7a4af-145">Дополнительные сведения о лямбда-выражениях см. в разделе [лямбда-выражения](../procedures/lambda-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="7a4af-145">For more information about lambda expressions, see [Lambda Expressions](../procedures/lambda-expressions.md).</span></span> <span data-ttu-id="7a4af-146">Дополнительные примеры лямбда-выражений и назначений `AddressOf` делегатам см. в статье [Relaxed Delegate Conversion](relaxed-delegate-conversion.md) (Неявное преобразование делегата).</span><span class="sxs-lookup"><span data-stu-id="7a4af-146">For more examples of lambda expression and `AddressOf` assignments to delegates, see [Relaxed Delegate Conversion](relaxed-delegate-conversion.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="7a4af-147">См. также</span><span class="sxs-lookup"><span data-stu-id="7a4af-147">Related Topics</span></span>

|<span data-ttu-id="7a4af-148">Заголовок</span><span class="sxs-lookup"><span data-stu-id="7a4af-148">Title</span></span>|<span data-ttu-id="7a4af-149">Описание</span><span class="sxs-lookup"><span data-stu-id="7a4af-149">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="7a4af-150">Практическое руководство. Вызов метода делегата</span><span class="sxs-lookup"><span data-stu-id="7a4af-150">How to: Invoke a Delegate Method</span></span>](how-to-invoke-a-delegate-method.md)|<span data-ttu-id="7a4af-151">Предоставляет пример, в котором показано, как связать метод с делегатом и вызвать этот метод через делегат.</span><span class="sxs-lookup"><span data-stu-id="7a4af-151">Provides an example that shows how to associate a method with a delegate and then invoke that method through the delegate.</span></span>|
|[<span data-ttu-id="7a4af-152">Практическое руководство. Передача процедур другой процедуре в Visual Basic</span><span class="sxs-lookup"><span data-stu-id="7a4af-152">How to: Pass Procedures to Another Procedure in Visual Basic</span></span>](how-to-pass-procedures-to-another-procedure.md)|<span data-ttu-id="7a4af-153">Демонстрирует использование делегатов для передачи одной процедуры в другую процедуру.</span><span class="sxs-lookup"><span data-stu-id="7a4af-153">Demonstrates how to use delegates to pass one procedure to another procedure.</span></span>|
|[<span data-ttu-id="7a4af-154">Неявное преобразование делегата</span><span class="sxs-lookup"><span data-stu-id="7a4af-154">Relaxed Delegate Conversion</span></span>](relaxed-delegate-conversion.md)|<span data-ttu-id="7a4af-155">Описывает, как можно назначить делегаты или обработчики для подпрограмм и функций, если их сигнатуры не совпадают</span><span class="sxs-lookup"><span data-stu-id="7a4af-155">Describes how you can assign subs and functions to delegates or handlers even when their signatures are not identical</span></span>|
|[<span data-ttu-id="7a4af-156">События</span><span class="sxs-lookup"><span data-stu-id="7a4af-156">Events</span></span>](../events/index.md)|<span data-ttu-id="7a4af-157">Предоставляет обзор событий в Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="7a4af-157">Provides an overview of events in Visual Basic.</span></span>|
