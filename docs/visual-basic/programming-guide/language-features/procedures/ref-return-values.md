---
description: Дополнительные сведения см. в статье поддержка возвращаемых ссылочных значений (Visual Basic).
title: Возвращаемые ссылочные значения
ms.date: 04/28/2017
helpviewer_keywords:
- variables [Visual Basic]
- ref return values [Visual Basic]
- ref returns [Visual Basic]
ms.assetid: 5ef0cc69-eb3a-4a67-92a2-78585f223cb5
ms.openlocfilehash: 215a647c68eb7eadd394a1a7842ceb98c46e04a5
ms.sourcegitcommit: 10e719780594efc781b15295e499c66f316068b8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100466553"
---
# <a name="support-for-reference-return-values-visual-basic"></a><span data-ttu-id="b51fb-103">Поддержка возвращаемых ссылочных значений (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="b51fb-103">Support for reference return values (Visual Basic)</span></span>

<span data-ttu-id="b51fb-104">Начиная с C# 7,0, язык C# поддерживает *возвращаемые ссылочные значения*.</span><span class="sxs-lookup"><span data-stu-id="b51fb-104">Starting with C# 7.0, the C# language supports *reference return values*.</span></span> <span data-ttu-id="b51fb-105">Один из способов понять возвращаемые ссылочные значения заключается в том, что они являются противоположными аргументами, передаваемыми по ссылке к методу.</span><span class="sxs-lookup"><span data-stu-id="b51fb-105">One way to understand reference return values is that they are the opposite of arguments that are passed by reference to a method.</span></span> <span data-ttu-id="b51fb-106">При изменении аргумента, передаваемого по ссылке, изменения отражаются в значении переменной в вызывающем объекте.</span><span class="sxs-lookup"><span data-stu-id="b51fb-106">When an argument passed by reference is modified, the changes are reflected in value of the variable on the caller.</span></span> <span data-ttu-id="b51fb-107">Если метод предоставляет вызывающему значению ссылочное значение, изменения, внесенные в возвращаемое значение ссылочного объекта, отражаются в данных вызываемого метода.</span><span class="sxs-lookup"><span data-stu-id="b51fb-107">When an method provides a reference return value to a caller, modifications made to the reference return value by the caller are reflected in the called method's data.</span></span>

<span data-ttu-id="b51fb-108">Visual Basic не позволяет создавать методы со возвращаемыми ссылочными значениями, но это позволяет использовать возвращаемые ссылочные значения.</span><span class="sxs-lookup"><span data-stu-id="b51fb-108">Visual Basic does not allow you to author methods with reference return values, but it does allow you to consume reference return values.</span></span> <span data-ttu-id="b51fb-109">Иными словами, можно вызвать метод с возвращаемым ссылочным значением и изменить это возвращаемое значение, а изменения ссылочного возвращаемого значения отражаются в данных вызываемого метода.</span><span class="sxs-lookup"><span data-stu-id="b51fb-109">In other words, you can call a method with a reference return value and modify that return value, and changes to the reference return value are reflected in the called method's data.</span></span>

## <a name="modifying-the-ref-return-value-directly"></a><span data-ttu-id="b51fb-110">Изменение возвращаемого значения ref напрямую</span><span class="sxs-lookup"><span data-stu-id="b51fb-110">Modifying the ref return value directly</span></span>

<span data-ttu-id="b51fb-111">Для методов, которые всегда завершаются успешно и не имеют `ByRef` параметров, можно изменить возвращаемое ссылочное значение напрямую.</span><span class="sxs-lookup"><span data-stu-id="b51fb-111">For methods that always succeed and have no `ByRef` parameters, you can modify the reference return value directly.</span></span> <span data-ttu-id="b51fb-112">Это делается путем присвоения нового значения выражениям, возвращающим возвращаемое ссылочное значение.</span><span class="sxs-lookup"><span data-stu-id="b51fb-112">You do this by assigning the new value to the expressions that returns the reference return value.</span></span>

<span data-ttu-id="b51fb-113">В следующем примере C# определяется `NumericValue.IncrementValue` метод, который увеличивает внутреннее значение и возвращает его в качестве возвращаемого ссылочного значения.</span><span class="sxs-lookup"><span data-stu-id="b51fb-113">The following C# example defines a `NumericValue.IncrementValue` method that increments an internal value and returns it as a reference return value.</span></span>

[!code-csharp[Ref-Return](../../../../../samples/snippets/visualbasic/programming-guide/language-features/procedures/ref-returns1.cs)]

<span data-ttu-id="b51fb-114">Возвращаемое ссылочное значение затем изменяется вызывающим объектом в следующем Visual Basic примере.</span><span class="sxs-lookup"><span data-stu-id="b51fb-114">The reference return value is then modified by the caller in the following Visual Basic example.</span></span> <span data-ttu-id="b51fb-115">Обратите внимание, что строка с `NumericValue.IncrementValue` вызовом метода не присваивает методу значение.</span><span class="sxs-lookup"><span data-stu-id="b51fb-115">Note that the line with the `NumericValue.IncrementValue` method call does not assign a value to the method.</span></span> <span data-ttu-id="b51fb-116">Вместо этого он присваивает значение ссылочному возвращаемому значению, возвращаемому методом.</span><span class="sxs-lookup"><span data-stu-id="b51fb-116">Instead, it assigns a value to the reference return value returned by the method.</span></span>

[!code-vb[Ref-Return](../../../../../samples/snippets/visualbasic/programming-guide/language-features/procedures/use-ref-returns1.vb)]

## <a name="using-a-helper-method"></a><span data-ttu-id="b51fb-117">Использование вспомогательного метода</span><span class="sxs-lookup"><span data-stu-id="b51fb-117">Using a helper method</span></span>

<span data-ttu-id="b51fb-118">В других случаях изменение возвращаемого ссылочного значения для вызова метода напрямую может быть не всегда желательным.</span><span class="sxs-lookup"><span data-stu-id="b51fb-118">In other cases, modifying the reference return value of a method call directly may not always be desirable.</span></span> <span data-ttu-id="b51fb-119">Например, метод поиска, возвращающий строку, не всегда может найти совпадение.</span><span class="sxs-lookup"><span data-stu-id="b51fb-119">For example, a search method that returns a string may not always find a match.</span></span> <span data-ttu-id="b51fb-120">В этом случае необходимо изменить возвращаемое ссылочное значение только в том случае, если поиск прошел успешно.</span><span class="sxs-lookup"><span data-stu-id="b51fb-120">In that case, you want to modify the reference return value only if the search is successful.</span></span>

<span data-ttu-id="b51fb-121">Этот сценарий показан в следующем примере C#.</span><span class="sxs-lookup"><span data-stu-id="b51fb-121">The following C# example illustrates this scenario.</span></span> <span data-ttu-id="b51fb-122">Он определяет `Sentence` , что класс, написанный на языке C#, включает `FindNext` метод, который находит следующее слово в предложении, которое начинается с указанной подстроки.</span><span class="sxs-lookup"><span data-stu-id="b51fb-122">It defines a `Sentence` class written in C# includes a `FindNext` method that finds the next word in a sentence that begins with a specified substring.</span></span> <span data-ttu-id="b51fb-123">Строка возвращается как значение, возвращаемое по ссылке, а переменная `Boolean`, переданная в метод по ссылке, показывает, дал ли поиск какие-то результаты.</span><span class="sxs-lookup"><span data-stu-id="b51fb-123">The string is returned as a reference return value, and a `Boolean` variable passed by reference to the method indicates whether the search was successful.</span></span> <span data-ttu-id="b51fb-124">Возвращаемое ссылочное значение указывает, что в дополнение к чтению возвращаемого значения вызывающий объект также может изменить его, и это изменение будет отражено в данных, содержащихся внутри `Sentence` класса.</span><span class="sxs-lookup"><span data-stu-id="b51fb-124">The reference return value indicates that in addition to reading the returned value, the caller can also modify it, and that modification is reflected in the data contained internally in the `Sentence` class.</span></span>

[!code-csharp[Ref-Return](../../../../../samples/snippets/visualbasic/getting-started/ref-returns.cs)]

<span data-ttu-id="b51fb-125">Непосредственное изменение возвращаемого ссылочного значения в этом случае не является надежным, так как вызов метода может не найти совпадения и вернуть первое слово в предложении.</span><span class="sxs-lookup"><span data-stu-id="b51fb-125">Directly modifying the reference return value in this case is not reliable, since the method call may fail to find a match and return the first word in the sentence.</span></span> <span data-ttu-id="b51fb-126">В этом случае вызывающий объект случайно изменит первое слово предложения.</span><span class="sxs-lookup"><span data-stu-id="b51fb-126">In that case, the caller will inadvertently modify the first word of the sentence.</span></span> <span data-ttu-id="b51fb-127">Это может быть предотвращено вызывающим объектом, возвращающим `null` (или `Nothing` в Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="b51fb-127">This could be prevented by the caller returning a `null` (or `Nothing` in Visual Basic).</span></span> <span data-ttu-id="b51fb-128">Но в этом случае попытка изменить строку, значение которой вызывает `Nothing` исключение <xref:System.NullReferenceException> .</span><span class="sxs-lookup"><span data-stu-id="b51fb-128">But in that case, attempting to modify a string whose value is `Nothing` throws a <xref:System.NullReferenceException>.</span></span> <span data-ttu-id="b51fb-129">Значение, если можно также предотвратить возврат вызывающей стороны <xref:System.String.Empty?displayProperty=nameWithType> , но для этого требуется, чтобы вызывающий объект определял строковую переменную со значением <xref:System.String.Empty?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="b51fb-129">If could also be prevented by the caller returning <xref:System.String.Empty?displayProperty=nameWithType>, but this requires that the caller define a string variable whose value is <xref:System.String.Empty?displayProperty=nameWithType>.</span></span> <span data-ttu-id="b51fb-130">Хотя вызывающий объект может изменить эту строку, само изменение не будет работать, так как измененная строка не имеет отношения к словам в предложении, которое хранится в `Sentence` классе.</span><span class="sxs-lookup"><span data-stu-id="b51fb-130">While the caller can modify that string, the modification itself serves no purpose, since the modified string has no relationship to the words in the sentence stored by the `Sentence` class.</span></span>

<span data-ttu-id="b51fb-131">Лучший способ решить эту проблему — передать возвращаемое ссылочное значение по ссылке на вспомогательный метод.</span><span class="sxs-lookup"><span data-stu-id="b51fb-131">The best way to handle this scenario is to pass the reference return value by reference to a helper method.</span></span> <span data-ttu-id="b51fb-132">Затем вспомогательный метод содержит логику для определения успешности вызова метода и изменения возвращаемого ссылочного значения.</span><span class="sxs-lookup"><span data-stu-id="b51fb-132">The helper method then contains the logic to determine whether the method call succeeded and, if it did, to modify the reference return value.</span></span> <span data-ttu-id="b51fb-133">В следующем примере показана возможная реализация.</span><span class="sxs-lookup"><span data-stu-id="b51fb-133">The following example provides a possible implementation.</span></span>

[!code-vb[Ref-Return](../../../../../samples/snippets/visualbasic/getting-started/ref-return-helper.vb#1)]

## <a name="see-also"></a><span data-ttu-id="b51fb-134">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="b51fb-134">See also</span></span>

- [<span data-ttu-id="b51fb-135">Передача аргументов по значению и по ссылке</span><span class="sxs-lookup"><span data-stu-id="b51fb-135">Passing arguments by value and by reference</span></span>](passing-arguments-by-value-and-by-reference.md)
- [<span data-ttu-id="b51fb-136">Процедуры в Visual Basic</span><span class="sxs-lookup"><span data-stu-id="b51fb-136">Procedures in Visual Basic</span></span>](index.md)
