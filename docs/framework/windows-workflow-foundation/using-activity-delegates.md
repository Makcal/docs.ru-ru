---
description: 'Дополнительные сведения: использование делегатов действий'
title: Использование делегатов действий
ms.date: 03/30/2017
ms.assetid: e33cf876-8979-440b-9b23-4a12d1139960
ms.openlocfilehash: 2570d32c275975b8bda34fab2ffd79a49b6a9c73
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99755087"
---
# <a name="using-activity-delegates"></a><span data-ttu-id="ccdd8-103">Использование делегатов действий</span><span class="sxs-lookup"><span data-stu-id="ccdd8-103">Using Activity Delegates</span></span>

<span data-ttu-id="ccdd8-104">Делегаты действий позволяют создателям действий предоставлять обратные вызовы с определенными сигнатурами, для которых пользователи действия могут предоставить обработчики, основанные на действиях.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-104">Activity delegates enable activity authors to expose callbacks with specific signatures, for which users of the activity can provide activity-based handlers.</span></span> <span data-ttu-id="ccdd8-105">Доступны два типа делегатов действия: <xref:System.Activities.ActivityAction%601> используется для определения делегатов действий, которые не возвращают значение, а <xref:System.Activities.ActivityFunc%601> используется для определения делегатов действий, которые возвращают значение.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-105">Two types of activity delegates are available: <xref:System.Activities.ActivityAction%601> is used to define activity delegates that do not have a return value, and <xref:System.Activities.ActivityFunc%601> is used to define activity delegates that do have a return value.</span></span>

<span data-ttu-id="ccdd8-106">Делегаты действий удобно использовать в тех случаях, когда дочерние действия должны быть ограничены необходимостью использования определенной сигнатуры.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-106">Activity delegates are useful in scenarios where a child activity must be constrained to having a certain signature.</span></span> <span data-ttu-id="ccdd8-107">Например, действие <xref:System.Activities.Statements.While> может содержать любой тип дочернего действия без ограничений, но текстом действия <xref:System.Activities.Statements.ForEach%601> является <xref:System.Activities.ActivityAction%601>; дочернее действие, в конце концов выполняемое <xref:System.Activities.Statements.ForEach%601>, должно иметь <xref:System.Activities.InArgument%601> того же типа элементов коллекции, который перечисляет <xref:System.Activities.Statements.ForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-107">For example, a <xref:System.Activities.Statements.While> activity can contain any type of child activity with no constraints, but the body of a <xref:System.Activities.Statements.ForEach%601> activity is an <xref:System.Activities.ActivityAction%601>, and the child activity that is ultimately executed by <xref:System.Activities.Statements.ForEach%601> must have an <xref:System.Activities.InArgument%601> that is the same type of the members of the collection that the <xref:System.Activities.Statements.ForEach%601> enumerates.</span></span>

## <a name="using-activityaction"></a><span data-ttu-id="ccdd8-108">Использование ActivityAction</span><span class="sxs-lookup"><span data-stu-id="ccdd8-108">Using ActivityAction</span></span>

<span data-ttu-id="ccdd8-109">Некоторые действия [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] используют действия операций, такие как действие <xref:System.Activities.Statements.Catch> и действие <xref:System.Activities.Statements.ForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-109">Several [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] activities use activity actions, such as the <xref:System.Activities.Statements.Catch> activity and the <xref:System.Activities.Statements.ForEach%601> activity.</span></span> <span data-ttu-id="ccdd8-110">В каждом из случаев действие операции представляет каталог, в котором автор рабочего процесса указывает операцию, обеспечивающую желаемое поведение, при составлении рабочего процесса с использованием одной из подобных операций.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-110">In each case, the activity action represents a location where the workflow author specifies an activity to provide the desired behavior when composing a workflow using one of these activities.</span></span> <span data-ttu-id="ccdd8-111">В следующем примере для отображения текста в окне консоли использовано действие <xref:System.Activities.Statements.ForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-111">In the following example, a <xref:System.Activities.Statements.ForEach%601> activity is used to display text to the console window.</span></span> <span data-ttu-id="ccdd8-112">Текст <xref:System.Activities.Statements.ForEach%601> определяется с использованием <xref:System.Activities.ActivityAction%601>, совпадающим с типом <xref:System.Activities.Statements.ForEach%601>, указанным в виде строки.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-112">The body of the <xref:System.Activities.Statements.ForEach%601> is specified by using an <xref:System.Activities.ActivityAction%601> that matches the type of the <xref:System.Activities.Statements.ForEach%601> which is string.</span></span> <span data-ttu-id="ccdd8-113">Действие <xref:System.Activities.Statements.WriteLine>, указанное в свойстве <xref:System.Activities.ActivityDelegate.Handler%2A>, имеет аргумент <xref:System.Activities.Statements.WriteLine.Text%2A>, привязанный к строковым значениям в коллекции, прохождение по которой производится действием <xref:System.Activities.Statements.ForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-113">The <xref:System.Activities.Statements.WriteLine> activity specified in the <xref:System.Activities.ActivityDelegate.Handler%2A> has its <xref:System.Activities.Statements.WriteLine.Text%2A> argument bound to the string values in the collection that the <xref:System.Activities.Statements.ForEach%601> activity iterates.</span></span>

[!code-csharp[CFX_ActivityExample#6](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#6)]

<span data-ttu-id="ccdd8-114">Аргумент actionArgument используется для передачи отдельных элементов в коллекции на WriteLine.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-114">The actionArgument is used to flow the individual items in the collection to the WriteLine.</span></span> <span data-ttu-id="ccdd8-115">При вызове рабочего процесса на консоль выводятся следующие данные.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-115">When the workflow is invoked, the following output is displayed to the console.</span></span>

```console
HelloWorld.
```

<span data-ttu-id="ccdd8-116">В примерах в этом разделе используется синтаксис инициализации объектов.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-116">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="ccdd8-117">Синтаксис инициализации объектов можно использовать для создания определений рабочих процессов в коде, поскольку он обеспечивает иерархическое представление действий в рабочем процессе и показывает связи между действиями.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-117">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="ccdd8-118">При программном создании рабочих процессов нет необходимости использовать синтаксис инициализации объектов.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-118">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="ccdd8-119">Следующий пример функционально эквивалентен предыдущему примеру.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-119">The following example is functionally equivalent to the previous example.</span></span>

[!code-csharp[CFX_ActivityExample#7](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#7)]

<span data-ttu-id="ccdd8-120">Дополнительные сведения об инициализаторах объектов см. [в разделе как инициализировать объекты без вызова конструктора (руководство по программированию на C#)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) и [как объявить объект с помощью инициализатора объекта (Visual Basic)](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span><span class="sxs-lookup"><span data-stu-id="ccdd8-120">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) and [How to: Declare an Object by Using an Object Initializer (Visual Basic)](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span></span>

<span data-ttu-id="ccdd8-121">В следующем примере действие <xref:System.Activities.Statements.TryCatch> используется в рабочем процессе.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-121">In the following example, a <xref:System.Activities.Statements.TryCatch> activity is used in a workflow.</span></span> <span data-ttu-id="ccdd8-122"><xref:System.ApplicationException> вызывается рабочим процессом и обрабатывается действием <xref:System.Activities.Statements.Catch%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-122">An <xref:System.ApplicationException> is thrown by the workflow, and is handled by a <xref:System.Activities.Statements.Catch%601> activity.</span></span> <span data-ttu-id="ccdd8-123">Обработчик <xref:System.Activities.Statements.Catch%601> действия действия является <xref:System.Activities.Statements.WriteLine> действием, и сведения об исключении передаются в него с помощью `ex` <xref:System.Activities.DelegateInArgument%601> .</span><span class="sxs-lookup"><span data-stu-id="ccdd8-123">The handler for the <xref:System.Activities.Statements.Catch%601> activity's activity action is a <xref:System.Activities.Statements.WriteLine> activity, and the exception detail is flowed through to it using the `ex` <xref:System.Activities.DelegateInArgument%601>.</span></span>

[!code-csharp[CFX_WorkflowApplicationExample#33](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]

<span data-ttu-id="ccdd8-124">При создании пользовательского действия, которое определяет действие <xref:System.Activities.ActivityAction%601>, используйте <xref:System.Activities.Statements.InvokeAction%601> для моделирования вызова этого действия <xref:System.Activities.ActivityAction%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-124">When creating a custom activity that defines an <xref:System.Activities.ActivityAction%601>, use an <xref:System.Activities.Statements.InvokeAction%601> to model the invocation of that <xref:System.Activities.ActivityAction%601>.</span></span> <span data-ttu-id="ccdd8-125">В этом примере определяется пользовательское действие `WriteLineWithNotification`.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-125">In this example, a custom `WriteLineWithNotification` activity is defined.</span></span> <span data-ttu-id="ccdd8-126">Это действие состоит из объекта <xref:System.Activities.Statements.Sequence>, который содержит действие <xref:System.Activities.Statements.WriteLine>, сопровождаемое действием <xref:System.Activities.Statements.InvokeAction%601>, которое вызывает действие <xref:System.Activities.ActivityAction%601>, принимающее один строковый аргумент.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-126">This activity is composed of a <xref:System.Activities.Statements.Sequence> that contains a <xref:System.Activities.Statements.WriteLine> activity followed by an <xref:System.Activities.Statements.InvokeAction%601> that invokes an <xref:System.Activities.ActivityAction%601> that takes one string argument.</span></span>

[!code-csharp[CFX_ActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#1)]

<span data-ttu-id="ccdd8-127">Когда создается рабочий процесс с помощью действия `WriteLineWithNotification`, создатель процесса задает нужную пользовательскую логику в свойстве <xref:System.Activities.ActivityDelegate.Handler%2A> операции действия.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-127">When a workflow is created by using the `WriteLineWithNotification` activity, the workflow author specifies the desired custom logic in the activity action’s <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span> <span data-ttu-id="ccdd8-128">В этом примере создается рабочий процесс, использующий действие `WriteLineWithNotification`, а действие <xref:System.Activities.Statements.WriteLine> используется как <xref:System.Activities.ActivityDelegate.Handler%2A>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-128">In this example, a workflow is created that use the `WriteLineWithNotification` activity, and a <xref:System.Activities.Statements.WriteLine> activity is used as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#2)]

<span data-ttu-id="ccdd8-129">Существует несколько универсальных версий <xref:System.Activities.Statements.InvokeAction%601> и <xref:System.Activities.ActivityAction%601> для передачи одного или нескольких аргументов.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-129">There are multiple generic versions of <xref:System.Activities.Statements.InvokeAction%601> and <xref:System.Activities.ActivityAction%601> provided for passing one or more arguments.</span></span>

## <a name="using-activityfunc"></a><span data-ttu-id="ccdd8-130">Использование ActivityFunc</span><span class="sxs-lookup"><span data-stu-id="ccdd8-130">Using ActivityFunc</span></span>

<span data-ttu-id="ccdd8-131"><xref:System.Activities.ActivityAction%601> используется в случае, когда действие не возвращает результирующего значения, а <xref:System.Activities.ActivityFunc%601> используется, когда результирующее значение возвращается.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-131"><xref:System.Activities.ActivityAction%601> is useful when there is no result value from the activity, and <xref:System.Activities.ActivityFunc%601> is used when a result value is returned.</span></span> <span data-ttu-id="ccdd8-132">При создании пользовательского действия, которое определяет действие <xref:System.Activities.ActivityFunc%601>, используйте <xref:System.Activities.Expressions.InvokeFunc%601> для моделирования вызова этого действия <xref:System.Activities.ActivityFunc%601>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-132">When creating a custom activity that defines an <xref:System.Activities.ActivityFunc%601>, use an <xref:System.Activities.Expressions.InvokeFunc%601> to model the invocation of that <xref:System.Activities.ActivityFunc%601>.</span></span> <span data-ttu-id="ccdd8-133">В следующем примере определяется действие `WriteFillerText` .</span><span class="sxs-lookup"><span data-stu-id="ccdd8-133">In the following example, a `WriteFillerText` activity is defined.</span></span> <span data-ttu-id="ccdd8-134">Для ввода текста наполнения задается действие <xref:System.Activities.Expressions.InvokeFunc%601>, которое принимает целочисленный аргумент и имеет строковый результат.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-134">To supply the filler text, an <xref:System.Activities.Expressions.InvokeFunc%601> is specified that takes an integer argument and has a string result.</span></span> <span data-ttu-id="ccdd8-135">После извлечения текст наполнения выводится на экран консоли с помощью действия <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-135">Once the filler text is retrieved, it is displayed to the console using a <xref:System.Activities.Statements.WriteLine> activity.</span></span>

[!code-csharp[CFX_ActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#3)]

<span data-ttu-id="ccdd8-136">Для ввода текста необходимо использовать действие, которое принимает аргумент `int` и имеет строковый результат.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-136">To supply the text, an activity must be used that takes one `int` argument and has a string result.</span></span> <span data-ttu-id="ccdd8-137">В этом примере показано действие `TextGenerator`, удовлетворяющее этим требованиям.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-137">This example shows a `TextGenerator` activity that meets these requirements.</span></span>

[!code-csharp[CFX_ActivityExample#4](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#4)]

<span data-ttu-id="ccdd8-138">Чтобы использовать действие `TextGenerator` с действием `WriteFillerText`, задайте его в виде <xref:System.Activities.ActivityDelegate.Handler%2A>.</span><span class="sxs-lookup"><span data-stu-id="ccdd8-138">To use the `TextGenerator` activity with the `WriteFillerText` activity, specify it as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#5](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#5)]
