---
description: 'Дополнительные сведения: рекомендации по хранению'
title: Оптимальные методы сохраняемости
ms.date: 03/30/2017
ms.assetid: 6974c5a4-1af8-4732-ab53-7d694608a3a0
ms.openlocfilehash: 788c025d52e504e7a767a4aa0841ae01a7d3327c
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99787881"
---
# <a name="persistence-best-practices"></a><span data-ttu-id="5a25e-103">Оптимальные методы сохраняемости</span><span class="sxs-lookup"><span data-stu-id="5a25e-103">Persistence Best Practices</span></span>

<span data-ttu-id="5a25e-104">В настоящем документе приведены лучшие методики по проектированию и настройке рабочих процессов, касающиеся сохраняемости рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="5a25e-104">This document covers best practices for workflow design and configuration related to workflow persistence.</span></span>  
  
## <a name="design-and-implementation-of-durable-workflows"></a><span data-ttu-id="5a25e-105">Проектирование и реализация устойчивых рабочих процессов</span><span class="sxs-lookup"><span data-stu-id="5a25e-105">Design and Implementation of Durable Workflows</span></span>  

 <span data-ttu-id="5a25e-106">Как правило, рабочие процессы выполняют работу в короткие периоды времени, которые чередуются с промежутками времени, в течение которых рабочие процессы простаивают, ожидая возникновения события.</span><span class="sxs-lookup"><span data-stu-id="5a25e-106">In general, workflows perform work in short periods that are interleaved with times during which the workflow is idle because it is waiting for an event.</span></span> <span data-ttu-id="5a25e-107">Таким событием может быть сообщение или истечение установки таймера.</span><span class="sxs-lookup"><span data-stu-id="5a25e-107">This event can be such things as a message or an expiring timer.</span></span> <span data-ttu-id="5a25e-108">Чтобы иметь возможность выгрузить экземпляр рабочего процесса, когда он становится простаивающим, узел службы должен сохранить этот экземпляр рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="5a25e-108">To be able to unload the workflow instance when it becomes idle, the service host must persist the workflow instance.</span></span> <span data-ttu-id="5a25e-109">Это возможно, только если экземпляр рабочего процесса не находится в зоне несохраняемости (например, ожидает завершения транзакции или ожидает асинхронный обратный вызов).</span><span class="sxs-lookup"><span data-stu-id="5a25e-109">This is possible only if the workflow instance is not in a no-persist zone (for example, waiting for a transaction to complete, or waiting for an asynchronous callback).</span></span> <span data-ttu-id="5a25e-110">Для обеспечения выгрузки простаивающего экземпляра рабочего процесса разработчик рабочих процессов должен использовать области транзакций и асинхронные действия только для кратковременных действий.</span><span class="sxs-lookup"><span data-stu-id="5a25e-110">To allow an idle workflow instance to unload, the workflow author should use transaction scopes and asynchronous activities for short-lived actions only.</span></span> <span data-ttu-id="5a25e-111">В частности, разработчик должен следить за тем, чтобы действия задержки в пределах этих зон несохраняемости были как можно более кратковременными.</span><span class="sxs-lookup"><span data-stu-id="5a25e-111">In particular, the author should keep delay activities within these no-persist zones as short as possible.</span></span>  
  
 <span data-ttu-id="5a25e-112">Сохранение рабочего процесса возможно, только если все типы данных, применяемые в рабочем процессе, являются сериализуемыми.</span><span class="sxs-lookup"><span data-stu-id="5a25e-112">A workflow can only be persisted if all of the data types used by the workflow are serializable.</span></span> <span data-ttu-id="5a25e-113">Кроме того, пользовательские типы, используемые в сохраняемых рабочих процессах, должны быть сериализуемыми с помощью <xref:System.Runtime.Serialization.NetDataContractSerializer>, чтобы быть сохраненными в <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-113">In addition, custom types used in persisted workflows must be serializable with <xref:System.Runtime.Serialization.NetDataContractSerializer> in order to be persisted by <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>.</span></span>  
  
 <span data-ttu-id="5a25e-114">Экземпляр рабочего процесса не может быть восстановлен в случае сбоя узла или компьютера, если он не был сохранен.</span><span class="sxs-lookup"><span data-stu-id="5a25e-114">A workflow instance cannot be recovered in case of a host or computer failure if it has not been persisted.</span></span> <span data-ttu-id="5a25e-115">Вообще говоря, рекомендуется сохранять экземпляр рабочего процесса в жизненном цикле рабочего процесса как можно раньше.</span><span class="sxs-lookup"><span data-stu-id="5a25e-115">In general, we recommend that you persist a workflow instance early in the workflow’s life cycle.</span></span>  
  
 <span data-ttu-id="5a25e-116">Если рабочий процесс занят в течение продолжительного времени, рекомендуется регулярно сохранять экземпляр этого рабочего процесса на протяжении периода его занятости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-116">If your workflow is busy for a long time, we recommend that you persist the workflow instance regularly throughout its busy period.</span></span> <span data-ttu-id="5a25e-117">Это можно обеспечить, добавляя действия <xref:System.Activities.Statements.Persist> по всей последовательности действий, которые поддерживают экземпляр рабочего процесса в состоянии занятости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-117">You can do this by adding <xref:System.Activities.Statements.Persist> activities throughout the sequence of activities that keep the workflow instance busy.</span></span> <span data-ttu-id="5a25e-118">Благодаря этому очистка памяти в домене приложения, сбои узла или сбои компьютера не вынуждают систему выполнять откат к началу периода занятости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-118">In this manner, application domain recycling, host failures, or computer failures do not cause the system to be rolled back to the start of the busy period.</span></span> <span data-ttu-id="5a25e-119">Следует учитывать, что добавление действий <xref:System.Activities.Statements.Persist> к применяемым рабочим процессам приводит к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="5a25e-119">Be aware that adding <xref:System.Activities.Statements.Persist> activities to your workflow could lead to a degradation of performance.</span></span>  
  
 <span data-ttu-id="5a25e-120">Применение Windows Server App Fabric весьма способствует упрощению настройки и использования сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-120">Windows Server App Fabric greatly simplifies the configuration and use of persistence.</span></span> <span data-ttu-id="5a25e-121">Дополнительные сведения см. в статье [сохраняемость в Windows Server App Fabric](/previous-versions/appfabric/ee677272(v=azure.10)) .</span><span class="sxs-lookup"><span data-stu-id="5a25e-121">For more information, see [Windows Server App Fabric Persistence](/previous-versions/appfabric/ee677272(v=azure.10))</span></span>  
  
## <a name="configuration-of-scalability-parameters"></a><span data-ttu-id="5a25e-122">Настройка параметров масштабируемости</span><span class="sxs-lookup"><span data-stu-id="5a25e-122">Configuration of Scalability Parameters</span></span>  

 <span data-ttu-id="5a25e-123">Требования к масштабируемости и производительности определяют значения следующих параметров:</span><span class="sxs-lookup"><span data-stu-id="5a25e-123">Scalability and performance requirements determine the settings of the following parameters:</span></span>  
  
- <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>  
  
- <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>  
  
- <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A>  
  
 <span data-ttu-id="5a25e-124">Эти параметры должны быть заданы следующим образом, согласно текущему сценарию.</span><span class="sxs-lookup"><span data-stu-id="5a25e-124">These parameters should be set as follows, according to the current scenario.</span></span>  
  
### <a name="scenario-a-small-number-of-workflow-instances-that-require-optimal-response-time"></a><span data-ttu-id="5a25e-125">Сценарий. Небольшое количество экземпляров рабочего процесса, которые требуют оптимального времени ответа</span><span class="sxs-lookup"><span data-stu-id="5a25e-125">Scenario: A Small Number of Workflow Instances That Require Optimal Response Time</span></span>  

 <span data-ttu-id="5a25e-126">В этом сценарии все экземпляры рабочего процесса должны оставаться загруженными, когда они становятся простаивающими.</span><span class="sxs-lookup"><span data-stu-id="5a25e-126">In this scenario, all workflow instances should remain loaded when they become idle.</span></span> <span data-ttu-id="5a25e-127">Задайте <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> равным большому значению.</span><span class="sxs-lookup"><span data-stu-id="5a25e-127">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to a large value.</span></span> <span data-ttu-id="5a25e-128">Использование этого параметра препятствует перемещению экземпляра рабочего процесса с одного компьютера на другой.</span><span class="sxs-lookup"><span data-stu-id="5a25e-128">The use of this setting prevents a workflow instance from moving between computers.</span></span> <span data-ttu-id="5a25e-129">Используйте этот параметр, только если соблюдаются одно или несколько из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="5a25e-129">Use this setting only if one or more of the following are true:</span></span>  
  
- <span data-ttu-id="5a25e-130">Экземпляр рабочего процесса получает единственное сообщение на протяжении всего времени своего существования.</span><span class="sxs-lookup"><span data-stu-id="5a25e-130">A workflow instance receives a single message throughout its lifetime.</span></span>  
  
- <span data-ttu-id="5a25e-131">Все экземпляры рабочего процесса запущены на единственном компьютере</span><span class="sxs-lookup"><span data-stu-id="5a25e-131">All workflow instances run on a single computer</span></span>  
  
- <span data-ttu-id="5a25e-132">Все сообщения, полученные экземпляром рабочего процесса, получены одним и тем же компьютером.</span><span class="sxs-lookup"><span data-stu-id="5a25e-132">All messages that are received by a workflow instance are received by the same computer.</span></span>  
  
 <span data-ttu-id="5a25e-133">Используйте действия <xref:System.Activities.Statements.Persist> или задайте <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> равным 0, чтобы включить восстановление применяемого экземпляра рабочего процесса после сбоев узла службы или компьютера.</span><span class="sxs-lookup"><span data-stu-id="5a25e-133">Use <xref:System.Activities.Statements.Persist> activities or set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> to 0 to enable recovery of your workflow instance after service host or computer failures.</span></span>  
  
### <a name="scenario-workflow-instances-are-idle-for-long-periods-of-time"></a><span data-ttu-id="5a25e-134">Сценарий. Экземпляры рабочего процесса простаивают в течение продолжительных промежутков времени</span><span class="sxs-lookup"><span data-stu-id="5a25e-134">Scenario: Workflow Instances Are Idle for Long Periods of Time</span></span>  

 <span data-ttu-id="5a25e-135">В этом сценарии задайте <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> равным 0, чтобы освобождать ресурсы как можно скорее.</span><span class="sxs-lookup"><span data-stu-id="5a25e-135">In this scenario, set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 0 to release resources as soon as possible.</span></span>  
  
### <a name="scenario-workflow-instances-receive-multiple-messages-in-a-short-period-of-time"></a><span data-ttu-id="5a25e-136">Сценарий. Экземпляры рабочих процессов получают множество сообщений за короткий период времени</span><span class="sxs-lookup"><span data-stu-id="5a25e-136">Scenario: Workflow Instances Receive Multiple Messages in a Short Period of Time</span></span>  

 <span data-ttu-id="5a25e-137">В этом сценарии задайте <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> равным 60 секундам, если эти сообщения получены одним и тем же компьютером.</span><span class="sxs-lookup"><span data-stu-id="5a25e-137">In this scenario, set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 60 seconds if these messages are received by the same computer.</span></span> <span data-ttu-id="5a25e-138">Это предотвращает возникновение быстрой последовательности выгрузок и загрузок экземпляра рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="5a25e-138">This prevents a rapid sequence of unloading and loading of a workflow instance.</span></span> <span data-ttu-id="5a25e-139">При этом также экземпляр не остается в памяти слишком долго.</span><span class="sxs-lookup"><span data-stu-id="5a25e-139">This also does not keep the instance in memory for too long.</span></span>  
  
 <span data-ttu-id="5a25e-140">Задайте <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> равным 0 и задайте <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A> равным BasicRetry или AggressiveRetry, если эти сообщения могут быть получены разными компьютерами.</span><span class="sxs-lookup"><span data-stu-id="5a25e-140">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 0, and set <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A> to BasicRetry or AggressiveRetry if these messages may be received by different computers.</span></span> <span data-ttu-id="5a25e-141">Это обеспечивает возможность загрузки экземпляра рабочего процесса другим компьютером.</span><span class="sxs-lookup"><span data-stu-id="5a25e-141">This allows the workflow instance to be loaded by another computer.</span></span>  
  
### <a name="scenario-workflow-uses-delay-activities-with-short-durations"></a><span data-ttu-id="5a25e-142">Сценарий. В рабочем процессе используются действия задержки с краткими продолжительностями</span><span class="sxs-lookup"><span data-stu-id="5a25e-142">Scenario: Workflow Uses Delay Activities with Short Durations</span></span>  

 <span data-ttu-id="5a25e-143">В этом сценарии <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> регулярно опрашивает базу данных сохраняемости на наличие экземпляров, которые должны быть загружены из-за истечения срока действия <xref:System.Activities.Statements.Delay>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-143">In this scenario, the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> regularly polls the persistence database for instances that should be loaded because of an expired <xref:System.Activities.Statements.Delay> activity.</span></span> <span data-ttu-id="5a25e-144">Если <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> находит таймер, установка которого должна истечь в следующем интервале опроса, то хранилище экземпляров рабочих процессов SQL сокращает интервал опроса.</span><span class="sxs-lookup"><span data-stu-id="5a25e-144">If the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> finds a timer that will expire in the next polling interval, the SQL Workflow Instance Store shortens the polling interval.</span></span> <span data-ttu-id="5a25e-145">Следующий опрос затем произойдет сразу после истечения установки таймера.</span><span class="sxs-lookup"><span data-stu-id="5a25e-145">The next poll will then occur right after the timer has expired.</span></span> <span data-ttu-id="5a25e-146">Таким образом, хранилище экземпляров рабочих процессов SQL достигает высокой точности установок таймеров, которые работают дольше по сравнению с продолжительностью интервала опроса, который задан в <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-146">This way, the SQL Workflow Instance Store achieves a high accuracy of timers that run longer than the polling interval, which is set by <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span></span> <span data-ttu-id="5a25e-147">Чтобы обеспечить своевременную обработку более коротких задержек, экземпляр рабочего процесса должен оставаться в памяти в течение по крайней мере одного интервала опроса.</span><span class="sxs-lookup"><span data-stu-id="5a25e-147">To enable timely processing of shorter delays, the workflow instance must remain in memory for at least one polling interval.</span></span>  
  
 <span data-ttu-id="5a25e-148">Задайте <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> равным 0, чтобы записать значение срока действия в базу данных сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-148">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> to 0 to write the expiration time to the persistence database.</span></span>  
  
 <span data-ttu-id="5a25e-149">Задайте значение <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> более продолжительным или равным <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>, чтобы экземпляр оставался в памяти в течение хотя бы одного интервала опроса.</span><span class="sxs-lookup"><span data-stu-id="5a25e-149">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to longer than or equal to <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to keep the instance in memory for at least one polling interval.</span></span>  
  
 <span data-ttu-id="5a25e-150">Не рекомендуется сокращать значение <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>, поскольку это приводит к повышению нагрузки на базу данных сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-150">We do not recommend reducing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> because this leads to an increased load on the persistence database.</span></span> <span data-ttu-id="5a25e-151">Каждый узел службы, который использует <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, опрашивает базу данных единожды в каждый период обнаружения.</span><span class="sxs-lookup"><span data-stu-id="5a25e-151">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the database one time per detection period.</span></span> <span data-ttu-id="5a25e-152">Задание <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> равным слишком малому интервалу времени может вызвать снижение производительности системы, если количество узлов службы велико.</span><span class="sxs-lookup"><span data-stu-id="5a25e-152">Setting <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to too small a time interval may cause your system's performance to decrease if the number of service hosts is large.</span></span>  
  
## <a name="configuring-the-sql-workflow-instance-store"></a><span data-ttu-id="5a25e-153">Настройка хранилища экземпляров рабочих процессов SQL</span><span class="sxs-lookup"><span data-stu-id="5a25e-153">Configuring the SQL Workflow Instance Store</span></span>  

 <span data-ttu-id="5a25e-154">Хранилище экземпляров рабочих процессов SQL имеет следующие параметры конфигурации:</span><span class="sxs-lookup"><span data-stu-id="5a25e-154">The SQL Workflow Instance Store has the following configuration parameters:</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceEncodingOption%2A>  
 <span data-ttu-id="5a25e-155">Этот параметр служит для <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> указанием производить сжатие данных о состоянии экземпляра рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="5a25e-155">This parameter instructs the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to compress the workflow instance state.</span></span> <span data-ttu-id="5a25e-156">Сжатие приводит к уменьшению объема данных, хранящихся в базе данных сохраняемости, и уменьшению сетевого трафика в том случае, если база данных сохраняемости находится на выделенном сервере базы данных.</span><span class="sxs-lookup"><span data-stu-id="5a25e-156">Compression reduces the amount of data that is stored in the persistence database and reduces network traffic in case the persistence database resides on a dedicated database server.</span></span> <span data-ttu-id="5a25e-157">Если используется сжатие, то возникают затраты вычислительных ресурсов на сжатие и извлечение данных о состоянии экземпляра.</span><span class="sxs-lookup"><span data-stu-id="5a25e-157">If compression is used, it requires computational resources to compress and extract the instance state.</span></span> <span data-ttu-id="5a25e-158">В большинстве случаев сжатие приводит к повышению производительности.</span><span class="sxs-lookup"><span data-stu-id="5a25e-158">In most cases, compression yields increased performance.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceCompletionAction%2A>  
 <span data-ttu-id="5a25e-159">Этот параметр служит для <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> указанием либо оставлять, либо удалять завершенные экземпляры.</span><span class="sxs-lookup"><span data-stu-id="5a25e-159">This parameter instructs the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to either keep or delete completed instances.</span></span> <span data-ttu-id="5a25e-160">Хранение завершенных экземпляров становится причиной повышения потребности в памяти для базы данных сохраняемости и приводит к появлению более крупных таблиц, что влечет за собой увеличение затрат времени на поиск в таблицах.</span><span class="sxs-lookup"><span data-stu-id="5a25e-160">Keeping completed instances increases the persistence database storage requirements and leads to larger tables, which increases table lookup times.</span></span> <span data-ttu-id="5a25e-161">Если хранение завершенных экземпляров не требуется для отладки или аудита, то лучше дать указание <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> удалять завершенные экземпляры.</span><span class="sxs-lookup"><span data-stu-id="5a25e-161">Unless completed instances are required for debugging or auditing, it is best to instruct the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to delete completed instances.</span></span> <span data-ttu-id="5a25e-162">Удаленные экземпляры следует хранить, только если пользователь определил процесс их удаления в конечном итоге.</span><span class="sxs-lookup"><span data-stu-id="5a25e-162">Deleted instances should be kept only if the user establishes a process for eventually removing them.</span></span> <span data-ttu-id="5a25e-163">Следует учитывать, что ключи корреляции не могут использоваться повторно, пока завершенный экземпляр рабочего процесса находится в хранилище экземпляров.</span><span class="sxs-lookup"><span data-stu-id="5a25e-163">Note that correlation keys cannot be reused as long as the completed workflow instance resides in the instance store.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>  
 <span data-ttu-id="5a25e-164">Этот параметр определяет максимальный интервал, с которым <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> опрашивает базу данных сохраняемости на наличие экземпляров, которые должны быть загружены по истечении срока действия <xref:System.Activities.Statements.Delay>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-164">This parameter defines the maximum interval with which the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the persistence database for instances that should be loaded when a <xref:System.Activities.Statements.Delay> activity expires.</span></span> <span data-ttu-id="5a25e-165">Если <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> находит таймер, установка которого истечет в следующем интервале опроса, то сокращает интервал опроса так, чтобы следующий опрос произошел сразу после истечения установки таймера.</span><span class="sxs-lookup"><span data-stu-id="5a25e-165">If the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> finds a timer that will expire in the next polling interval, it shortens the polling interval so that the next poll will occur right after the timer has expired.</span></span> <span data-ttu-id="5a25e-166">Благодаря этому в хранилище экземпляров рабочих процессов SQL достигается высокая точность установок таймеров, которые работают дольше, чем <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-166">This way, the SQL Workflow Instance Store achieves a high accuracy of timers that run longer than <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span></span>  
  
 <span data-ttu-id="5a25e-167">Не рекомендуется уменьшать значение <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>, поскольку это приводит к повышению нагрузки на базу данных сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-167">We do not recommend reducing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>, because this leads to an increased load on the persistence database.</span></span> <span data-ttu-id="5a25e-168">Каждый узел службы, который использует <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, опрашивает базу данных единожды в каждый период обнаружения.</span><span class="sxs-lookup"><span data-stu-id="5a25e-168">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the database one time per detection period.</span></span> <span data-ttu-id="5a25e-169">Задание <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> равным слишком малому интервалу может вызвать снижение производительности системы, если количество узлов службы велико.</span><span class="sxs-lookup"><span data-stu-id="5a25e-169">Setting <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to too small an interval may cause your system's performance to decrease if the number of service hosts is large.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>  
 <span data-ttu-id="5a25e-170">Этот параметр определяет интервал, с которым узел возобновляет свою блокировку в базе данных сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-170">This parameter defines the interval with which the host renews its lock in the persistence database.</span></span> <span data-ttu-id="5a25e-171">Сокращение этого интервала позволяет ускорить восстановление экземпляров рабочего процесса в случае сбоя узла или компьютера.</span><span class="sxs-lookup"><span data-stu-id="5a25e-171">Shortening this interval will enable a quicker recovery of the workflow instances in case a host or computer fails.</span></span> <span data-ttu-id="5a25e-172">С другой стороны, сокращение периода возобновления блокировки приводит к повышению нагрузки на базу данных сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a25e-172">On the other hand, a short lock renewal period increases the load on the persistence database.</span></span> <span data-ttu-id="5a25e-173">Каждый узел службы, который использует <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, обновляет свои блокировки в базе данных единожды за каждый период возобновления.</span><span class="sxs-lookup"><span data-stu-id="5a25e-173">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> will update its locks in the database one time per renewal period.</span></span> <span data-ttu-id="5a25e-174">Если на компьютере работает много узлов служб, убедитесь в том, что нагрузка, вызванная возобновлением блокировок, не приводит к снижению производительности системы.</span><span class="sxs-lookup"><span data-stu-id="5a25e-174">If a computer runs many service hosts, make sure that the load caused by lock renewal does not decrease your system's performance.</span></span> <span data-ttu-id="5a25e-175">Если же происходит снижение, рассмотрите возможность увеличить <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-175">If it does, consider increasing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A>  
 <span data-ttu-id="5a25e-176">Если это включено, то <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> предпринимает повторные попытки загрузки заблокированного экземпляра в течение следующих 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5a25e-176">If enabled, the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> retries to load a locked instance for the next 30 seconds.</span></span> <span data-ttu-id="5a25e-177">Задайте <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> равным BasicRetry или AggressiveRetry, если рабочий процесс получает множество сообщений за короткое время и получение этих сообщений происходит разными компьютерами.</span><span class="sxs-lookup"><span data-stu-id="5a25e-177">Set <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> to BasicRetry or AggressiveRetry if the workflow receives multiple messages in a short time, and these messages are received by different computers.</span></span>  
  
 <span data-ttu-id="5a25e-178">Таким образом, этот механизм повторения загрузки не порождает издержек производительности, пока не предпринимаются попытки повторения загрузки, поэтому следует всегда включать <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A>.</span><span class="sxs-lookup"><span data-stu-id="5a25e-178">Because the load retry mechanism does not introduce any performance overhead as long as load retries are not tried, <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> should always be enabled.</span></span>
