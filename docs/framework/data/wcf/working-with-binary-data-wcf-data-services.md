---
description: 'Дополнительные сведения: работа с двоичными данными (службы данных WCF)'
title: Работа с двоичными данными (службы данных WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, binary data
- WCF Data Services, streams
ms.assetid: aeccc45c-d5c5-4671-ad63-a492ac8043ac
ms.openlocfilehash: dfcc5f03376d2f84267d8648acf55fb1aa96e318
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99748106"
---
# <a name="working-with-binary-data-wcf-data-services"></a><span data-ttu-id="d6078-103">Работа с двоичными данными (службы данных WCF)</span><span class="sxs-lookup"><span data-stu-id="d6078-103">Working with Binary Data (WCF Data Services)</span></span>

[!INCLUDE [wcf-deprecated](~/includes/wcf-deprecated.md)]

<span data-ttu-id="d6078-104">Клиентская библиотека службы данных WCF позволяет извлекать и обновлять двоичные данные из канала Open Data Protocol (OData) одним из следующих способов:</span><span class="sxs-lookup"><span data-stu-id="d6078-104">The WCF Data Services client library enables you to retrieve and update binary data from an Open Data Protocol (OData) feed in one of the following ways:</span></span>

- <span data-ttu-id="d6078-105">В качестве свойства сущности примитивного типа.</span><span class="sxs-lookup"><span data-stu-id="d6078-105">As a primitive type property of an entity.</span></span> <span data-ttu-id="d6078-106">Этот метод рекомендуется использовать при работе с небольшими двоичными объектами данных, которые могут быть легко загружены в память.</span><span class="sxs-lookup"><span data-stu-id="d6078-106">This is the recommended method for working with small binary data objects that can be easily loaded into memory.</span></span> <span data-ttu-id="d6078-107">В этом случае двоичное свойство представляет собой свойство сущности, предоставленное моделью данных, служба данных сериализует двоичные данные в ответном сообщении как XML-элемент с двоичной кодировкой с базой 64.</span><span class="sxs-lookup"><span data-stu-id="d6078-107">In this case, the binary property is an entity property exposed by the data model, and the data service serializes the binary data as base-64 binary encoded XML in the response message.</span></span>

- <span data-ttu-id="d6078-108">В качестве отдельного потока двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="d6078-108">As a separate binary resource stream.</span></span> <span data-ttu-id="d6078-109">Этот метод рекомендуется использовать для доступа и изменения данных больших двоичных объектов, которые могут представлять фото, видео или другие типы данных с двоичной кодировкой.</span><span class="sxs-lookup"><span data-stu-id="d6078-109">This is the recommended method for accessing and changing binary large object (BLOB) data that may represent a photo, video, or any other type of binary encoded data.</span></span>

<span data-ttu-id="d6078-110">Службы данных WCF реализует потоковую передачу двоичных данных с помощью HTTP, как определено в OData.</span><span class="sxs-lookup"><span data-stu-id="d6078-110">WCF Data Services implements the streaming of binary data by using HTTP as defined in the OData.</span></span> <span data-ttu-id="d6078-111">В этом подходе двоичные данные обрабатываются как медиаресурс, отделенный, но при этом связанный с сущностью, которая называется медиассылкой.</span><span class="sxs-lookup"><span data-stu-id="d6078-111">In this mechanism, binary data is treated as a media resource that is separate from but related to an entity, which is called a media link entry.</span></span> <span data-ttu-id="d6078-112">Дополнительные сведения см. в разделе [Streaming Provider](streaming-provider-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="d6078-112">For more information, see [Streaming Provider](streaming-provider-wcf-data-services.md).</span></span>

> [!TIP]
> <span data-ttu-id="d6078-113">Пошаговый пример создания клиентского приложения Windows Presentation Foundation (WPF), которое скачивает двоичные файлы изображений из службы OData, в которой хранятся фотографии, см. в разделе Post [Data Services Streaming Provider Series-Part 2: доступ к потоку ресурсов мультимедиа от клиента](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="d6078-113">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="d6078-114">Чтобы скачать пример кода для службы данных для воспроизведения потока, как показано в записи блога, см. [Пример потоковой передачи Photo Data](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) Service на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="d6078-114">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

## <a name="entity-metadata"></a><span data-ttu-id="d6078-115">Метаданные сущности</span><span class="sxs-lookup"><span data-stu-id="d6078-115">Entity Metadata</span></span>

<span data-ttu-id="d6078-116">Сущность со связанным потоком медиаисточника указывается в метаданных службы данных с помощью атрибута `HasStream`, применяемого к типу сущности, который является ссылкой на данные.</span><span class="sxs-lookup"><span data-stu-id="d6078-116">An entity that has a related media resource stream is indicated in the data service metadata by the `HasStream` attribute applied to an entity type that is the media link entry.</span></span> <span data-ttu-id="d6078-117">В следующем примере `PhotoInfo` сущность — это запись ссылки на носитель, которая содержит связанный ресурс мультимедиа, обозначенный `HasStream` атрибутом.</span><span class="sxs-lookup"><span data-stu-id="d6078-117">In the following example, the `PhotoInfo` entity is a media link entry that has a related media resource, indicated by the `HasStream` attribute.</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="d6078-118">В остальных примерах этого раздела описываются способы доступа к потоку медиаресурса и его изменения.</span><span class="sxs-lookup"><span data-stu-id="d6078-118">The remaining examples in this topic show how to access and change the media resource stream.</span></span> <span data-ttu-id="d6078-119">Полный пример использования потока ресурсов мультимедиа в клиентском приложении платформа .NET Framework с помощью клиентской библиотеки службы данных WCF см. в разделе Передача [доступа к потоку ресурсов мультимедиа от клиента](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="d6078-119">For a complete example of how to consume a media resource stream in a .NET Framework client application by using the WCF Data Services client library, see the post [Accessing a Media Resource Stream from the Client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span>

## <a name="accessing-the-binary-resource-stream"></a><span data-ttu-id="d6078-120">Получение доступа к потоку двоичных данных</span><span class="sxs-lookup"><span data-stu-id="d6078-120">Accessing the Binary Resource Stream</span></span>

<span data-ttu-id="d6078-121">Клиентская библиотека службы данных WCF предоставляет методы для доступа к потокам двоичных ресурсов из службы данных на основе OData.</span><span class="sxs-lookup"><span data-stu-id="d6078-121">The WCF Data Services client library provides methods for accessing binary resource streams from an OData-based data service.</span></span> <span data-ttu-id="d6078-122">При загрузке медиаресурса можно использовать URI-идентификатор медиаресурса или получить двоичный поток, непосредственно содержащий данные медиаресурса.</span><span class="sxs-lookup"><span data-stu-id="d6078-122">When downloading a media resource, you can either use the URI of the media resource or you can get a binary stream that contains the media resource data itself.</span></span> <span data-ttu-id="d6078-123">Можно также загрузить данные медиаресурса в виде двоичного потока.</span><span class="sxs-lookup"><span data-stu-id="d6078-123">You can also upload media resource data as a binary stream.</span></span>

> [!TIP]
> <span data-ttu-id="d6078-124">Пошаговый пример создания клиентского приложения Windows Presentation Foundation (WPF), которое скачивает двоичные файлы изображений из службы OData, в которой хранятся фотографии, см. в разделе Post [Data Services Streaming Provider Series-Part 2: доступ к потоку ресурсов мультимедиа от клиента](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="d6078-124">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="d6078-125">Чтобы скачать пример кода для службы данных для воспроизведения потока, как показано в записи блога, см. [Пример потоковой передачи Photo Data](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) Service на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="d6078-125">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

### <a name="getting-the-uri-of-the-binary-stream"></a><span data-ttu-id="d6078-126">Получение URI-идентификатора двоичного потока</span><span class="sxs-lookup"><span data-stu-id="d6078-126">Getting the URI of the Binary Stream</span></span>

<span data-ttu-id="d6078-127">При получении определенных типов медиаресурсов, таких как изображения и другие медиафайлы, часто бывает проще использовать URI-идентификатор приложения, чем обрабатывать непосредственно источник двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="d6078-127">When retrieving certain types of media resources, such as images and other media files, it is often easier to use the URI of the media resource in your application than handling the binary data stream itself.</span></span> <span data-ttu-id="d6078-128">Чтобы получить URI-идентификатор потока ресурса, связанный с определенной ссылкой на данные, следует вызвать метод <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> для экземпляра <xref:System.Data.Services.Client.DataServiceContext>, который отслеживает сущность.</span><span class="sxs-lookup"><span data-stu-id="d6078-128">To get the URI of a resource stream associated with a give media link entry, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="d6078-129">В этом примере показан порядок вызова метода <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A>, получающего URI-идентификатор потока медиаресурса, который используется для создания нового изображения на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="d6078-129">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method to get the URI of a media resource stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photowindow.xaml.cs#getreadstreamuri)]
[!code-vb[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photowindow.xaml.vb#getreadstreamuri)]

### <a name="downloading-the-binary-resource-stream"></a><span data-ttu-id="d6078-130">Загрузка двоичного потока ресурса</span><span class="sxs-lookup"><span data-stu-id="d6078-130">Downloading the Binary Resource Stream</span></span>

<span data-ttu-id="d6078-131">При получении двоичного потока ресурса следует вызвать метод <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> для экземпляра <xref:System.Data.Services.Client.DataServiceContext>, который отслеживает ссылку на данные.</span><span class="sxs-lookup"><span data-stu-id="d6078-131">When retrieving a binary resource stream, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the media link entry.</span></span> <span data-ttu-id="d6078-132">Этот метод отправляет запрос службе данных, возвращающей объект <xref:System.Data.Services.Client.DataServiceStreamResponse>, который содержит ссылку на поток, содержащий медиаресурс.</span><span class="sxs-lookup"><span data-stu-id="d6078-132">This method sends a request to the data service that returns a <xref:System.Data.Services.Client.DataServiceStreamResponse> object, which has a reference to the stream that contains the resource.</span></span> <span data-ttu-id="d6078-133">Этот метод используется, если приложение требует двоичный файл ресурса в виде <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="d6078-133">Use this method when your application requires the binary resource as a <xref:System.IO.Stream>.</span></span> <span data-ttu-id="d6078-134">В следующем примере показано, как вызвать метод <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> для получения потока, используемого для создания нового изображения на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="d6078-134">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method to retrieve a stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_streaming_client/cs/customerphotowindow.xaml.cs#getreadstreamclient)]
[!code-vb[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_streaming_client/vb/customerphotowindow.xaml.vb#getreadstreamclient)]

> [!NOTE]
> <span data-ttu-id="d6078-135">Заголовок Content-Length в ответном сообщении, в котором содержится поток двоичных данных, не заданный службой данных.</span><span class="sxs-lookup"><span data-stu-id="d6078-135">The Content-Length header in the response message that contains the binary steam is not set by the data service.</span></span> <span data-ttu-id="d6078-136">Это значение может не отражать фактическую длину потока двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="d6078-136">This value may not reflect the actual length of the binary data stream.</span></span>

### <a name="uploading-a-media-resource-as-a-stream"></a><span data-ttu-id="d6078-137">Передача медиаресурса в виде потока</span><span class="sxs-lookup"><span data-stu-id="d6078-137">Uploading a Media Resource as a Stream</span></span>

<span data-ttu-id="d6078-138">Чтобы вставить или обновить медиаресурс, вызовите метод <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> для экземпляра <xref:System.Data.Services.Client.DataServiceContext>, который отслеживает сущность.</span><span class="sxs-lookup"><span data-stu-id="d6078-138">To insert or update a media resource, call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="d6078-139">Этот метод отправляет запрос службе данных, содержащей медиаресурс, считанный из предоставленного потока.</span><span class="sxs-lookup"><span data-stu-id="d6078-139">This method sends a request to the data service that contains the media resource read from the supplied stream.</span></span> <span data-ttu-id="d6078-140">В следующем примере показано, как вызвать метод <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, чтобы отправить изображение в службу данных.</span><span class="sxs-lookup"><span data-stu-id="d6078-140">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to send an image to the data service:</span></span>

[!code-csharp[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photodetailswindow.xaml.cs#setsavestream)]
[!code-vb[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photodetailswindow.xaml.vb#setsavestream)]

<span data-ttu-id="d6078-141">В этом примере метод <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> вызывается с помощью присвоения значения `true` параметру `closeStream`.</span><span class="sxs-lookup"><span data-stu-id="d6078-141">In this example, the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method is called by supplying a value of `true` for the `closeStream` parameter.</span></span> <span data-ttu-id="d6078-142">Благодаря этому объект <xref:System.Data.Services.Client.DataServiceContext> гарантированно закрывает поток после загрузки двоичных данных в службу данных.</span><span class="sxs-lookup"><span data-stu-id="d6078-142">This guarantees that the <xref:System.Data.Services.Client.DataServiceContext> closes the stream after the binary data is uploaded to the data service.</span></span>

> [!NOTE]
> <span data-ttu-id="d6078-143">При вызове метода <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> поток не отправляется в службу данных, пока не будет вызван метод <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="d6078-143">When you call <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, the stream is not sent to the data service until <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called.</span></span>

## <a name="see-also"></a><span data-ttu-id="d6078-144">См. также</span><span class="sxs-lookup"><span data-stu-id="d6078-144">See also</span></span>

- [<span data-ttu-id="d6078-145">Библиотека клиентов служб данных WCF</span><span class="sxs-lookup"><span data-stu-id="d6078-145">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)
- [<span data-ttu-id="d6078-146">Привязка данных к элементам управления</span><span class="sxs-lookup"><span data-stu-id="d6078-146">Binding Data to Controls</span></span>](binding-data-to-controls-wcf-data-services.md)
