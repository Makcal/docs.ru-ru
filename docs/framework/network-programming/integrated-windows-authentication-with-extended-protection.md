---
description: 'Узнайте подробнее о: Встроенная аутентификация Windows с расширенной защитой'
title: Встроенная аутентификация Windows с расширенной защитой
ms.date: 03/30/2017
ms.assetid: 81731998-d5e7-49e4-ad38-c8e6d01689d0
ms.openlocfilehash: 56f69d0c2fe5def43e640d687b12a45c17292d67
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99801895"
---
# <a name="integrated-windows-authentication-with-extended-protection"></a><span data-ttu-id="252ea-103">Встроенная аутентификация Windows с расширенной защитой</span><span class="sxs-lookup"><span data-stu-id="252ea-103">Integrated Windows Authentication with Extended Protection</span></span>

<span data-ttu-id="252ea-104">Были добавлены улучшения, которые влияют на обработку встроенной проверки подлинности Windows в <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream> и связанных классах в <xref:System.Net> и соответствующих пространствах имен.</span><span class="sxs-lookup"><span data-stu-id="252ea-104">Enhancements were made that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream>, and related classes in the <xref:System.Net> and related namespaces.</span></span> <span data-ttu-id="252ea-105">Была добавлена поддержка расширенной защиты для повышения безопасности.</span><span class="sxs-lookup"><span data-stu-id="252ea-105">Support was added for extended protection to enhance security.</span></span>  
  
 <span data-ttu-id="252ea-106">Эти изменения могут влиять на приложения, которые используют эти классы для создания веб-запросов и получения ответов, в которых используется встроенная проверка подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="252ea-106">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication is used.</span></span> <span data-ttu-id="252ea-107">Это изменение также может повлиять на веб-серверы и клиентские приложения, в которых используется встроенная проверка подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="252ea-107">This change can also impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="252ea-108">Эти изменения могут также влиять на приложения, которые используют эти классы для создания других типов запросов и получения ответов, в которых используется встроенная проверка подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="252ea-108">These changes can also affect applications that use these classes to make other types of requests and receive responses where integrated Windows authentication is used.</span></span>  
  
 <span data-ttu-id="252ea-109">Изменения для поддержки расширенной защиты будут доступны только для приложений в Windows 7 и Windows Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="252ea-109">The changes to support extended protection are available only for applications on Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="252ea-110">Функции расширенной защиты недоступны в более ранних версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="252ea-110">The extended protection features are not available on earlier versions of Windows.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="252ea-111">Обзор</span><span class="sxs-lookup"><span data-stu-id="252ea-111">Overview</span></span>  

 <span data-ttu-id="252ea-112">Структура встроенной проверки подлинности Windows позволяет формировать универсальные ответы на некоторые запросы учетных данных. Это означает, что эти ответы можно повторно использовать или перенаправлять.</span><span class="sxs-lookup"><span data-stu-id="252ea-112">The design of integrated Windows authentication allows for some credential challenge responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="252ea-113">Ответы на запросы должны обязательно содержать сведения о целевом объекте, а также могут содержать некоторые сведения о канале.</span><span class="sxs-lookup"><span data-stu-id="252ea-113">The challenge responses should be constructed at a minimum with target specific information and preferably also with some channel specific information.</span></span> <span data-ttu-id="252ea-114">Кроме того, службы могут предоставлять расширенную защиту, чтобы в ответах на запросы учетных данных также содержались сведения о службе, например имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-114">Services can then provide extended protection to ensure that credential challenge responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="252ea-115">С включением этих сведений в ответы на запросы учетных данных службы могут обеспечить лучшую защиту при изменении ответов на запросы учетных данных злоумышленниками.</span><span class="sxs-lookup"><span data-stu-id="252ea-115">With this information in the credential exchanges, services are able to better protect against malicious use of credential challenge responses that might have been improperly used.</span></span>  
  
 <span data-ttu-id="252ea-116">Механизм расширенной защиты представляет собой улучшение протоколов проверки подлинности, предназначенное для исключения атак на ретрансляторы проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="252ea-116">The extended protection design is an enhancement to authentication protocols designed to mitigate authentication relay attacks.</span></span> <span data-ttu-id="252ea-117">Это улучшение связано с концепцией каналов и сведениями о привязке службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-117">It revolves around the concept of channel and service binding information.</span></span>  
  
 <span data-ttu-id="252ea-118">Общие цели улучшения таковы.</span><span class="sxs-lookup"><span data-stu-id="252ea-118">The overall objectives are the following:</span></span>  
  
1. <span data-ttu-id="252ea-119">При обновлении клиента для поддержки расширенной защиты приложения должны предоставить сведения о привязке канала и привязке службы для всех поддерживаемых протоколов проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="252ea-119">If the client is updated to support the extended protection, applications should supply a channel binding and service binding information to all supported authentication protocols.</span></span> <span data-ttu-id="252ea-120">Сведения о привязке канала могут быть предоставлены только при наличии канала (TLS), к которому выполняется привязка.</span><span class="sxs-lookup"><span data-stu-id="252ea-120">Channel binding information can only be supplied when there is a channel (TLS) to bind to.</span></span> <span data-ttu-id="252ea-121">Сведения о привязке службы должны предоставляться всегда.</span><span class="sxs-lookup"><span data-stu-id="252ea-121">Service binding information should always be supplied.</span></span>  
  
2. <span data-ttu-id="252ea-122">Обновленные серверы, которые правильно настроены, могут проверять сведения о привязке для канала и службы, если эти сведения содержатся в маркере проверки подлинности клиента, и отклонять попытки проверки подлинности, если привязки каналов не совпадают.</span><span class="sxs-lookup"><span data-stu-id="252ea-122">Updated servers which are properly configured may verify the channel and service binding information when it is present in the client authentication token and reject the authentication attempt if the channel bindings do not match.</span></span> <span data-ttu-id="252ea-123">В зависимости от сценария развертывания серверы могут проверять привязку канала, привязку службы или обе привязки.</span><span class="sxs-lookup"><span data-stu-id="252ea-123">Depending on the deployment scenario, servers may verify channel binding, service binding or both.</span></span>  
  
3. <span data-ttu-id="252ea-124">Обновленные серверы могут принимать или отклонять запросы клиентов нижнего уровня, которые не содержат сведений о привязке канала, на основе политики.</span><span class="sxs-lookup"><span data-stu-id="252ea-124">Updated servers have the ability to accept or reject down-level client requests that do not contain the channel binding information based on policy.</span></span>  
  
 <span data-ttu-id="252ea-125">Сведения, используемые для расширенной защиты, включают в себя один или оба следующих компонента:</span><span class="sxs-lookup"><span data-stu-id="252ea-125">Information used by extended protection consists of one or both of the following two parts:</span></span>  
  
1. <span data-ttu-id="252ea-126">Маркер привязки канала.</span><span class="sxs-lookup"><span data-stu-id="252ea-126">A Channel Binding Token or CBT.</span></span>  
  
2. <span data-ttu-id="252ea-127">Сведения о привязке службы в виде имени субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-127">Service Binding information in the form of a Service Principal Name or SPN.</span></span>  
  
 <span data-ttu-id="252ea-128">Сведения о привязке службы свидетельствуют о намерении клиента проверить подлинность для конкретной конечной точки службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-128">Service Binding information is an indication of a client’s intent to authenticate to a particular service endpoint.</span></span> <span data-ttu-id="252ea-129">Эти сведения передаются от клиента на сервер с помощью следующих свойств:</span><span class="sxs-lookup"><span data-stu-id="252ea-129">It is communicated from client to server with the following properties:</span></span>  
  
- <span data-ttu-id="252ea-130">Значение имени субъекта-службы должно быть доступно на сервере, выполняющем проверку подлинности клиента, в виде открытого текста.</span><span class="sxs-lookup"><span data-stu-id="252ea-130">The SPN value must be available to the server performing client authentication in clear text form.</span></span>  
  
- <span data-ttu-id="252ea-131">Значение имени субъекта-службы является открытым.</span><span class="sxs-lookup"><span data-stu-id="252ea-131">The value of the SPN is public.</span></span>  
  
- <span data-ttu-id="252ea-132">Имя субъекта-службы должно быть криптографически защищено во время передачи, чтобы его было невозможно вставить, удалить или изменить с помощью атаки "человек посередине".</span><span class="sxs-lookup"><span data-stu-id="252ea-132">The SPN must be cryptographically protected in transit such that a man-in-the-middle attack cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="252ea-133">Маркер привязки канала — это свойство внешнего безопасного канала (например, TLS), которое используется для привязки этого канала к обмену данными во внутреннем канале, проверку подлинности которого выполнил клиент.</span><span class="sxs-lookup"><span data-stu-id="252ea-133">A CBT is a property of the outer secure channel (such as TLS) used to tie (bind) it to a conversation over an inner, client-authenticated channel.</span></span> <span data-ttu-id="252ea-134">Маркер привязки канала должен иметь следующие свойства (эти свойства также определяются в стандарте RFC 5056, принятом IETF):</span><span class="sxs-lookup"><span data-stu-id="252ea-134">The CBT must have the following properties (also defined by IETF RFC 5056):</span></span>  
  
- <span data-ttu-id="252ea-135">При наличии внешнего канала значение маркера привязки канала должно определять внешний канал или конечную точку сервера. Маркер привязки канала должен быть получен обеими сторонами обмена (клиентской и серверной) независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="252ea-135">When an outer channel exists, the value of the CBT must be a property identifying either the outer channel or the server endpoint, independently arrived at by both client and server sides of a conversation.</span></span>  
  
- <span data-ttu-id="252ea-136">Злоумышленник не должен иметь возможность повлиять на значение маркера привязки канала.</span><span class="sxs-lookup"><span data-stu-id="252ea-136">Value of the CBT sent by the client must not be something an attacker can influence.</span></span>  
  
- <span data-ttu-id="252ea-137">Конфиденциальность маркера привязки канала не гарантируется.</span><span class="sxs-lookup"><span data-stu-id="252ea-137">No guarantees are made about secrecy of the CBT value.</span></span> <span data-ttu-id="252ea-138">Однако это не означает, что значение привязки службы и сведения о привязке канала могут быть доступны кому-то, кроме сервера, выполняющего проверку подлинности, так как протокол, посредством которого передается маркер привязки канала, может шифровать этот маркер.</span><span class="sxs-lookup"><span data-stu-id="252ea-138">This does not however mean that the value of the service binding as well as channel binding information can always be examined by any other but the server performing authentication, as the protocol carrying the CBT may be encrypting it.</span></span>  
  
- <span data-ttu-id="252ea-139">Целостность маркера привязки канала должна быть криптографически защищена во время передачи, чтобы его значение было невозможно вставить, удалить или изменить с помощью атаки "человек посередине".</span><span class="sxs-lookup"><span data-stu-id="252ea-139">The CBT must be cryptographically integrity protected in transit such that an attacker cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="252ea-140">Привязка канала выполняется клиентом, который передает имя субъекта-службы и маркер привязки канала на сервер в защищенном режиме.</span><span class="sxs-lookup"><span data-stu-id="252ea-140">Channel binding is accomplished by the client transferring the SPN and the CBT to the server in a tamperproof fashion.</span></span> <span data-ttu-id="252ea-141">Сервер проверяет сведения о привязке канала в соответствии со своей политикой и отклоняет попытки проверки подлинности, целевым объектом которых он не является.</span><span class="sxs-lookup"><span data-stu-id="252ea-141">The server validates the channel binding information in accordance with its policy and rejects authentication attempts for which it does not believe itself to have been the intended target.</span></span> <span data-ttu-id="252ea-142">Таким образом, два каналы становятся криптографически связанными друг с другом.</span><span class="sxs-lookup"><span data-stu-id="252ea-142">This way, the two channels become cryptographically bound together.</span></span>  
  
 <span data-ttu-id="252ea-143">Для сохранения совместимости с существующими клиентами и приложениями сервер можно настроить таким образом, чтобы разрешить попытки проверки подлинности для клиентов, которые еще не поддерживают расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="252ea-143">To preserve compatibility with existing clients and applications, a server may be configured to allow authentication attempts by clients that do not yet support extended protection.</span></span> <span data-ttu-id="252ea-144">Это называется "частично усиленной" конфигурацией в отличие от "полностью усиленной" конфигурации.</span><span class="sxs-lookup"><span data-stu-id="252ea-144">This is referred to as a "partially hardened" configuration, in contrast to a "fully hardened" configuration.</span></span>  
  
 <span data-ttu-id="252ea-145">Несколько компонентов в пространствах имен <xref:System.Net> и <xref:System.Net.Security> выполняют встроенную проверку подлинности Windows от имени вызывающего приложения.</span><span class="sxs-lookup"><span data-stu-id="252ea-145">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="252ea-146">В этом разделе описаны изменения в компонентах System.Net для добавления расширенной защиты при использовании встроенной проверки подлинности Windows в этих компонентах.</span><span class="sxs-lookup"><span data-stu-id="252ea-146">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="252ea-147">Расширенная защита поддерживается в Windows 7.</span><span class="sxs-lookup"><span data-stu-id="252ea-147">Extended protection is currently supported on Windows 7.</span></span> <span data-ttu-id="252ea-148">Предоставляется механизм, с помощью которого приложение может определить, поддерживает ли операционная система расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="252ea-148">A mechanism is provided so an application can determine if the operating system supports extended protection.</span></span>  
  
## <a name="changes-to-support-extended-protection"></a><span data-ttu-id="252ea-149">Изменения для поддержки расширенной защиты</span><span class="sxs-lookup"><span data-stu-id="252ea-149">Changes to Support Extended Protection</span></span>  

 <span data-ttu-id="252ea-150">Процесс проверки подлинности, используемый со встроенной проверкой подлинности Windows, в зависимости от протокола проверки подлинности часто включает в себя запрос, который выдается компьютером назначения и отправляется обратно на клиентский компьютер.</span><span class="sxs-lookup"><span data-stu-id="252ea-150">The authentication process used with integrated Windows authentication, depending on the authentication protocol used, often includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="252ea-151">Расширенная защита добавляет новые функции при проверке подлинности</span><span class="sxs-lookup"><span data-stu-id="252ea-151">Extended protection adds new features to this authentication process</span></span>  
  
 <span data-ttu-id="252ea-152">Пространство имен <xref:System.Security.Authentication.ExtendedProtection> обеспечивает поддержку проверки подлинности для приложений с использованием расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="252ea-152">The <xref:System.Security.Authentication.ExtendedProtection> namespace provides support for authentication using extended protection for applications.</span></span> <span data-ttu-id="252ea-153">Класс <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> в этом пространстве имен представляет привязку каналов.</span><span class="sxs-lookup"><span data-stu-id="252ea-153">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> class in this namespace represents a channel binding.</span></span> <span data-ttu-id="252ea-154">Класс <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> в этом пространстве имен представляет политику расширенной защиты, используемую сервером для проверки входящих клиентских подключений.</span><span class="sxs-lookup"><span data-stu-id="252ea-154">The <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class in this namespace represents the extended protection policy used by the server to validate incoming client connections.</span></span> <span data-ttu-id="252ea-155">Другие члены класса используются с расширенной защитой.</span><span class="sxs-lookup"><span data-stu-id="252ea-155">Other class members are used with extended protection.</span></span>  
  
 <span data-ttu-id="252ea-156">Для серверных приложений к таким классам относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="252ea-156">For server applications, these classes include the following:</span></span>  
  
 <span data-ttu-id="252ea-157">Класс <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>, содержащий следующие элементы:</span><span class="sxs-lookup"><span data-stu-id="252ea-157">A <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> that has the following elements:</span></span>  
  
- <span data-ttu-id="252ea-158">Свойство <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A>, которое указывает, поддерживает ли операционная система встроенную проверку подлинности Windows с расширенной защитой.</span><span class="sxs-lookup"><span data-stu-id="252ea-158">An <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> property that indicates whether the operating system supports integrated windows authentication with extended protection.</span></span>  
  
- <span data-ttu-id="252ea-159">Значение <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement>, указывающее, когда следует применять расширенную политику защиты.</span><span class="sxs-lookup"><span data-stu-id="252ea-159">A <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> value that indicates when the extended protection policy should be enforced.</span></span>  
  
- <span data-ttu-id="252ea-160">Значение <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario>, которое указывает сценарий развертывания.</span><span class="sxs-lookup"><span data-stu-id="252ea-160">A <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> value that indicates the deployment scenario.</span></span> <span data-ttu-id="252ea-161">Это влияет на проверку расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="252ea-161">This influences how extended protection is checked.</span></span>  
  
- <span data-ttu-id="252ea-162">Необязательный объект <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection>, содержащий пользовательский список имен субъектов-служб, который используется для проверки имени субъекта-службы, предоставленного клиентом в виде целевого объекта проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="252ea-162">An optional <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> that contains the custom SPN list that is used to match against the SPN provided by the client as the intended target of the authentication.</span></span>  
  
- <span data-ttu-id="252ea-163">Необязательный объект <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding>, содержащий пользовательскую привязку канала, используемую при проверке.</span><span class="sxs-lookup"><span data-stu-id="252ea-163">An optional <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> that contains a custom channel binding to use for validation.</span></span> <span data-ttu-id="252ea-164">Этот сценарий не является наиболее распространенным.</span><span class="sxs-lookup"><span data-stu-id="252ea-164">This scenario is not a common case</span></span>  
  
 <span data-ttu-id="252ea-165">Пространство имен <xref:System.Security.Authentication.ExtendedProtection.Configuration> обеспечивает поддержку настройки проверки подлинности для приложений с использованием расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="252ea-165">The <xref:System.Security.Authentication.ExtendedProtection.Configuration> namespace provides support for configuration of authentication using extended protection for applications.</span></span>  
  
 <span data-ttu-id="252ea-166">В существующем пространстве имен <xref:System.Net> были изменены некоторые функции для поддержки расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="252ea-166">A number of feature changes were made to support extended protection in the existing <xref:System.Net> namespace.</span></span> <span data-ttu-id="252ea-167">К этим изменениям относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="252ea-167">These changes include the following:</span></span>  
  
- <span data-ttu-id="252ea-168">В пространство имен <xref:System.Net> добавлен новый класс <xref:System.Net.TransportContext>, который представляет контекст транспорта.</span><span class="sxs-lookup"><span data-stu-id="252ea-168">A new <xref:System.Net.TransportContext> class added to the <xref:System.Net> namespace that represents a transport context.</span></span>  
  
- <span data-ttu-id="252ea-169">В класс <xref:System.Net.HttpWebRequest> добавлены новые перегрузки методов <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> и <xref:System.Net.HttpWebRequest.GetRequestStream%2A>, которые позволяют получить <xref:System.Net.TransportContext> для поддержки расширенной защиты клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="252ea-169">New <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> and <xref:System.Net.HttpWebRequest.GetRequestStream%2A> overload methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="252ea-170">Дополнения к классам <xref:System.Net.HttpListener> и <xref:System.Net.HttpListenerRequest> для поддержки серверных приложений.</span><span class="sxs-lookup"><span data-stu-id="252ea-170">Additions to the <xref:System.Net.HttpListener> and <xref:System.Net.HttpListenerRequest> classes to support server applications.</span></span>  
  
 <span data-ttu-id="252ea-171">Была изменена функция для поддержки расширенной защиты для клиентских приложений SMTP в существующем пространстве имен <xref:System.Net.Mail>:</span><span class="sxs-lookup"><span data-stu-id="252ea-171">A feature change was made to support extended protection for SMTP client applications in the existing <xref:System.Net.Mail> namespace:</span></span>  
  
- <span data-ttu-id="252ea-172">Свойство <xref:System.Net.Mail.SmtpClient.TargetName%2A> в классе <xref:System.Net.Mail.SmtpClient>, которое представляет имя участника-службы, используемое для проверки подлинности при использовании расширенной защиты для клиентских приложений SMTP.</span><span class="sxs-lookup"><span data-stu-id="252ea-172">A <xref:System.Net.Mail.SmtpClient.TargetName%2A> property in the <xref:System.Net.Mail.SmtpClient> class that represents the SPN to use for authentication when using extended protection for SMTP client applications.</span></span>  
  
 <span data-ttu-id="252ea-173">В существующем пространстве имен <xref:System.Net.Security> были изменены некоторые функции для поддержки расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="252ea-173">A number of feature changes were made to support extended protection in the existing <xref:System.Net.Security> namespace.</span></span> <span data-ttu-id="252ea-174">К этим изменениям относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="252ea-174">These changes include the following:</span></span>  
  
- <span data-ttu-id="252ea-175">В класс <xref:System.Net.Security.NegotiateStream> добавлены новые перегрузки методов <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> и <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A>, которые позволяют передавать маркер привязки канала для поддержки расширенной защиты клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="252ea-175">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing a CBT to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="252ea-176">В класс <xref:System.Net.Security.NegotiateStream> добавлены новые перегрузки методов <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> и <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A>, которые позволяют передавать <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> для поддержки расширенной защиты серверных приложений.</span><span class="sxs-lookup"><span data-stu-id="252ea-176">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> to support extended protection for server applications.</span></span>  
  
- <span data-ttu-id="252ea-177">Новое свойство <xref:System.Net.Security.SslStream.TransportContext%2A> в классе <xref:System.Net.Security.SslStream> для поддержки расширенной защиты клиентских и серверных приложений.</span><span class="sxs-lookup"><span data-stu-id="252ea-177">A new <xref:System.Net.Security.SslStream.TransportContext%2A> property in the <xref:System.Net.Security.SslStream> class to support extended protection for client and server applications.</span></span>  
  
 <span data-ttu-id="252ea-178">В пространство имен <xref:System.Net.Security> добавлено свойство <xref:System.Net.Configuration.SmtpNetworkElement> для поддержки настройки расширенной защиты для клиентов SMTP.</span><span class="sxs-lookup"><span data-stu-id="252ea-178">A <xref:System.Net.Configuration.SmtpNetworkElement> property was added to support configuration of extended protection for SMTP clients in the <xref:System.Net.Security> namespace.</span></span>  
  
## <a name="extended-protection-for-client-applications"></a><span data-ttu-id="252ea-179">Расширенная защита для клиентских приложений</span><span class="sxs-lookup"><span data-stu-id="252ea-179">Extended Protection for Client Applications</span></span>  

 <span data-ttu-id="252ea-180">Для большинства приложений расширенная защита поддерживается автоматически.</span><span class="sxs-lookup"><span data-stu-id="252ea-180">Extended protection support for most client applications happens automatically.</span></span> <span data-ttu-id="252ea-181">Классы <xref:System.Net.HttpWebRequest> и <xref:System.Net.Mail.SmtpClient> поддерживают расширенную защиту, если базовая версия Windows поддерживает расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="252ea-181">The <xref:System.Net.HttpWebRequest> and <xref:System.Net.Mail.SmtpClient> classes support extended protection whenever the underlying version of Windows supports extended protection.</span></span> <span data-ttu-id="252ea-182">Экземпляр <xref:System.Net.HttpWebRequest> отправляет имя участника-службы, сформированное из <xref:System.Uri>.</span><span class="sxs-lookup"><span data-stu-id="252ea-182">An <xref:System.Net.HttpWebRequest> instance sends an SPN constructed from the <xref:System.Uri>.</span></span> <span data-ttu-id="252ea-183">По умолчанию экземпляр <xref:System.Net.Mail.SmtpClient> отправляет имя участника-службы, сформированное из имени узла на почтовом сервере SMTP.</span><span class="sxs-lookup"><span data-stu-id="252ea-183">By default, an <xref:System.Net.Mail.SmtpClient> instance sends an SPN constructed from the host name of the SMTP mail server.</span></span>  
  
 <span data-ttu-id="252ea-184">Для пользовательской проверки подлинности клиентские приложения могут использовать методы <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> или <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> в классе <xref:System.Net.HttpWebRequest>, которые позволяют получить <xref:System.Net.TransportContext> и маркер привязки канала с помощью метода <xref:System.Net.TransportContext.GetChannelBinding%2A>.</span><span class="sxs-lookup"><span data-stu-id="252ea-184">For custom authentication, client applications can use the <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> or <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> and the CBT using the <xref:System.Net.TransportContext.GetChannelBinding%2A> method.</span></span>  
  
 <span data-ttu-id="252ea-185">Имя субъекта-службы для встроенной проверки подлинности Windows, которое отправляется экземпляром <xref:System.Net.HttpWebRequest> в заданную службу, можно переопределить, задав свойство <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A>.</span><span class="sxs-lookup"><span data-stu-id="252ea-185">The SPN to use for integrated Windows authentication sent by an <xref:System.Net.HttpWebRequest> instance to a given service can be overridden by setting the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property.</span></span>  
  
 <span data-ttu-id="252ea-186">Свойство <xref:System.Net.Mail.SmtpClient.TargetName%2A> можно использовать для установки пользовательского имени субъекта-службы, которое будет использоваться во встроенной проверке подлинности Windows для соединения SMTP.</span><span class="sxs-lookup"><span data-stu-id="252ea-186">The <xref:System.Net.Mail.SmtpClient.TargetName%2A> property can be used to set a custom SPN to use for integrated Windows authentication for the SMTP connection.</span></span>  
  
## <a name="extended-protection-for-server-applications"></a><span data-ttu-id="252ea-187">Расширенная защита для серверных приложений</span><span class="sxs-lookup"><span data-stu-id="252ea-187">Extended Protection for Server Applications</span></span>  

 <span data-ttu-id="252ea-188"><xref:System.Net.HttpListener> автоматически предоставляет механизмы для проверки привязок службы при проверке подлинности HTTP.</span><span class="sxs-lookup"><span data-stu-id="252ea-188"><xref:System.Net.HttpListener> automatically provides mechanisms for validating service bindings when performing HTTP authentication.</span></span>  
  
 <span data-ttu-id="252ea-189">Наиболее безопасный сценарий — включение расширенной защиты для префиксов `HTTPS://`.</span><span class="sxs-lookup"><span data-stu-id="252ea-189">The most secure scenario is to enable extended protection for `HTTPS://` prefixes.</span></span> <span data-ttu-id="252ea-190">В этом случае установите <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> в значение <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>, <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> — в значение <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> или <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> и <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> — в значение <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>. Значение <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> переводит <xref:System.Net.HttpListener> в частично усиленный режим, а <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> — в полностью усиленный режим.</span><span class="sxs-lookup"><span data-stu-id="252ea-190">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="252ea-191">В этой конфигурации при выполнении запроса к серверу с помощью внешнего безопасного канала у внешнего канала запрашивается привязка канала.</span><span class="sxs-lookup"><span data-stu-id="252ea-191">In this configuration when a request is made to the server through an outer secure channel, the outer channel is queried for a channel binding.</span></span> <span data-ttu-id="252ea-192">Эта привязка канала передается вызовам проверки подлинности SSPI, которые проверяют соответствие переданной привязки и привязки канала в BLOB-объекте проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="252ea-192">This channel binding is passed to the authentication SSPI calls, which validate that the channel binding in the authentication blob matches.</span></span> <span data-ttu-id="252ea-193">Существует три возможных результата:</span><span class="sxs-lookup"><span data-stu-id="252ea-193">There are three possible outcomes:</span></span>  
  
1. <span data-ttu-id="252ea-194">Базовая операционная система сервера не поддерживает расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="252ea-194">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="252ea-195">Запрос не будет передан в приложение, и клиенту будет возвращен ответ 401 (Не авторизовано).</span><span class="sxs-lookup"><span data-stu-id="252ea-195">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="252ea-196">В источник трассировки <xref:System.Net.HttpListener> будет записано сообщение с указанием причины сбоя.</span><span class="sxs-lookup"><span data-stu-id="252ea-196">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="252ea-197">Если вызов SSPI завершается неудачно, это означает, что либо клиент предоставил привязку канала, которая не соответствует ожидаемому значению привязки, полученному из внешнего канала, либо клиенту не удалось предоставить привязку канала при настройке политики расширенной защиты на сервере для <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span><span class="sxs-lookup"><span data-stu-id="252ea-197">The SSPI call fails indicating that either the client specified a channel binding that did not match the expected value retrieved from the outer channel or the client failed to supply a channel binding when the extended protection policy on the server was configured for <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span></span> <span data-ttu-id="252ea-198">В обоих случаях запрос не будет передан в приложение, и клиенту будет возвращен ответ 401 (Не авторизовано).</span><span class="sxs-lookup"><span data-stu-id="252ea-198">In both cases, the request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="252ea-199">В источник трассировки <xref:System.Net.HttpListener> будет записано сообщение с указанием причины сбоя.</span><span class="sxs-lookup"><span data-stu-id="252ea-199">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="252ea-200">Клиент указывает правильную привязку канала или получает возможность подключиться без указания привязки канала, так как политика расширенной защиты на сервере настроена со свойством <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported>. Запрос возвращается приложению для обработки.</span><span class="sxs-lookup"><span data-stu-id="252ea-200">The client specifies the correct channel binding or is allowed to connect without specifying a channel binding since the extended protection policy on the server is configured with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> The request is returned to the application for processing.</span></span> <span data-ttu-id="252ea-201">Имена служб не проверяются автоматически.</span><span class="sxs-lookup"><span data-stu-id="252ea-201">No service name check is performed automatically.</span></span> <span data-ttu-id="252ea-202">Приложение может выполнить собственную проверку имени службы с помощью свойства <xref:System.Net.HttpListenerRequest.ServiceName%2A>, но в таких обстоятельствах это действие является избыточным.</span><span class="sxs-lookup"><span data-stu-id="252ea-202">An application may choose to perform its own service name validation using the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property, but under these circumstances it is redundant.</span></span>  
  
 <span data-ttu-id="252ea-203">Если приложение выполняет собственные вызовы SSPI для проверки подлинности на основе BLOB-объектов, передаваемых в тексте HTTP-запроса, и хочет поддерживать привязки каналов, приложение должно получить ожидаемую привязку канала из внешнего безопасного канала с помощью <xref:System.Net.HttpListener> и передать ее собственной функции Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext).</span><span class="sxs-lookup"><span data-stu-id="252ea-203">If an application makes its own SSPI calls to perform authentication based on blobs passed back and forth within the body of an HTTP request and wishes to support channel binding, it needs to retrieve the expected channel binding from the outer secure channel using <xref:System.Net.HttpListener> in order to pass it to native Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span> <span data-ttu-id="252ea-204">Для этого используйте свойство <xref:System.Net.HttpListenerRequest.TransportContext%2A> и вызовите метод <xref:System.Net.TransportContext.GetChannelBinding%2A> для получения маркера привязки канала.</span><span class="sxs-lookup"><span data-stu-id="252ea-204">To do this, use the <xref:System.Net.HttpListenerRequest.TransportContext%2A> property and call <xref:System.Net.TransportContext.GetChannelBinding%2A> method to retrieve the CBT.</span></span> <span data-ttu-id="252ea-205">Поддерживаются только привязки конечной точки.</span><span class="sxs-lookup"><span data-stu-id="252ea-205">Only endpoint bindings are supported.</span></span> <span data-ttu-id="252ea-206">Если указано что-то иное, кроме <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint>, будет выдано исключение <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="252ea-206">If anything other <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> is specified, a <xref:System.NotSupportedException> will be thrown.</span></span> <span data-ttu-id="252ea-207">Если базовая операционная система поддерживает привязки каналов, метод <xref:System.Net.TransportContext.GetChannelBinding%2A> будет возвращать объект <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle>, в котором содержится указатель на привязку канала, который можно передать функции [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) в качестве элемента pvBuffer структуры SecBuffer, передаваемой в параметре `pInput`.</span><span class="sxs-lookup"><span data-stu-id="252ea-207">If the underlying operating system supports channel binding, the <xref:System.Net.TransportContext.GetChannelBinding%2A> method will return a <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> wrapping a pointer to a channel binding suitable for passing to [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function as the pvBuffer member of a SecBuffer structure passed in the `pInput` parameter.</span></span> <span data-ttu-id="252ea-208">Свойство <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> содержит длину привязки канала в байтах.</span><span class="sxs-lookup"><span data-stu-id="252ea-208">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> property contains the length, in bytes, of the channel binding.</span></span> <span data-ttu-id="252ea-209">Если базовая операционная система не поддерживает привязки каналов, функция возвращает `null`.</span><span class="sxs-lookup"><span data-stu-id="252ea-209">If the underlying operating system does not support channel bindings, the function will return `null`.</span></span>  
  
 <span data-ttu-id="252ea-210">Другой возможный сценарий — включение расширенной защиты для префиксов `HTTP://`, когда прокси не используются.</span><span class="sxs-lookup"><span data-stu-id="252ea-210">Another possible scenario is to enable extended protection for `HTTP://` prefixes when proxies are not used.</span></span> <span data-ttu-id="252ea-211">В этом случае установите <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> в значение <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>, <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> — в значение <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> или <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> и <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> — в значение <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>. Значение <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> переводит <xref:System.Net.HttpListener> в частично усиленный режим, а <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> — в полностью усиленный режим.</span><span class="sxs-lookup"><span data-stu-id="252ea-211">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="252ea-212">По умолчанию список допустимых имен служб создается на основе префиксов, которые были зарегистрированы с <xref:System.Net.HttpListener>.</span><span class="sxs-lookup"><span data-stu-id="252ea-212">A default list of allowed service names is created based on the prefixes which have been registered with the <xref:System.Net.HttpListener>.</span></span> <span data-ttu-id="252ea-213">Для просмотра списка по умолчанию можно использовать свойство <xref:System.Net.HttpListener.DefaultServiceNames%2A>.</span><span class="sxs-lookup"><span data-stu-id="252ea-213">This default list can be examined through the <xref:System.Net.HttpListener.DefaultServiceNames%2A> property.</span></span> <span data-ttu-id="252ea-214">Если этот список не является исчерпывающим, приложение может указать пользовательскую коллекцию имен служб в конструкторе класса <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>, и эта коллекция будет использоваться вместо списка имен служб по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="252ea-214">If this list is not comprehensive, an application can specify a custom service name collection in the constructor for the <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class which will be used instead of the default service name list.</span></span>  
  
 <span data-ttu-id="252ea-215">В этой конфигурации при отправке запроса на сервер без использования внешнего безопасного канала проверка подлинности выполняется нормально без проверки привязки канала.</span><span class="sxs-lookup"><span data-stu-id="252ea-215">In this configuration, when a request is made to the server without an outer secure channel authentication proceeds normally without a channel binding check.</span></span> <span data-ttu-id="252ea-216">Если проверка подлинности завершается успешно, то в контексте запрашивается имя службы, предоставленное клиентом, и это имя службы проверяется на соответствие списку допустимых имен служб.</span><span class="sxs-lookup"><span data-stu-id="252ea-216">If the authentication succeeds, the context is queried for the service name that the client provided and validated against the list of acceptable service names.</span></span> <span data-ttu-id="252ea-217">Существует четыре возможных результата:</span><span class="sxs-lookup"><span data-stu-id="252ea-217">There are four possible outcomes:</span></span>  
  
1. <span data-ttu-id="252ea-218">Базовая операционная система сервера не поддерживает расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="252ea-218">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="252ea-219">Запрос не будет передан в приложение, и клиенту будет возвращен ответ 401 (Не авторизовано).</span><span class="sxs-lookup"><span data-stu-id="252ea-219">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="252ea-220">В источник трассировки <xref:System.Net.HttpListener> будет записано сообщение с указанием причины сбоя.</span><span class="sxs-lookup"><span data-stu-id="252ea-220">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="252ea-221">Базовая операционная система клиента не поддерживает расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="252ea-221">The client’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="252ea-222">В конфигурации <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> попытка проверки подлинности завершится успешно, и запрос будет возвращен в приложение.</span><span class="sxs-lookup"><span data-stu-id="252ea-222">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> configuration, the authentication attempt will succeed and the request will be returned to the application.</span></span> <span data-ttu-id="252ea-223">В конфигурации <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> попытка проверки подлинности завершится неудачно.</span><span class="sxs-lookup"><span data-stu-id="252ea-223">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> configuration, the authentication attempt will fail.</span></span> <span data-ttu-id="252ea-224">Запрос не будет передан в приложение, и клиенту будет возвращен ответ 401 (Не авторизовано).</span><span class="sxs-lookup"><span data-stu-id="252ea-224">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="252ea-225">В источник трассировки <xref:System.Net.HttpListener> будет записано сообщение с указанием причины сбоя.</span><span class="sxs-lookup"><span data-stu-id="252ea-225">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="252ea-226">Базовая операционная система клиента поддерживает расширенную защиту, но в приложении не указана привязка службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-226">The client’s underlying operating system supports extended protection, but the application did not specify a service binding.</span></span> <span data-ttu-id="252ea-227">Запрос не будет передан в приложение, и клиенту будет возвращен ответ 401 (Не авторизовано).</span><span class="sxs-lookup"><span data-stu-id="252ea-227">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="252ea-228">В источник трассировки <xref:System.Net.HttpListener> будет записано сообщение с указанием причины сбоя.</span><span class="sxs-lookup"><span data-stu-id="252ea-228">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
4. <span data-ttu-id="252ea-229">В клиенте указана привязка службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-229">The client specified a service binding.</span></span> <span data-ttu-id="252ea-230">Привязка службы сравнивается со списком допустимых привязок службы.</span><span class="sxs-lookup"><span data-stu-id="252ea-230">The service binding is compared to the list of allowed service bindings.</span></span> <span data-ttu-id="252ea-231">Если привязка соответствует списку, запрос возвращается приложению.</span><span class="sxs-lookup"><span data-stu-id="252ea-231">If it matches, the request is returned to the application.</span></span> <span data-ttu-id="252ea-232">В противном случае запрос не будет передан в приложение, и клиенту будет автоматически возвращен ответ 401 (Не авторизовано).</span><span class="sxs-lookup"><span data-stu-id="252ea-232">Otherwise, the request will not be exposed to the application, and an unauthorized (401) response will be automatically returned to the client.</span></span> <span data-ttu-id="252ea-233">В источник трассировки <xref:System.Net.HttpListener> будет записано сообщение с указанием причины сбоя.</span><span class="sxs-lookup"><span data-stu-id="252ea-233">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
 <span data-ttu-id="252ea-234">Если этого простого подхода со списком допустимых имен служб недостаточно, приложение может выполнять собственную проверку имени службы, обращаясь к свойству <xref:System.Net.HttpListenerRequest.ServiceName%2A>.</span><span class="sxs-lookup"><span data-stu-id="252ea-234">If this simple approach using an allowed list of acceptable service names is insufficient, an application may provide its own service name validation by querying the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property.</span></span> <span data-ttu-id="252ea-235">В случаях 1 и 2 выше свойство возвратит `null`.</span><span class="sxs-lookup"><span data-stu-id="252ea-235">In cases 1 and 2 above, the property will return `null`.</span></span> <span data-ttu-id="252ea-236">В случае 3 будет возвращена пустая строка.</span><span class="sxs-lookup"><span data-stu-id="252ea-236">In case 3, it will return an empty string.</span></span> <span data-ttu-id="252ea-237">В случае 4 будет возвращено имя службы, указанное клиентом.</span><span class="sxs-lookup"><span data-stu-id="252ea-237">In case 4, the service name specified by the client will be returned.</span></span>  
  
 <span data-ttu-id="252ea-238">Эти функции расширенной защиты также могут использоваться серверными приложениями для проверки подлинности с другими типами запросов, а также при использовании доверенного прокси.</span><span class="sxs-lookup"><span data-stu-id="252ea-238">These extended protection features can also be used by server applications for authentication with other types of requests and when trusted proxies are used.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="252ea-239">См. также</span><span class="sxs-lookup"><span data-stu-id="252ea-239">See also</span></span>

- <xref:System.Security.Authentication.ExtendedProtection>
- <xref:System.Security.Authentication.ExtendedProtection.Configuration>
