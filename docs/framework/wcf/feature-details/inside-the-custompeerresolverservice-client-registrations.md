---
description: 'Дополнительные сведения см. в Кустомпирресолверсервице: регистрация клиента.'
title: 'Подробная информация о CustomPeerResolverService: регистрация клиентов'
ms.date: 03/30/2017
ms.assetid: 40236953-a916-4236-84a6-928859e1331a
ms.openlocfilehash: 2cc0706fc473985cf6572e6ee5387a26366bc2c8
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99802844"
---
# <a name="inside-the-custompeerresolverservice-client-registrations"></a><span data-ttu-id="0fe26-103">Подробная информация о CustomPeerResolverService: регистрация клиентов</span><span class="sxs-lookup"><span data-stu-id="0fe26-103">Inside the CustomPeerResolverService: Client Registrations</span></span>

<span data-ttu-id="0fe26-104">Каждый узел в сетке публикует информацию о своей конечной точке в службе распознавателя с помощью функции `Register`.</span><span class="sxs-lookup"><span data-stu-id="0fe26-104">Each node in the mesh publishes its endpoint information to the resolver service through the `Register` function.</span></span> <span data-ttu-id="0fe26-105">Служба распознавателя хранит эту информацию в виде регистрационной записи.</span><span class="sxs-lookup"><span data-stu-id="0fe26-105">The resolver service stores this information as a registration record.</span></span> <span data-ttu-id="0fe26-106">Эта запись содержит уникальный идентификатор (RegistrationID) и информацию о конечной точке (PeerNodeAddress) для узла.</span><span class="sxs-lookup"><span data-stu-id="0fe26-106">This record contains a unique identifier (RegistrationID) and endpoint information (PeerNodeAddress) for the node.</span></span>  
  
## <a name="stale-records-and-expiration-time"></a><span data-ttu-id="0fe26-107">Устаревшие записи и срок действия</span><span class="sxs-lookup"><span data-stu-id="0fe26-107">Stale Records and Expiration Time</span></span>  

 <span data-ttu-id="0fe26-108">В идеальном случае, когда узел покидает сетку, он вызывает функцию `Unregister`, после чего служба распознавателя удаляет регистрационную запись.</span><span class="sxs-lookup"><span data-stu-id="0fe26-108">Ideally, when a node leaves the mesh, it will call the `Unregister` function, which causes the resolver service to remove the registration entry.</span></span> <span data-ttu-id="0fe26-109">Иногда узлы закрываются или становятся недоступными перед вызовом функции `Unregister`, оставляя устаревшую регистрационную запись.</span><span class="sxs-lookup"><span data-stu-id="0fe26-109">Sometimes, nodes shut down or become inaccessible before calling `Unregister`, leaving behind a stale registration record.</span></span>  
  
 <span data-ttu-id="0fe26-110">Устаревшие записи в службе распознавателя могут стать причиной сбоя подключения.</span><span class="sxs-lookup"><span data-stu-id="0fe26-110">Stale records in your resolver service can cause failed connections.</span></span> <span data-ttu-id="0fe26-111">Если узел, который пытается подключиться к сетке, получает информацию об устаревшем соединении от службы распознавателя, для успешного подключения к сетке может потребоваться больше времени.</span><span class="sxs-lookup"><span data-stu-id="0fe26-111">If a node trying to connect to a mesh receives stale connection information from the resolver service, it can take longer to successfully join the mesh.</span></span> <span data-ttu-id="0fe26-112">Устаревшие записи также занимают место в памяти.</span><span class="sxs-lookup"><span data-stu-id="0fe26-112">Stale records also take up memory.</span></span> <span data-ttu-id="0fe26-113">Без эффективного процесса очистки кэш, используемый для хранения регистрационных записей, может в конечном счете переполниться и вызвать сбой службы распознавателя.</span><span class="sxs-lookup"><span data-stu-id="0fe26-113">Without an efficient clean up process, the cache used to store registrations could eventually overflow and crash the resolver service.</span></span>  
  
 <span data-ttu-id="0fe26-114">Служба <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> указывает срок действия (DateTime) для каждой записи и сохраняет эту информацию как часть записи.</span><span class="sxs-lookup"><span data-stu-id="0fe26-114">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> marks each record with an expiration time (DateTime), and stores that information as part of the record.</span></span> <span data-ttu-id="0fe26-115">Служба использует срок действия для определения устаревших записей.</span><span class="sxs-lookup"><span data-stu-id="0fe26-115">The service uses the expiration time to identify stale records.</span></span> <span data-ttu-id="0fe26-116">Пользовательские реализации выполняются подобным же образом.</span><span class="sxs-lookup"><span data-stu-id="0fe26-116">Custom implementations should do something similar.</span></span>  
  
## <a name="refreshinterval-and-cleanupinterval"></a><span data-ttu-id="0fe26-117">RefreshInterval и CleanupInterval</span><span class="sxs-lookup"><span data-stu-id="0fe26-117">RefreshInterval and CleanupInterval</span></span>  

 <span data-ttu-id="0fe26-118">Свойство `RefreshInterval` службы <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> определяет срок действия регистрационных записей в таблице подстановки регистрационных записей службы.</span><span class="sxs-lookup"><span data-stu-id="0fe26-118">The `RefreshInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> defines how long registration records remain valid in the service's registration lookup table.</span></span> <span data-ttu-id="0fe26-119">По истечении срока действия, указанного в этом свойстве для определенной записи, она становится устаревшей и помечается для удаления.</span><span class="sxs-lookup"><span data-stu-id="0fe26-119">When the amount of time supplied to this property has passed for a given record, that record becomes stale and is marked for deletion.</span></span>  
  
 <span data-ttu-id="0fe26-120">Свойство `CleanupInterval` службы <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> определяет периодичность поиска и удаления устаревших регистрационных записей.</span><span class="sxs-lookup"><span data-stu-id="0fe26-120">The `CleanupInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> tells the service how often to search for and delete stale registration records.</span></span> <span data-ttu-id="0fe26-121">Срок, указанный в свойстве `CleanupInterval`, должен быть не менее указанного в свойстве `RefreshInterval` этой службы.</span><span class="sxs-lookup"><span data-stu-id="0fe26-121">The `CleanupInterval` should be set to a time greater than or equal to the `RefreshInterval` set on the service.</span></span>  
  
 <span data-ttu-id="0fe26-122">Чтобы реализовать собственную службу распознавателя, необходимо записать функцию обслуживания для удаления устаревших регистрационных записей.</span><span class="sxs-lookup"><span data-stu-id="0fe26-122">To implement your own resolver service, you need to write a maintenance function to remove stale registration records.</span></span> <span data-ttu-id="0fe26-123">Для этого можно использовать следующие способы.</span><span class="sxs-lookup"><span data-stu-id="0fe26-123">There are several ways to do this:</span></span>  
  
- <span data-ttu-id="0fe26-124">**Периодическое обслуживание**: Настройте таймер для периодического отключения и пройдите через хранилище данных, чтобы удалить старые записи.</span><span class="sxs-lookup"><span data-stu-id="0fe26-124">**Periodic maintenance**: Set a timer to go off periodically, and go through your data store to delete old records.</span></span> <span data-ttu-id="0fe26-125">Этот подход используется в службе <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService>.</span><span class="sxs-lookup"><span data-stu-id="0fe26-125">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> uses this approach.</span></span>  
  
- <span data-ttu-id="0fe26-126">**Пассивное удаление**. вместо активного поиска устаревших записей через регулярные интервалы можно выявление и удаление устаревших записей, когда служба уже выполняет другую функцию.</span><span class="sxs-lookup"><span data-stu-id="0fe26-126">**Passive deletion**: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function.</span></span> <span data-ttu-id="0fe26-127">Потенциально это может увеличить время отклика на запросы от клиентов распознавателя, но устраняет необходимость в таймере. Этот способ может быть более эффективным, если ожидается, что несколько узлов покинут сетку без вызова функции `Unregister`.</span><span class="sxs-lookup"><span data-stu-id="0fe26-127">This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling `Unregister`.</span></span>  
  
## <a name="registrationlifetime-and-refresh"></a><span data-ttu-id="0fe26-128">RegistrationLifetime и Refresh</span><span class="sxs-lookup"><span data-stu-id="0fe26-128">RegistrationLifetime and Refresh</span></span>  

 <span data-ttu-id="0fe26-129">Когда узел регистрируется в службе распознавателя, он получает объект <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> от службы.</span><span class="sxs-lookup"><span data-stu-id="0fe26-129">When a node registers with a resolver service, it receives a <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> object from the service.</span></span> <span data-ttu-id="0fe26-130">Этот объект имеет свойство `RegistrationLifetime`, в котором содержится информация о времени, оставшемся до истечения срока действия регистрации и удаления узла службой распознавателя.</span><span class="sxs-lookup"><span data-stu-id="0fe26-130">This object has a `RegistrationLifetime` property which indicates to the node how much time it has before the registration expires and is removed by the resolver service.</span></span> <span data-ttu-id="0fe26-131">Если, например, срок действия регистрации `RegistrationLifetime` составляет 2 минуты, узел должен вызвать функцию `Refresh` в течение не более 2 минут, чтобы запись не перешла в разряд устаревших и не была удалена.</span><span class="sxs-lookup"><span data-stu-id="0fe26-131">If, for example, the `RegistrationLifetime` is 2 minutes, the node needs to call `Refresh` in under 2 minutes to ensure the record stays fresh and is not deleted.</span></span> <span data-ttu-id="0fe26-132">Когда служба распознавателя получает запрос `Refresh`, она ищет запись и сбрасывает срок действия.</span><span class="sxs-lookup"><span data-stu-id="0fe26-132">When the resolver service receives a `Refresh` request, it looks up the record and resets the expiration time.</span></span> <span data-ttu-id="0fe26-133">Функция Refresh возвращает объект <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> со свойством `RegistrationLifetime`.</span><span class="sxs-lookup"><span data-stu-id="0fe26-133">Refresh returns a <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> object with a `RegistrationLifetime` property.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0fe26-134">См. также</span><span class="sxs-lookup"><span data-stu-id="0fe26-134">See also</span></span>

- [<span data-ttu-id="0fe26-135">Одноранговые распознаватели</span><span class="sxs-lookup"><span data-stu-id="0fe26-135">Peer Resolvers</span></span>](peer-resolvers.md)
