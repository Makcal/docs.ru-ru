---
description: Дополнительные сведения см. в статье Общие сведения о очередях
title: Общие сведения об очередях
ms.date: 03/30/2017
helpviewer_keywords:
- queues [WCF], MSMQ integration
ms.assetid: b8757992-ffce-40ad-9e9b-3243f6d0fce1
ms.openlocfilehash: 8414a8f9121c30a97f5fef5e1f26dfe57abc7956
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99633031"
---
# <a name="queues-overview"></a><span data-ttu-id="cfb1b-103">Общие сведения о очередях</span><span class="sxs-lookup"><span data-stu-id="cfb1b-103">Queues overview</span></span>

<span data-ttu-id="cfb1b-104">В этом разделе описаны общие и основные принципы, лежащие в основе взаимодействия с использованием очередей.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-104">This section introduces the general and core concepts behind queued communication.</span></span> <span data-ttu-id="cfb1b-105">В последующих разделах приводятся сведения о том, как описанные здесь концепции очередей обрабатываются в Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="cfb1b-105">Subsequent sections go into details about how the queuing concepts described here are manifested in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="basic-queuing-concepts"></a><span data-ttu-id="cfb1b-106">Основные принципы очередей</span><span class="sxs-lookup"><span data-stu-id="cfb1b-106">Basic Queuing Concepts</span></span>  

 <span data-ttu-id="cfb1b-107">При разработке распределенного приложения важно выбрать правильный транспорт для связи между службами и клиентами.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-107">When designing a distributed application, choosing the right transport for communication between services and clients is important.</span></span> <span data-ttu-id="cfb1b-108">Выбор транспорта определяется несколькими факторами.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-108">Several factors affect the kind of transport to use.</span></span> <span data-ttu-id="cfb1b-109">Во-первых, выбор между транспортом очередей или прямым транспортом (как TCP или HTTP) определяется изоляцией между службой, клиентом и транспортом.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-109">One important factor—isolation between the service, the client, and the transport—determines use of a queued transport or a direct transport, such as TCP or HTTP.</span></span> <span data-ttu-id="cfb1b-110">Особенностью прямых транспортов, таких как TCP или HTTP, является то, что связь останавливается при прекращении функционирования службы или клиента или сбое сети.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-110">Due to the nature of direct transports such as TCP and HTTP, communication stops altogether if the service or the client stop functioning or if the network fails.</span></span> <span data-ttu-id="cfb1b-111">Приложение работает, только если служба, клиент и сеть выполняются одновременно.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-111">The service, the client, and the network must be running at the same time for the application to work.</span></span> <span data-ttu-id="cfb1b-112">Транспорты очереди обеспечивают изоляцию, т. е. при сбое службы, клиента или каналов связи между ними клиент и служба могут продолжать функционировать.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-112">Queued transports provide isolation, which means that if the service or client fail or if communication links between them fail, the client and service can continue to function.</span></span>  
  
 <span data-ttu-id="cfb1b-113">Очереди обеспечивают надежную связь даже в случае сбоя участников взаимодействия или неполадок в сети.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-113">Queues provide reliable communication even with failures in the communicating parties or the network.</span></span> <span data-ttu-id="cfb1b-114">Очереди перенаправляют и доставляют сообщения, которыми обмениваются участники взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-114">Queues capture and deliver messages exchanged between the communicating parties.</span></span> <span data-ttu-id="cfb1b-115">Как правило, очереди содержатся в хранилище, которое может быть неустойчивым и постоянным.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-115">Queues are typically backed by some kind of a store, which can be volatile or durable.</span></span> <span data-ttu-id="cfb1b-116">Очереди хранят сообщения от клиента от имени службы, а затем переадресовывают эти сообщения службе.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-116">Queues store messages from a client on behalf of a service and later forward these messages to the service.</span></span> <span data-ttu-id="cfb1b-117">Очереди с косвенным обращением обеспечивают гарантированную изоляцию от сбоев любого участника взаимодействия и поэтому являются предпочтительным механизмом связи в системах высокой доступности и отключенных службах.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-117">The indirection queues provide ensured isolation of failure by either party, thus making it the preferred communication mechanism for high-availability systems and disconnected services.</span></span> <span data-ttu-id="cfb1b-118">Косвенное обращение обеспечивается ценой высокой задержки.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-118">The indirection comes with the cost of high latency.</span></span> <span data-ttu-id="cfb1b-119">*Задержка* — это время задержки между моментом отправки клиентом сообщения и временем его получения службой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-119">*Latency* is the time delay between the time the client sends a message and the time the service receives it.</span></span> <span data-ttu-id="cfb1b-120">Это означает, что после отправки сообщения пользователь не знает, когда сообщение будет обработано.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-120">This means that once a message is sent, you do not know when that message may be processed.</span></span> <span data-ttu-id="cfb1b-121">Большинство приложений с очередями справляются с высокой задержкой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-121">Most queued applications cope with high latency.</span></span> <span data-ttu-id="cfb1b-122">Следующая иллюстрация представляет концептуальную модель взаимодействия с использованием очередей.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-122">The following illustration shows a conceptual model of queued communication.</span></span>  
  
 <span data-ttu-id="cfb1b-123">![Модель взаимодействия с использованием очереди](media/qconceptual-figure1c.gif "QConceptual-Figure1c")</span><span class="sxs-lookup"><span data-stu-id="cfb1b-123">![Model of queued communication](media/qconceptual-figure1c.gif "QConceptual-Figure1c")</span></span>  
  
 <span data-ttu-id="cfb1b-124">Концептуальная модель взаимодействия с использованием очередей</span><span class="sxs-lookup"><span data-stu-id="cfb1b-124">Queued communication conceptual model</span></span>  
  
 <span data-ttu-id="cfb1b-125">На практике очередь функционирует по принципу распределенности.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-125">In reality, the queue is a distributed concept.</span></span> <span data-ttu-id="cfb1b-126">Очереди могут быть локальными для любого участника взаимодействия или удаленными для обоих участников.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-126">As such, they can be local to either party or remote to both parties.</span></span> <span data-ttu-id="cfb1b-127">Как правило, очередь является локальной для службы.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-127">Typically, the queue is local to the service.</span></span> <span data-ttu-id="cfb1b-128">В этом случае клиент не может рассчитывать на постоянную доступность подключения к удаленной очереди.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-128">In this configuration, the client cannot depend on connectivity to the remote queue to be constantly available.</span></span> <span data-ttu-id="cfb1b-129">Аналогично, очередь должна быть доступной независимо от того, доступна ли служба, выполняющая чтение из очереди.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-129">Similarly, the queue must be available independent of the availability of the service reading from the queue.</span></span> <span data-ttu-id="cfb1b-130">Диспетчер очередей управляет коллекцией очередей.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-130">A queue manager manages a collection of queues.</span></span> <span data-ttu-id="cfb1b-131">Он несет ответственность за прием сообщений, отправленных в его очереди из других диспетчеров очередей.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-131">It is responsible for accepting messages sent to its queues from other queue managers.</span></span> <span data-ttu-id="cfb1b-132">Также на диспетчера очередей возлагается ответственность за управление возможностью подключения к удаленным очередям и передачу сообщений этим удаленным очередям.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-132">It is also responsible for managing connectivity to remote queues and transferring messages to those remote queues.</span></span> <span data-ttu-id="cfb1b-133">Чтобы обеспечить доступность очередей независимо от сбоев клиентского приложения или приложения служб, диспетчер очередей, как правило, выполняется как внешняя служба.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-133">To ensure availability of queues despite client or service application failures, the queue manager is typically run as an external service.</span></span>  
  
 <span data-ttu-id="cfb1b-134">Когда клиент отправляет сообщение в очередь, он адресует сообщение целевой очереди, т. е. очереди, управляемой диспетчером очередей службы.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-134">When a client sends a message to a queue, it addresses the message to the target queue, which is the queue managed by the service's queue manager.</span></span> <span data-ttu-id="cfb1b-135">Диспетчер очередей на стороне клиента отправляет сообщение в очередь передачи (очередь исходящих сообщений).</span><span class="sxs-lookup"><span data-stu-id="cfb1b-135">The queue manager on the client sends the message to a transmission (or outgoing) queue.</span></span> <span data-ttu-id="cfb1b-136">Очередь передачи - это очередь в диспетчере очередей клиента, которая хранит сообщения для передачи целевой очереди.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-136">The transmission queue is a queue on the client queue manager that stores messages for transmission to the target queue.</span></span> <span data-ttu-id="cfb1b-137">Затем диспетчер очередей находит путь к диспетчеру очередей, владеющему целевой очередью, и передает ему сообщение.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-137">The queue manager then finds a path to the queue manager that owns the target queue and transfers the message to it.</span></span> <span data-ttu-id="cfb1b-138">Для обеспечения надежной связи и во избежание потери данных диспетчеры очередей реализуют надежный протокол передачи.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-138">To ensure reliable communication, the queue managers implement a reliable transfer protocol to prevent data loss.</span></span> <span data-ttu-id="cfb1b-139">Диспетчер очереди назначения принимает сообщения, адресованные принадлежащим ему целевым очередям, и хранит эти сообщения.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-139">The destination queue manager accepts messages addressed to the target queues it owns and stores the messages.</span></span> <span data-ttu-id="cfb1b-140">Служба создает запросы на чтение из целевой очереди, после чего диспетчер очередей доставляет сообщение в приложение назначения.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-140">The service makes requests to read from the target queue, at which time the queue manager then delivers the message to the destination application.</span></span> <span data-ttu-id="cfb1b-141">На следующем рисунке показана связь между четырьмя участниками.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-141">The following illustration shows communication between the four parties.</span></span>  
  
 <span data-ttu-id="cfb1b-142">![Схема находящихся в очереди приложений](media/distributed-queue-figure.jpg "Схема распределенной очереди")</span><span class="sxs-lookup"><span data-stu-id="cfb1b-142">![Queued Application Diagram](media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="cfb1b-143">Взаимодействие с использованием очередей в типичном сценарии развертывания.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-143">Queued communication in a typical deployment scenario</span></span>  
  
 <span data-ttu-id="cfb1b-144">Итак, диспетчер очередей обеспечивает необходимую изоляцию, чтобы сбои отправителя и получателя не влияли на фактическое взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-144">Thus, the queue manager provides the required isolation so that the sender and receiver can independently fail without affecting actual communication.</span></span> <span data-ttu-id="cfb1b-145">Преимущество дополнительного косвенного обращения, обеспечиваемого очередями, также позволяет нескольким экземплярам приложения выполнять чтение из одной очереди, таким образом, при функционировании узлов по принципу фермы достигается большая пропускная способность.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-145">The benefit of extra indirection that queues provide also enables multiple application instances to read from the same queue, so that farming work among the nodes achieves higher throughput.</span></span> <span data-ttu-id="cfb1b-146">Следовательно, очереди часто используются для повышения масштабируемости и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-146">Therefore, it is not uncommon to see queues being used to achieve higher scale and throughput requirements.</span></span>  
  
## <a name="queues-and-transactions"></a><span data-ttu-id="cfb1b-147">Очереди и транзакции</span><span class="sxs-lookup"><span data-stu-id="cfb1b-147">Queues and Transactions</span></span>  

 <span data-ttu-id="cfb1b-148">Транзакции позволяют группировать наборы операций, чтобы в случае сбоя одной операции происходил сбой всех операций.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-148">Transactions allow you to group a set of operations together so that if one operation fails, all of the operations fail.</span></span> <span data-ttu-id="cfb1b-149">Пример использования транзакций заключается в том, что пользователь использует ATM для перемещения $1 000 с учетной записи для их экономии.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-149">An example of how to use transactions is when a person uses an ATM to transfer $1,000 from their savings account to their checking account.</span></span> <span data-ttu-id="cfb1b-150">Для перемещения средств необходимо выполнить следующие операции.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-150">This entails the following operations:</span></span>  
  
- <span data-ttu-id="cfb1b-151">Снятие 1 000 долларов со сберегательного счета.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-151">Withdrawing $1,000 from the savings account.</span></span>  
  
- <span data-ttu-id="cfb1b-152">Внесение 1 000 долларов на текущий счет.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-152">Depositing $1,000 into the checking account.</span></span>  
  
 <span data-ttu-id="cfb1b-153">Если первая операция завершается успешно (т. е. удается снять 1 000 долларов со сберегательного счета), а вторая - нет, 1 000 долларов теряется, так как сумма уже была снята со сберегательного счета.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-153">If the first operation succeeds and $1,000 is withdrawn from the savings account but the second operation fails, the $1,000 is lost because it has already been withdrawn from the savings account.</span></span> <span data-ttu-id="cfb1b-154">Для поддержания действительного состояния счетов необходимо обеспечить сбой обеих операций при сбое одной из них.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-154">To keep the accounts in a valid state, if one operation fails, both operations must fail.</span></span>  
  
 <span data-ttu-id="cfb1b-155">В транзакционном обмене сообщениями сообщения можно отправлять в очередь и получать сообщения из нее в рамках транзакции.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-155">In transactional messaging, messages can be sent to the queue and received from the queue under a transaction.</span></span> <span data-ttu-id="cfb1b-156">Таким образом, если сообщение отправлено в рамках транзакции и происходит откат транзакции, результат такой же, как если бы сообщение никогда не было отправлено в очередь.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-156">Thus, if a message is sent in a transaction and the transaction is rolled back, then the outcome is as if the message had never been sent to the queue.</span></span> <span data-ttu-id="cfb1b-157">Аналогично, если сообщение получено в рамках транзакции и происходит откат транзакции, результат такой же, как если бы сообщение никогда не было получено.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-157">Similarly if a message is received in a transaction and the transaction is rolled back, then the outcome is as if the message had never been received.</span></span> <span data-ttu-id="cfb1b-158">Сообщение остается в очереди и доступно для чтения.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-158">The message remains in the queue to be read.</span></span>  
  
 <span data-ttu-id="cfb1b-159">Из-за высокой задержки при отправке сообщения невозможно узнать, через какое время оно достигнет целевой очереди и сколько времени потребуется службе для обработки сообщения.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-159">Because of high latency, when you send a message you have no way of knowing how long it takes to reach its target queue, nor do you know how long it takes for the service to process the message.</span></span> <span data-ttu-id="cfb1b-160">Поэтому нецелесообразно использовать одну транзакцию для отправки, получения и последующей обработки сообщения.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-160">Because of this, you do not want to use a single transaction to send the message, receive the message, and then process the message.</span></span> <span data-ttu-id="cfb1b-161">В этом случае создается транзакция, которая остается незафиксированной в течение неопределенного промежутка времени.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-161">This creates a transaction that is not committed for an indeterminate amount of time.</span></span> <span data-ttu-id="cfb1b-162">При взаимодействии клиента и службы через очередь с использованием транзакции в процессе участвуют две транзакции: одна - на стороне клиента, другая - на стороне службы.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-162">When a client and service communicate through a queue using a transaction, two transactions are involved: one on the client and one on the service.</span></span> <span data-ttu-id="cfb1b-163">На следующем рисунке показаны границы транзакции при стандартном взаимодействии с использованием очередей.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-163">The following illustration shows the transaction boundaries in typical queued communication.</span></span>  
  
 <span data-ttu-id="cfb1b-164">![Очередь с транзакциями](media/qwithtransactions-figure3.gif "QWithTransactions-Figure3")</span><span class="sxs-lookup"><span data-stu-id="cfb1b-164">![Queue with transactions](media/qwithtransactions-figure3.gif "QWithTransactions-Figure3")</span></span>  
  
 <span data-ttu-id="cfb1b-165">Взаимодействие с использованием очередей и отдельными транзакциями для сбора и доставки</span><span class="sxs-lookup"><span data-stu-id="cfb1b-165">Queued communication showing separate transactions for capture and delivery</span></span>  
  
 <span data-ttu-id="cfb1b-166">Клиентская транзакция обрабатывает и отправляет сообщение.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-166">The client transaction processes and sends the message.</span></span> <span data-ttu-id="cfb1b-167">После фиксирования транзакции сообщение попадает в очередь передачи.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-167">When the transaction is committed, the message is in the transmission queue.</span></span> <span data-ttu-id="cfb1b-168">На стороне службы транзакция выполняет чтение сообщения из целевой очереди, обрабатывает сообщение и фиксирует транзакцию.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-168">On the service, the transaction reads the message from the target queue, processes the message, and then commits the transaction.</span></span> <span data-ttu-id="cfb1b-169">В случае ошибки во время обработки происходит откат сообщения и его размещение в целевой очереди.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-169">If an error occurs during the processing, the message is rolled back and placed in the target queue.</span></span>  
  
## <a name="asynchronous-communication-using-queues"></a><span data-ttu-id="cfb1b-170">Асинхронное взаимодействие с использованием очередей</span><span class="sxs-lookup"><span data-stu-id="cfb1b-170">Asynchronous Communication Using Queues</span></span>  

 <span data-ttu-id="cfb1b-171">Очереди предоставляют асинхронные средства взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-171">Queues provide an asynchronous means of communication.</span></span> <span data-ttu-id="cfb1b-172">Приложения, отправляющие сообщения с использованием очередей, не могут ожидать получения и обработки сообщения принимающим приложением из-за высокой задержки, введенной диспетчером очередей.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-172">Applications that send messages using queues cannot wait for the message to be received and processed by the receiver because of high latency introduced by the queue manager.</span></span> <span data-ttu-id="cfb1b-173">Сообщения могут оставаться в очереди гораздо дольше, чем предполагалось приложением.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-173">Messages can remain in the queue for a far longer time than the application intended.</span></span> <span data-ttu-id="cfb1b-174">Чтобы избежать этого, приложение может задать сообщению значение срока жизни.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-174">To avoid this, the application can specify a Time-To-Live value on the message.</span></span> <span data-ttu-id="cfb1b-175">Это значение задает, как долго сообщение должно оставаться в очереди передачи.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-175">This value specifies how long the message should remain in the transmission queue.</span></span> <span data-ttu-id="cfb1b-176">Если данное временное значение превышено, а сообщение не отправлено в целевую очередь, оно может быть передано в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-176">If this time value is exceeded, and the message still has not been sent to the target queue, the message can be transferred to a dead-letter queue.</span></span>  
  
 <span data-ttu-id="cfb1b-177">При отправке сообщения отправителем, возврат из операции отправки подразумевает, что сообщение только что было доставлено в очередь передачи на стороне отправителя.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-177">When the sender sends a message, the return from the send operation implies that the message only made it to the transmission queue on the sender.</span></span> <span data-ttu-id="cfb1b-178">Следовательно, в случае сбоя доставки сообщения в целевую очередь отправляющее приложение не может немедленно узнать об этом.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-178">As such, if there is a failure in getting the message to the target queue, the sending application cannot know about it immediately.</span></span> <span data-ttu-id="cfb1b-179">Фиксирование таких сбоев возможно благодаря передаче недоставленного сообщения в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-179">To take note of such failures, the failed message is transferred to a dead-letter queue.</span></span>  
  
 <span data-ttu-id="cfb1b-180">Любую ошибку (например, недостижение сообщением целевой очереди или истечение срока жизни сообщения) необходимо обрабатывать отдельно.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-180">Any error, such as a message failing to reach the target queue or the Time-To-Live expiring, must be processed separately.</span></span> <span data-ttu-id="cfb1b-181">Следовательно, приложения с использованием очередей часто создают два набора логики.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-181">It is not uncommon, therefore, for queued applications to write two sets of logic:</span></span>  
  
- <span data-ttu-id="cfb1b-182">Стандартная логика отправки и получения сообщений клиентом и службой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-182">The normal client and service logic of sending and receiving messages.</span></span>  
  
- <span data-ttu-id="cfb1b-183">Компенсирующая логика для обработки сообщений, при передаче или доставке которых произошел сбой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-183">Compensation logic to handle messages from the failed transmission or delivery.</span></span>  
  
 <span data-ttu-id="cfb1b-184">Эти принципы рассматриваются в следующих подразделах.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-184">The following sections discuss these concepts.</span></span>  
  
## <a name="dead-letter-queue-programming"></a><span data-ttu-id="cfb1b-185">Программирование очереди недоставленных сообщений</span><span class="sxs-lookup"><span data-stu-id="cfb1b-185">Dead-Letter Queue Programming</span></span>  

 <span data-ttu-id="cfb1b-186">В очередях недоставленных сообщений содержатся сообщения, которые по различным причинам не попали в целевую очередь.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-186">Dead-letter queues contain messages that failed to reach the target queue for various reasons.</span></span> <span data-ttu-id="cfb1b-187">Причины могут быть самыми разнообразными - от истечения срока жизни сообщения до возникновения проблем с подключением, из-за которых не удалось передать сообщение в целевую очередь.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-187">The reasons can range from expired messages to connectivity issues preventing transfer of the message to the target queue.</span></span>  
  
 <span data-ttu-id="cfb1b-188">Как правило, приложение может выполнить чтение сообщений из общесистемной очереди недоставленных сообщений, определить, на каком именно этапе произошла ошибка, и предпринять необходимые меры, например исправить ошибки и отправить сообщение повторно, либо отметить произошедший сбой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-188">Typically, an application can read messages from a system-wide dead-letter queue, determine what went wrong, and take appropriate action, such as correcting the errors and resending the message or taking note of it.</span></span>  
  
## <a name="poison-message-queue-programming"></a><span data-ttu-id="cfb1b-189">Программирование очереди подозрительных сообщений</span><span class="sxs-lookup"><span data-stu-id="cfb1b-189">Poison Message Queue Programming</span></span>  

 <span data-ttu-id="cfb1b-190">После попадания сообщения в целевую очередь может несколько раз произойти сбой в обработке сообщения службой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-190">After a message makes it to the target queue, the service may repeatedly fail to process the message.</span></span> <span data-ttu-id="cfb1b-191">Например, приложение, которое выполняет чтение сообщения из очереди в рамках транзакции и обновляет базу данных, может обнаружить, что база данных временно отключена.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-191">For example, an application reading a message from the queue under a transaction and updating a database may find the database temporarily disconnected.</span></span> <span data-ttu-id="cfb1b-192">В этом случае происходит откат транзакции, создание новой транзакции и повторное прочтение сообщения из очереди.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-192">In this case, the transaction is rolled back, a new transaction is created, and the message is reread from the queue.</span></span> <span data-ttu-id="cfb1b-193">Вторая попытка может завершиться успешно или с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-193">A second attempt may succeed or fail.</span></span> <span data-ttu-id="cfb1b-194">В некоторых случаях в зависимости от причины ошибки может несколько раз произойти сбой при попытке доставки сообщения в приложение.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-194">In some cases, depending on the cause of the error, the message may repeatedly fail delivery to the application.</span></span> <span data-ttu-id="cfb1b-195">В этом случае сообщение считается «подозрительным».</span><span class="sxs-lookup"><span data-stu-id="cfb1b-195">In this case, the message is deemed as "poison."</span></span> <span data-ttu-id="cfb1b-196">Такие сообщения перемещаются в очередь подозрительных сообщений, которая может быть прочитана приложением для обработки подозрительных сообщений.</span><span class="sxs-lookup"><span data-stu-id="cfb1b-196">Such messages are moved to a poison queue that can be read by a poison-handling application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cfb1b-197">См. также</span><span class="sxs-lookup"><span data-stu-id="cfb1b-197">See also</span></span>

- [<span data-ttu-id="cfb1b-198">Очереди в WCF</span><span class="sxs-lookup"><span data-stu-id="cfb1b-198">Queuing in WCF</span></span>](queuing-in-wcf.md)
- [<span data-ttu-id="cfb1b-199">Сеансы и очереди</span><span class="sxs-lookup"><span data-stu-id="cfb1b-199">Sessions and Queues</span></span>](../samples/sessions-and-queues.md)
- [<span data-ttu-id="cfb1b-200">Очереди недоставленных сообщений</span><span class="sxs-lookup"><span data-stu-id="cfb1b-200">Dead Letter Queues</span></span>](../samples/dead-letter-queues.md)
- [<span data-ttu-id="cfb1b-201">Неустойчивое взаимодействие с использованием очереди</span><span class="sxs-lookup"><span data-stu-id="cfb1b-201">Volatile Queued Communication</span></span>](../samples/volatile-queued-communication.md)
- [<span data-ttu-id="cfb1b-202">Отправка сообщений из приложения Windows Communication Foundation в приложение MSMQ</span><span class="sxs-lookup"><span data-stu-id="cfb1b-202">Windows Communication Foundation to Message Queuing</span></span>](../samples/wcf-to-message-queuing.md)
- [<span data-ttu-id="cfb1b-203">Установка системы очередей сообщений (MSMQ)</span><span class="sxs-lookup"><span data-stu-id="cfb1b-203">Installing Message Queuing (MSMQ)</span></span>](../samples/installing-message-queuing-msmq.md)
- [<span data-ttu-id="cfb1b-204">Передача сообщений из приложения MSMQ в приложение Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="cfb1b-204">Message Queuing to Windows Communication Foundation</span></span>](../samples/message-queuing-to-wcf.md)
- [<span data-ttu-id="cfb1b-205">Безопасность сообщений при использовании очереди сообщений</span><span class="sxs-lookup"><span data-stu-id="cfb1b-205">Message Security over Message Queuing</span></span>](../samples/message-security-over-message-queuing.md)
