---
description: 'Дополнительные сведения: потоковая передача сообщений'
title: Потоковая передача сообщений
ms.date: 03/30/2017
ms.assetid: 72a47a51-e5e7-4b76-b24a-299d51e0ae5a
ms.openlocfilehash: 282b16850e4babe73207e3f3e1a8bd5da24c70cf
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99793393"
---
# <a name="streaming-message-transfer"></a><span data-ttu-id="47d1b-103">Потоковая передача сообщений</span><span class="sxs-lookup"><span data-stu-id="47d1b-103">Streaming Message Transfer</span></span>

<span data-ttu-id="47d1b-104">Транспорты Windows Communication Foundation (WCF) поддерживают два режима передачи сообщений:</span><span class="sxs-lookup"><span data-stu-id="47d1b-104">Windows Communication Foundation (WCF) transports support two modes for transferring messages:</span></span>  
  
- <span data-ttu-id="47d1b-105">При буферизованной передаче все сообщение хранится в буфере памяти до завершения передачи.</span><span class="sxs-lookup"><span data-stu-id="47d1b-105">Buffered transfers hold the entire message in a memory buffer until the transfer is complete.</span></span> <span data-ttu-id="47d1b-106">Буферизованное сообщение должно быть доставлено полностью, прежде чем получатель сможет его прочитать.</span><span class="sxs-lookup"><span data-stu-id="47d1b-106">A buffered message must be completely delivered before a receiver can read it.</span></span>  
  
- <span data-ttu-id="47d1b-107">При потоковой передаче сообщение передается в виде потока.</span><span class="sxs-lookup"><span data-stu-id="47d1b-107">Streamed transfers expose the message as a stream.</span></span> <span data-ttu-id="47d1b-108">Получатель начинает обработку сообщения до того, как оно будет полностью доставлено.</span><span class="sxs-lookup"><span data-stu-id="47d1b-108">The receiver starts processing the message before it is completely delivered.</span></span>  
  
- <span data-ttu-id="47d1b-109">Потоковая передача позволяет улучшить возможности масштабирования службы за счет исключения необходимости использовать большие буферы памяти.</span><span class="sxs-lookup"><span data-stu-id="47d1b-109">Streamed transfers can improve the scalability of a service by eliminating the requirement for large memory buffers.</span></span> <span data-ttu-id="47d1b-110">Степень улучшения масштабируемости при изменении режима передачи зависит от размера передаваемых сообщений.</span><span class="sxs-lookup"><span data-stu-id="47d1b-110">Whether changing the transfer mode improves scalability depends on the size of the messages being transferred.</span></span> <span data-ttu-id="47d1b-111">Для сообщений большого размера предпочтительнее использовать потоковую передачу.</span><span class="sxs-lookup"><span data-stu-id="47d1b-111">Large message sizes favor using streamed transfers.</span></span>  
  
 <span data-ttu-id="47d1b-112">По умолчанию транспорты HTTP, TCP/IP и именованных каналов используют буферизованную передачу.</span><span class="sxs-lookup"><span data-stu-id="47d1b-112">By default, the HTTP, TCP/IP, and named pipe transports use buffered transfers.</span></span> <span data-ttu-id="47d1b-113">Этот документ описывает изменение режима передачи с буферизованной на потоковую для этих транспортов, а также возможные последствия.</span><span class="sxs-lookup"><span data-stu-id="47d1b-113">This document describes how to switch these transports from a buffered to streamed transfer mode and the consequences of doing so.</span></span>  
  
## <a name="enabling-streamed-transfers"></a><span data-ttu-id="47d1b-114">Включение потоковой передачи</span><span class="sxs-lookup"><span data-stu-id="47d1b-114">Enabling Streamed Transfers</span></span>  

 <span data-ttu-id="47d1b-115">Выбор режима передачи выполняется в элементе привязки транспорта.</span><span class="sxs-lookup"><span data-stu-id="47d1b-115">Selecting between buffered and streamed transfer modes is done on the binding element of the transport.</span></span> <span data-ttu-id="47d1b-116">Свойству <xref:System.ServiceModel.TransferMode> элемента привязки можно присвоить значение `Buffered`, `Streamed`, `StreamedRequest` или `StreamedResponse`.</span><span class="sxs-lookup"><span data-stu-id="47d1b-116">The binding element has a <xref:System.ServiceModel.TransferMode> property that can be set to `Buffered`, `Streamed`, `StreamedRequest`, or `StreamedResponse`.</span></span> <span data-ttu-id="47d1b-117">Если режиму передачи присвоено значение `Streamed`, потоковая передача будет выполняться в обоих направлениях.</span><span class="sxs-lookup"><span data-stu-id="47d1b-117">Setting the transfer mode to `Streamed` enables streaming communication in both directions.</span></span> <span data-ttu-id="47d1b-118">Если режиму передачи присвоено значение `StreamedRequest` или `StreamedResponse`, потоковая передача будет выполняться только в указанном направлении.</span><span class="sxs-lookup"><span data-stu-id="47d1b-118">Setting the transfer mode to `StreamedRequest` or `StreamedResponse` enables streaming communication in the indicated direction only.</span></span>  
  
 <span data-ttu-id="47d1b-119">Привязки <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding> и <xref:System.ServiceModel.NetNamedPipeBinding> предоставляют свойство <xref:System.ServiceModel.TransferMode>.</span><span class="sxs-lookup"><span data-stu-id="47d1b-119">The <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding>, and <xref:System.ServiceModel.NetNamedPipeBinding> bindings expose the <xref:System.ServiceModel.TransferMode> property.</span></span> <span data-ttu-id="47d1b-120">Для других транспортов необходимо создать пользовательскую привязку для задания режима передачи.</span><span class="sxs-lookup"><span data-stu-id="47d1b-120">For other transports, you must create a custom binding to set the transfer mode.</span></span>  
  
 <span data-ttu-id="47d1b-121">Решение по использованию буферизованной или потоковой передачи является локальным решением конечной точки.</span><span class="sxs-lookup"><span data-stu-id="47d1b-121">The decision to use either buffered or streamed transfers is a local decision of the endpoint.</span></span> <span data-ttu-id="47d1b-122">Для транспортов HTTP режим передачи не распространяется через подключение или на серверы и другие посредники.</span><span class="sxs-lookup"><span data-stu-id="47d1b-122">For HTTP transports, the transfer mode does not propagate across a connection, or to servers and other intermediaries.</span></span> <span data-ttu-id="47d1b-123">Выбор режима передачи не отражается в описании интерфейса службы.</span><span class="sxs-lookup"><span data-stu-id="47d1b-123">Setting the transfer mode is not reflected in the description of the service interface.</span></span> <span data-ttu-id="47d1b-124">Чтобы задать режим, после создания класса клиента для службы необходимо изменить файл конфигурации для тех служб, которые планируется использовать с потоковой передачей.</span><span class="sxs-lookup"><span data-stu-id="47d1b-124">After generating a client class for a service, you must edit the configuration file for services intended to be used with streamed transfers to set the mode.</span></span> <span data-ttu-id="47d1b-125">Для транспортов TCP и именованного канала режим передачи распространяется в виде утверждения политики.</span><span class="sxs-lookup"><span data-stu-id="47d1b-125">For TCP and named pipe transports, the transfer mode is propagated as a policy assertion.</span></span>  
  
 <span data-ttu-id="47d1b-126">Примеры кода см. [в разделе как включить потоковую передачу](how-to-enable-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="47d1b-126">For code samples, see [How to: Enable Streaming](how-to-enable-streaming.md).</span></span>  
  
## <a name="enabling-asynchronous-streaming"></a><span data-ttu-id="47d1b-127">Включение асинхронной потоковой передачи</span><span class="sxs-lookup"><span data-stu-id="47d1b-127">Enabling Asynchronous Streaming</span></span>  

 <span data-ttu-id="47d1b-128">Чтобы включить поддержку асинхронной потоковой передачи данных, добавьте поведение конечной точки <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> в основное приложение службы и установите свойству <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> значение `true`.</span><span class="sxs-lookup"><span data-stu-id="47d1b-128">To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`.</span></span>  
  
 <span data-ttu-id="47d1b-129">Эта версия WCF также добавляет возможность истинной асинхронной потоковой передачи на стороне отправки.</span><span class="sxs-lookup"><span data-stu-id="47d1b-129">This version of WCF also adde the capability of true asynchronous streaming on the send side.</span></span> <span data-ttu-id="47d1b-130">Это повышает масштабируемость службы в сценариях, когда обрабатываются потоковые сообщения для нескольких клиентов. Некоторые из этих сообщений считываются медленно, возможно, из-за перегрузки сети или не считываются совсем.</span><span class="sxs-lookup"><span data-stu-id="47d1b-130">This improves scalability of the service in scenarios where it is streaming messages to multiple clients some of which are slow in reading; possibly due to network congestion or are not reading at all.</span></span> <span data-ttu-id="47d1b-131">В этих сценариях WCF больше не блокирует поклиентно отдельные потоки службы.</span><span class="sxs-lookup"><span data-stu-id="47d1b-131">In these scenarios WCF no longer blocks individual threads on the service per client.</span></span> <span data-ttu-id="47d1b-132">Это гарантирует, что служба может обрабатывать гораздо больше клиентов, повышая таким образом масштабируемость службы.</span><span class="sxs-lookup"><span data-stu-id="47d1b-132">This ensures that the service is able to process many more clients thereby improving the scalability of the service.</span></span>  
  
## <a name="restrictions-on-streamed-transfers"></a><span data-ttu-id="47d1b-133">Ограничения потоковой передачи</span><span class="sxs-lookup"><span data-stu-id="47d1b-133">Restrictions on Streamed Transfers</span></span>  

 <span data-ttu-id="47d1b-134">При использовании режима потоковой передачи среда выполнения накладывает дополнительные ограничения.</span><span class="sxs-lookup"><span data-stu-id="47d1b-134">Using the streamed transfer mode causes the run time to enforce additional restrictions.</span></span>  
  
 <span data-ttu-id="47d1b-135">Операции, происходящие в потоковом транспорте, могут иметь контракт не более чем с одним входным или выходным параметром.</span><span class="sxs-lookup"><span data-stu-id="47d1b-135">Operations that occur across a streamed transport can have a contract with at most one input or output parameter.</span></span> <span data-ttu-id="47d1b-136">Такой параметр соответствует всему телу сообщения и должен принадлежать к типу <xref:System.ServiceModel.Channels.Message>, наследуемому от <xref:System.IO.Stream>, или реализации <xref:System.Xml.Serialization.IXmlSerializable>.</span><span class="sxs-lookup"><span data-stu-id="47d1b-136">That parameter corresponds to the entire body of the message and must be a <xref:System.ServiceModel.Channels.Message>, a derived type of <xref:System.IO.Stream>, or an <xref:System.Xml.Serialization.IXmlSerializable> implementation.</span></span> <span data-ttu-id="47d1b-137">Наличие возвращаемого значения операции эквивалентно наличию выходного параметра.</span><span class="sxs-lookup"><span data-stu-id="47d1b-137">Having a return value for an operation is equivalent to having an output parameter.</span></span>  
  
 <span data-ttu-id="47d1b-138">Некоторые функции WCF, такие как надежный обмен сообщениями, транзакции и безопасность на уровне сообщений SOAP, полагаются на сообщения буферизации для передачи.</span><span class="sxs-lookup"><span data-stu-id="47d1b-138">Some WCF features, such as reliable messaging, transactions, and SOAP message-level security, rely on buffering messages for transmissions.</span></span> <span data-ttu-id="47d1b-139">Использование этих возможностей может уменьшить или свести до минимума повышение производительности, достигаемое за счет потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="47d1b-139">Using these features may reduce or eliminate the performance benefits gained by using streaming.</span></span> <span data-ttu-id="47d1b-140">Для защиты потокового транспорта следует использовать либо безопасность только на транспортном уровне, либо безопасность на транспортном уровне и безопасность сообщений только с проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="47d1b-140">To secure a streamed transport, use transport-level security only or use transport-level security plus authentication-only message security.</span></span>  
  
 <span data-ttu-id="47d1b-141">Заголовки SOAP буферизуются всегда, даже если выбран режим потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="47d1b-141">SOAP headers are always buffered, even when the transfer mode is set to streamed.</span></span> <span data-ttu-id="47d1b-142">Размер заголовков сообщений не должен превышать размер квоты транспорта `MaxBufferSize`.</span><span class="sxs-lookup"><span data-stu-id="47d1b-142">The headers for a message must not exceed the size of the `MaxBufferSize` transport quota.</span></span> <span data-ttu-id="47d1b-143">Дополнительные сведения об этом параметре см. в разделе [квоты транспорта](transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="47d1b-143">For more information about this setting, see [Transport Quotas](transport-quotas.md).</span></span>  
  
## <a name="differences-between-buffered-and-streamed-transfers"></a><span data-ttu-id="47d1b-144">Различия между буферизованной и потоковой передачей</span><span class="sxs-lookup"><span data-stu-id="47d1b-144">Differences Between Buffered and Streamed Transfers</span></span>  

 <span data-ttu-id="47d1b-145">Изменение режима передачи с буферизованного на потоковый также приводит к изменению собственной формы канала для транспортов TCP и именованных каналов.</span><span class="sxs-lookup"><span data-stu-id="47d1b-145">Changing the transfer mode from buffered to streamed also changes the native channel shape of the TCP and named pipe transports.</span></span> <span data-ttu-id="47d1b-146">При буферизованной передаче собственная форма канала представлена интерфейсом <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="47d1b-146">For buffered transfers, the native channel shape is <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span></span> <span data-ttu-id="47d1b-147">При потоковой передаче собственные каналы представлены интерфейсами <xref:System.ServiceModel.Channels.IRequestChannel> и <xref:System.ServiceModel.Channels.IReplyChannel>.</span><span class="sxs-lookup"><span data-stu-id="47d1b-147">For streamed transfers, the native channels are <xref:System.ServiceModel.Channels.IRequestChannel> and <xref:System.ServiceModel.Channels.IReplyChannel>.</span></span> <span data-ttu-id="47d1b-148">Изменение режима передачи в существующем приложении, использующем эти транспорты напрямую (т.е. не через контракт службы), требует изменения ожидаемой формы канала для производств и прослушивателей каналов.</span><span class="sxs-lookup"><span data-stu-id="47d1b-148">Changing the transfer mode in an existing application that uses these transports directly (that is, not through a service contract) requires changing the expected channel shape for channel factories and listeners.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="47d1b-149">См. также</span><span class="sxs-lookup"><span data-stu-id="47d1b-149">See also</span></span>

- [<span data-ttu-id="47d1b-150">Практическое руководство. Включение потоковой передачи</span><span class="sxs-lookup"><span data-stu-id="47d1b-150">How to: Enable Streaming</span></span>](how-to-enable-streaming.md)
