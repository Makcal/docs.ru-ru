---
description: Дополнительные сведения см. в статье размещение в приложении службы Windows.
title: Размещение в приложении службы Windows
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: 702fe95b14b9bce3ffaa774e17a9fc1293717e66
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99743126"
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="e16b5-103">Размещение в приложении службы Windows</span><span class="sxs-lookup"><span data-stu-id="e16b5-103">Hosting in a Windows Service Application</span></span>

<span data-ttu-id="e16b5-104">Службы Windows (ранее называвшиеся службами Windows NT) обеспечивают модель процессов, особенно подходящую для приложений, которые должны существовать в длительно исполняемом файле и не отображают никакой формы пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e16b5-104">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="e16b5-105">Временем существования процессов приложений служб Windows управляет диспетчер служб, который позволяет запускать, останавливать и приостанавливать приложения служб Windows.</span><span class="sxs-lookup"><span data-stu-id="e16b5-105">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="e16b5-106">Можно настроить автоматический запуск процесса службы Windows при запуске компьютера, сделав его подходящей средой размещения для приложений Always on.</span><span class="sxs-lookup"><span data-stu-id="e16b5-106">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> <span data-ttu-id="e16b5-107">Дополнительные сведения о приложениях служб Windows см. в разделе [приложения службы Windows](https://go.microsoft.com/fwlink/?LinkId=89450).</span><span class="sxs-lookup"><span data-stu-id="e16b5-107">For more information about Windows service applications, see [Windows Service Applications](https://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="e16b5-108">Приложения, на которых размещаются длительные службы Windows Communication Foundation (WCF), совместно используют многие характеристики со службами Windows.</span><span class="sxs-lookup"><span data-stu-id="e16b5-108">Applications that host long-running Windows Communication Foundation (WCF) services share many characteristics with Windows services.</span></span> <span data-ttu-id="e16b5-109">В частности, службы WCF — это длительно выполняемые серверные исполняемые файлы, которые не взаимодействуют напрямую с пользователем и поэтому не реализуют какой-либо формы пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e16b5-109">In particular, WCF services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="e16b5-110">Таким образом, размещение служб WCF внутри приложения службы Windows — один вариант для создания надежных, долгосрочных приложений WCF.</span><span class="sxs-lookup"><span data-stu-id="e16b5-110">As such, hosting WCF services inside of a Windows service application is one option for building robust, long-running, WCF applications.</span></span>  
  
 <span data-ttu-id="e16b5-111">Часто разработчики WCF должны решить, следует ли размещать свое приложение WCF в приложении службы Windows или в среде размещения служб службы IIS (IIS) или службы активации Windows (WAS).</span><span class="sxs-lookup"><span data-stu-id="e16b5-111">Often, WCF developers must decide whether to host their WCF application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="e16b5-112">Рассмотреть возможность использования приложений служб Windows необходимо в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="e16b5-112">You should consider using Windows service applications under the following conditions:</span></span>  
  
- <span data-ttu-id="e16b5-113">Приложение требует явной активации.</span><span class="sxs-lookup"><span data-stu-id="e16b5-113">Your application requires explicit activation.</span></span> <span data-ttu-id="e16b5-114">Например, службы Windows следует использовать, когда приложение должно запускаться автоматически при запуске сервера, а не динамически при поступлении первого входящего сообщения.</span><span class="sxs-lookup"><span data-stu-id="e16b5-114">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
- <span data-ttu-id="e16b5-115">Процесс, в котором размещается приложение, после запуска должен оставаться работающим.</span><span class="sxs-lookup"><span data-stu-id="e16b5-115">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="e16b5-116">После запуска процесс службы Windows остается работающим, если явно не завершается администратором сервера с помощью диспетчера служб.</span><span class="sxs-lookup"><span data-stu-id="e16b5-116">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="e16b5-117">Приложения, размещенные в IIS или службе активации Windows, могут запускаться и останавливаться динамически для обеспечения оптимального использования системных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e16b5-117">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="e16b5-118">Приложения, для которых требуется явное управление в течение времени существования их процесса размещения, должны использовать службы Windows, а не IIS или службу активации Windows.</span><span class="sxs-lookup"><span data-stu-id="e16b5-118">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
- <span data-ttu-id="e16b5-119">Служба WCF должна работать на Windows Server 2003 и использовать транспорты, отличные от HTTP.</span><span class="sxs-lookup"><span data-stu-id="e16b5-119">Your WCF service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="e16b5-120">В Windows Server 2003 среда размещения IIS 6,0 ограничена только связью по протоколу HTTP.</span><span class="sxs-lookup"><span data-stu-id="e16b5-120">On Windows Server 2003, the IIS 6.0 hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="e16b5-121">Это ограничение не распространяется на приложения служб Windows и может использовать любой поддерживаемый транспортный протокол WCF, включая NET. TCP, net. pipe и net. MSMQ.</span><span class="sxs-lookup"><span data-stu-id="e16b5-121">Windows service applications are not subject to this restriction and can use any transport WCF supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="e16b5-122">Размещение WCF в приложении службы Windows</span><span class="sxs-lookup"><span data-stu-id="e16b5-122">To host WCF inside of a Windows service application</span></span>  
  
1. <span data-ttu-id="e16b5-123">Создайте приложение службы Windows.</span><span class="sxs-lookup"><span data-stu-id="e16b5-123">Create a Windows service application.</span></span> <span data-ttu-id="e16b5-124">Приложения служб Windows можно создавать в управляемом коде, используя классы в пространстве имен <xref:System.ServiceProcess>.</span><span class="sxs-lookup"><span data-stu-id="e16b5-124">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="e16b5-125">Это приложение должно включать один класс, наследуемый от <xref:System.ServiceProcess.ServiceBase>.</span><span class="sxs-lookup"><span data-stu-id="e16b5-125">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2. <span data-ttu-id="e16b5-126">Свяжите время существования служб WCF со временем существования приложения службы Windows.</span><span class="sxs-lookup"><span data-stu-id="e16b5-126">Link the lifetime of the WCF services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="e16b5-127">Как правило, службы WCF, размещенные в приложении службы Windows, становятся активными при запуске службы размещения, прекращают прослушивание сообщений при остановке службы размещения и завершают процесс размещения, когда служба WCF обнаруживает ошибку.</span><span class="sxs-lookup"><span data-stu-id="e16b5-127">Typically, you want WCF services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the WCF service encounters an error.</span></span> <span data-ttu-id="e16b5-128">Это можно обеспечить, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="e16b5-128">This can be accomplished as follows:</span></span>  
  
    - <span data-ttu-id="e16b5-129">Переопределите <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, чтобы открыть один или несколько экземпляров <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="e16b5-129">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="e16b5-130">Одно приложение службы Windows может размещать несколько служб WCF, запускаемых и останавливаемых в качестве группы.</span><span class="sxs-lookup"><span data-stu-id="e16b5-130">A single Windows service application can host multiple WCF services that start and stop as a group.</span></span>  
  
    - <span data-ttu-id="e16b5-131">Переопределите <xref:System.ServiceProcess.ServiceBase.OnStop%2A> для вызова <xref:System.ServiceModel.Channels.CommunicationObject.Closed> на <xref:System.ServiceModel.ServiceHost> всех запущенных службах WCF, которые были запущены во время <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> .</span><span class="sxs-lookup"><span data-stu-id="e16b5-131">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running WCF services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    - <span data-ttu-id="e16b5-132">Подпишитесь на событие <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> приложения <xref:System.ServiceModel.ServiceHost> и используйте класс <xref:System.ServiceProcess.ServiceController>, чтобы завершить работу приложения службы Windows в случае ошибки.</span><span class="sxs-lookup"><span data-stu-id="e16b5-132">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="e16b5-133">Приложения служб Windows, в которых размещаются службы WCF, развертываются и управляются так же, как приложения служб Windows, которые не используют WCF.</span><span class="sxs-lookup"><span data-stu-id="e16b5-133">Windows service applications that host WCF services are deployed and managed in the same way as Windows service applications that do not make use of WCF.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e16b5-134">См. также</span><span class="sxs-lookup"><span data-stu-id="e16b5-134">See also</span></span>

- <xref:System.ServiceProcess>
- [<span data-ttu-id="e16b5-135">Пошаговое руководство: Создание приложения служб Windows в конструкторе компонентов</span><span class="sxs-lookup"><span data-stu-id="e16b5-135">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](https://go.microsoft.com/fwlink/?LinkId=94875)
- [<span data-ttu-id="e16b5-136">Практическое руководство. Размещение службы WCF в управляемой службе Windows</span><span class="sxs-lookup"><span data-stu-id="e16b5-136">How to: Host a WCF Service in a Managed Windows Service</span></span>](how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [<span data-ttu-id="e16b5-137">Узел службы Windows</span><span class="sxs-lookup"><span data-stu-id="e16b5-137">Windows Service Host</span></span>](../samples/windows-service-host.md)
- [<span data-ttu-id="e16b5-138">Программная архитектура приложений служб</span><span class="sxs-lookup"><span data-stu-id="e16b5-138">Service Application Programming Architecture</span></span>](https://go.microsoft.com/fwlink/?LinkId=94876)
- <span data-ttu-id="e16b5-139">[Функции размещения Windows Server App Fabric](/previous-versions/appfabric/ee677189(v=azure.10))</span><span class="sxs-lookup"><span data-stu-id="e16b5-139">[Windows Server App Fabric Hosting Features](/previous-versions/appfabric/ee677189(v=azure.10))</span></span>
