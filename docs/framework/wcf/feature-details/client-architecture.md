---
description: Дополнительные сведения о клиентской архитектуре
title: Клиентская архитектура
ms.date: 03/30/2017
ms.assetid: 02624403-0d77-41cb-9a86-ab55e98c7966
ms.openlocfilehash: dc027d5b9d470afe71c577681f42fc2d0b6bef4c
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99743624"
---
# <a name="client-architecture"></a><span data-ttu-id="ba98e-103">Клиентская архитектура</span><span class="sxs-lookup"><span data-stu-id="ba98e-103">Client Architecture</span></span>

<span data-ttu-id="ba98e-104">Приложения используют клиентские объекты Windows Communication Foundation (WCF) для вызова операций службы.</span><span class="sxs-lookup"><span data-stu-id="ba98e-104">Applications use Windows Communication Foundation (WCF) client objects to invoke service operations.</span></span> <span data-ttu-id="ba98e-105">В этом разделе обсуждаются клиентские объекты WCF, каналы клиента WCF и их связи с архитектурой базового канала.</span><span class="sxs-lookup"><span data-stu-id="ba98e-105">This topic discusses WCF client objects, WCF client channels, and their relationships to the underlying channel architecture.</span></span> <span data-ttu-id="ba98e-106">Основные сведения о клиентских объектах WCF см. в разделе [Общие сведения о клиенте WCF](../wcf-client-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ba98e-106">For a basic overview of WCF client objects, see [WCF Client Overview](../wcf-client-overview.md).</span></span> <span data-ttu-id="ba98e-107">Дополнительные сведения о слое каналов см. в разделе [расширение канального уровня](../extending/extending-the-channel-layer.md).</span><span class="sxs-lookup"><span data-stu-id="ba98e-107">For more information about the channel layer, see [Extending the Channel Layer](../extending/extending-the-channel-layer.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="ba98e-108">Обзор</span><span class="sxs-lookup"><span data-stu-id="ba98e-108">Overview</span></span>  

 <span data-ttu-id="ba98e-109">Время выполнения модели службы создает клиенты WCF, которые состоят из следующих элементов:</span><span class="sxs-lookup"><span data-stu-id="ba98e-109">The service model run time creates WCF clients, which are composed of the following:</span></span>  
  
- <span data-ttu-id="ba98e-110">Автоматически созданная реализация клиента контракта службы, направляющая вызовы из кода приложения в исходящие сообщения, а также направляющая ответные сообщения в параметры вывода и возвращаемые значения, которые приложение может получать.</span><span class="sxs-lookup"><span data-stu-id="ba98e-110">An automatically generated client implementation of a service contract, which turns calls from your application code into outgoing messages, and turns response messages into output parameters and return values that your application can retrieve.</span></span>  
  
- <span data-ttu-id="ba98e-111">Реализация интерфейса управления (<xref:System.ServiceModel.IClientChannel?displayProperty=nameWithType>), который объединяет различные интерфейсы и обеспечивает доступ к функциям управления, наиболее важной из которых является способность закрыть сеанс клиента и удалить канал.</span><span class="sxs-lookup"><span data-stu-id="ba98e-111">An implementation of a control interface (<xref:System.ServiceModel.IClientChannel?displayProperty=nameWithType>) that groups together various interfaces and provides access to control functionality, most notably the ability to close the client session and dispose the channel.</span></span>  
  
- <span data-ttu-id="ba98e-112">Клиентский канал, созданный на основе параметров конфигурации, определенных использованной привязкой.</span><span class="sxs-lookup"><span data-stu-id="ba98e-112">A client channel that is built based on the configuration settings specified by the used binding.</span></span>  
  
 <span data-ttu-id="ba98e-113">Приложения могут создавать такие клиенты по запросу либо с помощью, <xref:System.ServiceModel.ChannelFactory?displayProperty=nameWithType> либо путем создания экземпляра <xref:System.ServiceModel.ClientBase%601> производного класса в том виде, в котором он создается [средством служебной программы метаданных ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="ba98e-113">Applications can create such clients on demand, either through a <xref:System.ServiceModel.ChannelFactory?displayProperty=nameWithType> or by creating an instance of a <xref:System.ServiceModel.ClientBase%601> derived class as it is generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="ba98e-114">Эти созданные клиентские классы осуществляют инкапсуляцию и делегирование в реализацию клиентского канала, которая динамически создается фабрикой <xref:System.ServiceModel.ChannelFactory>.</span><span class="sxs-lookup"><span data-stu-id="ba98e-114">These ready-built client classes encapsulate and delegate to a client channel implementation that is dynamically constructed by a <xref:System.ServiceModel.ChannelFactory>.</span></span> <span data-ttu-id="ba98e-115">Следовательно, наибольший интерес для данного обсуждения представляют клиентские каналы и создающая их фабрика каналов.</span><span class="sxs-lookup"><span data-stu-id="ba98e-115">Therefore, the client channel and the channel factory that produces them are the focal point of interest for this discussion.</span></span>  
  
## <a name="client-objects-and-client-channels"></a><span data-ttu-id="ba98e-116">Клиентские объекты и клиентские каналы</span><span class="sxs-lookup"><span data-stu-id="ba98e-116">Client Objects and Client Channels</span></span>  

 <span data-ttu-id="ba98e-117">Базовый интерфейс клиентов WCF — это <xref:System.ServiceModel.IClientChannel?displayProperty=nameWithType> интерфейс, который предоставляет основные функциональные возможности клиента, а также основные функциональные возможности объекта связи, функции <xref:System.ServiceModel.ICommunicationObject?displayProperty=nameWithType> контекста <xref:System.ServiceModel.IContextChannel?displayProperty=nameWithType> и расширяемое поведение <xref:System.ServiceModel.IExtensibleObject%601?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="ba98e-117">The base interface of WCF clients is the <xref:System.ServiceModel.IClientChannel?displayProperty=nameWithType> interface, which exposes core client functionality as well as the basic communication object functionality of <xref:System.ServiceModel.ICommunicationObject?displayProperty=nameWithType>, the context functionality of <xref:System.ServiceModel.IContextChannel?displayProperty=nameWithType>, and the extensible behavior of <xref:System.ServiceModel.IExtensibleObject%601?displayProperty=nameWithType>.</span></span>  
  
 <span data-ttu-id="ba98e-118">Интерфейс <xref:System.ServiceModel.IClientChannel>, однако, не определяет сам контракт службы.</span><span class="sxs-lookup"><span data-stu-id="ba98e-118">The <xref:System.ServiceModel.IClientChannel> interface, however, does not define a service contract itself.</span></span> <span data-ttu-id="ba98e-119">Они объявляются интерфейсом контракта службы (обычно создаются из метаданных службы с помощью такого средства, как [средство служебной программы метаданных ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md)).</span><span class="sxs-lookup"><span data-stu-id="ba98e-119">Those are declared by the service contract interface (typically generated from service metadata using a tool like the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md)).</span></span> <span data-ttu-id="ba98e-120">Типы клиентов WCF расширяют <xref:System.ServiceModel.IClientChannel> и, и целевой интерфейс контракта службы, чтобы позволить приложениям напрямую вызывать операции, а также иметь доступ к функциональным возможностям во время выполнения на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="ba98e-120">WCF client types extend both <xref:System.ServiceModel.IClientChannel> and the target service contract interface to enable applications to call operations directly and also have access to client-side run-time functionality.</span></span> <span data-ttu-id="ba98e-121">Создание клиента WCF предоставляет объекты WCF <xref:System.ServiceModel.ChannelFactory?displayProperty=nameWithType> с информацией, необходимой для создания времени выполнения, которое может подключаться и взаимодействовать с настроенной конечной точкой службы.</span><span class="sxs-lookup"><span data-stu-id="ba98e-121">Creating an WCF client provides WCF<xref:System.ServiceModel.ChannelFactory?displayProperty=nameWithType> objects with the information necessary to create a run time that can connect and interact with the configured service endpoint.</span></span>  
  
 <span data-ttu-id="ba98e-122">Как упоминалось ранее, необходимо настроить два типа клиента WCF, прежде чем их можно будет использовать.</span><span class="sxs-lookup"><span data-stu-id="ba98e-122">As mentioned earlier, the two WCF client types must be configured before you can use them.</span></span> <span data-ttu-id="ba98e-123">Простейшие типы клиентов WCF — это объекты, производные от <xref:System.ServiceModel.ClientBase%601> (или <xref:System.ServiceModel.DuplexClientBase%601> Если контракт службы является дуплексным контрактом).</span><span class="sxs-lookup"><span data-stu-id="ba98e-123">The simplest WCF client types are objects that derive from <xref:System.ServiceModel.ClientBase%601> (or <xref:System.ServiceModel.DuplexClientBase%601> if the service contract is a duplex contract).</span></span> <span data-ttu-id="ba98e-124">Эти типы можно создать с помощью программно настроенного конструктора или с использованием файла конфигурации и затем вызывать непосредственно для запуска операций службы.</span><span class="sxs-lookup"><span data-stu-id="ba98e-124">You can create these types by using a constructor, configured programmatically, or by using a configuration file, and then called directly to invoke service operations.</span></span> <span data-ttu-id="ba98e-125">Основные сведения об <xref:System.ServiceModel.ClientBase%601> объектах см. в разделе [Общие сведения о клиенте WCF](../wcf-client-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ba98e-125">For a basic overview of <xref:System.ServiceModel.ClientBase%601> objects, see [WCF Client Overview](../wcf-client-overview.md).</span></span>  
  
 <span data-ttu-id="ba98e-126">Второй тип создается во время выполнения в результате вызова метода <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span><span class="sxs-lookup"><span data-stu-id="ba98e-126">The second type is generated at run time from a call to the <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A> method.</span></span> <span data-ttu-id="ba98e-127">Приложения, связанные с жестким контролем конкретных коммуникаций, обычно используют этот тип клиента, называемый *объектом "канал клиента*", так как он обеспечивает более прямое взаимодействие, чем базовая система клиентской среды выполнения и канала.</span><span class="sxs-lookup"><span data-stu-id="ba98e-127">Applications concerned with tight control of the communication specifics typically use this client type, called a *client channel object*, because it enables more direct interaction than the underlying client run-time and channel system.</span></span>  
  
## <a name="channel-factories"></a><span data-ttu-id="ba98e-128">Фабрики каналов</span><span class="sxs-lookup"><span data-stu-id="ba98e-128">Channel Factories</span></span>  

 <span data-ttu-id="ba98e-129">За создание базовой среды выполнения, которая поддерживает вызовы клиентов, отвечает класс <xref:System.ServiceModel.ChannelFactory%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ba98e-129">The class that is responsible for creating the underlying run time that supports client invocations is the <xref:System.ServiceModel.ChannelFactory%601?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="ba98e-130">Как клиентские объекты WCF, так и объекты канала клиента WCF используют <xref:System.ServiceModel.ChannelFactory%601> объект для создания экземпляров; <xref:System.ServiceModel.ClientBase%601> производный клиент инкапсулирует обработку фабрики каналов, но в ряде сценариев вполне целесообразно использовать фабрику каналов напрямую.</span><span class="sxs-lookup"><span data-stu-id="ba98e-130">Both WCF client objects and WCF client channel objects use a <xref:System.ServiceModel.ChannelFactory%601> object to create instances; the <xref:System.ServiceModel.ClientBase%601> derived client object encapsulates the handling of the channel factory, but for a number of scenarios it is perfectly reasonable to use the channel factory directly.</span></span> <span data-ttu-id="ba98e-131">Распространенный сценарий для этого - необходимость многократного создания новых клиентских каналов из существующей фабрики.</span><span class="sxs-lookup"><span data-stu-id="ba98e-131">The common scenario for this is if you want to repeatedly create new client channels from an existing factory.</span></span> <span data-ttu-id="ba98e-132">При использовании клиентского объекта можно получить базовую фабрику каналов из клиентского объекта WCF, вызвав <xref:System.ServiceModel.ClientBase%601.ChannelFactory%2A?displayProperty=nameWithType> свойство.</span><span class="sxs-lookup"><span data-stu-id="ba98e-132">If you are using a client object, you can obtain the underlying channel factory from a WCF client object by calling the <xref:System.ServiceModel.ClientBase%601.ChannelFactory%2A?displayProperty=nameWithType> property.</span></span>  
  
 <span data-ttu-id="ba98e-133">В отношении фабрик каналов необходимо иметь в виду, что они создают новые экземпляры клиентских каналов для предоставленной им конфигурации до вызова метода <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ba98e-133">The important thing to remember about channel factories is that they create new instances of client channels for the configuration provided to them prior to calling <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="ba98e-134">После вызова <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A> (или <xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> , <xref:System.ServiceModel.ClientBase%601.CreateChannel%2A?displayProperty=nameWithType> или любой операции с клиентским объектом WCF) нельзя изменить фабрику каналов и не дождаться получения каналов к различным экземплярам службы, даже если вы просто изменяете адрес целевой конечной точки.</span><span class="sxs-lookup"><span data-stu-id="ba98e-134">Once you call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A> (or <xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType>, <xref:System.ServiceModel.ClientBase%601.CreateChannel%2A?displayProperty=nameWithType>, or any operation on a WCF client object), you cannot modify the channel factory and expect to get channels to different service instances, even if you are merely changing the target endpoint address.</span></span> <span data-ttu-id="ba98e-135">Если требуется создать клиентский объект или клиентский канал с другой конфигурацией, сначала необходимо создать новую фабрику каналов.</span><span class="sxs-lookup"><span data-stu-id="ba98e-135">If you want to create a client object or client channel with a different configuration, you must create a new channel factory first.</span></span>  
  
 <span data-ttu-id="ba98e-136">Дополнительные сведения о различных проблемах, связанных с использованием клиентских объектов WCF и каналов клиента WCF, см. [в разделе доступ к службам с помощью клиента WCF](accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="ba98e-136">For more information about various issues using WCF client objects and WCF client channels, see [Accessing Services Using a WCF Client](accessing-services-using-a-client.md).</span></span>  
  
 <span data-ttu-id="ba98e-137">В следующих двух разделах описывается создание и использование объектов канала клиента WCF.</span><span class="sxs-lookup"><span data-stu-id="ba98e-137">The following two sections describe the creation and use of WCF client channel objects.</span></span>  
  
#### <a name="creating-a-new-wcf-client-channel-object"></a><span data-ttu-id="ba98e-138">Создание нового объекта клиентского канала WCF</span><span class="sxs-lookup"><span data-stu-id="ba98e-138">Creating a New WCF Client Channel Object</span></span>  

 <span data-ttu-id="ba98e-139">Чтобы продемонстрировать использование клиентского канала, предположим, что создан следующий контракт службы.</span><span class="sxs-lookup"><span data-stu-id="ba98e-139">To illustrate the use of a client channel, assume the following service contract has been generated.</span></span>  
  
 [!code-csharp[C_GeneratedCodeFiles#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_generatedcodefiles/cs/proxycode.cs#12)]  
  
 <span data-ttu-id="ba98e-140">Для подключения к службе `ISampleService` используйте созданный интерфейс контракта непосредственно с фабрикой каналов (<xref:System.ServiceModel.ChannelFactory%601>).</span><span class="sxs-lookup"><span data-stu-id="ba98e-140">To connect to an `ISampleService` service, use the generated contract interface directly with a channel factory (<xref:System.ServiceModel.ChannelFactory%601>).</span></span> <span data-ttu-id="ba98e-141">При создании и настройке фабрики каналов для конкретного контракта можно вызвать метод <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A> для возврата объектов клиентских каналов, которые можно использовать для взаимодействия со службой `ISampleService`.</span><span class="sxs-lookup"><span data-stu-id="ba98e-141">Once you create and configure a channel factory for a particular contract, you can call the <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A> method to return client channel objects that you can use to communicate with an `ISampleService` service.</span></span>  
  
 <span data-ttu-id="ba98e-142">При использовании класса <xref:System.ServiceModel.ChannelFactory%601> с интерфейсом контракта службы следует перейти к интерфейсу <xref:System.ServiceModel.IClientChannel> , чтобы явно открыть, закрыть канал или прервать его работу.</span><span class="sxs-lookup"><span data-stu-id="ba98e-142">When using the <xref:System.ServiceModel.ChannelFactory%601> class with a service contract interface, you must cast to the <xref:System.ServiceModel.IClientChannel> interface to explicitly open, close, or abort the channel.</span></span> <span data-ttu-id="ba98e-143">Для упрощения работы средство Svcutil.exe создает также вспомогательный интерфейс, реализующий и интерфейс контракта службы, и интерфейс <xref:System.ServiceModel.IClientChannel> , чтобы можно было взаимодействовать с инфраструктурой клиентских каналов без переходов.</span><span class="sxs-lookup"><span data-stu-id="ba98e-143">To make it easier to work with, the Svcutil.exe tool also generates a helper interface that implements both the service contract interface and <xref:System.ServiceModel.IClientChannel> to enable you to interact with the client channel infrastructure without having to cast.</span></span> <span data-ttu-id="ba98e-144">В следующем коде показано определение вспомогательного клиентского канала, который реализует указанный выше контракт службы.</span><span class="sxs-lookup"><span data-stu-id="ba98e-144">The following code shows the definition of a helper client channel that implements the preceding service contract.</span></span>  
  
 [!code-csharp[C_GeneratedCodeFiles#13](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_generatedcodefiles/cs/proxycode.cs#13)]  
  
#### <a name="creating-a-new-wcf-client-channel-object"></a><span data-ttu-id="ba98e-145">Создание нового объекта клиентского канала WCF</span><span class="sxs-lookup"><span data-stu-id="ba98e-145">Creating a New WCF Client Channel Object</span></span>  

 <span data-ttu-id="ba98e-146">Чтобы воспользоваться клиентским каналом для подключения к службе `ISampleService`, используйте созданный интерфейс контракта (или вспомогательный вариант) непосредственно с фабрикой каналов, передав тип интерфейса контракта в качестве параметра типа.</span><span class="sxs-lookup"><span data-stu-id="ba98e-146">To use a client channel to connect to an `ISampleService` service, use the generated contract interface (or the helper version) directly with a channel factory, passing the type of the contract interface as the type parameter.</span></span> <span data-ttu-id="ba98e-147">После создания и настройки фабрики каналов для конкретного контракта можно вызвать метод <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType> для возврата объектов клиентских каналов, которые можно использовать для взаимодействия со службой `ISampleService`.</span><span class="sxs-lookup"><span data-stu-id="ba98e-147">Once a channel factory for a particular contract has been created and configured, you can call the <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType> method to return client channel objects that you can use to communicate with an `ISampleService` service.</span></span>  
  
 <span data-ttu-id="ba98e-148">Созданные объекты клиентских каналов реализуют интерфейс <xref:System.ServiceModel.IClientChannel> и интерфейс контракта.</span><span class="sxs-lookup"><span data-stu-id="ba98e-148">When created, the client channel objects implement <xref:System.ServiceModel.IClientChannel> and the contract interface.</span></span> <span data-ttu-id="ba98e-149">Следовательно, их можно использовать непосредственно для вызова операций, взаимодействующих со службой, поддерживающей этот контракт.</span><span class="sxs-lookup"><span data-stu-id="ba98e-149">Therefore, you can use them directly to call operations that interact with a service that supports that contract.</span></span>  
  
 <span data-ttu-id="ba98e-150">Различие между применением клиентских объектов и объектов клиентских каналов состоит только в управлении и удобстве использования для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="ba98e-150">The difference between using client objects and client channel objects is merely one of control and ease of use for developers.</span></span> <span data-ttu-id="ba98e-151">Многие разработчики, хорошо работающие с классами и объектами, предпочитают использовать клиентский объект WCF вместо канала клиента WCF.</span><span class="sxs-lookup"><span data-stu-id="ba98e-151">Many developers who are comfortable working with classes and objects will prefer to use the WCF client object instead of the WCF client channel.</span></span>  
  
 <span data-ttu-id="ba98e-152">Пример см. в разделе [как использовать ChannelFactory](how-to-use-the-channelfactory.md).</span><span class="sxs-lookup"><span data-stu-id="ba98e-152">For an example, see [How to: Use the ChannelFactory](how-to-use-the-channelfactory.md).</span></span>
