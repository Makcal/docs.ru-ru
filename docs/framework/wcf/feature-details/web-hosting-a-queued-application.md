---
description: Дополнительные сведения о веб-размещении приложения в очереди
title: Размещение веб-узлов в приложении, использующем очереди
ms.date: 03/30/2017
ms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88
ms.openlocfilehash: 5fb056a75598523554869f0089689979986dba7f
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99752565"
---
# <a name="web-hosting-a-queued-application"></a><span data-ttu-id="067d8-103">Размещение веб-узлов в приложении, использующем очереди</span><span class="sxs-lookup"><span data-stu-id="067d8-103">Web Hosting a Queued Application</span></span>

<span data-ttu-id="067d8-104">Служба активации Windows (WAS) управляет активацией и временем жизни рабочих процессов, которые содержат приложения, размещенные в службах Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="067d8-104">The Windows Process Activation Service (WAS) manages the activation and lifetime of the worker processes that contain applications that host Windows Communication Foundation (WCF) services.</span></span> <span data-ttu-id="067d8-105">Модель процесса WAS обобщает модель процесса IIS 6.0 для HTTP-сервера, удаляя зависимость от HTTP.</span><span class="sxs-lookup"><span data-stu-id="067d8-105">The WAS process model generalizes the IIS 6.0 process model for the HTTP server by removing the dependency on HTTP.</span></span> <span data-ttu-id="067d8-106">Это позволяет службам WCF использовать протоколы HTTP и отличные от HTTP, такие как net. MSMQ и MSMQ. formatname, в среде размещения, которая поддерживает активацию на основе сообщений и предлагает возможность размещения большого количества приложений на определенном компьютере.</span><span class="sxs-lookup"><span data-stu-id="067d8-106">This allows WCF services to use both HTTP and non-HTTP protocols, such as net.msmq and msmq.formatname, in a hosting environment that supports message-based activation and offers the ability to host a large number of applications on a given computer.</span></span>  
  
 <span data-ttu-id="067d8-107">WAS содержит службу активации очереди сообщений (MSMQ), которая активирует приложение с использованием очередей, где одно или более сообщений ставятся в очередь сообщений MSMQ, одну из очередей, используемых приложением.</span><span class="sxs-lookup"><span data-stu-id="067d8-107">WAS includes a Message Queuing (MSMQ) activation service that activates a queued application when one or more messages are placed in one of the queues used by the application.</span></span> <span data-ttu-id="067d8-108">Служба активации MSMQ является службой NT, запускающейся по умолчанию автоматически.</span><span class="sxs-lookup"><span data-stu-id="067d8-108">The MSMQ activation service is an NT service that is automatically started by default.</span></span>  
  
 <span data-ttu-id="067d8-109">Дополнительные сведения о WAS и его преимуществах см. [в разделе Размещение в службе активации Windows](hosting-in-windows-process-activation-service.md).</span><span class="sxs-lookup"><span data-stu-id="067d8-109">For more information about WAS and its benefits, see [Hosting in Windows Process Activation Service](hosting-in-windows-process-activation-service.md).</span></span> <span data-ttu-id="067d8-110">Дополнительные сведения об MSMQ см. в статье [Общие сведения о очередях](queues-overview.md).</span><span class="sxs-lookup"><span data-stu-id="067d8-110">For more information about MSMQ, see [Queues Overview](queues-overview.md).</span></span>
  
## <a name="queue-addressing-in-was"></a><span data-ttu-id="067d8-111">Адресация очереди в WAS</span><span class="sxs-lookup"><span data-stu-id="067d8-111">Queue Addressing in WAS</span></span>  

 <span data-ttu-id="067d8-112">Приложения WAS имеют адреса в виде универсальных кодов ресурсов (URI).</span><span class="sxs-lookup"><span data-stu-id="067d8-112">WAS applications have Uniform Resource Identifier (URI) addresses.</span></span> <span data-ttu-id="067d8-113">Адреса приложений состоят из двух частей: основной префикс URI и относительный адрес, специальный для каждого приложения (путь).</span><span class="sxs-lookup"><span data-stu-id="067d8-113">Application addresses have two parts: a base URI prefix and an application-specific, relative address (path).</span></span> <span data-ttu-id="067d8-114">Вместе эти две части показывают внешний адрес приложения.</span><span class="sxs-lookup"><span data-stu-id="067d8-114">These two parts provide the external address for an application when joined together.</span></span> <span data-ttu-id="067d8-115">Базовый префикс URI создается на основе привязки сайта и используется для всех приложений сайта, например "net. msmq://localhost", "MSMQ. formatname://localhost" или "net. TCP://localhost".</span><span class="sxs-lookup"><span data-stu-id="067d8-115">The base URI prefix is constructed from the site binding and is used for all the applications under the site, for example, "net.msmq://localhost", "msmq.formatname://localhost", or "net.tcp://localhost".</span></span> <span data-ttu-id="067d8-116">После этого адреса приложений создаются путем создания фрагментов пути для конкретного приложения (например, "/Аппликатиононе") и добавления их к базовому префиксу URI для получения полного URI приложения, например "net. msmq://ЛОКАЛХОСТ/аппликатиононе".</span><span class="sxs-lookup"><span data-stu-id="067d8-116">Application addresses are then constructed by taking application-specific path fragments (such as "/applicationOne") and appending them to the base URI prefix to arrive at the full application URI, for example, "net.msmq://localhost/applicationOne".</span></span>  
  
 <span data-ttu-id="067d8-117">Служба активации MSMQ использует URI приложения для проверки соответствия с очередью, сообщения которой служба активации MSMQ должна контролировать.</span><span class="sxs-lookup"><span data-stu-id="067d8-117">The MSMQ activation service uses the application URI to match the queue that the MSMQ activation service must monitor for messages.</span></span> <span data-ttu-id="067d8-118">При запуске служба активации MSMQ перечисляет все общие и частные очереди на компьютере, с которого она их получает согласно настройкам конфигурации, и отслеживает наличие в них сообщений.</span><span class="sxs-lookup"><span data-stu-id="067d8-118">When the MSMQ activation service starts, it enumerates all public and private queues on the computer it is configured to receive from and monitors them for messages.</span></span> <span data-ttu-id="067d8-119">Служба активации MSMQ обновляет список очередей для проверки каждые 10 минут.</span><span class="sxs-lookup"><span data-stu-id="067d8-119">Every 10 minutes, the MSMQ activation service refreshes the list of queues to monitor.</span></span> <span data-ttu-id="067d8-120">Если в очереди найдено сообщение, служба активации проверяет соответствие имени очереди и самого длинного согласующегося URI для привязки net.msmq и активирует приложение.</span><span class="sxs-lookup"><span data-stu-id="067d8-120">When a message is found in a queue, the activation service matches the queue name to the longest matching application URI for the net.msmq binding and activates the application.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="067d8-121">Активируемое приложение должно соответствовать (иметь самый длинный согласующийся код) префиксу имени очереди.</span><span class="sxs-lookup"><span data-stu-id="067d8-121">The application being activated must match (longest match) the prefix of the queue name.</span></span>  
  
 <span data-ttu-id="067d8-122">Например, имя очереди: msmqWebHost/orderProcessing/service.svc.</span><span class="sxs-lookup"><span data-stu-id="067d8-122">For example, a queue name is: msmqWebHost/orderProcessing/service.svc.</span></span> <span data-ttu-id="067d8-123">Если приложение 1 имеет виртуальный каталог /msmqWebHost/orderProcessing с файлом service.svc в нем, а приложение 2 имеет виртуальный каталог /msmqWebHost с orderProcessing.svc в нем, активируется приложение 1.</span><span class="sxs-lookup"><span data-stu-id="067d8-123">If Application 1 has a virtual directory /msmqWebHost/orderProcessing with a service.svc under it, and Application 2 has a virtual directory /msmqWebHost with an orderProcessing.svc under it, Application 1 is activated.</span></span> <span data-ttu-id="067d8-124">Если приложение 1 удалено, активируется приложение 2.</span><span class="sxs-lookup"><span data-stu-id="067d8-124">If Application 1 is deleted, Application 2 is activated.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="067d8-125">При создании очереди ни одно сообщение из всех отправленных в очередь не активирует приложение до тех пор, пока служба активации MSMQ не обновит список очередей, что произойдет максимум через 10 минут после создания очереди.</span><span class="sxs-lookup"><span data-stu-id="067d8-125">When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created.</span></span> <span data-ttu-id="067d8-126">При повторном запуске службы активации список очередей также обновляется.</span><span class="sxs-lookup"><span data-stu-id="067d8-126">Restarting the activation service refreshes the queue list as well.</span></span>  
  
### <a name="the-effect-of-private-and-public-queues-on-addressing"></a><span data-ttu-id="067d8-127">Влияние общих и частных очередей на адресацию</span><span class="sxs-lookup"><span data-stu-id="067d8-127">The Effect of Private and Public Queues on Addressing</span></span>  

 <span data-ttu-id="067d8-128">Служба активизации MSMQ не делает различий между мониторингом частных и общих очередей.</span><span class="sxs-lookup"><span data-stu-id="067d8-128">The MSMQ activation service does not distinguish between private and public queue monitoring.</span></span> <span data-ttu-id="067d8-129">В принципе, общая и частная очереди не могут иметь одинаковых имен.</span><span class="sxs-lookup"><span data-stu-id="067d8-129">As such, you cannot have public and private queues with the same name.</span></span> <span data-ttu-id="067d8-130">Но, если это так, приложение, размещенное на веб-сервере, может быть активировано чтением сообщения из любой из очередей.</span><span class="sxs-lookup"><span data-stu-id="067d8-130">If you do, a Web-hosted application may get activated reading from either of the queues.</span></span>  
  
### <a name="queue-configuration-for-activation"></a><span data-ttu-id="067d8-131">Конфигурация очереди для активации</span><span class="sxs-lookup"><span data-stu-id="067d8-131">Queue Configuration for Activation</span></span>  

 <span data-ttu-id="067d8-132">Служба активации MSMQ работает как NETWORK SERVICE.</span><span class="sxs-lookup"><span data-stu-id="067d8-132">The MSMQ activation service runs as NETWORK SERVICE.</span></span> <span data-ttu-id="067d8-133">Это служба, осуществляющая мониторинг очередей для активации приложений.</span><span class="sxs-lookup"><span data-stu-id="067d8-133">It is the service that monitors queues to activate applications.</span></span> <span data-ttu-id="067d8-134">Для того, чтобы служба активировала приложения из очереди, очередь должна быть доступна NETWORK SERVICE для просмотра сообщений в списке управления доступом (ACL).</span><span class="sxs-lookup"><span data-stu-id="067d8-134">For it to activate applications from the queue, the queue must provide for NETWORK SERVICE access to peek for messages in its access control list (ACL).</span></span>  
  
### <a name="poison-messaging"></a><span data-ttu-id="067d8-135">Подозрительные сообщения</span><span class="sxs-lookup"><span data-stu-id="067d8-135">Poison Messaging</span></span>  

 <span data-ttu-id="067d8-136">Обработка подозрительных сообщений в WCF обрабатывается каналом, который не только обнаруживает, что сообщение является подозрительным, но и выбирает расстановку на основе пользовательской конфигурации.</span><span class="sxs-lookup"><span data-stu-id="067d8-136">Poison message handling in WCF is handled by the channel, which not only detects that a message is poisoned but selects a disposition based on user configuration.</span></span> <span data-ttu-id="067d8-137">В результате, в очереди находится одно сообщение.</span><span class="sxs-lookup"><span data-stu-id="067d8-137">As a result, there is a single message in the queue.</span></span> <span data-ttu-id="067d8-138">Приложение, размещающееся на веб-сервере, прерывает последующие попытки, и сообщение перемещается в очередь повторного выполнения.</span><span class="sxs-lookup"><span data-stu-id="067d8-138">The Web-hosted application aborts successive times and the message is moved to a retry queue.</span></span> <span data-ttu-id="067d8-139">В момент истечения времени цикла повторного выполнения сообщение перемещается из очереди повторного выполнения в главную очередь для повторной попытки.</span><span class="sxs-lookup"><span data-stu-id="067d8-139">At a point dictated by the retry cycle delay, the message is moved from the retry queue to the main queue to try again.</span></span> <span data-ttu-id="067d8-140">Однако, чтобы это произошло, канал в очереди должен быть активным.</span><span class="sxs-lookup"><span data-stu-id="067d8-140">But this requires the queued channel to be active.</span></span> <span data-ttu-id="067d8-141">Если цикл в приложении задает WAS, сообщение остается в очереди повторного выполнения до тех пор, пока в основную очередь не поступит другое сообщение, активирующее приложение в очереди.</span><span class="sxs-lookup"><span data-stu-id="067d8-141">If the application is recycled by WAS, then the message remains in the retry queue until another message arrives in the main queue to activate the queued application.</span></span> <span data-ttu-id="067d8-142">Обходным путем в этом случае является перемещение сообщения вручную из очереди повторного выполнения обратно в основную очередь для повторной активации приложения.</span><span class="sxs-lookup"><span data-stu-id="067d8-142">The workaround in this case is to move the message manually from the retry queue back to the main queue to reactivate the application.</span></span>  
  
### <a name="subqueue-and-system-queue-caveat"></a><span data-ttu-id="067d8-143">Вложенная очередь и недостаток системных очередей</span><span class="sxs-lookup"><span data-stu-id="067d8-143">Subqueue and System Queue Caveat</span></span>  

 <span data-ttu-id="067d8-144">Приложение, размещенное WAS не может быть активировано посредством сообщений из системных очередей, таких как общесистемная очередь недоставленных сообщений или вложенных очередей, таких как вложенные очереди подозрительных сообщений.</span><span class="sxs-lookup"><span data-stu-id="067d8-144">A WAS-hosted application cannot be activated based on messages in a system queue, such as the system-wide dead-letter queue, or sub-queues, such as poison sub-queues.</span></span> <span data-ttu-id="067d8-145">Это ограничение для данной версии продукта.</span><span class="sxs-lookup"><span data-stu-id="067d8-145">This is a limitation for this version of the product.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="067d8-146">См. также</span><span class="sxs-lookup"><span data-stu-id="067d8-146">See also</span></span>

- [<span data-ttu-id="067d8-147">Обработка подозрительных сообщений</span><span class="sxs-lookup"><span data-stu-id="067d8-147">Poison Message Handling</span></span>](poison-message-handling.md)
- [<span data-ttu-id="067d8-148">Конечные точки служб и адресация очереди</span><span class="sxs-lookup"><span data-stu-id="067d8-148">Service Endpoints and Queue Addressing</span></span>](service-endpoints-and-queue-addressing.md)
