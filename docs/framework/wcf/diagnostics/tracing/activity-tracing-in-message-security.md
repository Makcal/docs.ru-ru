---
description: 'Дополнительные сведения: трассировка действий в безопасности сообщений'
title: Отслеживание действий при обеспечении безопасности сообщений
ms.date: 03/30/2017
ms.assetid: 68862534-3b2e-4270-b097-8121b12a2c97
ms.openlocfilehash: 94fb6f60539465dd16e09a968679567e94d6cd24
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99770863"
---
# <a name="activity-tracing-in-message-security"></a><span data-ttu-id="a4be8-103">Отслеживание действий при обеспечении безопасности сообщений</span><span class="sxs-lookup"><span data-stu-id="a4be8-103">Activity Tracing in Message Security</span></span>

<span data-ttu-id="a4be8-104">В данном разделе описывается трассировка действий для обработки событий безопасности, которая осуществляется в три этапа (см. ниже).</span><span class="sxs-lookup"><span data-stu-id="a4be8-104">This topic describes activity tracing for security processing, which happens in the following three phases.</span></span>  
  
- <span data-ttu-id="a4be8-105">Согласование и обмен маркерами SCT.</span><span class="sxs-lookup"><span data-stu-id="a4be8-105">Negotiation/SCT exchange.</span></span> <span data-ttu-id="a4be8-106">Это может происходить на транспортном уровне (посредством обмена двоичными данными) или на уровне сообщений (посредством обмена сообщениями SOAP).</span><span class="sxs-lookup"><span data-stu-id="a4be8-106">This can happen at the transport later (through binary data exchange) or message layer (through SOAP message exchanges).</span></span>  
  
- <span data-ttu-id="a4be8-107">Зашифровывание и расшифровывание сообщений с проверкой подписи и проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="a4be8-107">Message encryption/decryption, with signature verification and authentication.</span></span> <span data-ttu-id="a4be8-108">Трассировки создаются во внешнем действии (обычно "Обработать действие").</span><span class="sxs-lookup"><span data-stu-id="a4be8-108">Traces appear in the ambient activity, typically "Process Action."</span></span>  
  
- <span data-ttu-id="a4be8-109">Авторизация и проверка.</span><span class="sxs-lookup"><span data-stu-id="a4be8-109">Authorization and verification.</span></span> <span data-ttu-id="a4be8-110">Это может происходить локально или при обмене данными между конечными точками.</span><span class="sxs-lookup"><span data-stu-id="a4be8-110">This can happen locally or when communicating between endpoints.</span></span>  
  
## <a name="negotiationsct-exchange"></a><span data-ttu-id="a4be8-111">Согласование и обмен маркерами SCT</span><span class="sxs-lookup"><span data-stu-id="a4be8-111">Negotiation/SCT exchange</span></span>  

 <span data-ttu-id="a4be8-112">В ходе этапа согласования и обмена маркерами SCT на клиенте создается два типа действий: "Установить безопасный сеанс" и "Закрыть безопасный сеанс".</span><span class="sxs-lookup"><span data-stu-id="a4be8-112">In the negotiation/SCT exchange phase, two activity types are created on the client: "Set up Secure Session" and "Close Secure Session."</span></span> <span data-ttu-id="a4be8-113">"Установить безопасный сеанс" охватывает трассировки для обмена сообщениями RST/RSTR/SCT, а "Закрыть безопасный сеанс" включает трассировки для сообщения отмены.</span><span class="sxs-lookup"><span data-stu-id="a4be8-113">"Set up Secure Session" encompasses traces for the RST/RSTR/SCT message exchanges, while "Close Secure Session" includes traces for the Cancel message.</span></span>  
  
 <span data-ttu-id="a4be8-114">На сервере каждый запрос или ответ RST/RSTR/SCT происходит в собственном действии.</span><span class="sxs-lookup"><span data-stu-id="a4be8-114">On the server, each request/reply for the RST/RSTR/SCT appears in its own activity.</span></span> <span data-ttu-id="a4be8-115">Если `propagateActivity` = `true` на сервере и на клиенте, действия на сервере имеют одинаковый идентификатор и отображаются вместе в окне "Настройка безопасного сеанса" при просмотре с помощью средства просмотра трассировки службы.</span><span class="sxs-lookup"><span data-stu-id="a4be8-115">If `propagateActivity`=`true` on both the server and client, activities on the server have the same ID, and appear together in the "Setup Secure Session" when viewed through Service Trace Viewer.</span></span>  
  
 <span data-ttu-id="a4be8-116">Данная модель трассировки действий применяется для проверки подлинности по имени пользователя и паролю, проверки подлинности сертификатов и проверки подлинности NTLM.</span><span class="sxs-lookup"><span data-stu-id="a4be8-116">This activity tracing model is valid for user name/password authentication, certificate authentication, and NTLM authentication.</span></span>  
  
 <span data-ttu-id="a4be8-117">В следующей таблице перечислены действия и трассировки для согласования и обмена маркерами SCT.</span><span class="sxs-lookup"><span data-stu-id="a4be8-117">The following table lists the activities and traces for negotiation and SCT exchange.</span></span>  
  
||<span data-ttu-id="a4be8-118">Время начала согласования и обмена маркерами SCT</span><span class="sxs-lookup"><span data-stu-id="a4be8-118">Time when Negotiation/SCT exchange happens</span></span>|<span data-ttu-id="a4be8-119">Действия</span><span class="sxs-lookup"><span data-stu-id="a4be8-119">Activities</span></span>|<span data-ttu-id="a4be8-120">Трассировки</span><span class="sxs-lookup"><span data-stu-id="a4be8-120">Traces</span></span>|  
|-|-------------------------------------------------|----------------|------------|  
|<span data-ttu-id="a4be8-121">Безопасный транспорт</span><span class="sxs-lookup"><span data-stu-id="a4be8-121">Secure Transport</span></span><br /><br /> <span data-ttu-id="a4be8-122">(HTTPS, SSL)</span><span class="sxs-lookup"><span data-stu-id="a4be8-122">(HTTPS, SSL)</span></span>|<span data-ttu-id="a4be8-123">При получении первого сообщения.</span><span class="sxs-lookup"><span data-stu-id="a4be8-123">On first message received.</span></span>|<span data-ttu-id="a4be8-124">Трассировки создаются во внешнем действии.</span><span class="sxs-lookup"><span data-stu-id="a4be8-124">Traces are emitted in the ambient activity.</span></span>|<span data-ttu-id="a4be8-125">-Трассировки Exchange</span><span class="sxs-lookup"><span data-stu-id="a4be8-125">-   Exchange traces</span></span><br /><span data-ttu-id="a4be8-126">— Защищенный канал установлен</span><span class="sxs-lookup"><span data-stu-id="a4be8-126">-   Secure channel established</span></span><br /><span data-ttu-id="a4be8-127">— Получено общих секретов.</span><span class="sxs-lookup"><span data-stu-id="a4be8-127">-   Share secrets obtained.</span></span>|  
|<span data-ttu-id="a4be8-128">Уровень защищенных сообщений</span><span class="sxs-lookup"><span data-stu-id="a4be8-128">Secure Message Layer</span></span><br /><br /> <span data-ttu-id="a4be8-129">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="a4be8-129">(WSHTTP)</span></span>|<span data-ttu-id="a4be8-130">При получении первого сообщения.</span><span class="sxs-lookup"><span data-stu-id="a4be8-130">On first message received.</span></span>|<span data-ttu-id="a4be8-131">На клиенте:</span><span class="sxs-lookup"><span data-stu-id="a4be8-131">On the client:</span></span><br /><br /> <span data-ttu-id="a4be8-132">— "Настройка безопасного сеанса" из "действия обработки" этого первого сообщения для каждого запроса или ответа в RST/RSTR/SCT.</span><span class="sxs-lookup"><span data-stu-id="a4be8-132">-   "Setup Secure Session" out of "Process Action" of that first message, for each request/reply for RST/RSTR/SCT.</span></span><br /><span data-ttu-id="a4be8-133">— "Закрыть безопасный сеанс" для отмены Exchange, из "закрытие действия прокси-сервера".</span><span class="sxs-lookup"><span data-stu-id="a4be8-133">-   "Close Secure Session" for the CANCEL exchange, out of the "Close Proxy activity."</span></span> <span data-ttu-id="a4be8-134">В зависимости от времени закрытия безопасного сеанса данное действие может произойти из другого внешнего действия.</span><span class="sxs-lookup"><span data-stu-id="a4be8-134">This activity may happen out of some other ambient activity, depending on when the secure session is closed.</span></span><br /><br /> <span data-ttu-id="a4be8-135">На сервере:</span><span class="sxs-lookup"><span data-stu-id="a4be8-135">On the server:</span></span><br /><br /> <span data-ttu-id="a4be8-136">— Одно действие "обработать действие" для каждого запроса или ответа для RST/SCT/Cancel на сервере.</span><span class="sxs-lookup"><span data-stu-id="a4be8-136">-   One "Process Action" activity for each request/reply for RST/SCT/Cancel on the server.</span></span> <span data-ttu-id="a4be8-137">Если `propagateActivity` = `true` , действия RST/RSTR/SCT объединяются с "Настройка сеанса безопасности", а "Отмена" объединяется с действием "Закрыть" клиента.</span><span class="sxs-lookup"><span data-stu-id="a4be8-137">If `propagateActivity`=`true`, RST/RSTR/SCT activities are merged with "Set up Security Session", and Cancel is merged with the "Close" activity from the client.</span></span><br /><br /> <span data-ttu-id="a4be8-138">Для действия "Установить безопасный сеанс" предусмотрено два этапа:</span><span class="sxs-lookup"><span data-stu-id="a4be8-138">There are two stages for "Set up Secure Session":</span></span><br /><br /> <span data-ttu-id="a4be8-139">1. согласование проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a4be8-139">1.  Authentication negotiation.</span></span> <span data-ttu-id="a4be8-140">Этот этап не является обязательным, если у клиента уже есть надлежащие учетные данные.</span><span class="sxs-lookup"><span data-stu-id="a4be8-140">This is optional if the client already has the proper credentials.</span></span> <span data-ttu-id="a4be8-141">Этот этап можно выполнить посредством безопасного транспорта или обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="a4be8-141">This phase can be done through secure transport, or through message exchanges.</span></span> <span data-ttu-id="a4be8-142">В последнем случае может осуществляться 1 или 2 операции обмена маркерами RST/RSTR.</span><span class="sxs-lookup"><span data-stu-id="a4be8-142">In the latter case, 1 or 2 RST/RSTR exchanges can happen.</span></span> <span data-ttu-id="a4be8-143">В случае этих операций обмена трассировки создаются в новых действиях запроса или ответа, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="a4be8-143">For these exchanges, traces are emitted in new request/reply activities as previously designed.</span></span><br /><span data-ttu-id="a4be8-144">2. Установка безопасного сеанса (SCT), в которой происходит один RST или RSTR.</span><span class="sxs-lookup"><span data-stu-id="a4be8-144">2.  Secure session establishment (SCT), in which one RST/RSTR exchange happens here.</span></span> <span data-ttu-id="a4be8-145">Внешние действия аналогичны описанным выше.</span><span class="sxs-lookup"><span data-stu-id="a4be8-145">This has the same ambient activities as described previously.</span></span>|<span data-ttu-id="a4be8-146">-Трассировки Exchange</span><span class="sxs-lookup"><span data-stu-id="a4be8-146">-   Exchange traces</span></span><br /><span data-ttu-id="a4be8-147">— Защищенный канал установлен</span><span class="sxs-lookup"><span data-stu-id="a4be8-147">-   Secure channel established</span></span><br /><span data-ttu-id="a4be8-148">— Получено общих секретов.</span><span class="sxs-lookup"><span data-stu-id="a4be8-148">-   Share secrets obtained.</span></span>|  
  
> [!NOTE]
> <span data-ttu-id="a4be8-149">В смешанном режиме безопасности согласование проверки подлинности происходит при обмене двоичными данными, но SCT происходит при обмене сообщениями.</span><span class="sxs-lookup"><span data-stu-id="a4be8-149">In mixed security mode, negotiation authentication happens in binary exchanges, but SCT happens in message exchange.</span></span> <span data-ttu-id="a4be8-150">В чистом режиме передачи согласование происходит только в процессе передачи без каких-либо дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="a4be8-150">In pure transport mode, negotiation happens only in transport with no additional activities.</span></span>  
  
## <a name="message-encryption-and-decryption"></a><span data-ttu-id="a4be8-151">Зашифровывание и расшифровывание сообщений</span><span class="sxs-lookup"><span data-stu-id="a4be8-151">Message Encryption and Decryption</span></span>  

 <span data-ttu-id="a4be8-152">В следующей таблице перечислены действия и трассировки для зашифровывания и расшифровывания сообщений, а также проверки подписи.</span><span class="sxs-lookup"><span data-stu-id="a4be8-152">The following table lists the activities and traces for message encryption/decryption, as well as signature authentication.</span></span>  
  
||<span data-ttu-id="a4be8-153">Безопасный транспорт</span><span class="sxs-lookup"><span data-stu-id="a4be8-153">Secure Transport</span></span><br /><br /> <span data-ttu-id="a4be8-154">(HTTPS, SSL) и уровень защищенных сообщений</span><span class="sxs-lookup"><span data-stu-id="a4be8-154">(HTTPS, SSL) and Secure Message Layer</span></span><br /><br /> <span data-ttu-id="a4be8-155">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="a4be8-155">(WSHTTP)</span></span>|  
|-|---------------------------------------------------------------------------------|  
|<span data-ttu-id="a4be8-156">Время начала зашифровывания или расшифровывания сообщения либо проверки подписи</span><span class="sxs-lookup"><span data-stu-id="a4be8-156">Time when message encryption/decryption, as well as signature authentication happens</span></span>|<span data-ttu-id="a4be8-157">При получении сообщения</span><span class="sxs-lookup"><span data-stu-id="a4be8-157">On message received</span></span>|  
|<span data-ttu-id="a4be8-158">Действия</span><span class="sxs-lookup"><span data-stu-id="a4be8-158">Activities</span></span>|<span data-ttu-id="a4be8-159">Трассировки создаются в действии ProcessAction на клиенте и сервере.</span><span class="sxs-lookup"><span data-stu-id="a4be8-159">Traces are emitted in the ProcessAction activity on the client and server.</span></span>|  
|<span data-ttu-id="a4be8-160">Трассировки</span><span class="sxs-lookup"><span data-stu-id="a4be8-160">Traces</span></span>|<span data-ttu-id="a4be8-161">-Сендсекуритихеадер (отправитель):</span><span class="sxs-lookup"><span data-stu-id="a4be8-161">-   sendSecurityHeader (sender):</span></span><br /><span data-ttu-id="a4be8-162">-Подписать сообщение</span><span class="sxs-lookup"><span data-stu-id="a4be8-162">-   Sign message</span></span><br /><span data-ttu-id="a4be8-163">— Шифровать данные запроса</span><span class="sxs-lookup"><span data-stu-id="a4be8-163">-   Encrypt request data</span></span><br /><span data-ttu-id="a4be8-164">-Рецеивесекуритихеадер (получатель):</span><span class="sxs-lookup"><span data-stu-id="a4be8-164">-   receiveSecurityHeader (receiver):</span></span><br /><span data-ttu-id="a4be8-165">-Проверить подпись</span><span class="sxs-lookup"><span data-stu-id="a4be8-165">-   Verify signature</span></span><br /><span data-ttu-id="a4be8-166">— Расшифровка данных ответа</span><span class="sxs-lookup"><span data-stu-id="a4be8-166">-   Decrypt response data</span></span><br /><span data-ttu-id="a4be8-167">Проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="a4be8-167">-   Authentication</span></span>|  
  
> [!NOTE]
> <span data-ttu-id="a4be8-168">В чистом режиме передачи зашифровывание или расшифровывание сообщения происходит только в процессе передачи без каких-либо дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="a4be8-168">In pure transport mode, message encryption/decryption happens only in transport with no additional activities.</span></span>  
  
## <a name="authorization-and-verification"></a><span data-ttu-id="a4be8-169">Авторизация и проверка</span><span class="sxs-lookup"><span data-stu-id="a4be8-169">Authorization and Verification</span></span>  

 <span data-ttu-id="a4be8-170">В следующей таблице перечислены действия и трассировки для авторизации.</span><span class="sxs-lookup"><span data-stu-id="a4be8-170">The following table lists the activities and traces for authorization.</span></span>  
  
||<span data-ttu-id="a4be8-171">Время начала авторизации</span><span class="sxs-lookup"><span data-stu-id="a4be8-171">Time when authorization happens</span></span>|<span data-ttu-id="a4be8-172">Действия</span><span class="sxs-lookup"><span data-stu-id="a4be8-172">Activities</span></span>|<span data-ttu-id="a4be8-173">Трассировки</span><span class="sxs-lookup"><span data-stu-id="a4be8-173">Traces</span></span>|  
|-|-------------------------------------|----------------|------------|  
|<span data-ttu-id="a4be8-174">Локальный (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="a4be8-174">Local (default)</span></span>|<span data-ttu-id="a4be8-175">После расшифровывания сообщения на сервере</span><span class="sxs-lookup"><span data-stu-id="a4be8-175">After the message is decrypted on the server</span></span>|<span data-ttu-id="a4be8-176">Трассировки создаются в действии ProcessAction на сервере.</span><span class="sxs-lookup"><span data-stu-id="a4be8-176">Traces are emitted in the ProcessAction activity at the server.</span></span>|<span data-ttu-id="a4be8-177">Пользователь авторизован.</span><span class="sxs-lookup"><span data-stu-id="a4be8-177">User authorized.</span></span>|  
|<span data-ttu-id="a4be8-178">Удаленный доступ</span><span class="sxs-lookup"><span data-stu-id="a4be8-178">Remote</span></span>|<span data-ttu-id="a4be8-179">После расшифровывания сообщения на сервере</span><span class="sxs-lookup"><span data-stu-id="a4be8-179">After the message is decrypted on the server</span></span>|<span data-ttu-id="a4be8-180">Трассировки создаются в новом действии, вызываемом действием ProcessAction.</span><span class="sxs-lookup"><span data-stu-id="a4be8-180">Traces are emitted in a new activity invoked by the ProcessAction activity.</span></span>|<span data-ttu-id="a4be8-181">Пользователь авторизован.</span><span class="sxs-lookup"><span data-stu-id="a4be8-181">User authorized.</span></span>|
