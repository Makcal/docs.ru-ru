---
description: 'Дополнительные сведения: расширение диспетчеров'
title: Расширение диспетчеров
ms.date: 03/30/2017
helpviewer_keywords:
- dispatcher extensions [WCF]
ms.assetid: d0ad15ac-fa12-4f27-80e8-7ac2271e5985
ms.openlocfilehash: 22be85c57439a88746e3e87625472d02ab412c1d
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99735287"
---
# <a name="extending-dispatchers"></a><span data-ttu-id="67e4b-103">Расширение диспетчеров</span><span class="sxs-lookup"><span data-stu-id="67e4b-103">Extending Dispatchers</span></span>

<span data-ttu-id="67e4b-104">Диспетчеры отвечают за удаление входящих сообщений из базовых каналов, их перевод в вызовы метода в коде приложения и отправку результатов обратно вызывающему коду.</span><span class="sxs-lookup"><span data-stu-id="67e4b-104">Dispatchers are responsible for pulling incoming messages out of the underlying channels, translating them into method invocations in application code, and sending the results back to the caller.</span></span> <span data-ttu-id="67e4b-105">Расширения диспетчера позволяют изменить эту процедуру.</span><span class="sxs-lookup"><span data-stu-id="67e4b-105">Dispatcher extensions allow you to modify this processing.</span></span>  <span data-ttu-id="67e4b-106">Можно реализовать инспекторы сообщений или параметров, которые инспектируют или изменяют содержимое сообщений или параметров.</span><span class="sxs-lookup"><span data-stu-id="67e4b-106">You can implement message or parameter inspectors that inspect or modify the contents of messages or parameters.</span></span>  <span data-ttu-id="67e4b-107">Можно изменить способ перенаправления сообщений в операции или обеспечить какие-либо другие функции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-107">You can change the way messages are routed to operations or provide some other functionality.</span></span>

<span data-ttu-id="67e4b-108">В этом разделе описывается использование <xref:System.ServiceModel.Dispatcher.DispatchRuntime> <xref:System.ServiceModel.Dispatcher.DispatchOperation> классов и в приложении службы Windows Communication Foundation (WCF) для изменения поведения диспетчера по умолчанию, а также для перехвата или изменения сообщений, параметров или возвращаемых значений перед отправкой или получением из уровня канала.</span><span class="sxs-lookup"><span data-stu-id="67e4b-108">This topic describes how to use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> and <xref:System.ServiceModel.Dispatcher.DispatchOperation> classes in a Windows Communication Foundation (WCF) service application to modify the default execution behavior of a dispatcher or to intercept or modify messages, parameters, or return values prior to or subsequent to sending or retrieving them from the channel layer.</span></span> <span data-ttu-id="67e4b-109">Дополнительные сведения о эквивалентной обработке сообщений среды выполнения клиента см. в разделе [расширение клиентов](extending-clients.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-109">For more information about the equivalent client runtime message processing, see [Extending Clients](extending-clients.md).</span></span> <span data-ttu-id="67e4b-110">Сведения о роли, которую <xref:System.ServiceModel.IExtensibleObject%601> типы играют в доступе к общему состоянию между различными объектами настройки среды выполнения, см. в разделе [расширяемые объекты](extensible-objects.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-110">To understand the role that <xref:System.ServiceModel.IExtensibleObject%601> types play in accessing shared state between various runtime customization objects, see [Extensible Objects](extensible-objects.md).</span></span>

## <a name="dispatchers"></a><span data-ttu-id="67e4b-111">Диспетчеры</span><span class="sxs-lookup"><span data-stu-id="67e4b-111">Dispatchers</span></span>

<span data-ttu-id="67e4b-112">Уровень модели службы осуществляет преобразование между моделью программирования разработчика и базовым обменом сообщениями, который обычно называется "уровень каналов".</span><span class="sxs-lookup"><span data-stu-id="67e4b-112">The service model layer performs the conversion between the developer’s programming model and the underlying message exchange, commonly called the channel layer.</span></span> <span data-ttu-id="67e4b-113">В WCF диспетчеры канала и конечной точки ( <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> и <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> соответственно) — это компоненты службы, отвечающие за принятие новых каналов, получение сообщений, отправку и вызов операций, а также обработку ответа.</span><span class="sxs-lookup"><span data-stu-id="67e4b-113">In WCF the channel and endpoint dispatchers (<xref:System.ServiceModel.Dispatcher.ChannelDispatcher> and <xref:System.ServiceModel.Dispatcher.EndpointDispatcher>, respectively) are the service components responsible for accepting new channels, receiving messages, operation dispatch and invocation, and response processing.</span></span> <span data-ttu-id="67e4b-114">Объекты диспетчера - это объекты получателя, однако реализации контракта обратного вызова в дуплексных службах также предоставляют свои объекты диспетчера для проверки, изменения или расширения.</span><span class="sxs-lookup"><span data-stu-id="67e4b-114">Dispatcher objects are receiver objects, but callback contract implementations in duplex services also expose their dispatcher objects for inspection, modification, or extension.</span></span>

<span data-ttu-id="67e4b-115">Диспетчер каналов (и сопровождающий прослушиватель <xref:System.ServiceModel.Channels.IChannelListener>) удаляет сообщения из базового канала и передает их соответствующим диспетчерам конечной точки.</span><span class="sxs-lookup"><span data-stu-id="67e4b-115">The channel dispatcher (and companion <xref:System.ServiceModel.Channels.IChannelListener>) pulls messages out of the underling channel and passes the messages to their respective endpoint dispatchers.</span></span> <span data-ttu-id="67e4b-116">Каждый диспетчер конечной точки имеет среду выполнения <xref:System.ServiceModel.Dispatcher.DispatchRuntime>, направляющую сообщения в соответствующую операцию <xref:System.ServiceModel.Dispatcher.DispatchOperation>, которая отвечает за вызов метода, реализующего операцию.</span><span class="sxs-lookup"><span data-stu-id="67e4b-116">Each endpoint dispatcher has a <xref:System.ServiceModel.Dispatcher.DispatchRuntime> that routes messages to the appropriate <xref:System.ServiceModel.Dispatcher.DispatchOperation>, which is responsible for calling the method that implements the operation.</span></span> <span data-ttu-id="67e4b-117">Одновременно с этим вызываются различные необязательные и обязательные классы расширений.</span><span class="sxs-lookup"><span data-stu-id="67e4b-117">Various optional and required extension classes are invoked along the way.</span></span> <span data-ttu-id="67e4b-118">В этом разделе объясняется, как взаимодействуют все эти элементы и как можно изменять их свойства и подключать собственный код для расширения их базовой функциональности.</span><span class="sxs-lookup"><span data-stu-id="67e4b-118">This topic explains how these pieces fit together, and how you might modify properties and plug your own code in to extend the base functionality.</span></span>

<span data-ttu-id="67e4b-119">Свойства диспетчера и измененные объекты настройки вставляются с помощью объектов службы, конечной точки, контракта или поведения операции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-119">Dispatcher properties and modified customization objects are inserted by using service, endpoint, contract, or operation behavior objects.</span></span> <span data-ttu-id="67e4b-120">В этом разделе не описано, как использовать эти поведения.</span><span class="sxs-lookup"><span data-stu-id="67e4b-120">This topic does not describe how to use behaviors.</span></span> <span data-ttu-id="67e4b-121">Дополнительные сведения о типах, используемых для вставки изменений Dispatcher, см. в разделе [Настройка и расширение среды выполнения с помощью поведений](configuring-and-extending-the-runtime-with-behaviors.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-121">For more information about the types used to insert dispatcher modifications, see [Configuring and Extending the Runtime with Behaviors](configuring-and-extending-the-runtime-with-behaviors.md).</span></span>

<span data-ttu-id="67e4b-122">На следующем изображении представлено общее описание элементов архитектуры в службе.</span><span class="sxs-lookup"><span data-stu-id="67e4b-122">The following graphic provides a high-level view of the architectural items in a service.</span></span>

<span data-ttu-id="67e4b-123">![Архитектура среды выполнения подготовки к отправки](./media/wcfc-dispatchruntimearchc.gif "wcfc_DispatchRuntimeArchc")</span><span class="sxs-lookup"><span data-stu-id="67e4b-123">![The dispatch runtime architecture](./media/wcfc-dispatchruntimearchc.gif "wcfc_DispatchRuntimeArchc")</span></span>

### <a name="channel-dispatchers"></a><span data-ttu-id="67e4b-124">Диспетчеры каналов</span><span class="sxs-lookup"><span data-stu-id="67e4b-124">Channel Dispatchers</span></span>

<span data-ttu-id="67e4b-125">Объект <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> создается для связи прослушивателя <xref:System.ServiceModel.Channels.IChannelListener> по определенному URI (называемому "URI прослушивания") с экземпляром службы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-125">A <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> object is created to associate an <xref:System.ServiceModel.Channels.IChannelListener> at a particular URI (called a listen URI) with an instance of a service.</span></span> <span data-ttu-id="67e4b-126">Следовательно, каждый объект <xref:System.ServiceModel.ServiceHost> может иметь множество объектов <xref:System.ServiceModel.Dispatcher.ChannelDispatcher>, каждый из которых связан только с одним прослушивателем и URI прослушивания.</span><span class="sxs-lookup"><span data-stu-id="67e4b-126">Each <xref:System.ServiceModel.ServiceHost> object can have many <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> objects, each associated with only one listener and listen URI.</span></span> <span data-ttu-id="67e4b-127">При поступлении сообщения диспетчер каналов <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> запрашивает все связанные объекты <xref:System.ServiceModel.Dispatcher.EndpointDispatcher>, может ли данная конечная точка принять это сообщение, и передает его соответствующей конечной точке.</span><span class="sxs-lookup"><span data-stu-id="67e4b-127">When a message arrives, the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> queries each of the associated <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> objects whether the endpoint can accept the message, and passes the message to the one that can.</span></span>

<span data-ttu-id="67e4b-128">Все свойства, которые управляют временем существования и поведением сеанса канала, доступны для проверки или изменения в объекте <xref:System.ServiceModel.Dispatcher.ChannelDispatcher>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-128">All properties that control the lifetime and behavior of a channel session are available for inspection or modification on the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> object.</span></span> <span data-ttu-id="67e4b-129">Сюда относятся пользовательские инициализаторы канала, прослушиватель канала, узел, связанный контекст <xref:System.ServiceModel.InstanceContext> и т. д.</span><span class="sxs-lookup"><span data-stu-id="67e4b-129">These include custom channel initializers, the channel listener, the host, the associated <xref:System.ServiceModel.InstanceContext>, and so on.</span></span>

### <a name="endpoint-dispatchers"></a><span data-ttu-id="67e4b-130">Диспетчеры конечных точек</span><span class="sxs-lookup"><span data-stu-id="67e4b-130">Endpoint Dispatchers</span></span>

<span data-ttu-id="67e4b-131">Объект <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> отвечает за обработку сообщений от <xref:System.ServiceModel.Dispatcher.ChannelDispatcher>, если адрес назначения сообщения соответствует свойству <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.AddressFilter%2A> и действие сообщения соответствует свойству <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.ContractFilter%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-131">The <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> object is responsible for processing messages from a <xref:System.ServiceModel.Dispatcher.ChannelDispatcher> when the destination address of a message matches the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.AddressFilter%2A> and the message action matches the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.ContractFilter%2A> property.</span></span> <span data-ttu-id="67e4b-132">Если принять сообщение могут два объекта <xref:System.ServiceModel.Dispatcher.EndpointDispatcher>, то значение свойства <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.FilterPriority%2A> определяет конечную точку с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="67e4b-132">If two <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> objects can accept a message, the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher.FilterPriority%2A> property value determines the higher priority endpoint.</span></span>

<span data-ttu-id="67e4b-133">Используйте диспетчер конечных точек <xref:System.ServiceModel.Dispatcher.EndpointDispatcher>, чтобы получить две основные точки расширения модели службы (классы <xref:System.ServiceModel.Dispatcher.DispatchRuntime> и <xref:System.ServiceModel.Dispatcher.DispatchOperation>), которые можно использовать для настройки обработки диспетчера.</span><span class="sxs-lookup"><span data-stu-id="67e4b-133">Use the <xref:System.ServiceModel.Dispatcher.EndpointDispatcher> to acquire the two main service model extension points – the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> and <xref:System.ServiceModel.Dispatcher.DispatchOperation> classes – that you can use to customize the processing of the dispatcher.</span></span> <span data-ttu-id="67e4b-134">Класс <xref:System.ServiceModel.Dispatcher.DispatchRuntime> позволяет пользователям перехватывать и расширять диспетчер в области контракта (т. е. для всех сообщений контракта).</span><span class="sxs-lookup"><span data-stu-id="67e4b-134">The <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class allows users to intercept and extend the dispatcher at the contract scope (that is, for all messages in a contract).</span></span> <span data-ttu-id="67e4b-135">Класс <xref:System.ServiceModel.Dispatcher.DispatchOperation> позволяет пользователям перехватывать и расширять диспетчер в области операции (т. е. для всех сообщений операции).</span><span class="sxs-lookup"><span data-stu-id="67e4b-135">The <xref:System.ServiceModel.Dispatcher.DispatchOperation> class allows users to intercept and extend the dispatcher at an operation scope (that is, for all messages in an operation).</span></span>

## <a name="scenarios"></a><span data-ttu-id="67e4b-136">Сценарии</span><span class="sxs-lookup"><span data-stu-id="67e4b-136">Scenarios</span></span>

<span data-ttu-id="67e4b-137">Существует несколько причин для расширения диспетчера.</span><span class="sxs-lookup"><span data-stu-id="67e4b-137">There a number of reasons to extend the dispatcher:</span></span>

- <span data-ttu-id="67e4b-138">Пользовательская проверка сообщений</span><span class="sxs-lookup"><span data-stu-id="67e4b-138">Custom Message Validation.</span></span> <span data-ttu-id="67e4b-139">Пользователи могут принудительно указать, что сообщение допустимо для определенной схемы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-139">Users can enforce that a message is valid for a certain schema.</span></span> <span data-ttu-id="67e4b-140">Для этого нужно реализовать интерфейсы перехватчиков сообщений.</span><span class="sxs-lookup"><span data-stu-id="67e4b-140">This can be done by implementing the message interceptor interfaces.</span></span> <span data-ttu-id="67e4b-141">Пример см. в разделе [инспекторы сообщений](../samples/message-inspectors.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-141">For an example, see [Message Inspectors](../samples/message-inspectors.md).</span></span>

- <span data-ttu-id="67e4b-142">Ведение пользовательского журнала сообщений</span><span class="sxs-lookup"><span data-stu-id="67e4b-142">Custom Message Logging.</span></span> <span data-ttu-id="67e4b-143">Пользователи могут проверять и регистрировать некоторый набор сообщений приложения, которые проходят через конечную точку.</span><span class="sxs-lookup"><span data-stu-id="67e4b-143">Users can inspect and log some set of application messages that flow through an endpoint.</span></span> <span data-ttu-id="67e4b-144">Для этого также можно использовать интерфейсы перехватчиков сообщений.</span><span class="sxs-lookup"><span data-stu-id="67e4b-144">This can also be accomplished with the message interceptor interfaces.</span></span>

- <span data-ttu-id="67e4b-145">Пользовательские преобразования сообщений</span><span class="sxs-lookup"><span data-stu-id="67e4b-145">Custom Message Transformations.</span></span> <span data-ttu-id="67e4b-146">Пользователи могут применять к сообщению определенные преобразования в среде выполнения (например, для управления версиями).</span><span class="sxs-lookup"><span data-stu-id="67e4b-146">Users can apply certain transformations to the message in the runtime (for example, for versioning).</span></span> <span data-ttu-id="67e4b-147">Для этого также можно использовать интерфейсы перехватчиков сообщений.</span><span class="sxs-lookup"><span data-stu-id="67e4b-147">This can be accomplished, again, with the message interceptor interfaces.</span></span>

- <span data-ttu-id="67e4b-148">Пользовательская модель данных</span><span class="sxs-lookup"><span data-stu-id="67e4b-148">Custom Data Model.</span></span> <span data-ttu-id="67e4b-149">Пользователи могут использовать модель сериализации данных, отличную от той, которая поддерживается по умолчанию в WCF (а именно, <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> <xref:System.Xml.Serialization.XmlSerializer?displayProperty=nameWithType> и необработанные сообщения).</span><span class="sxs-lookup"><span data-stu-id="67e4b-149">Users can have a data serialization model other than those supported by default in WCF (namely, <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType>, <xref:System.Xml.Serialization.XmlSerializer?displayProperty=nameWithType>, and raw messages).</span></span> <span data-ttu-id="67e4b-150">Для этого также можно реализовать интерфейсы модулей форматирования сообщений.</span><span class="sxs-lookup"><span data-stu-id="67e4b-150">This can be done by implement the message formatter interfaces.</span></span> <span data-ttu-id="67e4b-151">Пример см. в разделе [модуль форматирования операций и селектор операций](../samples/operation-formatter-and-operation-selector.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-151">For an example, see [Operation Formatter and Operation Selector](../samples/operation-formatter-and-operation-selector.md).</span></span>

- <span data-ttu-id="67e4b-152">Пользовательская проверка параметров</span><span class="sxs-lookup"><span data-stu-id="67e4b-152">Custom Parameter Validation.</span></span> <span data-ttu-id="67e4b-153">Пользователи могут проводить принудительную проверку допустимости типизированных параметров (в отличие от XML).</span><span class="sxs-lookup"><span data-stu-id="67e4b-153">Users can enforce that typed parameters are valid (as opposed to XML).</span></span> <span data-ttu-id="67e4b-154">Для этого также можно использовать интерфейсы инспекторов параметров.</span><span class="sxs-lookup"><span data-stu-id="67e4b-154">This can be done using the parameter inspector interfaces.</span></span>

- <span data-ttu-id="67e4b-155">Пользовательская диспетчеризация операций</span><span class="sxs-lookup"><span data-stu-id="67e4b-155">Custom Operation Dispatching.</span></span> <span data-ttu-id="67e4b-156">Пользователи могут диспетчеризовать не только действия, но и, например, элементы тела сообщения или пользовательские свойства сообщения.</span><span class="sxs-lookup"><span data-stu-id="67e4b-156">Users can implement dispatching on something other than action – for example, on the body element, or on a custom message property.</span></span> <span data-ttu-id="67e4b-157">Это можно сделать с помощью интерфейса <xref:System.ServiceModel.Dispatcher.IDispatchOperationSelector>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-157">This can be done using the <xref:System.ServiceModel.Dispatcher.IDispatchOperationSelector> interface.</span></span> <span data-ttu-id="67e4b-158">Пример см. в разделе [модуль форматирования операций и селектор операций](../samples/operation-formatter-and-operation-selector.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-158">For an example, see [Operation Formatter and Operation Selector](../samples/operation-formatter-and-operation-selector.md).</span></span>

- <span data-ttu-id="67e4b-159">Использование пулов объектов</span><span class="sxs-lookup"><span data-stu-id="67e4b-159">Object Pooling.</span></span> <span data-ttu-id="67e4b-160">Пользователи могут объединять экземпляры в пул, вместо того чтобы выделять новый экземпляр для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="67e4b-160">Users can pool instances rather than allocating a new one for every call.</span></span> <span data-ttu-id="67e4b-161">Это можно реализовать с помощью интерфейсов поставщика экземпляров.</span><span class="sxs-lookup"><span data-stu-id="67e4b-161">This can be implemented using the instance provider interfaces.</span></span> <span data-ttu-id="67e4b-162">Пример см. в разделе [группирование](../samples/pooling.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-162">For an example, see [Pooling](../samples/pooling.md).</span></span>

- <span data-ttu-id="67e4b-163">Аренда экземпляров</span><span class="sxs-lookup"><span data-stu-id="67e4b-163">Instance Leasing.</span></span> <span data-ttu-id="67e4b-164">Пользователи могут реализовать шаблон аренды для времени существования экземпляра, аналогичный шаблону удаленного взаимодействия .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="67e4b-164">Users can implement a leasing pattern for instance lifetime, similar to that of .NET Framework Remoting.</span></span> <span data-ttu-id="67e4b-165">Это можно сделать с помощью интерфейсов времени существования контекста экземпляра.</span><span class="sxs-lookup"><span data-stu-id="67e4b-165">This can be done using the instance context lifetime interfaces.</span></span>

- <span data-ttu-id="67e4b-166">Пользовательская обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="67e4b-166">Custom Error Handling.</span></span> <span data-ttu-id="67e4b-167">Пользователи могут управлять как обработкой локальных ошибок, так и передачей ошибок обратно клиентам.</span><span class="sxs-lookup"><span data-stu-id="67e4b-167">Users can control how both local errors are processed and how faults are communicated back to clients.</span></span> <span data-ttu-id="67e4b-168">Это можно реализовать с помощью интерфейсов <xref:System.ServiceModel.Dispatcher.IErrorHandler>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-168">This can be implemented using the <xref:System.ServiceModel.Dispatcher.IErrorHandler> interfaces.</span></span>

- <span data-ttu-id="67e4b-169">Пользовательские поведения авторизации</span><span class="sxs-lookup"><span data-stu-id="67e4b-169">Custom Authorization Behaviors.</span></span> <span data-ttu-id="67e4b-170">Пользователи могут осуществлять пользовательское управление доступом, расширяя элементы среды выполнения контракта или операции и добавляя проверки безопасности на основе маркеров, присутствующих в сообщении.</span><span class="sxs-lookup"><span data-stu-id="67e4b-170">Users can implement custom access control by extending the Contract or Operation run-time pieces and adding security checks based upon the tokens present in the message.</span></span> <span data-ttu-id="67e4b-171">Это можно сделать с помощью интерфейсов перехватчиков сообщений или перехватчиков параметров.</span><span class="sxs-lookup"><span data-stu-id="67e4b-171">This can be accomplished using either the message interceptor or parameter interceptor interfaces.</span></span> <span data-ttu-id="67e4b-172">Примеры см. в разделе [расширяемость системы безопасности](../samples/security-extensibility.md).</span><span class="sxs-lookup"><span data-stu-id="67e4b-172">For examples, see [Security Extensibility](../samples/security-extensibility.md).</span></span>

  > [!CAUTION]
  > <span data-ttu-id="67e4b-173">Поскольку изменение свойств безопасности может привести к нарушению безопасности приложений WCF, настоятельно рекомендуется внимательно соблюдать изменения, связанные с безопасностью, и тщательно проверять их перед развертыванием.</span><span class="sxs-lookup"><span data-stu-id="67e4b-173">Because altering security properties has the potential to compromise the security of WCF applications, it is strongly recommended that you undertake security-related modifications with care and test thoroughly prior to deployment.</span></span>

- <span data-ttu-id="67e4b-174">Пользовательские проверяющие элементы управления средой выполнения WCF</span><span class="sxs-lookup"><span data-stu-id="67e4b-174">Custom WCF Runtime Validators.</span></span> <span data-ttu-id="67e4b-175">Вы можете установить пользовательские проверяющие элементы управления, которые анализируют службы, контракты и привязки, чтобы применять политики корпоративного уровня в отношении приложений WCF.</span><span class="sxs-lookup"><span data-stu-id="67e4b-175">You can install custom validators that examine services, contracts, and bindings to enforce enterprise-level policies with respect to WCF applications.</span></span> <span data-ttu-id="67e4b-176">(Например, см. раздел [как заблокировать конечные точки на предприятии](how-to-lock-down-endpoints-in-the-enterprise.md).)</span><span class="sxs-lookup"><span data-stu-id="67e4b-176">(For example, see [How to: Lock Down Endpoints in the Enterprise](how-to-lock-down-endpoints-in-the-enterprise.md).)</span></span>

### <a name="using-the-dispatchruntime-class"></a><span data-ttu-id="67e4b-177">Использование класса DispatchRuntime</span><span class="sxs-lookup"><span data-stu-id="67e4b-177">Using the DispatchRuntime Class</span></span>

<span data-ttu-id="67e4b-178">Используйте класс <xref:System.ServiceModel.Dispatcher.DispatchRuntime> либо для изменения поведения службы по умолчанию или отдельной конечной точки, либо для вставки объектов, реализующих пользовательские изменения, в один (или оба) из следующих процессов служб (или процессов клиентов, если речь идет о дуплексном клиенте).</span><span class="sxs-lookup"><span data-stu-id="67e4b-178">Use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class either to modify the default behavior of a service or individual endpoint, or to insert objects that implement custom modifications to one or both of the following service processes (or client processes in the case of a duplex client):</span></span>

- <span data-ttu-id="67e4b-179">Преобразование входящих сообщений в объекты и выпуск этих объектов в качестве вызовов методов на объекте службы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-179">The transformation of incoming messages into objects and releasing those objects as method invocations on a service object.</span></span>

- <span data-ttu-id="67e4b-180">Преобразование объектов, принятых от ответа на вызов операции службы, в исходящие сообщения.</span><span class="sxs-lookup"><span data-stu-id="67e4b-180">The transformation of objects received from the response to a service operation invocation into outbound messages.</span></span>

<span data-ttu-id="67e4b-181">Объект <xref:System.ServiceModel.Dispatcher.DispatchRuntime> разрешает перехватывать и расширять диспетчеры каналов или конечных точек для всех сообщений в конкретном контракте, даже если сообщение не распознается.</span><span class="sxs-lookup"><span data-stu-id="67e4b-181">The <xref:System.ServiceModel.Dispatcher.DispatchRuntime> enables you to intercept and extend the channel or endpoint dispatcher for all messages across a particular contract, even when a message is not recognized.</span></span> <span data-ttu-id="67e4b-182">При приеме сообщения, не соответствующего ни одному из заданных в контракте сообщений, оно отправляется операции, возвращаемой свойством <xref:System.ServiceModel.Dispatcher.DispatchRuntime.UnhandledDispatchOperation%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-182">When a message arrives that does not match any declared in the contract it is dispatched to the operation returned by the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.UnhandledDispatchOperation%2A> property.</span></span> <span data-ttu-id="67e4b-183">Сведения о перехвате или расширении всех сообщений для конкретной операции см. в описании класса <xref:System.ServiceModel.Dispatcher.DispatchOperation>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-183">To intercept or extend across all messages for a particular operation, see the <xref:System.ServiceModel.Dispatcher.DispatchOperation> class.</span></span>

<span data-ttu-id="67e4b-184">Класс <xref:System.ServiceModel.Dispatcher.DispatchRuntime> предоставляет четыре основных области расширяемости диспетчера.</span><span class="sxs-lookup"><span data-stu-id="67e4b-184">There are four main areas of dispatcher extensibility exposed by the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class:</span></span>

1. <span data-ttu-id="67e4b-185">Компоненты канала используют свойства объекта <xref:System.ServiceModel.Dispatcher.DispatchRuntime> и сопоставленного диспетчера каналов, возвращаемого свойством <xref:System.ServiceModel.Dispatcher.DispatchRuntime.ChannelDispatcher%2A>, для настройки приема и закрытия каналов диспетчером каналов.</span><span class="sxs-lookup"><span data-stu-id="67e4b-185">Channel components use the properties of the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> and those of the associated channel dispatcher returned by the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.ChannelDispatcher%2A> property to customize how the channel dispatcher accepts and closes channels.</span></span> <span data-ttu-id="67e4b-186">Эта категория содержит свойства <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ChannelInitializers%2A> и <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InputSessionShutdownHandlers%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-186">This category includes the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ChannelInitializers%2A> and <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InputSessionShutdownHandlers%2A> properties.</span></span>

2. <span data-ttu-id="67e4b-187">Компоненты сообщения настраиваются для каждого обрабатываемого сообщения.</span><span class="sxs-lookup"><span data-stu-id="67e4b-187">Message components are customized for each message processed.</span></span> <span data-ttu-id="67e4b-188">Эта категория содержит свойства <xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageInspectors%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.OperationSelector%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A> и <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ErrorHandlers%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-188">This category includes the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageInspectors%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.OperationSelector%2A>, <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A>, and the <xref:System.ServiceModel.Dispatcher.ChannelDispatcher.ErrorHandlers%2A> properties.</span></span>

3. <span data-ttu-id="67e4b-189">Компоненты экземпляра настраивают создание, время жизни и удаление экземпляров типа службы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-189">Instance components customize the creation, lifetime, and disposal of instances of the service type.</span></span> <span data-ttu-id="67e4b-190">За дополнительными сведениями о времени жизни объектов служб обратитесь к свойству <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-190">For more information about service object lifetimes, see the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property.</span></span> <span data-ttu-id="67e4b-191">Эта категория содержит свойства <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceContextInitializers%2A> и <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceProvider%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-191">This category includes the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceContextInitializers%2A> and the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.InstanceProvider%2A> properties.</span></span>

4. <span data-ttu-id="67e4b-192">Компоненты, относящиеся к безопасности, могут использовать следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="67e4b-192">Security-related components can use the following properties:</span></span>

    - <span data-ttu-id="67e4b-193">Свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A> обозначает место записи событий аудита.</span><span class="sxs-lookup"><span data-stu-id="67e4b-193"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A> indicates where audit events are written.</span></span>

    - <span data-ttu-id="67e4b-194">Свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.ImpersonateCallerForAllOperations%2A> определяет, будет ли служба пытаться производить олицетворение при помощи учетных данных, предоставленных во входящем сообщении.</span><span class="sxs-lookup"><span data-stu-id="67e4b-194"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.ImpersonateCallerForAllOperations%2A> controls whether the service attempts to impersonate using the credentials provided by the incoming message.</span></span>

    - <span data-ttu-id="67e4b-195">Свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageAuthenticationAuditLevel%2A> определяет, будут ли события успешной проверки подлинности сообщения записываться в журнал событий, указанный в <xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-195"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.MessageAuthenticationAuditLevel%2A> controls whether successful message authentication events are written to the event log specified by <xref:System.ServiceModel.Dispatcher.DispatchRuntime.SecurityAuditLogLocation%2A>.</span></span>

    - <span data-ttu-id="67e4b-196">Свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.PrincipalPermissionMode%2A> управляет способом задания свойства <xref:System.Threading.Thread.CurrentPrincipal%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-196"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.PrincipalPermissionMode%2A> controls how the <xref:System.Threading.Thread.CurrentPrincipal%2A> property is set.</span></span>

    - <span data-ttu-id="67e4b-197">Свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.ServiceAuthorizationAuditLevel%2A> указывает каким образом производится аудит событий авторизации.</span><span class="sxs-lookup"><span data-stu-id="67e4b-197"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.ServiceAuthorizationAuditLevel%2A> specifies how the auditing of authorization events is performed.</span></span>

    - <span data-ttu-id="67e4b-198">Свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.SuppressAuditFailure%2A> указывает, будут ли подавляться некритические исключения, создаваемые в процессе ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="67e4b-198"><xref:System.ServiceModel.Dispatcher.DispatchRuntime.SuppressAuditFailure%2A> specifies whether to suppress non-critical exceptions that occur during the logging process.</span></span>

<span data-ttu-id="67e4b-199">Обычно объекты пользовательских расширений присваиваются свойству <xref:System.ServiceModel.Dispatcher.DispatchRuntime> или вставляются в коллекцию поведением службы (объект, реализующий <xref:System.ServiceModel.Description.IServiceBehavior>), поведением контракта (объект, реализующий <xref:System.ServiceModel.Description.IContractBehavior>) или поведением конечной точки (объект, реализующий <xref:System.ServiceModel.Description.IEndpointBehavior>).</span><span class="sxs-lookup"><span data-stu-id="67e4b-199">Typically, custom extension objects are assigned to a <xref:System.ServiceModel.Dispatcher.DispatchRuntime> property or inserted into a collection by a service behavior (an object that implements <xref:System.ServiceModel.Description.IServiceBehavior>), a contract behavior (an object that implements <xref:System.ServiceModel.Description.IContractBehavior>), or an endpoint behavior (an object that implements <xref:System.ServiceModel.Description.IEndpointBehavior>).</span></span> <span data-ttu-id="67e4b-200">После этого объект устанавливающего поведения добавляется в соответствующую коллекцию поведений программно или реализацией пользовательского объекта <xref:System.ServiceModel.Configuration.BehaviorExtensionElement>, чтобы разрешить вставку поведения с помощью файла конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="67e4b-200">Then the installing behavior object is added to the appropriate collection of behaviors either programmatically or by implementing a custom <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> object to enable the behavior to be inserted using an application configuration file.</span></span>

<span data-ttu-id="67e4b-201">Дуплексные клиенты (клиенты, реализующие контракт обратного вызова, заданный дуплексной службой) также имеют объект <xref:System.ServiceModel.Dispatcher.DispatchRuntime>, доступ к которому можно получить с помощью свойства <xref:System.ServiceModel.Dispatcher.ClientRuntime.CallbackDispatchRuntime%2A>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-201">Duplex clients (clients that implement a callback contract specified by a duplex service) also have a <xref:System.ServiceModel.Dispatcher.DispatchRuntime> object that can be accessed using the <xref:System.ServiceModel.Dispatcher.ClientRuntime.CallbackDispatchRuntime%2A> property.</span></span>

### <a name="using-the-dispatchoperation-class"></a><span data-ttu-id="67e4b-202">Использование класса DispatchOperation</span><span class="sxs-lookup"><span data-stu-id="67e4b-202">Using the DispatchOperation Class</span></span>

<span data-ttu-id="67e4b-203">Класс <xref:System.ServiceModel.Dispatcher.DispatchOperation> - это местоположение изменений в среде выполнения и точка вставки для пользовательских расширений, область действия которых ограничивается только одной операцией службы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-203">The <xref:System.ServiceModel.Dispatcher.DispatchOperation> class is the location for run-time modifications and the insertion point for custom extensions that are scoped to only one service operation.</span></span> <span data-ttu-id="67e4b-204">(Чтобы изменить поведение среды выполнения службы для всех сообщений в контракте, используйте класс <xref:System.ServiceModel.Dispatcher.DispatchRuntime>.)</span><span class="sxs-lookup"><span data-stu-id="67e4b-204">(To modify service run-time behavior for all messages in a contract, use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime> class.)</span></span>

<span data-ttu-id="67e4b-205">Установите изменения <xref:System.ServiceModel.Dispatcher.DispatchOperation> с помощью пользовательского объекта поведения службы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-205">Install <xref:System.ServiceModel.Dispatcher.DispatchOperation> modifications using a custom service behavior object.</span></span>

<span data-ttu-id="67e4b-206">Используйте свойство <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A>, чтобы найти объект <xref:System.ServiceModel.Dispatcher.DispatchOperation>, который представляет определенную операцию службы.</span><span class="sxs-lookup"><span data-stu-id="67e4b-206">Use the <xref:System.ServiceModel.Dispatcher.DispatchRuntime.Operations%2A> property to locate the <xref:System.ServiceModel.Dispatcher.DispatchOperation> object that represents a particular service operation.</span></span>

<span data-ttu-id="67e4b-207">Следующие свойства управляют выполнением среды выполнения на уровне операции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-207">The following properties control runtime execution at the operation level:</span></span>

- <span data-ttu-id="67e4b-208">Свойства <xref:System.ServiceModel.Dispatcher.DispatchOperation.Action%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReplyAction%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.FaultContractInfos%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsOneWay%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsTerminating%2A> и <xref:System.ServiceModel.Dispatcher.DispatchOperation.Name%2A> получают значения, соответствующие операции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-208">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.Action%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReplyAction%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.FaultContractInfos%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsOneWay%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.IsTerminating%2A>, and <xref:System.ServiceModel.Dispatcher.DispatchOperation.Name%2A> properties obtain the respective values for the operation.</span></span>

- <span data-ttu-id="67e4b-209">Свойства <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionAutoComplete%2A> и <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionRequired%2A> задают поведение транзакции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-209">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionAutoComplete%2A> and <xref:System.ServiceModel.Dispatcher.DispatchOperation.TransactionRequired%2A> specify transaction behavior.</span></span>

- <span data-ttu-id="67e4b-210">Свойства <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceBeforeCall%2A> и <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceAfterCall%2A> управляют временем существования пользовательского объекта службы относительно <xref:System.ServiceModel.InstanceContext>.</span><span class="sxs-lookup"><span data-stu-id="67e4b-210">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceBeforeCall%2A> and <xref:System.ServiceModel.Dispatcher.DispatchOperation.ReleaseInstanceAfterCall%2A> properties control the lifetime of the user-defined service object relative to the <xref:System.ServiceModel.InstanceContext>.</span></span>

- <span data-ttu-id="67e4b-211">Свойства <xref:System.ServiceModel.Dispatcher.DispatchOperation.DeserializeRequest%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.SerializeReply%2A> и <xref:System.ServiceModel.Dispatcher.DispatchOperation.Formatter%2A> разрешают явное управление преобразованием сообщений в объекты и наоборот.</span><span class="sxs-lookup"><span data-stu-id="67e4b-211">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.DeserializeRequest%2A>, <xref:System.ServiceModel.Dispatcher.DispatchOperation.SerializeReply%2A>, and the <xref:System.ServiceModel.Dispatcher.DispatchOperation.Formatter%2A> properties enable explicit control over the conversion from messages to objects and objects to messages.</span></span>

- <span data-ttu-id="67e4b-212">Свойство <xref:System.ServiceModel.Dispatcher.DispatchOperation.Impersonation%2A> задает уровень олицетворения операции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-212">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.Impersonation%2A> property specifies the operation impersonation level.</span></span>

- <span data-ttu-id="67e4b-213">Свойство <xref:System.ServiceModel.Dispatcher.DispatchOperation.CallContextInitializers%2A> вставляет пользовательские расширения контекста вызова для операции.</span><span class="sxs-lookup"><span data-stu-id="67e4b-213">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.CallContextInitializers%2A> property inserts custom call context extensions for the operation.</span></span>

- <span data-ttu-id="67e4b-214">Свойство <xref:System.ServiceModel.Dispatcher.DispatchOperation.AutoDisposeParameters%2A> управляет временем уничтожения объектов параметров.</span><span class="sxs-lookup"><span data-stu-id="67e4b-214">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.AutoDisposeParameters%2A> property controls when parameter objects are destroyed.</span></span>

- <span data-ttu-id="67e4b-215">Свойство <xref:System.ServiceModel.Dispatcher.DispatchOperation.Invoker%2A> вставляет пользовательский объект средства вызова.</span><span class="sxs-lookup"><span data-stu-id="67e4b-215">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.Invoker%2A> property to insert a custom invoker object.</span></span>

- <span data-ttu-id="67e4b-216">Свойство <xref:System.ServiceModel.Dispatcher.DispatchOperation.ParameterInspectors%2A> позволяет вставлять пользовательский инспектор параметров, который можно использовать для проверки или изменения параметров и возвращаемых значений.</span><span class="sxs-lookup"><span data-stu-id="67e4b-216">The <xref:System.ServiceModel.Dispatcher.DispatchOperation.ParameterInspectors%2A> property enables you to insert a custom parameter inspector that you can use to inspect or modify parameters and return values.</span></span>

## <a name="see-also"></a><span data-ttu-id="67e4b-217">См. также</span><span class="sxs-lookup"><span data-stu-id="67e4b-217">See also</span></span>

- <xref:System.ServiceModel.Dispatcher.DispatchRuntime>
- <xref:System.ServiceModel.Dispatcher.DispatchOperation>
- [<span data-ttu-id="67e4b-218">Практическое руководство. Проверка и изменение сообщений в службе</span><span class="sxs-lookup"><span data-stu-id="67e4b-218">How to: Inspect and Modify Messages on the Service</span></span>](how-to-inspect-and-modify-messages-on-the-service.md)
- [<span data-ttu-id="67e4b-219">Практическое руководство. Проверка или изменение параметров</span><span class="sxs-lookup"><span data-stu-id="67e4b-219">How to: Inspect or Modify Parameters</span></span>](how-to-inspect-or-modify-parameters.md)
- [<span data-ttu-id="67e4b-220">Практическое руководство. Блокировка конечных точек в среде предприятия</span><span class="sxs-lookup"><span data-stu-id="67e4b-220">How to: Lock Down Endpoints in the Enterprise</span></span>](how-to-lock-down-endpoints-in-the-enterprise.md)
