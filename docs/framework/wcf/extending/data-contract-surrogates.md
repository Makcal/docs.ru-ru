---
description: 'Дополнительные сведения: суррогаты контракта данных'
title: Суррогаты контрактов данных
ms.date: 03/30/2017
helpviewer_keywords:
- data contracts [WCF], surrogates
ms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5
ms.openlocfilehash: 335e7f64868177d00c747e29c463808f3eff3056
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99685807"
---
# <a name="data-contract-surrogates"></a><span data-ttu-id="5f7d6-103">Суррогаты контрактов данных</span><span class="sxs-lookup"><span data-stu-id="5f7d6-103">Data Contract Surrogates</span></span>

<span data-ttu-id="5f7d6-104">*Суррогат* контракта данных — это расширенная функция, созданная на основе модели контракта данных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-104">The data contract *surrogate* is an advanced feature built upon the Data Contract model.</span></span> <span data-ttu-id="5f7d6-105">Эта возможность предназначена для настройки и подстановки типов, когда необходимо изменить способ сериализации типа, десериализации или преобразования типа в метаданные.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-105">This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.</span></span> <span data-ttu-id="5f7d6-106">Например, суррогат может использоваться в сценариях, когда для типа не задан контракт данных, поля и свойства не помечены атрибутом <xref:System.Runtime.Serialization.DataMemberAttribute> или пользователи хотят динамически создавать вариации схемы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-106">Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.</span></span>  
  
 <span data-ttu-id="5f7d6-107">Сериализация и десериализация выполняются с суррогатом контракта данных при использовании <xref:System.Runtime.Serialization.DataContractSerializer> для преобразования из .NET Framework в подходящий формат, например XML.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-107">Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML.</span></span> <span data-ttu-id="5f7d6-108">Суррогат контракта данных также может использоваться для изменения метаданных, экспортированных для типов, при создании представлений метаданных, например документов схемы XML (XSD).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-108">Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).</span></span> <span data-ttu-id="5f7d6-109">Во время импорта из метаданных создается код, суррогат может также использоваться для настройки создаваемого кода.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-109">Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.</span></span>  
  
## <a name="how-the-surrogate-works"></a><span data-ttu-id="5f7d6-110">Как работает суррогат</span><span class="sxs-lookup"><span data-stu-id="5f7d6-110">How the Surrogate Works</span></span>  

 <span data-ttu-id="5f7d6-111">Суррогат сопоставляет один тип ("исходный" тип) с другим типом ("суррогатным" типом).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-111">A surrogate works by mapping one type (the "original" type) to another type (the "surrogated" type).</span></span> <span data-ttu-id="5f7d6-112">В следующем примере показаны исходный тип `Inventory` и новый суррогатный тип `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-112">The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type.</span></span> <span data-ttu-id="5f7d6-113">Тип `Inventory` не позволяет сериализацию, а тип `InventorySurrogated` позволяет:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-113">The `Inventory` type is not serializable but the `InventorySurrogated` type is:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  
  
 <span data-ttu-id="5f7d6-114">Так как для этого класса контракт данных не определен, класс преобразуется в суррогатный класс с контрактом данных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-114">Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.</span></span> <span data-ttu-id="5f7d6-115">Суррогатный класс показан в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-115">The surrogated class is shown in the following example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  
  
## <a name="implementing-the-idatacontractsurrogate"></a><span data-ttu-id="5f7d6-116">Реализация IDataContractSurrogate</span><span class="sxs-lookup"><span data-stu-id="5f7d6-116">Implementing the IDataContractSurrogate</span></span>  

 <span data-ttu-id="5f7d6-117">Для использования суррогата контракта данных необходимо реализовать интерфейс <xref:System.Runtime.Serialization.IDataContractSurrogate>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-117">To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.</span></span>  
  
 <span data-ttu-id="5f7d6-118">Ниже приведен обзор каждого метода интерфейса <xref:System.Runtime.Serialization.IDataContractSurrogate> с возможной реализацией.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-118">The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.</span></span>  
  
### <a name="getdatacontracttype"></a><span data-ttu-id="5f7d6-119">GetDataContractType</span><span class="sxs-lookup"><span data-stu-id="5f7d6-119">GetDataContractType</span></span>  

 <span data-ttu-id="5f7d6-120">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> сопоставляет один тип с другим.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-120">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another.</span></span> <span data-ttu-id="5f7d6-121">Этот метод требуется для сериализации, десериализации, импорта и экспорта.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-121">This method is required for serialization, deserialization, import, and export.</span></span>  
  
 <span data-ttu-id="5f7d6-122">Первая задача - определить, какие типы будут сопоставляться с другими типами.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-122">The first task is defining what types will be mapped to other types.</span></span> <span data-ttu-id="5f7d6-123">Пример:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-123">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  
  
- <span data-ttu-id="5f7d6-124">При сериализации сопоставление, которое возвращает этот метод, используется затем для преобразования исходного экземпляра в суррогатный экземпляр вызовом метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-124">On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span>  
  
- <span data-ttu-id="5f7d6-125">При десериализации сопоставление, которое возвращает этот метод, используется сериализатором для десериализации в экземпляр суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-125">On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.</span></span> <span data-ttu-id="5f7d6-126">Затем вызывается метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> для преобразования суррогатного экземпляра в экземпляр исходного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-126">It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.</span></span>  
  
- <span data-ttu-id="5f7d6-127">При экспорте суррогатный тип, возвращенный этим методом, применяется для получения контракта данных, который будет использоваться для генерирования метаданных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-127">On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.</span></span>  
  
- <span data-ttu-id="5f7d6-128">При импорте исходный тип заменяется на суррогатный, который применяется для получения контракта данных, необходимого, например для поддержки возможности ссылок.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-128">On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.</span></span>  
  
 <span data-ttu-id="5f7d6-129">Параметр <xref:System.Type> является типом объекта, который подвергается сериализации, десериализации, импорту или экспорту.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-129">The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported.</span></span> <span data-ttu-id="5f7d6-130">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> должен возвращать тип, который был на входе, если суррогат не обрабатывает тип.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-130">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type.</span></span> <span data-ttu-id="5f7d6-131">В противном случае возвращается соответствующий суррогатный тип.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-131">Otherwise, return the appropriate surrogated type.</span></span> <span data-ttu-id="5f7d6-132">Если существует несколько суррогатных типов, метод позволяет определить несколько сопоставлений.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-132">If several surrogate types exist, numerous mappings can be defined in this method.</span></span>  
  
 <span data-ttu-id="5f7d6-133">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> не вызывается для встроенных примитивов контрактов данных, например <xref:System.Int32> или <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-133">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>.</span></span> <span data-ttu-id="5f7d6-134">Для других типов, таких как массивы, типы, определяемые пользователем, и других структур данных, метод вызывается для каждого типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-134">For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.</span></span>  
  
 <span data-ttu-id="5f7d6-135">В предыдущем примере метод проверяет, совместим ли параметр `type` и `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-135">In the previous example, the method checks if the `type` parameter and `Inventory` are comparable.</span></span> <span data-ttu-id="5f7d6-136">Если да, то метод сопоставляет его с `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-136">If so, the method maps it to `InventorySurrogated`.</span></span> <span data-ttu-id="5f7d6-137">Каждый раз при сериализации, десериализации, импорте схемы или экспорте схемы сперва вызывается эта функция для определения соответствия типов.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-137">Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.</span></span>  
  
### <a name="getobjecttoserialize-method"></a><span data-ttu-id="5f7d6-138">Метод GetObjectToSerialize</span><span class="sxs-lookup"><span data-stu-id="5f7d6-138">GetObjectToSerialize Method</span></span>  

 <span data-ttu-id="5f7d6-139">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> преобразует экземпляр исходного типа в экземпляр суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-139">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance.</span></span> <span data-ttu-id="5f7d6-140">Этот метод требуется для сериализации.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-140">The method is required for serialization.</span></span>  
  
 <span data-ttu-id="5f7d6-141">На втором этапе необходимо определить, каким образом физические данные из исходного экземпляра будут преобразовываться в данные суррогатного, при помощи реализации метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-141">The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span> <span data-ttu-id="5f7d6-142">Пример:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-142">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  
  
 <span data-ttu-id="5f7d6-143">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> вызывается при сериализации объекта.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-143">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized.</span></span> <span data-ttu-id="5f7d6-144">Этот метод передает данные из исходного типа в поля суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-144">This method transfers data from the original type to the fields of the surrogated type.</span></span> <span data-ttu-id="5f7d6-145">Поля могут быть напрямую сопоставлены с суррогатными полями, либо в суррогате можно сохранить результат манипуляций с исходными данными.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-145">Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.</span></span> <span data-ttu-id="5f7d6-146">Некоторые варианты использования: прямое сопоставление полей; выполнение операций над данными, которые нужно сохранить в суррогатных полях; сохранение XML исходного типа в суррогатном поле.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-146">Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.</span></span>  
  
 <span data-ttu-id="5f7d6-147">Параметр `targetType` относится к объявленному типу элемента.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-147">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="5f7d6-148">Этот параметр является суррогатным типом, возвращенным методом <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-148">This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method.</span></span> <span data-ttu-id="5f7d6-149">Сериализатор не требует, чтобы возвращенный объект можно было назначить этому типу.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-149">The serializer does not enforce that the object returned is assignable to this type.</span></span> <span data-ttu-id="5f7d6-150">`obj`Параметр — это объект для сериализации, который будет преобразован в его суррогат при необходимости.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-150">The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary.</span></span> <span data-ttu-id="5f7d6-151">Этот метод возвращает входной объект, если суррогатный не обрабатывает этот объект.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-151">This method must return the input object if the surrogated does not handle the object.</span></span> <span data-ttu-id="5f7d6-152">В противном случае возвращается новый суррогатный объект.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-152">Otherwise, the new surrogate object will be returned.</span></span> <span data-ttu-id="5f7d6-153">Суррогат не вызывается, если объект пустой.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-153">The surrogate is not called if the object is null.</span></span> <span data-ttu-id="5f7d6-154">Метод позволяет определить несколько суррогатных сопоставлений для различных экземпляров.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-154">Numerous surrogate mappings for different instances may be defined within this method.</span></span>  
  
 <span data-ttu-id="5f7d6-155">При создании объекта <xref:System.Runtime.Serialization.DataContractSerializer> можно задать для него сохранение ссылок на объекты.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-155">When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references.</span></span> <span data-ttu-id="5f7d6-156">(Дополнительные сведения см. в разделе [сериализация и десериализация](../feature-details/serialization-and-deserialization.md).) Это делается путем задания `preserveObjectReferences` для параметра в конструкторе значения `true` .</span><span class="sxs-lookup"><span data-stu-id="5f7d6-156">(For more information, see [Serialization and Deserialization](../feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`.</span></span> <span data-ttu-id="5f7d6-157">В таком случае суррогат вызывается для объекта только один раз, так как все последующие сериализации просто записывают в поток ссылку.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-157">In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.</span></span> <span data-ttu-id="5f7d6-158">Если параметр `preserveObjectReferences` имеет значение `false`, суррогат вызывается для каждого вхождения экземпляра.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-158">If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.</span></span>  
  
 <span data-ttu-id="5f7d6-159">Если тип экземпляра, подвергающегося сериализации, отличается от объявленного типа, сведения о типе записываются в поток (например `xsi:type`), чтобы экземпляр затем можно было десериализовать.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-159">If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end.</span></span> <span data-ttu-id="5f7d6-160">Это происходит независимо от того, является объект суррогатным, или нет.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-160">This process occurs whether the object is surrogated or not.</span></span>  
  
 <span data-ttu-id="5f7d6-161">В приведенном выше примере данные экземпляра `Inventory` преобразуются в данные `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-161">The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`.</span></span> <span data-ttu-id="5f7d6-162">Проверяется тип объекта и выполняются необходимые операции для преобразования в суррогатный тип.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-162">It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.</span></span> <span data-ttu-id="5f7d6-163">В данном случае поля класса `Inventory` напрямую копируются в поля класса `InventorySurrogated`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-163">In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.</span></span>  
  
### <a name="getdeserializedobject-method"></a><span data-ttu-id="5f7d6-164">Метод GetDeserializedObject</span><span class="sxs-lookup"><span data-stu-id="5f7d6-164">GetDeserializedObject Method</span></span>  

 <span data-ttu-id="5f7d6-165">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> преобразует экземпляр суррогатного типа в экземпляр исходного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-165">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance.</span></span> <span data-ttu-id="5f7d6-166">Этот метод требуется для десериализации.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-166">It is required for deserialization.</span></span>  
  
 <span data-ttu-id="5f7d6-167">Следующая задача - определить, каким образом физические данные из суррогатного экземпляра будут сопоставляться с данными исходного экземпляра.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-167">The next task is to define the way the physical data will be mapped from the surrogate instance to the original.</span></span> <span data-ttu-id="5f7d6-168">Пример:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-168">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  
  
 <span data-ttu-id="5f7d6-169">Этот метод вызывается только во время десериализации объекта.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-169">This method is called only during the deserialization of an object.</span></span> <span data-ttu-id="5f7d6-170">Он предоставляет возможность обратного сопоставления данных для десериализации из суррогатного типа обратно в исходный тип.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-170">It provides reverse data mapping for the deserialization from the surrogate type back to its original type.</span></span> <span data-ttu-id="5f7d6-171">Аналогично методу `GetObjectToSerialize`, возможен прямой обмен данными полей, выполнение операций над данными или хранение XML-данных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-171">Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.</span></span> <span data-ttu-id="5f7d6-172">При десериализации не всегда получаются данные, идентичные исходным, что связано с операциями при преобразовании данных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-172">When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.</span></span>  
  
 <span data-ttu-id="5f7d6-173">Параметр `targetType` относится к объявленному типу элемента.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-173">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="5f7d6-174">Этот параметр является суррогатным типом, возвращенным методом `GetDataContractType`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-174">This parameter is the surrogated type returned by the `GetDataContractType` method.</span></span> <span data-ttu-id="5f7d6-175">`obj`Параметр ссылается на объект, который был десериализован.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-175">The `obj` parameter refers to the object that has been deserialized.</span></span> <span data-ttu-id="5f7d6-176">Объект может быть преобразован обратно в свой исходный тип, если он был заменен на суррогатный.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-176">The object can be converted back to its original type if it is surrogated.</span></span> <span data-ttu-id="5f7d6-177">Этот метод возвращает входной объект, если суррогатный не обрабатывает этот объект.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-177">This method returns the input object if the surrogate does not handle the object.</span></span> <span data-ttu-id="5f7d6-178">В противном случае после завершения преобразования возвращается десериализованный объект.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-178">Otherwise, the deserialized object will be returned once its conversion has been completed.</span></span> <span data-ttu-id="5f7d6-179">Если есть несколько суррогатных типов, можно задать преобразование данных из суррогатного типа в исходный для каждого из них, указав каждый тип и его преобразование.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-179">If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.</span></span>  
  
 <span data-ttu-id="5f7d6-180">Когда возвращается объект, внутренние таблицы объектов обновляются, получая объект, возвращенный суррогатом.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-180">When returning an object, the internal object tables are updated with the object returned by this surrogate.</span></span> <span data-ttu-id="5f7d6-181">Все дальнейшие ссылки на экземпляр будут получать суррогатный экземпляр из таблиц объектов.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-181">Any subsequent references to an instance will obtain the surrogated instance from the object tables.</span></span>  
  
 <span data-ttu-id="5f7d6-182">В предшествующем примере объекты типа `InventorySurrogated` преобразуются обратно в исходный тип `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-182">The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`.</span></span> <span data-ttu-id="5f7d6-183">В данном случае данные напрямую передаются из полей `InventorySurrogated` в соответствующие поля `Inventory`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-183">In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`.</span></span> <span data-ttu-id="5f7d6-184">Так как операций с данными не производилось, все поля элементов будут содержать те же данные, что и до сериализации.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-184">Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.</span></span>  
  
### <a name="getcustomdatatoexport-method"></a><span data-ttu-id="5f7d6-185">Метод GetCustomDataToExport</span><span class="sxs-lookup"><span data-stu-id="5f7d6-185">GetCustomDataToExport Method</span></span>  

 <span data-ttu-id="5f7d6-186">При экспорте схемы метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> является необязательным.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-186">When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional.</span></span> <span data-ttu-id="5f7d6-187">Он применяется для вставки дополнительных данных или указаний в экспортированную схему.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-187">It is used to insert additional data or hints into the exported schema.</span></span> <span data-ttu-id="5f7d6-188">Дополнительные данные могут быть добавлены на уровне элемента или типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-188">Additional data can be inserted at the member level or type level.</span></span> <span data-ttu-id="5f7d6-189">Пример:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-189">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  
  
 <span data-ttu-id="5f7d6-190">Этот метод (с двумя перегрузками) позволяет включение дополнительных сведений в метаданные на уровне элемента или типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-190">This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.</span></span> <span data-ttu-id="5f7d6-191">Можно добавить указания о том, является ли элемент открытым или закрытым, а также комментарии, которые сохраняются при экспорте и импорте схемы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-191">It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.</span></span> <span data-ttu-id="5f7d6-192">Если не применять этот метод, такая информация теряется.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-192">Such information would be lost without this method.</span></span> <span data-ttu-id="5f7d6-193">Этот метод не позволяет добавлять или удалять элементы и типы, а дает возможность добавлять дополнительные данные в схемы на любом из этих двух уровней.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-193">This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.</span></span>  
  
 <span data-ttu-id="5f7d6-194">Этот метод перегружен и может принимать либо объект `Type` (параметр `clrtype`), либо объект <xref:System.Reflection.MemberInfo> (параметр `memberInfo`).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-194">The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter).</span></span> <span data-ttu-id="5f7d6-195">Второй параметр всегда будет объектом `Type` (параметр `dataContractType`).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-195">The second parameter is always a `Type` (`dataContractType` parameter).</span></span> <span data-ttu-id="5f7d6-196">Этот метод вызывается для каждого элемента и типа суррогатного типа `dataContractType`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-196">This method is called for every member and type of the surrogated `dataContractType` type.</span></span>  
  
 <span data-ttu-id="5f7d6-197">Каждая из перегрузок возвращает либо `null`, либо объект, который можно сериализовать.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-197">Either of these overloads must return either `null` or a serializable object.</span></span> <span data-ttu-id="5f7d6-198">Непустой объект сериализуется как заметка в экспортированной схеме.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-198">A non-null object will be serialized as annotation into the exported schema.</span></span> <span data-ttu-id="5f7d6-199">Для перегрузки `Type` каждый тип, экспортированный в схему, предается этому методу в первом параметре с суррогатным типом в качестве параметра `dataContractType`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-199">For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter.</span></span> <span data-ttu-id="5f7d6-200">Для перегрузки `MemberInfo` каждый элемент, экспортированный в схему, отправляет свои сведения как параметр `memberInfo` с суррогатным типом в качестве второго параметра.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-200">For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.</span></span>  
  
#### <a name="getcustomdatatoexport-method-type-type"></a><span data-ttu-id="5f7d6-201">Метод GetCustomDataToExport (Type, Type)</span><span class="sxs-lookup"><span data-stu-id="5f7d6-201">GetCustomDataToExport Method (Type, Type)</span></span>  

 <span data-ttu-id="5f7d6-202">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> вызывается во время экспорта схемы для каждого определения типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-202">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition.</span></span> <span data-ttu-id="5f7d6-203">Этот метод добавляет информацию в типы схемы при экспорте.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-203">The method adds information to the types within the schema when exporting.</span></span> <span data-ttu-id="5f7d6-204">Каждый определенный тип отправляется этому методу с целью определить, есть ли дополнительные данные, которые необходимо включить в схему.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-204">Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.</span></span>  
  
#### <a name="getcustomdatatoexport-method-memberinfo-type"></a><span data-ttu-id="5f7d6-205">Метод GetCustomDataToExport (MemberInfo, Type)</span><span class="sxs-lookup"><span data-stu-id="5f7d6-205">GetCustomDataToExport Method (MemberInfo, Type)</span></span>  

 <span data-ttu-id="5f7d6-206">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> вызывается во время экспорта для каждого элемента в экспортируемых типах.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-206">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported.</span></span> <span data-ttu-id="5f7d6-207">Эта функция дает возможность настроить для элементов любые комментарии, которые будут включены в схему при экспорте.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-207">This function enables you to customize any comments for the members that will be included in the schema upon export.</span></span> <span data-ttu-id="5f7d6-208">Сведения для каждого элемента класса отправляются в этот метод для проверки, не нужно ли включить в схему какие-либо дополнительные данные.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-208">The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.</span></span>  
  
 <span data-ttu-id="5f7d6-209">В приведенном выше примере выполняется поиск по `dataContractType` для каждого элемента суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-209">The example above searches through the `dataContractType` for each member of the surrogate.</span></span> <span data-ttu-id="5f7d6-210">Затем возвращается соответствующий модификатор доступа для каждого поля.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-210">It then returns the appropriate access modifier for each field.</span></span> <span data-ttu-id="5f7d6-211">Без такой настойки значение по умолчанию для любого модификатора доступа - открытый.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-211">Without this customization, the default value for access modifiers is public.</span></span> <span data-ttu-id="5f7d6-212">Поэтому в коде, сгенерированном при помощи экспортированной схемы, все элементы будут определены как открытые, независимо от их реальных ограничений доступа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-212">Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.</span></span> <span data-ttu-id="5f7d6-213">Если бы эта реализация не использовалась, элемент `numpens` был бы открытым в экспортированной схеме, хотя он определен как закрытый в суррогате.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-213">When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private.</span></span> <span data-ttu-id="5f7d6-214">Благодаря этому методу в экспортированной схеме модификатор доступа может быть сгенерирован как закрытый.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-214">Through the use of this method, in the exported schema, the access modifier can be generated as private.</span></span>  
  
### <a name="getreferencedtypeonimport-method"></a><span data-ttu-id="5f7d6-215">Метод GetReferencedTypeOnImport</span><span class="sxs-lookup"><span data-stu-id="5f7d6-215">GetReferencedTypeOnImport Method</span></span>  

 <span data-ttu-id="5f7d6-216">Этот метод сопоставляет тип <xref:System.Type> суррогата с исходным типом.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-216">This method maps the <xref:System.Type> of the surrogate to the original type.</span></span> <span data-ttu-id="5f7d6-217">Этот метод является необязательным для импорта схем.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-217">This method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="5f7d6-218">При создании суррогата, импортирующего схему и генерирующего код для нее, следующая задача - перейти от типа суррогатного экземпляра к исходному типу.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-218">When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.</span></span>  
  
 <span data-ttu-id="5f7d6-219">Если в сгенерированном коде необходимо сослаться на существующий пользовательский тип, это можно сделать реализацией метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-219">If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.</span></span>  
  
 <span data-ttu-id="5f7d6-220">При импорте схемы этот метод вызывается для каждого объявления типа, чтобы сопоставить суррогатный контракт данных с типом.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-220">When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.</span></span> <span data-ttu-id="5f7d6-221">Строковые параметры `typeName` и `typeNamespace` определяют имя и пространство имен суррогатного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-221">The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type.</span></span> <span data-ttu-id="5f7d6-222">Возвращаемое значение для метода <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> используется для определения, нужно ли сгенерировать новый тип.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-222">The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated.</span></span> <span data-ttu-id="5f7d6-223">Этот метод возвращает либо допустимый тип, либо значение NULL.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-223">This method must return either a valid type or null.</span></span> <span data-ttu-id="5f7d6-224">В случае допустимого типа возвращаемый тип используется как тип, на который существует ссылка в сгенерированном коде.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-224">For valid types, the type returned will be used as a referenced type in the generated code.</span></span> <span data-ttu-id="5f7d6-225">Если возвращается значение NULL, ссылки на тип не будет, должен быть создан новый тип.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-225">If null is returned, no type will be referenced and a new type must be created.</span></span> <span data-ttu-id="5f7d6-226">Если есть несколько суррогатов, можно выполнить сопоставление каждого суррогатного типа и его исходного типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-226">If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.</span></span>  
  
 <span data-ttu-id="5f7d6-227">Параметр `customData` является объектом, возвращенным методом <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-227">The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span></span> <span data-ttu-id="5f7d6-228">Параметр `customData` используется, когда создатели суррогата хотят поместить дополнительные данные или указания в метаданные, которые используются при импорте для генерирования кода.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-228">This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.</span></span>  
  
### <a name="processimportedtype-method"></a><span data-ttu-id="5f7d6-229">Метод ProcessImportedType</span><span class="sxs-lookup"><span data-stu-id="5f7d6-229">ProcessImportedType Method</span></span>  

 <span data-ttu-id="5f7d6-230">Метод <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> позволяет настроить любой тип, созданный при импорте схемы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-230">The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation.</span></span> <span data-ttu-id="5f7d6-231">Этот метод является необязательным.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-231">This method is optional.</span></span>  
  
 <span data-ttu-id="5f7d6-232">При импорте схемы этот метод позволяет настройку любого импортированного типа и сведений о компиляции.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-232">When importing a schema, this method allows for any imported type and compilation information to be customized.</span></span> <span data-ttu-id="5f7d6-233">Пример:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-233">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  
  
 <span data-ttu-id="5f7d6-234">Во время импорта этот метод вызывается для каждого генерируемого типа.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-234">During import, this method is called for every type generated.</span></span> <span data-ttu-id="5f7d6-235">Измените объект <xref:System.CodeDom.CodeTypeDeclaration> или <xref:System.CodeDom.CodeCompileUnit>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-235">Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>.</span></span> <span data-ttu-id="5f7d6-236">Это означает в том числе изменение имени, элементов, атрибутов и многих других свойств объекта `CodeTypeDeclaration`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-236">This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`.</span></span> <span data-ttu-id="5f7d6-237">Обрабатывая объект `CodeCompileUnit`, можно изменить директивы, пространства имен, сборки, на которые существуют ссылки, и некоторые другие аспекты.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-237">By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.</span></span>  
  
 <span data-ttu-id="5f7d6-238">Параметр `CodeTypeDeclaration` содержит объявление типа Code DOM.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-238">The `CodeTypeDeclaration` parameter contains the code DOM type declaration.</span></span> <span data-ttu-id="5f7d6-239">Параметр `CodeCompileUnit` позволяет изменение обработки кода.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-239">The `CodeCompileUnit` parameter allows for modification for processing the code.</span></span>  <span data-ttu-id="5f7d6-240">Если возвращается результат `null`, в объявлении типа он уничтожается.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-240">Returning `null` results in the type declaration being discarded.</span></span> <span data-ttu-id="5f7d6-241">В противном случае, если возвращается объект `CodeTypeDeclaration`, изменения сохраняются.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-241">Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.</span></span>  
  
 <span data-ttu-id="5f7d6-242">Если при экспорте метаданных добавляются пользовательские данные, необходимо, чтобы они были предоставлены пользователю при импорте для их использования.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-242">If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.</span></span> <span data-ttu-id="5f7d6-243">Такие пользовательские данные могут использоваться для указаний о модели программирования или других комментариев.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-243">This custom data can be used for programming model hints, or other comments.</span></span> <span data-ttu-id="5f7d6-244">Каждый экземпляр `CodeTypeDeclaration` и <xref:System.CodeDom.CodeTypeMember> включает в себя пользовательские данные в виде свойства <xref:System.CodeDom.CodeObject.UserData%2A>, приведенного к типу `IDataContractSurrogate`.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-244">Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.</span></span>  
  
 <span data-ttu-id="5f7d6-245">В приведенном выше примере в импортированной схеме производится несколько изменений.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-245">The example above performs some changes on the schema imported.</span></span> <span data-ttu-id="5f7d6-246">Код сохраняет закрытые элементы исходного типа при помощи суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-246">The code preserves private members of the original type by using a surrogate.</span></span> <span data-ttu-id="5f7d6-247">При импорте схемы модификатор доступа по умолчанию имеет значение `public` (открытый).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-247">The default access modifier when importing a schema is `public`.</span></span> <span data-ttu-id="5f7d6-248">Поэтому все элементы суррогатной схемы будут открытыми, если не изменить их, как в этом примере.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-248">Therefore, all members of the surrogate schema will be public unless modified, as in this example.</span></span> <span data-ttu-id="5f7d6-249">При экспорте в метаданные вставляются пользовательские данные, указывающие, какие элементы являются закрытыми.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-249">During export, custom data is inserted into the metadata about which members are private.</span></span> <span data-ttu-id="5f7d6-250">Производится поиск в пользовательских данных и проверка, должен ли модификатор доступа быть закрытым. Затем выполняется изменение соответствующего элемента, он делается закрытым при помощи атрибутов.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-250">The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.</span></span> <span data-ttu-id="5f7d6-251">Без такой настройки элемент `numpens` был бы определен как открытый вместо закрытого.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-251">Without this customization, the `numpens` member would be defined as public instead of private.</span></span>  
  
### <a name="getknowncustomdatatypes-method"></a><span data-ttu-id="5f7d6-252">Метод GetKnownCustomDataTypes</span><span class="sxs-lookup"><span data-stu-id="5f7d6-252">GetKnownCustomDataTypes Method</span></span>  

 <span data-ttu-id="5f7d6-253">Этот метод получает определенные типы пользовательских данных из схемы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-253">This method obtains custom data types defined from the schema.</span></span> <span data-ttu-id="5f7d6-254">Этот метод является необязательным для импорта схем.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-254">The method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="5f7d6-255">Этот метод вызывается в начале экспорта или импорта схемы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-255">The method is called at the beginning of schema export and import.</span></span> <span data-ttu-id="5f7d6-256">Метод возвращает типы пользовательских данных, которые используются в экспортируемой или импортируемой схеме.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-256">The method returns the custom data types used in the schema exported or imported.</span></span> <span data-ttu-id="5f7d6-257">Методу передается объект <xref:System.Collections.ObjectModel.Collection%601> (параметр `customDataTypes`), который представляет собой коллекцию типов.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-257">The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types.</span></span> <span data-ttu-id="5f7d6-258">Метод добавляет дополнительные известные типы в эту коллекцию.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-258">The method should add additional known types to this collection.</span></span> <span data-ttu-id="5f7d6-259">Известные типы пользовательских данных необходимы для сериализации и десериализации пользовательских данных при помощи <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-259">The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="5f7d6-260">Дополнительные сведения см. в статье о [известных типах контрактов данных](../feature-details/data-contract-known-types.md).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-260">For more information, see [Data Contract Known Types](../feature-details/data-contract-known-types.md).</span></span>  
  
## <a name="implementing-a-surrogate"></a><span data-ttu-id="5f7d6-261">Реализация суррогата</span><span class="sxs-lookup"><span data-stu-id="5f7d6-261">Implementing a Surrogate</span></span>  

 <span data-ttu-id="5f7d6-262">Чтобы использовать суррогат контракта данных в WCF, необходимо выполнить несколько особых процедур.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-262">To use the data contract surrogate within WCF, you must follow a few special procedures.</span></span>  
  
### <a name="to-use-a-surrogate-for-serialization-and-deserialization"></a><span data-ttu-id="5f7d6-263">Использование суррогата для сериализации и десериализации</span><span class="sxs-lookup"><span data-stu-id="5f7d6-263">To Use a Surrogate for Serialization and Deserialization</span></span>  

 <span data-ttu-id="5f7d6-264">Для выполнения сериализации и десериализации данных с суррогатом используйте <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-264">Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate.</span></span> <span data-ttu-id="5f7d6-265">Объект <xref:System.Runtime.Serialization.DataContractSerializer> создается при помощи <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-265">The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span></span> <span data-ttu-id="5f7d6-266">Необходимо также задать суррогат.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-266">The surrogate must also be specified.</span></span>  
  
##### <a name="to-implement-serialization-and-deserialization"></a><span data-ttu-id="5f7d6-267">Реализация сериализации и десериализации</span><span class="sxs-lookup"><span data-stu-id="5f7d6-267">To implement serialization and deserialization</span></span>  
  
1. <span data-ttu-id="5f7d6-268">Создайте экземпляр <xref:System.ServiceModel.ServiceHost> для службы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-268">Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service.</span></span> <span data-ttu-id="5f7d6-269">Полные инструкции см. в разделе [Базовая программирование WCF](../basic-wcf-programming.md).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-269">For complete instructions, see [Basic WCF Programming](../basic-wcf-programming.md).</span></span>  
  
2. <span data-ttu-id="5f7d6-270">Для каждого объекта <xref:System.ServiceModel.Description.ServiceEndpoint> заданного узла службы найдите соответствующий объект <xref:System.ServiceModel.Description.OperationDescription>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-270">For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.</span></span>  
  
3. <span data-ttu-id="5f7d6-271">Выполните поиск экземпляра <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> в поведениях операций.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-271">Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.</span></span>  
  
4. <span data-ttu-id="5f7d6-272">Если найден экземпляр <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>, задайте в его свойстве <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-272">If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate.</span></span> <span data-ttu-id="5f7d6-273">Если экземпляр <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> не найден, создайте новый экземпляр и задайте для элемента <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> нового расширения новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-273">If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.</span></span>  
  
5. <span data-ttu-id="5f7d6-274">Наконец, добавьте это новое поведение в текущие поведения операций, как показано в примере:</span><span class="sxs-lookup"><span data-stu-id="5f7d6-274">Finally, add this new behavior to the current operation behaviors, as shown in the following example:</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  
  
### <a name="to-use-a-surrogate-for-metadata-import"></a><span data-ttu-id="5f7d6-275">Использование суррогата для импорта метаданных</span><span class="sxs-lookup"><span data-stu-id="5f7d6-275">To Use a Surrogate for Metadata Import</span></span>  

 <span data-ttu-id="5f7d6-276">При импорте метаданных, таких как WSDL и XSD, для генерации клиентского кода суррогат необходимо добавить в компонент, отвечающий за генерирование кода из схемы XSD, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-276">When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span></span> <span data-ttu-id="5f7d6-277">Для этого напрямую измените объект <xref:System.ServiceModel.Description.WsdlImporter>, который используется для импорта метаданных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-277">To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.</span></span>  
  
##### <a name="to-implement-a-surrogate-for-metadata-importation"></a><span data-ttu-id="5f7d6-278">Реализация суррогата для импорта метаданных</span><span class="sxs-lookup"><span data-stu-id="5f7d6-278">To implement a surrogate for metadata importation</span></span>  
  
1. <span data-ttu-id="5f7d6-279">Импортируйте метаданные при помощи класса <xref:System.ServiceModel.Description.WsdlImporter>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-279">Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.</span></span>  
  
2. <span data-ttu-id="5f7d6-280">Чтобы проверить, определен ли объект <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>, воспользуйтесь методом <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-280">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.</span></span>  
  
3. <span data-ttu-id="5f7d6-281">Если метод <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> возвращает значение `false`, создайте новый объект <xref:System.Runtime.Serialization.XsdDataContractImporter> и задайте в его свойстве <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> новый экземпляр класса <xref:System.Runtime.Serialization.ImportOptions>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-281">If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span> <span data-ttu-id="5f7d6-282">В противном случае используйте импортер, возвращенный параметром `out` метода <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-282">Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="5f7d6-283">Если для импортера <xref:System.Runtime.Serialization.XsdDataContractImporter> не определено свойство <xref:System.Runtime.Serialization.ImportOptions>, задайте для свойства новый экземпляр класса <xref:System.Runtime.Serialization.ImportOptions>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-283">If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span>  
  
5. <span data-ttu-id="5f7d6-284">Задайте для свойства <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> объекта <xref:System.Runtime.Serialization.ImportOptions> импортера <xref:System.Runtime.Serialization.XsdDataContractImporter> в качестве значения новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-284">Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.</span></span>  
  
6. <span data-ttu-id="5f7d6-285">Добавьте объект <xref:System.Runtime.Serialization.XsdDataContractImporter> в коллекцию, возвращенную свойством <xref:System.ServiceModel.Description.MetadataExporter.State%2A> объекта <xref:System.ServiceModel.Description.WsdlImporter> (унаследован от класса <xref:System.ServiceModel.Description.MetadataExporter>).</span><span class="sxs-lookup"><span data-stu-id="5f7d6-285">Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)</span></span>  
  
7. <span data-ttu-id="5f7d6-286">Используйте метод <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> объекта <xref:System.ServiceModel.Description.WsdlImporter> для импорта всех контрактов данных схемы.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-286">Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema.</span></span> <span data-ttu-id="5f7d6-287">Во время последнего действия генерируется код из схем, загруженных при вызове суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-287">During the last step, code is generated from the schemas loaded by calling into the surrogate.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  
  
### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="5f7d6-288">Использование суррогата для экспорта метаданных</span><span class="sxs-lookup"><span data-stu-id="5f7d6-288">To Use a surrogate for Metadata Export</span></span>  

 <span data-ttu-id="5f7d6-289">По умолчанию при экспорте метаданных из WCF для службы необходимо создать схему WSDL и XSD.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-289">By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.</span></span> <span data-ttu-id="5f7d6-290">Суррогат необходимо добавить в компонент, отвечающий за генерацию XSD-схемы для типов контрактов данных, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-290">The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span></span> <span data-ttu-id="5f7d6-291">Для этого используйте либо поведение, реализующее <xref:System.ServiceModel.Description.IWsdlExportExtension> для изменения <xref:System.ServiceModel.Description.WsdlExporter>, либо напрямую измените объект <xref:System.ServiceModel.Description.WsdlExporter>, который используется для экспорта метаданных.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-291">To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.</span></span>  
  
##### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="5f7d6-292">Использование суррогата для экспорта метаданных</span><span class="sxs-lookup"><span data-stu-id="5f7d6-292">To use a surrogate for metadata export</span></span>  
  
1. <span data-ttu-id="5f7d6-293">Создайте новый объект <xref:System.ServiceModel.Description.WsdlExporter> или используйте параметр `wsdlExporter`, переданный методу <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-293">Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.</span></span>  
  
2. <span data-ttu-id="5f7d6-294">Чтобы проверить, определен ли объект <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>, воспользуйтесь функцией <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-294">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.</span></span>  
  
3. <span data-ttu-id="5f7d6-295">Если метод <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> возвращает значение `false`, создайте новый объект <xref:System.Runtime.Serialization.XsdDataContractExporter> со сгенерированными схемами XML из объекта <xref:System.ServiceModel.Description.WsdlExporter>, и добавьте его в коллекцию, возвращенную свойством <xref:System.ServiceModel.Description.MetadataExporter.State%2A> объекта <xref:System.ServiceModel.Description.WsdlExporter>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-295">If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>.</span></span> <span data-ttu-id="5f7d6-296">В противном случае используйте экспортер, возвращенный параметром `out` метода <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-296">Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="5f7d6-297">Если для экспортера <xref:System.Runtime.Serialization.XsdDataContractExporter> не определен объект <xref:System.Runtime.Serialization.ExportOptions>, задайте для свойства <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> в качестве значения новый экземпляр класса <xref:System.Runtime.Serialization.ExportOptions>.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-297">If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.</span></span>  
  
5. <span data-ttu-id="5f7d6-298">Задайте для свойства <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> объекта <xref:System.Runtime.Serialization.ExportOptions> импортера <xref:System.Runtime.Serialization.XsdDataContractExporter> в качестве значения новый экземпляр суррогата.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-298">Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate.</span></span> <span data-ttu-id="5f7d6-299">Дальнейшие шаги по экспорту метаданных остаются без изменений.</span><span class="sxs-lookup"><span data-stu-id="5f7d6-299">Subsequent steps for exporting metadata do not require any changes.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  
  
## <a name="see-also"></a><span data-ttu-id="5f7d6-300">См. также</span><span class="sxs-lookup"><span data-stu-id="5f7d6-300">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Runtime.Serialization.IDataContractSurrogate>
- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>
- <xref:System.Runtime.Serialization.ImportOptions>
- <xref:System.Runtime.Serialization.ExportOptions>
- [<span data-ttu-id="5f7d6-301">Использование контрактов данных</span><span class="sxs-lookup"><span data-stu-id="5f7d6-301">Using Data Contracts</span></span>](../feature-details/using-data-contracts.md)
