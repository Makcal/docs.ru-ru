---
description: 'Дополнительные сведения: определение и указание ошибок'
title: Определение и задание сбоев
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], specifying
- handling faults [WCF], defining
ms.assetid: c00c84f1-962d-46a7-b07f-ebc4f80fbfc1
ms.openlocfilehash: cf8c4dafaf3958cbb0be6fd096049d13f70685bd
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99646118"
---
# <a name="defining-and-specifying-faults"></a><span data-ttu-id="554e0-103">Определение и задание сбоев</span><span class="sxs-lookup"><span data-stu-id="554e0-103">Defining and Specifying Faults</span></span>

<span data-ttu-id="554e0-104">Ошибки SOAP передают сведения об ошибке от службы клиенту и, в дуплексном случае, от клиента службе совместимым способом.</span><span class="sxs-lookup"><span data-stu-id="554e0-104">SOAP faults convey error condition information from a service to a client and, in the duplex case, from a client to a service in an interoperable way.</span></span> <span data-ttu-id="554e0-105">В этом разделе описано, как и когда можно определить содержимое пользовательских ошибок и задать операции, которые могут возвратить это содержимое.</span><span class="sxs-lookup"><span data-stu-id="554e0-105">This topic discusses when and how to define custom fault content and specify which operations can return them.</span></span> <span data-ttu-id="554e0-106">Дополнительные сведения о том, как служба или дуплексный клиент могут отправлять эти ошибки, а также о том, как клиент или приложение службы обрабатывает эти ошибки, см. в разделе [Отправка и получение ошибок](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="554e0-106">For more information about how a service, or duplex client, can send those faults and how a client or service application handles these faults, see [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span> <span data-ttu-id="554e0-107">Общие сведения об обработке ошибок в приложениях Windows Communication Foundation (WCF) см. в разделе [Указание и обработка ошибок в контрактах и службах](specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="554e0-107">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](specifying-and-handling-faults-in-contracts-and-services.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="554e0-108">Обзор</span><span class="sxs-lookup"><span data-stu-id="554e0-108">Overview</span></span>  

 <span data-ttu-id="554e0-109">Объявленные ошибки SOAP - это ошибки, в которых в операции имеется атрибут <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType>, указывающий пользовательский тип ошибки SOAP.</span><span class="sxs-lookup"><span data-stu-id="554e0-109">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="554e0-110">Необъявленные ошибки SOAP - это ошибки, не указанные в контракте операции.</span><span class="sxs-lookup"><span data-stu-id="554e0-110">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span> <span data-ttu-id="554e0-111">Изучение этого раздела поможет определять такие состояния ошибки и создать для своей службы контракт ошибок, который может использоваться клиентами для правильной обработки состояния ошибки при уведомлении о пользовательской ошибке SOAP.</span><span class="sxs-lookup"><span data-stu-id="554e0-111">This topic helps you identify those error conditions and create a fault contract for your service that clients can use to properly handle those error conditions when notified by custom SOAP faults.</span></span> <span data-ttu-id="554e0-112">Необходимо решить следующие основные задачи (порядок имеет значение):</span><span class="sxs-lookup"><span data-stu-id="554e0-112">The basic tasks are, in order:</span></span>  
  
1. <span data-ttu-id="554e0-113">Определить состояния ошибки, о которых должен знать клиент службы;</span><span class="sxs-lookup"><span data-stu-id="554e0-113">Define the error conditions that a client of your service should know about.</span></span>  
  
2. <span data-ttu-id="554e0-114">Определить пользовательское содержимое ошибок SOAP для этих состояний ошибки;</span><span class="sxs-lookup"><span data-stu-id="554e0-114">Define the custom content of the SOAP faults for those error conditions.</span></span>  
  
3. <span data-ttu-id="554e0-115">Отметить операции, чтобы создаваемые ими определенные ошибки SOAP предоставлялись клиентам в формате WSDL.</span><span class="sxs-lookup"><span data-stu-id="554e0-115">Mark your operations so that the specific SOAP faults that they throw are exposed to clients in WSDL.</span></span>  
  
### <a name="defining-error-conditions-that-clients-should-know-about"></a><span data-ttu-id="554e0-116">Определение состояний ошибки, о которых должен знать клиент</span><span class="sxs-lookup"><span data-stu-id="554e0-116">Defining Error Conditions That Clients Should Know About</span></span>  

 <span data-ttu-id="554e0-117">Ошибки SOAP - это общедоступные сообщения, содержащие сведения об ошибке определенной операции.</span><span class="sxs-lookup"><span data-stu-id="554e0-117">SOAP faults are publicly described messages that carry fault information for a particular operation.</span></span> <span data-ttu-id="554e0-118">Так как они описаны вместе с другими сообщениями операций в WSDL, клиенты знают о них и, следовательно, готовы обрабатывать такие ошибки при вызове операции.</span><span class="sxs-lookup"><span data-stu-id="554e0-118">Because they are described along with other operation messages in WSDL, clients know and, therefore, expect to handle such faults when invoking an operation.</span></span> <span data-ttu-id="554e0-119">Но поскольку службы WCF написаны на управляемом коде, решение о том, какие условия ошибок в управляемом коде следует преобразовать в ошибки и возвращены клиенту, дает возможность разделять ошибки и ошибки в службе от формальных сообщений об ошибках с клиентом.</span><span class="sxs-lookup"><span data-stu-id="554e0-119">But because WCF services are written in managed code, deciding which error conditions in managed code are to be converted into faults and returned to the client provides you the opportunity to separate error conditions and bugs in your service from the formal error conversation you have with a client.</span></span>  
  
 <span data-ttu-id="554e0-120">Например, в следующем примере кода показана операция, которая принимает два целых числа и возвращает другое целое число.</span><span class="sxs-lookup"><span data-stu-id="554e0-120">For example, the following code example shows an operation that takes two integers and returns another integer.</span></span> <span data-ttu-id="554e0-121">Здесь может быть создано несколько исключений, поэтому при разработке контракта ошибок нужно определить, какие состояния ошибки важны для клиента.</span><span class="sxs-lookup"><span data-stu-id="554e0-121">Several exceptions can be thrown here, so when designing the fault contract, you must determine which error conditions are important for your client.</span></span> <span data-ttu-id="554e0-122">В этом случае служба должна обнаруживать исключение <xref:System.DivideByZeroException?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="554e0-122">In this case, the service should detect the <xref:System.DivideByZeroException?displayProperty=nameWithType> exception.</span></span>  
  
```csharp  
[ServiceContract]  
public class CalculatorService  
{  
    [OperationContract]
    int Divide(int a, int b)  
    {  
      if (b==0) throw new Exception("Division by zero!");  
      return a/b;  
    }  
}  
```  
  
```vb
<ServiceContract> _
Public Class CalculatorService
    <OperationContract> _
    Public Function Divide(a As Integer, b As Integer) As Integer
        If b = 0 Then Throw New DivideByZeroException("Division by zero!")
        Return a / b
    End Function
End Class
```
  
 <span data-ttu-id="554e0-123">В данном примере операция может вернуть пользовательскую ошибку SOAP о делении на ноль, пользовательскую ошибку, связанную с математическими операциями, но содержащую сведения о делении на ноль, несколько ошибок для различных ситуаций с ошибками или не возвращать ошибок SOAP.</span><span class="sxs-lookup"><span data-stu-id="554e0-123">In the preceding example the operation can either return a custom SOAP fault that is specific to dividing by zero, a custom fault that is specific to math operations but that contains information specific to dividing by zero, multiple faults for several different error situations, or no SOAP fault at all.</span></span>  
  
### <a name="define-the-content-of-error-conditions"></a><span data-ttu-id="554e0-124">Определение содержимого состояний ошибки</span><span class="sxs-lookup"><span data-stu-id="554e0-124">Define the Content of Error Conditions</span></span>  

 <span data-ttu-id="554e0-125">Если установлено, что состояние ошибки может вернуть полезную пользовательскую ошибку SOAP, необходимо определить содержимое этой ошибки и убедиться, что структура содержимого сериализуется.</span><span class="sxs-lookup"><span data-stu-id="554e0-125">Once an error condition has been identified as one that can usefully return a custom SOAP fault, the next step is to define the contents of that fault and ensure that the content structure can be serialized.</span></span> <span data-ttu-id="554e0-126">В примере кода в предыдущем разделе показана ошибка, связанную с операцией `Divide`, но если в службе `Calculator` содержатся другие операции, одна пользовательская ошибка SOAP может сообщать клиенту обо всех состояниях ошибки калькулятора, включая `Divide`.</span><span class="sxs-lookup"><span data-stu-id="554e0-126">The code example in the preceding section shows an error specific to a `Divide` operation, but if there are other operations on the `Calculator` service, then a single custom SOAP fault can inform the client of all calculator error conditions, `Divide` included.</span></span> <span data-ttu-id="554e0-127">В следующем коде показан пример создания пользовательской ошибки SOAP, `MathFault`, которая может сообщать об ошибках, произошедших при любых математических операциях, включая `Divide`.</span><span class="sxs-lookup"><span data-stu-id="554e0-127">The following code example shows the creation of a custom SOAP fault, `MathFault`, which can report errors made using all math operations, including `Divide`.</span></span> <span data-ttu-id="554e0-128">Класс может задавать операцию (свойство `Operation`) и значение, описывающее проблему (свойство `ProblemType`), но при этом класс и эти свойства должны быть сериализуемы, чтобы их можно было передать клиенту в пользовательской ошибке SOAP.</span><span class="sxs-lookup"><span data-stu-id="554e0-128">While the class can specify an operation (the `Operation` property) and a value that describes the problem (the `ProblemType` property), the class and these properties must be serializable to be transferred to the client in a custom SOAP fault.</span></span> <span data-ttu-id="554e0-129">Чтобы обеспечить максимальный уровень сериализуемости типа и его свойств, а также максимальный уровень взаимодействия, используются атрибуты <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> и <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="554e0-129">Therefore, the <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> and <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> attributes are used to make the type and its properties serializable and as interoperable as possible.</span></span>  
  
 [!code-csharp[Faults#2](../../../samples/snippets/csharp/VS_Snippets_CFX/faults/cs/service.cs#2)]
 [!code-vb[Faults#2](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faults/vb/service.vb#2)]  
  
 <span data-ttu-id="554e0-130">Дополнительные сведения о том, как обеспечить сериализацию данных, см. [в разделе указание передача данных в контрактах служб](./feature-details/specifying-data-transfer-in-service-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="554e0-130">For more information about how to ensure your data is serializable, see [Specifying Data Transfer in Service Contracts](./feature-details/specifying-data-transfer-in-service-contracts.md).</span></span> <span data-ttu-id="554e0-131">Список поддерживаемых сериализации <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> см. в статье [типы, поддерживаемые сериализатором контрактов данных](./feature-details/types-supported-by-the-data-contract-serializer.md).</span><span class="sxs-lookup"><span data-stu-id="554e0-131">For a list of the serialization support that <xref:System.Runtime.Serialization.DataContractSerializer?displayProperty=nameWithType> provides, see [Types Supported by the Data Contract Serializer](./feature-details/types-supported-by-the-data-contract-serializer.md).</span></span>  
  
### <a name="mark-operations-to-establish-the-fault-contract"></a><span data-ttu-id="554e0-132">Разметка операций для установления контракта ошибок</span><span class="sxs-lookup"><span data-stu-id="554e0-132">Mark Operations to Establish the Fault Contract</span></span>  

 <span data-ttu-id="554e0-133">После определения сериализуемой структуры данных, которая возвращается как часть пользовательской ошибки SOAP, нужно отметить контракт операции, как создающий ошибку SOAP этого типа.</span><span class="sxs-lookup"><span data-stu-id="554e0-133">Once a serializable data structure that is returned as part of a custom SOAP fault is defined, the last step is to mark your operation contract as throwing a SOAP fault of that type.</span></span> <span data-ttu-id="554e0-134">Для этого следует использовать атрибут <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> и передать тип созданного пользовательского типа данных.</span><span class="sxs-lookup"><span data-stu-id="554e0-134">To do this, use the <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute and pass the type of the custom data type that you have constructed.</span></span> <span data-ttu-id="554e0-135">В следующем примере кода показано, как с помощью атрибута <xref:System.ServiceModel.FaultContractAttribute> указать, что операция `Divide` может возвращать ошибку SOAP типа `MathFault`.</span><span class="sxs-lookup"><span data-stu-id="554e0-135">The following code example shows how to use the <xref:System.ServiceModel.FaultContractAttribute> attribute to specify that the `Divide` operation can return a SOAP fault of type `MathFault`.</span></span> <span data-ttu-id="554e0-136">Другие математические операции теперь тоже могут указывать, что могут вернуть ошибку `MathFault`.</span><span class="sxs-lookup"><span data-stu-id="554e0-136">Other math-based operations can now also specify that they can return a `MathFault`.</span></span>  
  
 [!code-csharp[Faults#1](../../../samples/snippets/csharp/VS_Snippets_CFX/faults/cs/service.cs#1)]
 [!code-vb[Faults#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faults/vb/service.vb#1)]  
  
 <span data-ttu-id="554e0-137">Операция может указывать, что возвращает несколько пользовательских ошибок, если она отмечена несколькими атрибутами <xref:System.ServiceModel.FaultContractAttribute>.</span><span class="sxs-lookup"><span data-stu-id="554e0-137">An operation can specify that it returns more than one custom fault by marking that operation with more than one <xref:System.ServiceModel.FaultContractAttribute> attribute.</span></span>  
  
 <span data-ttu-id="554e0-138">Следующий шаг для реализации контракта сбоя в реализации операции описан в разделе [Отправка и получение ошибок](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="554e0-138">The next step, to implement the fault contract in your operation implementation, is described in the topic [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>  
  
#### <a name="soap-wsdl-and-interoperability-considerations"></a><span data-ttu-id="554e0-139">Вопросы SOAP, WSDL и взаимодействия</span><span class="sxs-lookup"><span data-stu-id="554e0-139">SOAP, WSDL, and Interoperability Considerations</span></span>  

 <span data-ttu-id="554e0-140">В некоторых ситуациях, особенно при взаимодействиях с другими платформами, может быть важно контролировать представление ошибки в сообщении SOAP или способ ее описания в метаданных WSDL.</span><span class="sxs-lookup"><span data-stu-id="554e0-140">In some circumstances, especially when interoperating with other platforms, it may be important to control the way a fault appears in a SOAP message or the way it is described in the WSDL metadata.</span></span>  
  
 <span data-ttu-id="554e0-141">Атрибут <xref:System.ServiceModel.FaultContractAttribute> содержит свойство <xref:System.ServiceModel.FaultContractAttribute.Name%2A>, позволяющее контролировать имя элемента ошибки WSDL, которое создается в метаданных этой ошибки.</span><span class="sxs-lookup"><span data-stu-id="554e0-141">The <xref:System.ServiceModel.FaultContractAttribute> attribute has a <xref:System.ServiceModel.FaultContractAttribute.Name%2A> property that allows control of the WSDL fault element name that is generated in the metadata for that fault.</span></span>  
  
 <span data-ttu-id="554e0-142">В соответствии со стандартом SOAP для ошибки могут указываться атрибуты `Action`, `Code` и `Reason`.</span><span class="sxs-lookup"><span data-stu-id="554e0-142">According to the SOAP standard, a fault can have an `Action`, a `Code`, and a `Reason`.</span></span> <span data-ttu-id="554e0-143">`Action` контролируется свойством <xref:System.ServiceModel.FaultContractAttribute.Action%2A>.</span><span class="sxs-lookup"><span data-stu-id="554e0-143">The `Action` is controlled by the <xref:System.ServiceModel.FaultContractAttribute.Action%2A> property.</span></span> <span data-ttu-id="554e0-144">Свойства <xref:System.ServiceModel.FaultException.Code%2A> и<xref:System.ServiceModel.FaultException.Reason%2A> - свойства класса <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>, родительского класса универсального класса <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="554e0-144">The <xref:System.ServiceModel.FaultException.Code%2A> property and <xref:System.ServiceModel.FaultException.Reason%2A> property are both properties of the <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> class, which is the parent class of the generic <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType>.</span></span> <span data-ttu-id="554e0-145">Свойство `Code` включает член <xref:System.ServiceModel.FaultCode.SubCode%2A>.</span><span class="sxs-lookup"><span data-stu-id="554e0-145">The `Code` property includes a <xref:System.ServiceModel.FaultCode.SubCode%2A> member.</span></span>  
  
 <span data-ttu-id="554e0-146">Существуют некоторые ограничения доступа к службам, создающим ошибки.</span><span class="sxs-lookup"><span data-stu-id="554e0-146">When accessing non-services that generate faults, certain limitations exist.</span></span> <span data-ttu-id="554e0-147">WCF поддерживает только ошибки с типами сведений, которые описываются в схеме и совместимы с контрактами данных.</span><span class="sxs-lookup"><span data-stu-id="554e0-147">WCF supports only faults with detail types that the schema describes and that are compatible with data contracts.</span></span> <span data-ttu-id="554e0-148">Например, как упоминалось выше, WCF не поддерживает ошибки, которые используют атрибуты XML в их типах сведений, или ошибки с несколькими элементами верхнего уровня в разделе сведений.</span><span class="sxs-lookup"><span data-stu-id="554e0-148">For example, as mentioned above, WCF does not support faults that use XML attributes in their detail types, or faults with more than one top-level element in the detail section.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="554e0-149">См. также</span><span class="sxs-lookup"><span data-stu-id="554e0-149">See also</span></span>

- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.Runtime.Serialization.DataContractAttribute>
- <xref:System.Runtime.Serialization.DataMemberAttribute>
- [<span data-ttu-id="554e0-150">Задание и обработка сбоев в контрактах и службах</span><span class="sxs-lookup"><span data-stu-id="554e0-150">Specifying and Handling Faults in Contracts and Services</span></span>](specifying-and-handling-faults-in-contracts-and-services.md)
- [<span data-ttu-id="554e0-151">Сбои при отправке и получении</span><span class="sxs-lookup"><span data-stu-id="554e0-151">Sending and Receiving Faults</span></span>](sending-and-receiving-faults.md)
- [<span data-ttu-id="554e0-152">Практическое руководство. Объявление сбоев в контрактах служб</span><span class="sxs-lookup"><span data-stu-id="554e0-152">How to: Declare Faults in Service Contracts</span></span>](how-to-declare-faults-in-service-contracts.md)
- [<span data-ttu-id="554e0-153">Основные сведения об уровне защиты</span><span class="sxs-lookup"><span data-stu-id="554e0-153">Understanding Protection Level</span></span>](understanding-protection-level.md)
- [<span data-ttu-id="554e0-154">Практическое руководство. Установка свойства ProtectionLevel</span><span class="sxs-lookup"><span data-stu-id="554e0-154">How to: Set the ProtectionLevel Property</span></span>](how-to-set-the-protectionlevel-property.md)
- [<span data-ttu-id="554e0-155">Задание передачи данных в контрактах служб</span><span class="sxs-lookup"><span data-stu-id="554e0-155">Specifying Data Transfer in Service Contracts</span></span>](./feature-details/specifying-data-transfer-in-service-contracts.md)
