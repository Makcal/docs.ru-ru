---
description: 'Дополнительные сведения: .NET Native и компиляция'
title: Машинный код .NET и компиляция
ms.date: 03/30/2017
ms.assetid: e38ae4f3-3e3d-42c3-a4b8-db1aa9d84f85
ms.openlocfilehash: 1a847340f48d97eb255869895f9a5b963e45e8ab
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99738563"
---
# <a name="net-native-and-compilation"></a><span data-ttu-id="dfa7c-103">Машинный код .NET и компиляция</span><span class="sxs-lookup"><span data-stu-id="dfa7c-103">.NET Native and Compilation</span></span>

<span data-ttu-id="dfa7c-104">Приложения Windows 8.1 и классические приложения Windows, предназначенные для платформы .NET Framework, создаются на определенном языке программирования и компилируются в промежуточный язык (IL).</span><span class="sxs-lookup"><span data-stu-id="dfa7c-104">Windows 8.1 applications and Windows Desktop applications that target the.NET Framework are written in a particular programming language and compiled into intermediate language (IL).</span></span> <span data-ttu-id="dfa7c-105">Перед выполнением какого-либо метода в первый раз JIT-компилятор компилирует IL-код в машинный код для локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-105">At runtime, a just-in-time (JIT) compiler is responsible for compiling the IL into native code for the local machine just before a method is executed for the first time.</span></span> <span data-ttu-id="dfa7c-106">В противоположность этому цепочка инструментов .NET Native преобразует исходный код в машинный код во время компиляции.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-106">In contrast, the .NET Native tool chain converts source code to native code at compile time.</span></span> <span data-ttu-id="dfa7c-107">В этом разделе сравнивается .NET Native с другими технологиями компиляции, доступными для приложений .NET Framework, а также детально рассматривается, как цепочка инструментов .NET Native создает исходный код, что поможет вам понять, почему исключения, возникающие в коде, скомпилированном .NET Native, не возникают в JIT-скомпилированном коде.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-107">This topic compares .NET Native with other compilation technologies available for .NET Framework apps, and also provides a practical overview of how .NET Native produces native code that can help you understand why exceptions that occur in code compiled with .NET Native do not occur in JIT-compiled code.</span></span>

## <a name="net-native-generating-native-binaries"></a><span data-ttu-id="dfa7c-108">.NET Native: создание двоичных файлов машинного кода</span><span class="sxs-lookup"><span data-stu-id="dfa7c-108">.NET Native: Generating native binaries</span></span>

<span data-ttu-id="dfa7c-109">Приложение, предназначенное для .NET Framework и не скомпилированное с помощью цепочки инструментов .NET Native, состоит из сборки приложения, которая включает следующее:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-109">An application that targets the .NET Framework and that is not compiled by using the .NET Native tool chain consists of your application assembly, which includes the following:</span></span>

- <span data-ttu-id="dfa7c-110">[Метаданные](../../standard/metadata-and-self-describing-components.md), описывающие сборку, ее зависимости, типы, которые она содержит, и их члены.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-110">[Metadata](../../standard/metadata-and-self-describing-components.md) that describes the assembly, its dependencies, the types it contains, and their members.</span></span> <span data-ttu-id="dfa7c-111">Метаданные используется для отражения и доступа через позднее связывание, а также в некоторых случаях для средств компиляции и построения.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-111">The metadata is used for reflection and late-bound access, and in some cases by compiler and build tools as well.</span></span>

- <span data-ttu-id="dfa7c-112">Код реализации.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-112">Implementation code.</span></span> <span data-ttu-id="dfa7c-113">Он состоит из кодов операций промежуточного языка (IL).</span><span class="sxs-lookup"><span data-stu-id="dfa7c-113">This consists of intermediate language (IL) opcodes.</span></span> <span data-ttu-id="dfa7c-114">Во время выполнения JIT-компилятор преобразует его в машинный код для целевой платформы.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-114">At runtime, the just-in-time (JIT) compiler translates it into native code for the target platform.</span></span>

 <span data-ttu-id="dfa7c-115">Для приложения, помимо главной сборки, требуется присутствие следующего:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-115">In addition to your main application assembly, an app requires that the following be present:</span></span>

- <span data-ttu-id="dfa7c-116">Все дополнительные библиотеки классов и сборки сторонних производителей, необходимые приложению.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-116">Any additional class libraries or third-party assemblies that are required by your app.</span></span> <span data-ttu-id="dfa7c-117">Эти сборки точно так же включают метаданные, описывающие сборку, ее типы и члены, а также IL-код, который реализует все члены типов.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-117">These assemblies similarly include metadata that describes the assembly, its types, and their members, as well as the IL that implements all type members.</span></span>

- <span data-ttu-id="dfa7c-118">Библиотека классов .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-118">The .NET Framework Class Library.</span></span> <span data-ttu-id="dfa7c-119">Это коллекция сборок, устанавливаемая на локальном компьютере при установке платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-119">This is a collection of assemblies that is installed on the local system with the .NET Framework installation.</span></span> <span data-ttu-id="dfa7c-120">Сборки, включенные в библиотеку классов .NET Framework, содержат полный набор метаданных и кода реализации.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-120">The assemblies included in the .NET Framework Class Library include a complete set of metadata and implementation code.</span></span>

- <span data-ttu-id="dfa7c-121">Среда CLR.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-121">The common language runtime.</span></span> <span data-ttu-id="dfa7c-122">Это коллекция библиотек DLL, которые выполняют такие операции, как загрузка сборок, управление памятью, сбор мусора, обработка исключений, JIT-компиляция, удаленное и локальное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-122">This is a collection of dynamic link libraries that perform such services as assembly loading, memory management and garbage collection, exception handling, just-in-time compilation, remoting, and interop.</span></span> <span data-ttu-id="dfa7c-123">Как и библиотека классов, среда выполнения устанавливается на локальном компьютере в процессе установки .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-123">Like the class library, the runtime is installed on the local system as part of the .NET Framework installation.</span></span>

<span data-ttu-id="dfa7c-124">Обратите внимание, для успешного выполнения приложения должны присутствовать: вся среда CLR, метаданные, IL-код для всех типов в сборках, специфичных для приложения, сторонние сборки и системные сборки.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-124">Note that the entire common language runtime, as well as metadata and IL for all types in application-specific assemblies, third-party assemblies, and system assemblies must be present for the app to execute successfully.</span></span>

## <a name="net-native-and-just-in-time-compilation"></a><span data-ttu-id="dfa7c-125">.NET Native и JIT-компиляция</span><span class="sxs-lookup"><span data-stu-id="dfa7c-125">.NET Native and just-in-time compilation</span></span>

<span data-ttu-id="dfa7c-126">Входные данные для цепочки инструментов машинного кода .NET — приложение Магазина Windows, сборка которого выполнена компилятором C# или Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-126">The input for the .NET Native tool chain is the Windows store app built by the C# or Visual Basic compiler.</span></span> <span data-ttu-id="dfa7c-127">Другими словами, цепочка инструментов машинного кода .NET Nativeначинает выполнение после того, как компилятор завершит компиляцию приложения Магазина Windows.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-127">In other words, the .NET Native tool chain begins execution when the language compiler has finished compilation of a Windows Store app.</span></span>

> [!TIP]
> <span data-ttu-id="dfa7c-128">Так как входные данные .NET Native — промежуточный язык (IL) и метаданные, записанные в сборки управляемого кода, то вы по-прежнему можете выполнять создание собственного кода или другие пользовательские операции посредством событий "перед сборкой" и "после сборки" или путем изменения файла проекта MSBuild.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-128">Because the input to .NET Native is the IL and metadata written to managed assemblies, you can still perform custom code generation or other custom operations by using pre-build or post-build events or by modifying the MSBuild project file.</span></span>
>
> <span data-ttu-id="dfa7c-129">Однако не поддерживаются инструменты, изменяющие IL-код и тем самым препятствующие анализу приложения IL цепочкой инструментов .NET.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-129">However, categories of tools that modify IL and thereby prevent the .NET tool chain from analyzing an app's IL are not supported.</span></span> <span data-ttu-id="dfa7c-130">Средства запутывания являются наиболее важными средствами этого типа.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-130">Obfuscators are the most notable tools of this type.</span></span>

<span data-ttu-id="dfa7c-131">Во время преобразования приложения из промежуточного языка в машинный код цепочка инструментов .NET Native выполняет следующие операции:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-131">In the course of converting an app from IL to native code, the .NET Native tool chain performs operations like the following:</span></span>

- <span data-ttu-id="dfa7c-132">Для некоторых ветвей кода  заменяется код, основанный на отражении и метаданных, на статический машинный код.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-132">For certain code paths, it replaces code that relies on reflection and metadata with static native code.</span></span> <span data-ttu-id="dfa7c-133">Например, если тип значения не переопределяет метод <xref:System.ValueType.Equals%2A?displayProperty=nameWithType>, то стандартный тест на эквивалентность использует отражение для получения объектов <xref:System.Reflection.FieldInfo>, представляющих поля этого типа значения, а затем сравнивает значения полей двух экземпляров.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-133">For example, if a value type does not override the <xref:System.ValueType.Equals%2A?displayProperty=nameWithType> method, the default test for equality uses reflection to retrieve <xref:System.Reflection.FieldInfo> objects that represent the value type's fields, then compares the field values of two instances.</span></span> <span data-ttu-id="dfa7c-134">При компиляции в машинный код цепочка инструментов .NET Native заменяет код отражения и метаданные на статическое сравнение значений полей.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-134">When compiling to native code, the .NET Native tool chain replaces the reflection code and metadata with a static comparison of the field values.</span></span>

- <span data-ttu-id="dfa7c-135">Везде, где возможно, делается попытка исключить все метаданные.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-135">Where possible, it attempts to eliminate all metadata.</span></span>

- <span data-ttu-id="dfa7c-136">.NET Native включает в заключительные сборки приложения только тот код реализации, который фактически вызывается приложением.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-136">It includes in the final app assemblies only the implementation code that is actually invoked by the app.</span></span> <span data-ttu-id="dfa7c-137">Особенно это касается кода сторонних библиотек и кода в библиотеке классов .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-137">This particularly affects code in third-party libraries and in the .NET Framework Class Library.</span></span> <span data-ttu-id="dfa7c-138">В результате приложение больше не зависит от сторонних библиотек или всей библиотеки классов .NET Framework; вместо этого код сторонних библиотек и библиотек классов .NET Framework теперь является локальным для приложения.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-138">As a result, an application no longer depends on either third-party libraries or the full .NET Framework Class Library; instead, code in third-party and .NET Framework class libraries is now local to the app.</span></span>

- <span data-ttu-id="dfa7c-139">.NET Native заменяет полную среду CLR на оптимизированную среды выполнения, которая в первую очередь содержит сборщика мусора.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-139">It replaces the full CLR with a refactored runtime that primarily contains the garbage collector.</span></span> <span data-ttu-id="dfa7c-140">Оптимизированная среда выполнения находится в библиотеке mrt100_app.dll, которая является локальной для приложения и имеет размер только несколько сотен килобайт.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-140">The refactored runtime is found in a library named mrt100_app.dll that is local to the app and is only a few hundred kilobytes in size.</span></span> <span data-ttu-id="dfa7c-141">Это возможно потому, что статическое связывание устраняет необходимость во многих операциях, реализуемых средой CLR.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-141">This is possible because static linking eliminates the need for many of the services performed by the common language runtime.</span></span>

  > [!NOTE]
  > <span data-ttu-id="dfa7c-142">.NET Native использует тот же сборщик мусора, что и стандартная среда CLR.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-142">.NET Native uses the same garbage collector as the standard common language runtime.</span></span> <span data-ttu-id="dfa7c-143">В сборщике мусора .NET Native фоновая сборка мусора включена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-143">In the .NET Native garbage collector, background garbage collection is enabled by default.</span></span> <span data-ttu-id="dfa7c-144">Дополнительные сведения о сборке мусора см. в разделе [Основы сборки мусора](../../standard/garbage-collection/fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="dfa7c-144">For more information about garbage collection, see [Fundamentals of Garbage Collection](../../standard/garbage-collection/fundamentals.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="dfa7c-145">.NET Native компилирует все приложение в приложение машинного кода.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-145">.NET Native compiles an entire application to a native application.</span></span> <span data-ttu-id="dfa7c-146">.NET Native не позволяет компилировать одну сборку, которая содержит библиотеку классов, в машинный код, для того чтобы его можно было вызывать напрямую из управляемого кода.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-146">It does not allow you to compile a single assembly that contains a class library to native code so that it can be called independently from managed code.</span></span>

<span data-ttu-id="dfa7c-147">Итоговое приложение, созданное цепочкой инструментов .NET Native, записывается в каталог ilc.out в каталоге отладки или выпуска каталога проекта.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-147">The resulting app that is produced by the .NET Native tool chain is written to a directory named ilc.out in the Debug or Release directory of your project directory.</span></span> <span data-ttu-id="dfa7c-148">Итоговое приложение состоит из следующих файлов:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-148">It consists of the following files:</span></span>

- <span data-ttu-id="dfa7c-149">*\<appName>* exe — исполняемый файл-заглушка, который просто передает управление Специальному `Main` экспорту в *\<appName>* DLL.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-149">*\<appName>*.exe, a stub executable that simply transfers control to a special `Main` export in *\<appName>*.dll.</span></span>

- <span data-ttu-id="dfa7c-150">*\<appName>*. DLL — библиотека динамической компоновки Windows, которая содержит весь код приложения, а также код из библиотеки классов платформа .NET Framework и любых сторонних библиотек, от которых зависит зависимость.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-150">*\<appName>*.dll, a Windows dynamic link library that contains all your application code, as well as code from the .NET Framework Class Library and any third-party libraries that you have a dependency on.</span></span>  <span data-ttu-id="dfa7c-151">Итоговое приложение также содержит код поддержки, например код, необходимый для взаимодействия с Windows и сериализации объектов в приложении.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-151">It also contains support code, such as the code necessary to interoperate with Windows and to serialize objects in your app.</span></span>

- <span data-ttu-id="dfa7c-152">mrt100_app.dll — оптимизированная среда выполнения, которая предоставляет сервисы реального времени, такие как сборка мусора.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-152">mrt100_app.dll, a refactored runtime that provides runtime services such as garbage collection.</span></span>

 <span data-ttu-id="dfa7c-153">APPX-манифестом приложения регистрируются все зависимости.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-153">All dependencies are captured by the app's APPX manifest.</span></span>  <span data-ttu-id="dfa7c-154">Помимо EXE-файла приложения, библиотеки DLL и среды выполнения mrt100_app.dll, которые входят непосредственно в APPX-пакет, пакет включает два дополнительных файла:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-154">In addition to the application exe, dll, and mrt100_app.dll, which are bundled directly in the appx package, this includes two more files:</span></span>

- <span data-ttu-id="dfa7c-155">msvcr140_app.dll — библиотека языка C времени выполнения (CRT), используемая mrt100_app.dll.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-155">msvcr140_app.dll, the C run-time (CRT) library used by mrt100_app.dll.</span></span> <span data-ttu-id="dfa7c-156">Она включается по ссылке платформы в пакете.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-156">It is included by a framework reference in the package.</span></span>

- <span data-ttu-id="dfa7c-157">mrt100.dll.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-157">mrt100.dll.</span></span> <span data-ttu-id="dfa7c-158">Эта библиотека содержит функции, которые могут повысить производительность библиотеки mrt100_app.dll, хотя ее отсутствие не препятствует функционированию mrt100_app.dll.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-158">This library includes functions that can improve the performance of mrt100_app.dll, although its absence does not prevent mrt100_app.dll from functioning.</span></span> <span data-ttu-id="dfa7c-159">Она загружается из папки system32 на локальном компьютере, если там она имеется.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-159">It is loaded from the system32 directory on the local machine, if it is present.</span></span>

<span data-ttu-id="dfa7c-160">Поскольку цепочка инструментов .NET Native связывает код реализации в приложении только в том случае, если известно, что приложение вызывает этот код, могут не включаться вместе с приложением метаданные или код реализации, требуемые в следующих сценариях:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-160">Because the .NET Native tool chain links implementation code into your app only if it knows that your app actually invokes that code, either the metadata or the implementation code required in the following scenarios may not be included with your app:</span></span>

- <span data-ttu-id="dfa7c-161">Отражение.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-161">Reflection.</span></span>

- <span data-ttu-id="dfa7c-162">динамический вызов или вызов посредством позднего связывания;</span><span class="sxs-lookup"><span data-stu-id="dfa7c-162">Dynamic or late-bound invocation.</span></span>

- <span data-ttu-id="dfa7c-163">сериализация и десериализация;</span><span class="sxs-lookup"><span data-stu-id="dfa7c-163">Serialization and deserialization.</span></span>

- <span data-ttu-id="dfa7c-164">COM-взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-164">COM interop.</span></span>

<span data-ttu-id="dfa7c-165">Если во время выполнения метаданные или необходимый код отсутствуют, среда выполнения .NET Native вызывает исключение.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-165">If the necessary metadata or implementation code is absent at runtime, the .NET Native runtime throws an exception.</span></span> <span data-ttu-id="dfa7c-166">Чтобы предотвратить эти исключения, убедитесь, что цепочка инструментов .NET Native включает необходимые метаданные и код реализации, с помощью [файла директив времени выполнения](runtime-directives-rd-xml-configuration-file-reference.md). Это XML-файл, указывающий элементы программы, чьи метаданные или код реализации должны быть доступны во время выполнения, и назначающий им политику времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-166">You can prevent these exceptions, and ensure that the .NET Native tool chain includes the required metadata and implementation code, by using a [runtime directives file](runtime-directives-rd-xml-configuration-file-reference.md), an XML file that designates the program elements whose metadata or implementation code must be available at runtime and assigns a runtime policy to them.</span></span> <span data-ttu-id="dfa7c-167">Ниже приведен стандартный файл директив среды выполнения, который добавляется в проект Магазина Windows, компилируемый цепочкой инструментов .NET Native:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-167">The following is the default runtime directives file that is added to a Windows Store project that is compiled by the .NET Native tool chain:</span></span>

```xml
<Directives xmlns="http://schemas.microsoft.com/netfx/2013/01/metadata">
  <Application>
    <Assembly Name="*Application*" Dynamic="Required All" />
  </Application>
</Directives>
```

<span data-ttu-id="dfa7c-168">Благодаря этому становятся доступными для отражения и динамического вызова все типы и их члены во всех сборках в пакете приложения.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-168">This enables all the types, as well as all their members, in all the assemblies in your app package for reflection and dynamic invocation.</span></span> <span data-ttu-id="dfa7c-169">Однако это не позволяет выполнять отражение или динамическую активацию типов в сборках библиотеки классов .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-169">However, it does not enable reflection or dynamic activation of types in .NET Framework Class Library assemblies.</span></span> <span data-ttu-id="dfa7c-170">В большинстве случаев этого достаточно.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-170">In many cases, this is adequate.</span></span>

## <a name="net-native-and-ngen"></a><span data-ttu-id="dfa7c-171">.NET Native и NGEN</span><span class="sxs-lookup"><span data-stu-id="dfa7c-171">.NET Native and NGEN</span></span>

<span data-ttu-id="dfa7c-172">[Генератор образов в машинном коде](../tools/ngen-exe-native-image-generator.md) (NGEN) компилирует сборки в машинный код и устанавливает их в кэш образов в машинном коде на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-172">The [(Native Image Generator](../tools/ngen-exe-native-image-generator.md) (NGEN) compiles assemblies to native code and installs them in the native image cache on the local computer.</span></span> <span data-ttu-id="dfa7c-173">Однако хотя NGEN, как и .NET Native, создает машинный код, NGEN имеет существенные отличия от .NET Native:</span><span class="sxs-lookup"><span data-stu-id="dfa7c-173">However, although NGEN, like .NET Native, produces native code, it differs from .NET Native in some significant ways:</span></span>

- <span data-ttu-id="dfa7c-174">Если для конкретного метода нет образа в машинном коде, NGEN переключается на JIT-компиляцию кода.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-174">If no native image is available for a particular method, NGEN falls back to JITing code.</span></span> <span data-ttu-id="dfa7c-175">Это означает, что образы в машинном коде должны продолжать включать метаданные и IL-код для того случая, если генератору NGEN необходимо переключиться на JIT-компиляцию.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-175">This means that native images must continue to include metadata and IL in the event that NGEN needs to fall back to JIT compilation.</span></span> <span data-ttu-id="dfa7c-176">В противоположность этому .NET Native только создает образы в машинном коде и не переключается на JIT-компиляцию.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-176">In contrast, .NET Native produces only native images and does not fall back to JIT compilation.</span></span> <span data-ttu-id="dfa7c-177">В результате должны сохраняться метаданные, необходимые только для некоторых сценариев отражения, сериализации и  взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-177">As a result, only metadata required for some reflection, serialization, and interop scenarios must be preserved.</span></span>

- <span data-ttu-id="dfa7c-178">NGEN по-прежнему полагается на полную среду CLR для таких сервисов, как загрузка сборок, удаленное и локальное взаимодействие, управление памятью, сбор мусора и, при необходимости, JIT-компиляция.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-178">NGEN continues to rely on the full common language runtime for services such as assembly loading, remoting, interop, memory management, garbage collection, and, if necessary, JIT compilation.</span></span> <span data-ttu-id="dfa7c-179">В .NET Native многие из этих сервисов являются либо ненужными (JIT-компиляции), либо разрешаются во время построения и включаются в сборку приложения.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-179">In .NET Native, many of these services are either unnecessary (JIT compilation) or are resolved at build-time and incorporated in the app assembly.</span></span> <span data-ttu-id="dfa7c-180">Остальные сервисы, наиболее важным из которых является сбор мусора, включены в гораздо более компактную, оптимизированную среду выполнения mrt100_app.dll.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-180">The remaining services, the most important of which is garbage collection, are included in a much smaller, refactored runtime named mrt100_app.dll.</span></span>

- <span data-ttu-id="dfa7c-181">Образы NGEN, как правило, хрупкие.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-181">NGEN images tend to be fragile.</span></span> <span data-ttu-id="dfa7c-182">Например, обновление или изменение зависимости обычно требует, чтобы сборки, которые его используют, также были пересозданы NGEN.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-182">For example, a patch or change to a dependency typically requires that the assemblies that use it also be re-NGENed.</span></span> <span data-ttu-id="dfa7c-183">Это особенно верно для системных сборок в библиотеке классов .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-183">This is particularly true of system assemblies in the .NET Framework Class Library.</span></span> <span data-ttu-id="dfa7c-184">В противоположность этому .NET Native позволяет обслуживать приложения независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="dfa7c-184">In contrast, .NET Native allows applications to be served independently of one another.</span></span>

## <a name="see-also"></a><span data-ttu-id="dfa7c-185">См. также</span><span class="sxs-lookup"><span data-stu-id="dfa7c-185">See also</span></span>

- [<span data-ttu-id="dfa7c-186">Метаданные и компоненты с самоописанием</span><span class="sxs-lookup"><span data-stu-id="dfa7c-186">Metadata and Self-Describing Components</span></span>](../../standard/metadata-and-self-describing-components.md)
- [<span data-ttu-id="dfa7c-187">Внутри .NET Native (видео Channel 9)</span><span class="sxs-lookup"><span data-stu-id="dfa7c-187">Inside .NET Native (Channel 9 Video)</span></span>](https://channel9.msdn.com/Shows/Going+Deep/Inside-NET-Native)
- [<span data-ttu-id="dfa7c-188">Отражение и машинный код .NET</span><span class="sxs-lookup"><span data-stu-id="dfa7c-188">Reflection and .NET Native</span></span>](reflection-and-net-native.md)
- [<span data-ttu-id="dfa7c-189">Машинный код .NET: Устранение общих неполадок</span><span class="sxs-lookup"><span data-stu-id="dfa7c-189">.NET Native General Troubleshooting</span></span>](net-native-general-troubleshooting.md)
