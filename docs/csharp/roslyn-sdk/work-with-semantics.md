---
title: Использование семантической модели пакета SDK для .NET Compiler Platform
description: Данный обзор описывает типы, используемые для получения сведений о семантической модели кода и управления ею.
ms.date: 10/15/2017
ms.custom: mvc
ms.openlocfilehash: f0d254045a168f82888c5cc77a34f194a68aed0e
ms.sourcegitcommit: 8299abfbd5c49b596d61f1e4d09bc6b8ba055b36
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98899130"
---
# <a name="work-with-semantics"></a><span data-ttu-id="381d0-103">Работа с семантикой</span><span class="sxs-lookup"><span data-stu-id="381d0-103">Work with semantics</span></span>

<span data-ttu-id="381d0-104">[Деревья синтаксиса](work-with-syntax.md) представляют лексическую и синтаксическую структуру исходного кода.</span><span class="sxs-lookup"><span data-stu-id="381d0-104">[Syntax trees](work-with-syntax.md) represent the lexical and syntactic structure of source code.</span></span> <span data-ttu-id="381d0-105">Хотя одной этой информации достаточно для описания всех объявлений и логики в источнике, ее недостаточно для определения того, на что указывает ссылка.</span><span class="sxs-lookup"><span data-stu-id="381d0-105">Although this information alone is enough to describe all the declarations and logic in the source, it is not enough information to identify what is being referenced.</span></span> <span data-ttu-id="381d0-106">Имя может представлять:</span><span class="sxs-lookup"><span data-stu-id="381d0-106">A name may represent:</span></span>

- <span data-ttu-id="381d0-107">тип;</span><span class="sxs-lookup"><span data-stu-id="381d0-107">a type</span></span>
- <span data-ttu-id="381d0-108">поле;</span><span class="sxs-lookup"><span data-stu-id="381d0-108">a field</span></span>
- <span data-ttu-id="381d0-109">метод;</span><span class="sxs-lookup"><span data-stu-id="381d0-109">a method</span></span>
- <span data-ttu-id="381d0-110">локальную переменную.</span><span class="sxs-lookup"><span data-stu-id="381d0-110">a local variable</span></span>

<span data-ttu-id="381d0-111">Хотя каждый из этих элементов имеет уникальные отличия, чтобы определить, на какой из них ссылается идентификатор, часто требуется хорошо разбираться в правилах языка.</span><span class="sxs-lookup"><span data-stu-id="381d0-111">Although each of these is uniquely different, determining which one an identifier actually refers to often requires a deep understanding of the language rules.</span></span>

<span data-ttu-id="381d0-112">В исходном коде представлены программные элементы, а программы также могут ссылаться на ранее скомпилированные библиотеки, упакованные в файлы сборки.</span><span class="sxs-lookup"><span data-stu-id="381d0-112">There are program elements represented in source code, and programs can also refer to previously compiled libraries, packaged in assembly files.</span></span> <span data-ttu-id="381d0-113">Хотя исходный код, а, следовательно, и синтаксические узлы и деревья синтаксиса для сборок недоступны, программы по-прежнему могут ссылаться на элементы внутри них.</span><span class="sxs-lookup"><span data-stu-id="381d0-113">Although no source code, and therefore no syntax nodes or trees, are available for assemblies, programs can still refer to elements inside them.</span></span>

<span data-ttu-id="381d0-114">Для этих задач требуется **семантическая модель**.</span><span class="sxs-lookup"><span data-stu-id="381d0-114">For those tasks, you need the **Semantic model**.</span></span>

<span data-ttu-id="381d0-115">Дополняя синтаксическую модель исходного кода, семантическая модель инкапсулирует правила языка, позволяя вам легко соотнести идентификаторы с программным элементом, на который указывает ссылка.</span><span class="sxs-lookup"><span data-stu-id="381d0-115">In addition to a syntactic model of the source code, a semantic model encapsulates the language rules, giving you an easy way to correctly match identifiers with the correct program element being referenced.</span></span>

## <a name="compilation"></a><span data-ttu-id="381d0-116">Компиляция</span><span class="sxs-lookup"><span data-stu-id="381d0-116">Compilation</span></span>

<span data-ttu-id="381d0-117">Компиляция является представлением всего, что необходимо для компиляции программы C# или Visual Basic, куда входят все ссылки на сборки, параметры компилятора и исходные файлы.</span><span class="sxs-lookup"><span data-stu-id="381d0-117">A compilation is a representation of everything needed to compile a C# or Visual Basic program, which includes all the assembly references, compiler options, and source files.</span></span>

<span data-ttu-id="381d0-118">Так как эти сведения находятся в одном месте, элементы, содержащиеся в исходном коде, можно описать более подробно.</span><span class="sxs-lookup"><span data-stu-id="381d0-118">Because all this information is in one place, the elements contained in the source code can be described in more detail.</span></span> <span data-ttu-id="381d0-119">Компиляция представляет каждый объявленный тип, член или переменную в виде символа.</span><span class="sxs-lookup"><span data-stu-id="381d0-119">The compilation represents each declared type, member, or variable as a symbol.</span></span> <span data-ttu-id="381d0-120">Компиляция содержит различные методы, помогающие найти и соотнести символы, которые были объявлены в исходном коде или импортированы в виде метаданных из сборки.</span><span class="sxs-lookup"><span data-stu-id="381d0-120">The compilation contains a variety of methods that help you find and relate the symbols that have either been declared in the source code or imported as metadata from an assembly.</span></span>

<span data-ttu-id="381d0-121">Аналогично деревьям синтаксиса компиляции являются неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="381d0-121">Similar to syntax trees, compilations are immutable.</span></span> <span data-ttu-id="381d0-122">После создания компиляция не может быть изменена ни вами, ни другим человеком, совместно с которым вы ее используете.</span><span class="sxs-lookup"><span data-stu-id="381d0-122">After you create a compilation, it cannot be changed by you or anyone else you might be sharing it with.</span></span> <span data-ttu-id="381d0-123">Однако вы можете создать компиляцию из существующей компиляции, указав при этом некоторое изменение.</span><span class="sxs-lookup"><span data-stu-id="381d0-123">However, you can create a new compilation from an existing compilation, specifying a change as you do so.</span></span> <span data-ttu-id="381d0-124">Например, можно создать компиляцию, которая во всем аналогична существующей компиляции, за исключением того, что она может включать дополнительный исходный файл или ссылку на сборку.</span><span class="sxs-lookup"><span data-stu-id="381d0-124">For example, you might create a compilation that is the same in every way as an existing compilation, except it may include an additional source file or assembly reference.</span></span>

## <a name="symbols"></a><span data-ttu-id="381d0-125">Символы</span><span class="sxs-lookup"><span data-stu-id="381d0-125">Symbols</span></span>

<span data-ttu-id="381d0-126">Символ представляет отдельный элемент, объявленный исходным кодом или импортированный из сборки в виде метаданных.</span><span class="sxs-lookup"><span data-stu-id="381d0-126">A symbol represents a distinct element declared by the source code or imported from an assembly as metadata.</span></span> <span data-ttu-id="381d0-127">Символом представлены все пространства имен, типы, методы, свойства, поля, события, параметры или локальные переменные.</span><span class="sxs-lookup"><span data-stu-id="381d0-127">Every namespace, type, method, property, field, event, parameter, or local variable is represented by a symbol.</span></span>

<span data-ttu-id="381d0-128">Различные методы и свойства в типе <xref:Microsoft.CodeAnalysis.Compilation> помогают вам искать символы.</span><span class="sxs-lookup"><span data-stu-id="381d0-128">A variety of methods and properties on the <xref:Microsoft.CodeAnalysis.Compilation> type help you find symbols.</span></span> <span data-ttu-id="381d0-129">Например, можно найти символ для объявленного типа по его общему имени метаданных.</span><span class="sxs-lookup"><span data-stu-id="381d0-129">For example, you can find a symbol for a declared type by its common metadata name.</span></span> <span data-ttu-id="381d0-130">Можно также получить доступ к целой таблице символов в виде дерева, корнем которого является глобальное пространство имен.</span><span class="sxs-lookup"><span data-stu-id="381d0-130">You can also access the entire symbol table as a tree of symbols rooted by the global namespace.</span></span>

<span data-ttu-id="381d0-131">Символы также содержат дополнительную информацию, которую компилятор определяет из источника или метаданных, например другие символы, на которые указывает ссылка.</span><span class="sxs-lookup"><span data-stu-id="381d0-131">Symbols also contain additional information that the compiler determines from the source or metadata, such as other referenced symbols.</span></span> <span data-ttu-id="381d0-132">Каждый тип символа представлен отдельным интерфейсом, производным от <xref:Microsoft.CodeAnalysis.ISymbol>, а также имеет собственные методы и свойства, описывающие собранные компилятором сведения.</span><span class="sxs-lookup"><span data-stu-id="381d0-132">Each kind of symbol is represented by a separate interface derived from <xref:Microsoft.CodeAnalysis.ISymbol>, each with its own methods and properties detailing the information the compiler has gathered.</span></span> <span data-ttu-id="381d0-133">Многие из этих свойств напрямую ссылаются на другие символы.</span><span class="sxs-lookup"><span data-stu-id="381d0-133">Many of these properties directly reference other symbols.</span></span> <span data-ttu-id="381d0-134">Например, свойство <xref:Microsoft.CodeAnalysis.IMethodSymbol.ReturnType?displayProperty=nameWithType> сообщает вам фактический символ типа, который возвращает метод.</span><span class="sxs-lookup"><span data-stu-id="381d0-134">For example, the <xref:Microsoft.CodeAnalysis.IMethodSymbol.ReturnType?displayProperty=nameWithType> property tells you the actual type symbol that the method returns.</span></span>

<span data-ttu-id="381d0-135">Символы представляют общее представление пространств имен, типов и членов между исходным кодом и метаданными.</span><span class="sxs-lookup"><span data-stu-id="381d0-135">Symbols present a common representation of namespaces, types, and members, between source code and metadata.</span></span> <span data-ttu-id="381d0-136">Например, метод, который был объявлен в исходном коде, и метод, который был импортирован из метаданных, оба представлены <xref:Microsoft.CodeAnalysis.IMethodSymbol> с одинаковыми свойствами.</span><span class="sxs-lookup"><span data-stu-id="381d0-136">For example, a method that was declared in source code and a method that was imported from metadata are both represented by an <xref:Microsoft.CodeAnalysis.IMethodSymbol> with the same properties.</span></span>

<span data-ttu-id="381d0-137">По своей сути символы похожи на систему типов среды CLR, представленную API <xref:System.Reflection>, однако их возможности шире, так как они моделируют не только типы.</span><span class="sxs-lookup"><span data-stu-id="381d0-137">Symbols are similar in concept to the CLR type system as represented by the <xref:System.Reflection> API, yet they are richer in that they model more than just types.</span></span> <span data-ttu-id="381d0-138">Пространства имен, локальные переменные и метки — все это символы.</span><span class="sxs-lookup"><span data-stu-id="381d0-138">Namespaces, local variables, and labels are all symbols.</span></span> <span data-ttu-id="381d0-139">Кроме того, символы являются представлением концепций языка, а не концепций среды CLR.</span><span class="sxs-lookup"><span data-stu-id="381d0-139">In addition, symbols are a representation of language concepts, not CLR concepts.</span></span> <span data-ttu-id="381d0-140">Есть много похожего, но имеется и большое количество значимых различий.</span><span class="sxs-lookup"><span data-stu-id="381d0-140">There is a lot of overlap, but there are many meaningful distinctions as well.</span></span> <span data-ttu-id="381d0-141">Например, метод итератора в C# или Visual Basic является отдельным символом.</span><span class="sxs-lookup"><span data-stu-id="381d0-141">For instance, an iterator method in C# or Visual Basic is a single symbol.</span></span> <span data-ttu-id="381d0-142">Однако когда метод итератора преобразуется в метаданные среды CLR, он превращается в тип и несколько методов.</span><span class="sxs-lookup"><span data-stu-id="381d0-142">However, when the iterator method is translated to CLR metadata, it is a type and multiple methods.</span></span>

## <a name="semantic-model"></a><span data-ttu-id="381d0-143">Семантическая модель</span><span class="sxs-lookup"><span data-stu-id="381d0-143">Semantic model</span></span>

<span data-ttu-id="381d0-144">Семантическая модель представляет всю семантическую информацию для одного исходного файла.</span><span class="sxs-lookup"><span data-stu-id="381d0-144">A semantic model represents all the semantic information for a single source file.</span></span> <span data-ttu-id="381d0-145">Ее можно использовать для обнаружения:</span><span class="sxs-lookup"><span data-stu-id="381d0-145">You can use it to discover the following:</span></span>

- <span data-ttu-id="381d0-146">символов, на которые указывает ссылка в определенном месте в исходном коде;</span><span class="sxs-lookup"><span data-stu-id="381d0-146">The symbols referenced at a specific location in source.</span></span>
- <span data-ttu-id="381d0-147">результирующего типа выражения;</span><span class="sxs-lookup"><span data-stu-id="381d0-147">The resultant type of any expression.</span></span>
- <span data-ttu-id="381d0-148">всех данных диагностики, относящихся к ошибкам и предупреждениям;</span><span class="sxs-lookup"><span data-stu-id="381d0-148">All diagnostics, which are errors and warnings.</span></span>
- <span data-ttu-id="381d0-149">перемещений переменных в регионы исходного кода и из них;</span><span class="sxs-lookup"><span data-stu-id="381d0-149">How variables flow in and out of regions of source.</span></span>
- <span data-ttu-id="381d0-150">ответов на более отвлеченные вопросы.</span><span class="sxs-lookup"><span data-stu-id="381d0-150">The answers to more speculative questions.</span></span>
